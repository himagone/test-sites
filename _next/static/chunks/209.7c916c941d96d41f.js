"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[209],{193:(e,t,r)=>{r.d(t,{A:()=>i});function i(e){let t,r={};return i=>{for(let s in i)if(!function(e,t){if(e===t)return!0;if(Array.isArray(e)){let r=e.length;if(!t||t.length!==r)return!1;for(let i=0;i<r;i++)if(e[i]!==t[i])return!1;return!0}return!1}(i[s],r[s])){t=e(i),r=i;break}return t}}},609:(e,t,r)=>{r.d(t,{h:()=>s});var i=r(32167);class s extends i.F{static defaultProps={...i.F.defaultProps,usage:0,byteLength:0,byteOffset:0,data:null,indexType:"uint16",mappedAtCreation:!1};static MAP_READ=1;static MAP_WRITE=2;static COPY_SRC=4;static COPY_DST=8;static INDEX=16;static VERTEX=32;static UNIFORM=64;static STORAGE=128;static INDIRECT=256;static QUERY_RESOLVE=512;get[Symbol.toStringTag](){return"Buffer"}usage;indexType;updateTimestamp;constructor(e,t){let r={...t};(t.usage||0)&s.INDEX&&!t.indexType&&(t.data instanceof Uint32Array?r.indexType="uint32":t.data instanceof Uint16Array&&(r.indexType="uint16")),delete r.data,super(e,r,s.defaultProps),this.usage=r.usage||0,this.indexType=r.indexType,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createBuffer({...this.props,...e})}readSyncWebGL(e,t){throw Error("not implemented")}static DEBUG_DATA_MAX_LENGTH=32;debugData=new ArrayBuffer(0);_setDebugData(e,t,r){let i=ArrayBuffer.isView(e)?e.buffer:e,n=Math.min(e?e.byteLength:r,s.DEBUG_DATA_MAX_LENGTH);null===i?this.debugData=new ArrayBuffer(n):0===t&&r===i.byteLength?this.debugData=i.slice(0,n):this.debugData=i.slice(t,t+n)}}},1673:(e,t,r)=>{let i;r.d(t,{P:()=>u});var s=r(53028),n=r(75031),o=r(73801),a=r(36389),l=r(70715);let h=[0,0,0];class u extends s.M{static get ZERO(){return i||Object.freeze(i=new u(0,0,0)),i}constructor(e=0,t=0,r=0){super(-0,-0,-0),1==arguments.length&&(0,n.cy)(e)?this.copy(e):(n.$W.debug&&((0,o.ws)(e),(0,o.ws)(t),(0,o.ws)(r)),this[0]=e,this[1]=t,this[2]=r)}set(e,t,r){return this[0]=e,this[1]=t,this[2]=r,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this.check()}fromObject(e){return n.$W.debug&&((0,o.ws)(e.x),(0,o.ws)(e.y),(0,o.ws)(e.z)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e}get ELEMENTS(){return 3}get z(){return this[2]}set z(e){this[2]=(0,o.ws)(e)}angle(e){return(0,a.g7)(this,e)}cross(e){return(0,a.$A)(this,this,e),this.check()}rotateX({radians:e,origin:t=h}){return(0,a.eL)(this,this,t,e),this.check()}rotateY({radians:e,origin:t=h}){return(0,a.Z8)(this,this,t,e),this.check()}rotateZ({radians:e,origin:t=h}){return(0,a.x6)(this,this,t,e),this.check()}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return(0,a.Z0)(this,this,e),this.check()}transformAsVector(e){return(0,l.cL)(this,this,e),this.check()}transformByMatrix3(e){return(0,a.ei)(this,this,e),this.check()}transformByMatrix2(e){return(0,l.J4)(this,this,e),this.check()}transformByQuaternion(e){return(0,a.gL)(this,this,e),this.check()}}},5229:(e,t,r)=>{r.d(t,{a:()=>s});var i=r(75031);class s extends Array{clone(){return new this.constructor().copy(this)}fromArray(e,t=0){for(let r=0;r<this.ELEMENTS;++r)this[r]=e[r+t];return this.check()}toArray(e=[],t=0){for(let r=0;r<this.ELEMENTS;++r)e[t+r]=this[r];return e}toObject(e){return e}from(e){return Array.isArray(e)?this.copy(e):this.fromObject(e)}to(e){return e===this?this:(0,i.cy)(e)?this.toArray(e):this.toObject(e)}toTarget(e){return e?this.to(e):this}toFloat32Array(){return new Float32Array(this)}toString(){return this.formatString(i.$W)}formatString(e){let t="";for(let r=0;r<this.ELEMENTS;++r)t+=(r>0?", ":"")+(0,i.Fl)(this[r],e);return`${e.printTypes?this.constructor.name:""}[${t}]`}equals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(!(0,i.aI)(this[t],e[t]))return!1;return!0}exactEquals(e){if(!e||this.length!==e.length)return!1;for(let t=0;t<this.ELEMENTS;++t)if(this[t]!==e[t])return!1;return!0}negate(){for(let e=0;e<this.ELEMENTS;++e)this[e]=-this[e];return this.check()}lerp(e,t,r){if(void 0===r)return this.lerp(this,e,t);for(let i=0;i<this.ELEMENTS;++i){let s=e[i],n="number"==typeof t?t:t[i];this[i]=s+r*(n-s)}return this.check()}min(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.min(e[t],this[t]);return this.check()}max(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=Math.max(e[t],this[t]);return this.check()}clamp(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e[r]),t[r]);return this.check()}add(...e){for(let t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]+=t[e];return this.check()}subtract(...e){for(let t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]-=t[e];return this.check()}scale(e){if("number"==typeof e)for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;else for(let t=0;t<this.ELEMENTS&&t<e.length;++t)this[t]*=e[t];return this.check()}multiplyByScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}check(){if(i.$W.debug&&!this.validate())throw Error(`math.gl: ${this.constructor.name} some fields set to invalid numbers'`);return this}validate(){let e=this.length===this.ELEMENTS;for(let t=0;t<this.ELEMENTS;++t)e=e&&Number.isFinite(this[t]);return e}sub(e){return this.subtract(e)}setScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]=e;return this.check()}addScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]+=e;return this.check()}subScalar(e){return this.addScalar(-e)}multiplyScalar(e){for(let t=0;t<this.ELEMENTS;++t)this[t]*=e;return this.check()}divideScalar(e){return this.multiplyByScalar(1/e)}clampScalar(e,t){for(let r=0;r<this.ELEMENTS;++r)this[r]=Math.min(Math.max(this[r],e),t);return this.check()}get elements(){return this}}},7840:(e,t,r)=>{r.d(t,{Uz:()=>o});var i=r(49509);function s(){let e;if("undefined"!=typeof window&&window.performance)e=window.performance.now();else if(void 0!==i&&i.hrtime){let t=i.hrtime();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}class n{constructor(e,t){this.sampleSize=1,this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this.name=e,this.type=t,this.reset()}reset(){return this.time=0,this.count=0,this.samples=0,this.lastTiming=0,this.lastSampleTime=0,this.lastSampleCount=0,this._count=0,this._time=0,this._samples=0,this._startTime=0,this._timerPending=!1,this}setSampleSize(e){return this.sampleSize=e,this}incrementCount(){return this.addCount(1),this}decrementCount(){return this.subtractCount(1),this}addCount(e){return this._count+=e,this._samples++,this._checkSampling(),this}subtractCount(e){return this._count-=e,this._samples++,this._checkSampling(),this}addTime(e){return this._time+=e,this.lastTiming=e,this._samples++,this._checkSampling(),this}timeStart(){return this._startTime=s(),this._timerPending=!0,this}timeEnd(){return this._timerPending&&(this.addTime(s()-this._startTime),this._timerPending=!1,this._checkSampling()),this}getSampleAverageCount(){return this.sampleSize>0?this.lastSampleCount/this.sampleSize:0}getSampleAverageTime(){return this.sampleSize>0?this.lastSampleTime/this.sampleSize:0}getSampleHz(){return this.lastSampleTime>0?this.sampleSize/(this.lastSampleTime/1e3):0}getAverageCount(){return this.samples>0?this.count/this.samples:0}getAverageTime(){return this.samples>0?this.time/this.samples:0}getHz(){return this.time>0?this.samples/(this.time/1e3):0}_checkSampling(){this._samples===this.sampleSize&&(this.lastSampleTime=this._time,this.lastSampleCount=this._count,this.count+=this._count,this.time+=this._time,this.samples+=this._samples,this._time=0,this._count=0,this._samples=0)}}class o{constructor(e){this.stats={},this.id=e.id,this.stats={},this._initializeStats(e.stats),Object.seal(this)}get(e,t="count"){return this._getOrCreate({name:e,type:t})}get size(){return Object.keys(this.stats).length}reset(){for(let e of Object.values(this.stats))e.reset();return this}forEach(e){for(let t of Object.values(this.stats))e(t)}getTable(){let e={};return this.forEach(t=>{e[t.name]={time:t.time||0,count:t.count||0,average:t.getAverageTime()||0,hz:t.getHz()||0}}),e}_initializeStats(e=[]){e.forEach(e=>this._getOrCreate(e))}_getOrCreate(e){let{name:t,type:r}=e,i=this.stats[t];return i||(i=e instanceof n?e:new n(t,r),this.stats[t]=i),i}}},10184:(e,t,r)=>{r.d(t,{X:()=>s});var i=r(32167);class s extends i.F{static defaultProps={...i.F.defaultProps,format:void 0,dimension:void 0,aspect:"all",baseMipLevel:0,mipLevelCount:void 0,baseArrayLayer:0,arrayLayerCount:void 0};get[Symbol.toStringTag](){return"TextureView"}constructor(e,t){super(e,t,s.defaultProps)}}},11179:(e,t,r)=>{r.d(t,{ZG:()=>a,$g:()=>o});let i={number:{type:"number",validate:(e,t)=>Number.isFinite(e)&&"object"==typeof t&&(void 0===t.max||e<=t.max)&&(void 0===t.min||e>=t.min)},array:{type:"array",validate:(e,t)=>Array.isArray(e)||ArrayBuffer.isView(e)}};function s(e){return Array.isArray(e)||ArrayBuffer.isView(e)?"array":typeof e}var n=r(18117);function o(e){e.map(e=>(function(e){var t;if(e.instance)return;o(e.dependencies||[]);let{propTypes:r={},deprecations:a=[],inject:l={}}=e,h={normalizedInjections:(0,n.Uu)(l),parsedDeprecations:((t=a).forEach(e=>{"function"===e.type?e.regex=RegExp(`\\b${e.old}\\(`):e.regex=RegExp(`${e.type} ${e.old};`)}),t)};r&&(h.propValidators=function(e){let t={};for(let[r,n]of Object.entries(e))t[r]=function(e){let t=s(e);if("object"!==t)return{value:e,...i[t],type:t};if("object"==typeof e)return e?void 0!==e.type?{...e,...i[e.type],type:e.type}:void 0===e.value?{type:"object",value:e}:(t=s(e.value),{...e,...i[t],type:t}):{type:"object",value:null};throw Error("props")}(n);return t}(r)),e.instance=h;let u={};r&&(u=Object.entries(r).reduce((e,[t,r])=>{let i=r?.value;return i&&(e[t]=i),e},{})),e.defaultUniforms={...e.defaultUniforms,...u}})(e))}function a(e,t,r){e.deprecations?.forEach(e=>{e.regex?.test(t)&&(e.deprecated?r.deprecated(e.old,e.new)():r.removed(e.old,e.new)())})}},11304:(e,t,r)=>{let i;function s(e){return(!i||i.byteLength<e)&&(i=new ArrayBuffer(e)),i}function n(e,t){let r=s(e.BYTES_PER_ELEMENT*t);return new e(r,0,t)}r.d(t,{X:()=>n,o:()=>s})},11867:(e,t,r)=>{r.d(t,{A:()=>s});class i{constructor(e={}){this._pool=[],this.opts={overAlloc:2,poolSize:100},this.setOptions(e)}setOptions(e){Object.assign(this.opts,e)}allocate(e,t,{size:r=1,type:i,padding:s=0,copy:n=!1,initialize:o=!1,maxCount:a}){let l=i||e&&e.constructor||Float32Array,h=t*r+s;if(ArrayBuffer.isView(e)){if(h<=e.length)return e;if(h*e.BYTES_PER_ELEMENT<=e.buffer.byteLength)return new l(e.buffer,0,h)}let u=1/0;a&&(u=a*r+s);let c=this._allocate(l,h,o,u);return e&&n?c.set(e):o||c.fill(0,0,4),this._release(e),c}release(e){this._release(e)}_allocate(e,t,r,i){let s=Math.max(Math.ceil(t*this.opts.overAlloc),1);s>i&&(s=i);let n=this._pool,o=e.BYTES_PER_ELEMENT*s,a=n.findIndex(e=>e.byteLength>=o);if(a>=0){let t=new e(n.splice(a,1)[0],0,s);return r&&t.fill(0),t}return new e(s)}_release(e){if(!ArrayBuffer.isView(e))return;let t=this._pool,{buffer:r}=e,{byteLength:i}=r,s=t.findIndex(e=>e.byteLength>=i);s<0?t.push(r):(s>0||t.length<this.opts.poolSize)&&t.splice(s,0,r),t.length>this.opts.poolSize&&t.shift()}}let s=new i},14080:(e,t,r)=>{r.d(t,{v:()=>i});function i(e,t){if(!e)throw Error(t||"loader assertion failed.")}},14569:(e,t,r)=>{r.d(t,{pp:()=>c,K2:()=>u,a5:()=>d});var i=r(37941);let s=new(r(43558)).t({id:"loaders.gl"});class n{log(){return()=>{}}info(){return()=>{}}warn(){return()=>{}}error(){return()=>{}}}class o{console;constructor(){this.console=console}log(...e){return this.console.log.bind(this.console,...e)}info(...e){return this.console.info.bind(this.console,...e)}warn(...e){return this.console.warn.bind(this.console,...e)}error(...e){return this.console.error.bind(this.console,...e)}}var a=r(30358);let l={fetch:null,mimeType:void 0,nothrow:!1,log:new o,useLocalLibraries:!1,CDN:"https://unpkg.com/@loaders.gl",worker:!0,maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:a.Bd,_nodeWorkers:!1,_workerType:"",limit:0,_limitMB:0,batchSize:"auto",batchDebounceMs:0,metadata:!1,transforms:[]},h={throws:"nothrow",dataType:"(no longer used)",uri:"baseUri",method:"fetch.method",headers:"fetch.headers",body:"fetch.body",mode:"fetch.mode",credentials:"fetch.credentials",cache:"fetch.cache",redirect:"fetch.redirect",referrer:"fetch.referrer",referrerPolicy:"fetch.referrerPolicy",integrity:"fetch.integrity",keepalive:"fetch.keepalive",signal:"fetch.signal"};function u(){globalThis.loaders=globalThis.loaders||{};let{loaders:e}=globalThis;return e._state||(e._state={}),e._state}function c(){let e=u();return e.globalOptions=e.globalOptions||{...l},e.globalOptions}function d(e,t,r,i){return function(e,t){for(let r of(f(e,null,l,h,t),t)){let i=e&&e[r.id]||{},s=r.options&&r.options[r.id]||{},n=r.deprecatedOptions&&r.deprecatedOptions[r.id]||{};f(i,r.id,s,n,t)}}(e,r=Array.isArray(r=r||[])?r:[r]),function(e,t,r){var i,s;let o={...e.options||{}};return i=o,!(s=r)||"baseUri"in i||(i.baseUri=s),null===o.log&&(o.log=new n),p(o,c()),p(o,t),o}(t,e,i)}function f(e,t,r,n,o){let a=t||"Top level",l=t?`${t}.`:"";for(let h in e){let u=!t&&(0,i.Gv)(e[h]),c="baseUri"===h&&!t,d="workerUrl"===h&&t;if(!(h in r)&&!c&&!d){if(h in n)s.warn(`${a} loader option '${l}${h}' no longer supported, use '${n[h]}'`)();else if(!u){let e=function(e,t){let r=e.toLowerCase(),i="";for(let s of t)for(let t in s.options){if(e===t)return`Did you mean '${s.id}.${t}'?`;let n=t.toLowerCase();(r.startsWith(n)||n.startsWith(r))&&(i=i||`Did you mean '${s.id}.${t}'?`)}return i}(h,o);s.warn(`${a} loader option '${l}${h}' not recognized. ${e}`)()}}}}function p(e,t){for(let r in t)if(r in t){let s=t[r];(0,i.aC)(s)&&(0,i.aC)(e[r])?e[r]={...e[r],...t[r]}:e[r]=t[r]}}},15026:(e,t,r)=>{r.d(t,{H9:()=>i});function i(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)||!!Array.isArray(e)&&(0===e.length||"number"==typeof e[0])}},15101:(e,t,r)=>{r.d(t,{L:()=>s});var i=r(32167);class s extends i.F{static defaultProps={...i.F.defaultProps,type:"color-sampler",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge",addressModeW:"clamp-to-edge",magFilter:"nearest",minFilter:"nearest",mipmapFilter:"none",lodMinClamp:0,lodMaxClamp:32,compare:"less-equal",maxAnisotropy:1};get[Symbol.toStringTag](){return"Sampler"}constructor(e,t){super(e,t=s.normalizeProps(e,t),s.defaultProps)}static normalizeProps(e,t){let r=e?.props?._resourceDefaults?.sampler||{};return{...t,...r}}}},15273:(e,t,r)=>{let i;r.d(t,{$M:()=>o,Vl:()=>l,_Z:()=>f,cT:()=>d,on:()=>h,zi:()=>a});var s=r(11867),n=r(1673);function o(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function a(e,t){let r=e%t;return r<0?t+r:r}function l(e){return[e[12],e[13],e[14]]}function h(e){return{left:c(e[3]+e[0],e[7]+e[4],e[11]+e[8],e[15]+e[12]),right:c(e[3]-e[0],e[7]-e[4],e[11]-e[8],e[15]-e[12]),bottom:c(e[3]+e[1],e[7]+e[5],e[11]+e[9],e[15]+e[13]),top:c(e[3]-e[1],e[7]-e[5],e[11]-e[9],e[15]-e[13]),near:c(e[3]+e[2],e[7]+e[6],e[11]+e[10],e[15]+e[14]),far:c(e[3]-e[2],e[7]-e[6],e[11]-e[10],e[15]-e[14])}}let u=new n.P;function c(e,t,r,i){u.set(e,t,r);let s=u.len();return{distance:i/s,normal:new n.P(-e/s,-t/s,-r/s)}}function d(e,t){let{size:r=1,startIndex:n=0}=t,o=void 0!==t.endIndex?t.endIndex:e.length,a=(o-n)/r;i=s.A.allocate(i,a,{type:Float32Array,size:2*r});let l=n,h=0;for(;l<o;){for(let t=0;t<r;t++){let s=e[l++];i[h+t]=s,i[h+t+r]=s-Math.fround(s)}h+=2*r}return i.subarray(0,a*r*2)}function f(e){let t=null,r=!1;for(let i of e)i&&(t?(r||(t=[[t[0][0],t[0][1]],[t[1][0],t[1][1]]],r=!0),t[0][0]=Math.min(t[0][0],i[0][0]),t[0][1]=Math.min(t[0][1],i[0][1]),t[1][0]=Math.max(t[1][0],i[1][0]),t[1][1]=Math.max(t[1][1],i[1][1])):t=i);return t}},16186:(e,t,r)=>{r.d(t,{A:()=>h});var i=r(53135),s=r(81465),n=r(75031),o=r(74502),a=r(42538);class l extends i.A{constructor(e={}){let t;let{latitude:r=0,longitude:i=0,zoom:a=0,pitch:l=0,bearing:h=0,nearZMultiplier:u=.1,farZMultiplier:c=1.01,nearZ:d,farZ:f,orthographic:p=!1,projectionMatrix:g,repeat:m=!1,worldOffset:_=0,position:A,padding:E,legacyMeterSizes:b=!1}=e,{width:y,height:T,altitude:C=1.5}=e,v=Math.pow(2,a);y=y||1,T=T||1;let R=null;if(g)C=g[5]/2,t=(0,s.Os)(C);else{let i;if(e.fovy?(t=e.fovy,C=(0,s.wZ)(t)):t=(0,s.Os)(C),E){let{top:e=0,bottom:t=0}=E;i=[0,(0,n.qE)((e+T-t)/2,0,T)-T/2]}R=(0,s.om)({width:y,height:T,scale:v,center:A&&[0,0,A[2]*(0,s.mY)(r)],offset:i,pitch:l,fovy:t,nearZMultiplier:u,farZMultiplier:c}),Number.isFinite(d)&&(R.near=d),Number.isFinite(f)&&(R.far=f)}let S=(0,s.rY)({height:T,pitch:l,bearing:h,scale:v,altitude:C});_&&(S=new o.k().translate([512*_,0,0]).multiplyLeft(S)),super({...e,width:y,height:T,viewMatrix:S,longitude:i,latitude:r,zoom:a,...R,fovy:t,focalDistance:C}),this.latitude=r,this.longitude=i,this.zoom=a,this.pitch=l,this.bearing=h,this.altitude=C,this.fovy=t,this.orthographic=p,this._subViewports=m?[]:null,this._pseudoMeters=b,Object.freeze(this)}get subViewports(){if(this._subViewports&&!this._subViewports.length){let e=this.getBounds(),t=Math.floor((e[0]+180)/360),r=Math.ceil((e[2]-180)/360);for(let e=t;e<=r;e++){let t=e?new l({...this,worldOffset:e}):this;this._subViewports.push(t)}}return this._subViewports}projectPosition(e){if(this._pseudoMeters)return super.projectPosition(e);let[t,r]=this.projectFlat(e);return[t,r,(e[2]||0)*(0,s.mY)(e[1])]}unprojectPosition(e){if(this._pseudoMeters)return super.unprojectPosition(e);let[t,r]=this.unprojectFlat(e),i=(e[2]||0)/(0,s.mY)(r);return[t,r,i]}addMetersToLngLat(e,t){return(0,s.dT)(e,t)}panByPosition(e,t){let r=(0,s.xJ)(t,this.pixelUnprojectionMatrix),i=this.projectFlat(e),n=a.WQ([],i,a.ze([],r)),o=a.WQ([],this.center,n),[l,h]=this.unprojectFlat(o);return{longitude:l,latitude:h}}getBounds(e={}){let t=(0,s.gW)(this,e.z||0);return[Math.min(t[0][0],t[1][0],t[2][0],t[3][0]),Math.min(t[0][1],t[1][1],t[2][1],t[3][1]),Math.max(t[0][0],t[1][0],t[2][0],t[3][0]),Math.max(t[0][1],t[1][1],t[2][1],t[3][1])]}fitBounds(e,t={}){let{width:r,height:i}=this,{longitude:n,latitude:o,zoom:a}=(0,s.Fe)({width:r,height:i,bounds:e,...t});return new l({width:r,height:i,longitude:n,latitude:o,zoom:a})}}l.displayName="WebMercatorViewport";let h=l},18117:(e,t,r)=>{r.d(t,{O_:()=>a,bv:()=>h,Uu:()=>l});let i={vertex:`\
#ifdef MODULE_LOGDEPTH
  logdepth_adjustPosition(gl_Position);
#endif
`,fragment:`\
#ifdef MODULE_MATERIAL
  fragColor = material_filterColor(fragColor);
#endif

#ifdef MODULE_LIGHTING
  fragColor = lighting_filterColor(fragColor);
#endif

#ifdef MODULE_FOG
  fragColor = fog_filterColor(fragColor);
#endif

#ifdef MODULE_PICKING
  fragColor = picking_filterHighlightColor(fragColor);
  fragColor = picking_filterPickingColor(fragColor);
#endif

#ifdef MODULE_LOGDEPTH
  logdepth_setFragDepth();
#endif
`},s=/void\s+main\s*\([^)]*\)\s*\{\n?/,n=/}\n?[^{}]*$/,o=[],a="__LUMA_INJECT_DECLARATIONS__";function l(e){let t={vertex:{},fragment:{}};for(let r in e){let i=e[r];"string"==typeof i&&(i={order:0,injection:i}),t[function(e){let t=e.slice(0,2);switch(t){case"vs":return"vertex";case"fs":return"fragment";default:throw Error(t)}}(r)][r]=i}return t}function h(e,t,r,l=!1){let u="vertex"===t;for(let t in r){let i=r[t];i.sort((e,t)=>e.order-t.order),o.length=i.length;for(let e=0,t=i.length;e<t;++e)o[e]=i[e].injection;let l=`${o.join("\n")}
`;switch(t){case"vs:#decl":u&&(e=e.replace(a,l));break;case"vs:#main-start":u&&(e=e.replace(s,e=>e+l));break;case"vs:#main-end":u&&(e=e.replace(n,e=>l+e));break;case"fs:#decl":u||(e=e.replace(a,l));break;case"fs:#main-start":u||(e=e.replace(s,e=>e+l));break;case"fs:#main-end":u||(e=e.replace(n,e=>l+e));break;default:e=e.replace(t,e=>e+l)}}return e=e.replace(a,""),l&&(e=e.replace(/\}\s*$/,e=>e+i[t])),e}},20613:(e,t,r)=>{r.d(t,{Q:()=>s,x:()=>i});let i="latest",s=(!globalThis._loadersgl_?.version&&(globalThis._loadersgl_=globalThis._loadersgl_||{},globalThis._loadersgl_.version="4.3.2"),globalThis._loadersgl_.version)},20761:(e,t,r)=>{r.d(t,{$:()=>T});var i=r(14080),s=r(30358);let n=globalThis.loaders?.parseImageNode,o="undefined"!=typeof Image,a="undefined"!=typeof ImageBitmap,l=!!s.Bd||!!n;var h=r(75331);let u=/^data:image\/svg\+xml/,c=/\.svg((\?|#).*)?$/;function d(e){return e&&(u.test(e)||c.test(e))}function f(e,t){if(d(t))throw Error("SVG cannot be parsed directly to imagebitmap");return new Blob([new Uint8Array(e)])}async function p(e,t,r){let i=function(e,t){if(d(t)){let t=new TextDecoder().decode(e);try{"function"==typeof unescape&&"function"==typeof encodeURIComponent&&(t=unescape(encodeURIComponent(t)))}catch(e){throw Error(e.message)}return`data:image/svg+xml;base64,${btoa(t)}`}return f(e,t)}(e,r),s=self.URL||self.webkitURL,n="string"!=typeof i&&s.createObjectURL(i);try{return await g(n||i,t)}finally{n&&s.revokeObjectURL(n)}}async function g(e,t){let r=new Image;return(r.src=e,t.image&&t.image.decode&&r.decode)?(await r.decode(),r):await new Promise((e,t)=>{try{r.onload=()=>e(r),r.onerror=e=>{let r=e instanceof Error?e.message:"error";t(Error(r))}}catch(e){t(e)}})}let m={},_=!0;async function A(e,t,r){let i;i=d(r)?await p(e,t,r):f(e,r);let s=t&&t.imagebitmap;return await E(i,s)}async function E(e,t=null){if((function(e){for(let t in e||m)return!1;return!0}(t)||!_)&&(t=null),t)try{return await createImageBitmap(e,t)}catch(e){console.warn(e),_=!1}return await createImageBitmap(e)}var b=r(65744);async function y(e,t){let{mimeType:r}=(0,b.m)(e)||{},s=globalThis.loaders?.parseImageNode;return(0,i.v)(s),await s(e,r)}let T={dataType:null,batchType:null,id:"image",module:"images",name:"Images",version:"4.3.2",mimeTypes:["image/png","image/jpeg","image/gif","image/webp","image/avif","image/bmp","image/vnd.microsoft.icon","image/svg+xml"],extensions:["png","jpg","jpeg","gif","webp","bmp","ico","svg","avif"],parse:async function e(e,t,r){let s;let n=((t=t||{}).image||{}).type||"auto",{url:u}=r||{};switch(function(e){switch(e){case"auto":case"data":return function(){if(a)return"imagebitmap";if(o)return"image";if(l)return"data";throw Error("Install '@loaders.gl/polyfills' to parse images under Node.js")}();default:return!function(e){switch(e){case"auto":return;case"imagebitmap":case"image":case"data":return;default:throw Error(`@loaders.gl/images: image ${e} not supported in this environment`)}}(e),e}}(n)){case"imagebitmap":s=await A(e,t,u);break;case"image":s=await p(e,t,u);break;case"data":s=await y(e,t);break;default:(0,i.v)(!1)}return"data"===n&&(s=(0,h.M5)(s)),s},tests:[e=>!!(0,b.m)(new DataView(e))],options:{image:{type:"auto",decode:!0}}}},20907:(e,t,r)=>{r.d(t,{A:()=>i});let i=new(r(43558)).t({id:"deck"})},22217:(e,t,r)=>{r.d(t,{_G:()=>l,ic:()=>a,k2:()=>h});var i=r(60263),s=r(39007);let n=null,o=!1,a={debugSpectorJS:i.R.get("debug-spectorjs"),debugSpectorJSUrl:"https://cdn.jsdelivr.net/npm/spectorjs@0.9.30/dist/spector.bundle.js",gl:void 0};async function l(e){if(!globalThis.SPECTOR)try{await (0,s.k)(e.debugSpectorJSUrl||a.debugSpectorJSUrl)}catch(e){i.R.warn(String(e))}}function h(e){if(!(e={...a,...e}).debugSpectorJS)return null;if(!n&&globalThis.SPECTOR&&!globalThis.luma?.spector){i.R.probe(1,"SPECTOR found and initialized. Start with `luma.spector.displayUI()`")();let{Spector:e}=globalThis.SPECTOR;n=new e,globalThis.luma&&(globalThis.luma.spector=n)}if(!n)return null;if(o||(o=!0,n.spyCanvases(),n?.onCaptureStarted.add(e=>i.R.info("Spector capture started:",e)()),n?.onCapture.add(e=>{i.R.info("Spector capture complete:",e)(),n?.getResultUI(),n?.resultView.display(),n?.resultView.addCapture(e)})),e.gl){let t=e.gl,r=t.device;n?.startCapture(e.gl,500),t.device=r,new Promise(e=>setTimeout(e,2e3)).then(e=>{i.R.info("Spector capture stopped after 2 seconds")(),n?.stopCapture()})}return n}},22662:(e,t,r)=>{r.d(t,{H:()=>eu});var i=r(37941),s=r(77031);let n={};class o extends Error{constructor(e,t){super(e),this.reason=t.reason,this.url=t.url,this.response=t.response}reason;url;response}let a=/^data:([-\w.]+\/[-\w.+]+)(;|,)/,l=/^([-\w.]+\/[-\w.+]+)/;function h(e,t){return e.toLowerCase()===t.toLowerCase()}function u(e){let t=a.exec(e);return t?t[1]:""}let c=/\?.*/;function d(e){return e.replace(c,"")}function f(e){return(0,i.Sv)(e)?e.url:(0,i.qf)(e)?e.name||"":"string"==typeof e?e:""}function p(e){if((0,i.Sv)(e)){let t=e.headers.get("content-type")||"",r=d(e.url);return function(e){let t=l.exec(e);return t?t[1]:e}(t)||u(r)}return(0,i.qf)(e)?e.type||"":"string"==typeof e?u(e):""}async function g(e){var t;if((0,i.Sv)(e))return e;let r={},s=(t=e,(0,i.Sv)(t)?t.headers["content-length"]||-1:(0,i.qf)(t)?t.size:"string"==typeof t?t.length:t instanceof ArrayBuffer||ArrayBuffer.isView(t)?t.byteLength:-1);s>=0&&(r["content-length"]=String(s));let n=f(e),o=p(e);o&&(r["content-type"]=o);let a=await A(e);a&&(r["x-first-bytes"]=a),"string"==typeof e&&(e=new TextEncoder().encode(e));let l=new Response(e,{headers:r});return Object.defineProperty(l,"url",{value:n}),l}async function m(e){if(!e.ok)throw await _(e)}async function _(e){let t=function(e){if(e.length<50)return e;let t=e.slice(e.length-15),r=e.substr(0,32);return`${r}...${t}`}(e.url),r=`Failed to fetch resource (${e.status}) ${e.statusText}: ${t}`;r=r.length>100?`${r.slice(0,100)}...`:r;let i={reason:e.statusText,url:e.url,response:e};try{let t=e.headers.get("Content-Type");i.reason=!e.bodyUsed&&t?.includes("application/json")?await e.json():await e.text()}catch(e){}return new o(r,i)}async function A(e){if("string"==typeof e)return`data:,${e.slice(0,5)}`;if(e instanceof Blob){let t=e.slice(0,5);return await new Promise(e=>{let r=new FileReader;r.onload=t=>e(t?.target?.result),r.readAsDataURL(t)})}if(e instanceof ArrayBuffer){let t=function(e){let t="",r=new Uint8Array(e);for(let e=0;e<r.byteLength;e++)t+=String.fromCharCode(r[e]);return btoa(t)}(e.slice(0,5));return`data:base64,${t}`}return null}async function E(e,t){if("string"==typeof e){var r;let i=function(e){for(let t in n)if(e.startsWith(t)){let r=n[t];e=e.replace(t,r)}return e.startsWith("http://")||e.startsWith("https://")||(e=`${e}`),e}(e);return!((r=i).startsWith("http:")||r.startsWith("https:"))&&!i.startsWith("data:")&&globalThis.loaders?.fetchNode?globalThis.loaders?.fetchNode(i,t):await fetch(i,t)}return await g(e)}var b=r(14569);function y(e,t){let r=(0,b.pp)(),s=e||r;return"function"==typeof s.fetch?s.fetch:(0,i.Gv)(s.fetch)?e=>E(e,s.fetch):t?.fetch?t?.fetch:E}var T=r(71253);class C{terminate(){}}var v=r(40769);let R=new Map;function S(e){let t=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(t)}function B(e){return!!e&&!!(e instanceof ArrayBuffer||"undefined"!=typeof MessagePort&&e instanceof MessagePort||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)}let w=()=>{};class M{name;source;url;terminated=!1;worker;onMessage;onError;_loadableURL="";static isSupported(){return"undefined"!=typeof Worker&&T.Bd||!T.Bd}constructor(e){let{name:t,source:r,url:i}=e;(0,v.v)(r||i),this.name=t,this.source=r,this.url=i,this.onMessage=w,this.onError=e=>console.log(e),this.worker=T.Bd?this._createBrowserWorker():this._createNodeWorker()}destroy(){this.onMessage=w,this.onError=w,this.worker.terminate(),this.terminated=!0}get isRunning(){return!!this.onMessage}postMessage(e,t){t=t||function e(t,r=!0,i){let s=i||new Set;if(t){if(B(t))s.add(t);else if(B(t.buffer))s.add(t.buffer);else if(ArrayBuffer.isView(t));else if(r&&"object"==typeof t)for(let i in t)e(t[i],r,s)}return void 0===i?Array.from(s):[]}(e),this.worker.postMessage(e,t)}_getErrorFromErrorEvent(e){let t="Failed to load ";return t+=`worker ${this.name} from ${this.url}. `,e.message&&(t+=`${e.message} in `),e.lineno&&(t+=`:${e.lineno}:${e.colno}`),Error(t)}_createBrowserWorker(){var e,t,r;let i;this._loadableURL=(e={source:this.source,url:this.url},(0,v.v)(e.source&&!e.url||!e.source&&e.url),(i=R.get(e.source||e.url))||(e.url&&(i=(t=e.url).startsWith("http")?S((r=t,`\
try {
  importScripts('${r}');
} catch (error) {
  console.error(error);
  throw error;
}`)):t,R.set(e.url,i)),e.source&&(i=S(e.source),R.set(e.source,i))),(0,v.v)(i),i);let s=new Worker(this._loadableURL,{name:this.name});return s.onmessage=e=>{e.data?this.onMessage(e.data):this.onError(Error("No data received"))},s.onerror=e=>{this.onError(this._getErrorFromErrorEvent(e)),this.terminated=!0},s.onmessageerror=e=>console.error(e),s}_createNodeWorker(){let e;if(this.url)e=new C(this.url.includes(":/")||this.url.startsWith("/")?this.url:`./${this.url}`,{eval:!1});else if(this.source)e=new C(this.source,{eval:!0});else throw Error("no worker");return e.on("message",e=>{this.onMessage(e)}),e.on("error",e=>{this.onError(e)}),e.on("exit",e=>{}),e}}class I{name;workerThread;isRunning=!0;result;_resolve=()=>{};_reject=()=>{};constructor(e,t){this.name=e,this.workerThread=t,this.result=new Promise((e,t)=>{this._resolve=e,this._reject=t})}postMessage(e,t){this.workerThread.postMessage({source:"loaders.gl",type:e,payload:t})}done(e){(0,v.v)(this.isRunning),this.isRunning=!1,this._resolve(e)}error(e){(0,v.v)(this.isRunning),this.isRunning=!1,this._reject(e)}}class P{name="unnamed";source;url;maxConcurrency=1;maxMobileConcurrency=1;onDebug=()=>{};reuseWorkers=!0;props={};jobQueue=[];idleQueue=[];count=0;isDestroyed=!1;static isSupported(){return M.isSupported()}constructor(e){this.source=e.source,this.url=e.url,this.setProps(e)}destroy(){this.idleQueue.forEach(e=>e.destroy()),this.isDestroyed=!0}setProps(e){this.props={...this.props,...e},void 0!==e.name&&(this.name=e.name),void 0!==e.maxConcurrency&&(this.maxConcurrency=e.maxConcurrency),void 0!==e.maxMobileConcurrency&&(this.maxMobileConcurrency=e.maxMobileConcurrency),void 0!==e.reuseWorkers&&(this.reuseWorkers=e.reuseWorkers),void 0!==e.onDebug&&(this.onDebug=e.onDebug)}async startJob(e,t=(e,t,r)=>e.done(r),r=(e,t)=>e.error(t)){let i=new Promise(i=>(this.jobQueue.push({name:e,onMessage:t,onError:r,onStart:i}),this));return this._startQueuedJob(),await i}async _startQueuedJob(){if(!this.jobQueue.length)return;let e=this._getAvailableWorker();if(!e)return;let t=this.jobQueue.shift();if(t){this.onDebug({message:"Starting job",name:t.name,workerThread:e,backlog:this.jobQueue.length});let r=new I(t.name,e);e.onMessage=e=>t.onMessage(r,e.type,e.payload),e.onError=e=>t.onError(r,e),t.onStart(r);try{await r.result}catch(e){console.error(`Worker exception: ${e}`)}finally{this.returnWorkerToQueue(e)}}}returnWorkerToQueue(e){!T.Bd||this.isDestroyed||!this.reuseWorkers||this.count>this._getMaxConcurrency()?(e.destroy(),this.count--):this.idleQueue.push(e),this.isDestroyed||this._startQueuedJob()}_getAvailableWorker(){return this.idleQueue.length>0?this.idleQueue.shift()||null:this.count<this._getMaxConcurrency()?(this.count++,new M({name:`${this.name.toLowerCase()} (#${this.count} of ${this.maxConcurrency})`,source:this.source,url:this.url})):null}_getMaxConcurrency(){return T.Fr?this.maxMobileConcurrency:this.maxConcurrency}}let L={maxConcurrency:3,maxMobileConcurrency:1,reuseWorkers:!0,onDebug:()=>{}};class O{props;workerPools=new Map;static _workerFarm;static isSupported(){return M.isSupported()}static getWorkerFarm(e={}){return O._workerFarm=O._workerFarm||new O({}),O._workerFarm.setProps(e),O._workerFarm}constructor(e){this.props={...L},this.setProps(e),this.workerPools=new Map}destroy(){for(let e of this.workerPools.values())e.destroy();this.workerPools=new Map}setProps(e){for(let t of(this.props={...this.props,...e},this.workerPools.values()))t.setProps(this._getWorkerPoolProps())}getWorkerPool(e){let{name:t,source:r,url:i}=e,s=this.workerPools.get(t);return s||((s=new P({name:t,source:r,url:i})).setProps(this._getWorkerPoolProps()),this.workerPools.set(t,s)),s}_getWorkerPoolProps(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}var x=r(20613);async function N(e,t,r,i,s){let n=e.id,o=function(e,t={}){let r=t[e.id]||{},i=T.Bd?`${e.id}-worker.js`:`${e.id}-worker-node.js`,s=r.workerUrl;if(s||"compression"!==e.id||(s=t.workerUrl),"test"===t._workerType&&(s=T.Bd?`modules/${e.module}/dist/${i}`:`modules/${e.module}/src/workers/${e.id}-worker-node.ts`),!s){let t=e.version;"latest"===t&&(t=x.x);let r=t?`@${t}`:"";s=`https://unpkg.com/@loaders.gl/${e.module}${r}/dist/${i}`}return(0,v.v)(s),s}(e,r),a=O.getWorkerFarm(r).getWorkerPool({name:n,url:o});r=JSON.parse(JSON.stringify(r)),i=JSON.parse(JSON.stringify(i||{}));let l=await a.startJob("process-on-worker",F.bind(null,s));l.postMessage("process",{input:t,options:r,context:i});let h=await l.result;return await h.result}async function F(e,t,r,i){switch(r){case"done":t.done(i);break;case"error":t.error(Error(i.error));break;case"process":let{id:s,input:n,options:o}=i;try{let r=await e(n,o);t.postMessage("done",{id:s,result:r})}catch(r){let e=r instanceof Error?r.message:"unknown error";t.postMessage("error",{id:s,error:e})}break;default:console.warn(`parse-with-worker unknown message ${r}`)}}var D=r(75606);async function U(e){let t=[];for await(let r of e)t.push(r);return(0,D.AQ)(...t)}async function*G(e,t){let r=t?.chunkSize||1048576,i=0;for(;i<e.size;){let t=i+r,s=await e.slice(i,t).arrayBuffer();i=t,yield s}}var k=r(30358);function H(e){if(e&&"object"==typeof e&&e.isBuffer||e instanceof ArrayBuffer)return e;if(ArrayBuffer.isView(e))return 0===e.byteOffset&&e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);if("string"==typeof e)return new TextEncoder().encode(e).buffer;if(e&&"object"==typeof e&&e._toArrayBuffer)return e._toArrayBuffer();throw Error("toArrayBuffer")}function V(e,t){return k.Bd?j(e,t):W(e,t)}async function*j(e,t){let r;let i=e.getReader();try{for(;;){let e=r||i.read();t?._streamReadAhead&&(r=i.read());let{done:s,value:n}=await e;if(s)return;yield H(n)}}catch(e){i.releaseLock()}}async function*W(e,t){for await(let t of e)yield H(t)}let z="Cannot convert supplied data type";async function X(e,t,r){let s=e instanceof ArrayBuffer||ArrayBuffer.isView(e);if("string"==typeof e||s)return function(e,t,r){if(t.text&&"string"==typeof e)return e;if((0,i.Pe)(e)&&(e=e.buffer),e instanceof ArrayBuffer){let r=e;return t.text&&!t.binary?new TextDecoder("utf8").decode(r):r}if(ArrayBuffer.isView(e)){if(t.text&&!t.binary)return new TextDecoder("utf8").decode(e);let r=e.buffer,i=e.byteLength||e.length;return(0!==e.byteOffset||i!==r.byteLength)&&(r=r.slice(e.byteOffset,e.byteOffset+i)),r}throw Error(z)}(e,t,0);if((0,i.qf)(e)&&(e=await g(e)),(0,i.Sv)(e)){let r=e;return await m(r),t.binary?await r.arrayBuffer():await r.text()}if((0,i.H1)(e)&&(e=function(e,t){if("string"==typeof e)return function*(e,t){let r=t?.chunkSize||262144,i=0,s=new TextEncoder;for(;i<e.length;){let t=Math.min(e.length-i,r),n=e.slice(i,i+t);i+=t,yield s.encode(n)}}(e,t);if(e instanceof ArrayBuffer)return function*(e,t={}){let{chunkSize:r=262144}=t,i=0;for(;i<e.byteLength;){let t=Math.min(e.byteLength-i,r),s=new ArrayBuffer(t),n=new Uint8Array(e,i,t);new Uint8Array(s).set(n),i+=t,yield s}}(e,t);if((0,i.qf)(e))return G(e,t);if((0,i.H1)(e))return V(e,t);if((0,i.Sv)(e))return V(e.body,t);throw Error("makeIterator")}(e,r)),(0,i.xZ)(e)||(0,i.Td)(e))return U(e);throw Error(z)}var K=r(89362),J=r(43558);let $="4.3.2",Y=$[0]>="0"&&$[0]<="9"?`v${$}`:"",q=function(){let e=new J.t({id:"loaders.gl"});return globalThis.loaders=globalThis.loaders||{},globalThis.loaders.log=e,globalThis.loaders.version=Y,globalThis.probe=globalThis.probe||{},globalThis.probe.loaders=e,e}();var Q=r(73271);let Z=/\.([^.]+)$/;async function ee(e,t=[],r,s){if(!er(e))return null;let n=et(e,t,{...r,nothrow:!0},s);if(n)return n;if((0,i.qf)(e)&&(n=et(e=await e.slice(0,10).arrayBuffer(),t,r,s)),!n&&!r?.nothrow)throw Error(ei(e));return n}function et(e,t=[],r,i){if(!er(e))return null;if(t&&!Array.isArray(t))return(0,s.D)(t);let n=[];t&&(n=n.concat(t)),r?.ignoreRegisteredLoaders||n.push(...(0,Q.Ph)()),function(e){for(let t of e)(0,s.D)(t)}(n);let o=function(e,t,r,i){let s=f(e),n=p(e),o=d(s)||i?.url,a=null,l="";return r?.mimeType&&(a=es(t,r?.mimeType),l=`match forced by supplied MIME type ${r?.mimeType}`),a=a||function(e,t){let r=t&&Z.exec(t),i=r&&r[1];return i?function(e,t){for(let r of(t=t.toLowerCase(),e))for(let e of r.extensions)if(e.toLowerCase()===t)return r;return null}(e,i):null}(t,o),l=l||(a?`matched url ${o}`:""),a=a||es(t,n),l=l||(a?`matched MIME type ${n}`:""),a=a||function(e,t){if(!t)return null;for(let r of e)if("string"==typeof t){if(function(e,t){return t.testText?t.testText(e):(Array.isArray(t.tests)?t.tests:[t.tests]).some(t=>e.startsWith(t))}(t,r))return r}else if(ArrayBuffer.isView(t)){if(en(t.buffer,t.byteOffset,r))return r}else if(t instanceof ArrayBuffer&&en(t,0,r))return r;return null}(t,e),l=l||(a?`matched initial data ${eo(e)}`:""),r?.fallbackMimeType&&(a=a||es(t,r?.fallbackMimeType),l=l||(a?`matched fallback MIME type ${n}`:"")),l&&q.log(1,`selectLoader selected ${a?.name}: ${l}.`),a}(e,n,r,i);if(!o&&!r?.nothrow)throw Error(ei(e));return o}function er(e){return!(e instanceof Response)||204!==e.status}function ei(e){let t=f(e),r=p(e),i="No valid loader found (";i+=(t?`${K.iW(t)}, `:"no url provided, ")+`MIME type: ${r?`"${r}"`:"not provided"}, `;let s=e?eo(e):"";return i+((s?` first bytes: "${s}"`:"first bytes: not available")+")")}function es(e,t){for(let r of e)if(r.mimeTypes?.some(e=>h(t,e))||h(t,`application/x.${r.id}`))return r;return null}function en(e,t,r){return(Array.isArray(r.tests)?r.tests:[r.tests]).some(r=>(function(e,t,r,i){if(i instanceof ArrayBuffer)return(0,D.YV)(i,e,i.byteLength);switch(typeof i){case"function":return i(e);case"string":let s=ea(e,t,i.length);return i===s;default:return!1}})(e,t,0,r))}function eo(e,t=5){return"string"==typeof e?e.slice(0,t):ArrayBuffer.isView(e)?ea(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?ea(e,0,t):""}function ea(e,t,r){if(e.byteLength<t+r)return"";let i=new DataView(e),s="";for(let e=0;e<r;e++)s+=String.fromCharCode(i.getUint8(t+e));return s}async function el(e,t,r,i){!t||Array.isArray(t)||(0,s.l)(t)||(i=void 0,r=t,t=void 0),e=await e,r=r||{};let n=f(e),o=function(e,t){let r;if(e&&!Array.isArray(e))return e;if(e&&(r=Array.isArray(e)?e:[e]),t&&t.loaders){let e=Array.isArray(t.loaders)?t.loaders:[t.loaders];r=r?[...r,...e]:e}return r&&r.length?r:void 0}(t,i),a=await ee(e,o,r);return a?(r=(0,b.a5)(r,a,o,n),i=function(e,t,r){if(r)return r;let i={fetch:y(t,e),...e};if(i.url){let e=d(i.url);i.baseUrl=e,i.queryString=function(e){let t=e.match(c);return t&&t[0]}(i.url),i.filename=K.iW(e),i.baseUrl=K.pD(e)}return Array.isArray(i.loaders)||(i.loaders=null),i}({url:n,_parse:el,loaders:o},r,i||null),await eh(a,e,r,i)):null}async function eh(e,t,r,s){var n;if(!function(e,t=x.Q){(0,v.v)(e,"no worker provided"),e.version}(e),r=function e(t,r,i=0){if(i>3)return r;let s={...t};for(let[t,n]of Object.entries(r))n&&"object"==typeof n&&!Array.isArray(n)?s[t]=e(s[t]||{},r[t],i+1):s[t]=r[t];return s}(e.options||{},r),(0,i.Sv)(t)){let e=t,{ok:r,redirected:i,status:n,statusText:o,type:a,url:l}=e;s.response={headers:Object.fromEntries(e.headers.entries()),ok:r,redirected:i,status:n,statusText:o,type:a,url:l}}if(t=await X(t,e,r),e.parseTextSync&&"string"==typeof t)return e.parseTextSync(t,r,s);if(n=r,O.isSupported()&&(T.Bd||n?._nodeWorkers)&&e.worker&&n?.worker)return await N(e,t,r,s,el);if(e.parseText&&"string"==typeof t)return await e.parseText(t,r,s);if(e.parse)return await e.parse(t,r,s);throw(0,v.v)(!e.parseSync),Error(`${e.id} loader - no parser found and worker is disabled`)}async function eu(e,t,r,n){let o,a;Array.isArray(t)||(0,s.l)(t)?(o=t,a=r):(o=[],a=t);let l=y(a),h=e;return"string"==typeof e&&(h=await l(e)),(0,i.qf)(e)&&(h=await l(e)),Array.isArray(o),await el(h,o,a)}},26106:(e,t,r)=>{r.d(t,{g:()=>s});var i=r(32167);class s extends i.F{static COPY_SRC=1;static COPY_DST=2;static TEXTURE=4;static STORAGE=8;static RENDER_ATTACHMENT=16;static CubeFaces=["+X","-X","+Y","-Y","+Z","-Z"];static defaultProps={...i.F.defaultProps,data:null,dimension:"2d",format:"rgba8unorm",width:void 0,height:void 0,depth:1,mipmaps:!1,compressed:!1,usage:0,mipLevels:void 0,samples:void 0,sampler:{},view:void 0,flipY:void 0};get[Symbol.toStringTag](){return"Texture"}toString(){return`Texture(${this.id},${this.format},${this.width}x${this.height})`}dimension;format;width;height;depth;mipLevels;updateTimestamp;constructor(e,t){if(super(e,t=s.normalizeProps(e,t),s.defaultProps),this.dimension=this.props.dimension,this.format=this.props.format,this.width=this.props.width,this.height=this.props.height,this.depth=this.props.depth,void 0===this.props.width||void 0===this.props.height){let e=s.getTextureDataSize(this.props.data);this.width=e?.width||1,this.height=e?.height||1}this.props.mipmaps&&void 0===this.props.mipLevels&&(this.props.mipLevels="pyramid"),this.mipLevels="pyramid"===this.props.mipLevels?s.getMipLevelCount(this.width,this.height):this.props.mipLevels||1,this.updateTimestamp=e.incrementTimestamp()}clone(e){return this.device.createTexture({...this.props,...e})}static isExternalImage(e){return"undefined"!=typeof ImageData&&e instanceof ImageData||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement||"undefined"!=typeof VideoFrame&&e instanceof VideoFrame||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas}static getExternalImageSize(e){if("undefined"!=typeof ImageData&&e instanceof ImageData||"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap||"undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas)return{width:e.width,height:e.height};if("undefined"!=typeof HTMLImageElement&&e instanceof HTMLImageElement)return{width:e.naturalWidth,height:e.naturalHeight};if("undefined"!=typeof HTMLVideoElement&&e instanceof HTMLVideoElement)return{width:e.videoWidth,height:e.videoHeight};if("undefined"!=typeof VideoFrame&&e instanceof VideoFrame)return{width:e.displayWidth,height:e.displayHeight};throw Error("Unknown image type")}static isTextureLevelData(e){return ArrayBuffer.isView(e?.data)}static getTextureDataSize(e){if(!e||ArrayBuffer.isView(e))return null;if(Array.isArray(e))return s.getTextureDataSize(e[0]);if(s.isExternalImage(e))return s.getExternalImageSize(e);if(e&&"object"==typeof e&&e.constructor===Object){let t=Object.values(e)[0];return{width:t.width,height:t.height}}throw Error("texture size deduction failed")}static normalizeTextureData(e,t){let r;return ArrayBuffer.isView(e)?[{data:e,width:t.width,height:t.height}]:Array.isArray(e)?e:[e]}static getMipLevelCount(e,t){return Math.floor(Math.log2(Math.max(e,t)))+1}static getCubeFaceDepth(e){switch(e){case"+X":return 0;case"-X":return 1;case"+Y":return 2;case"-Y":return 3;case"+Z":return 4;case"-Z":return 5;default:throw Error(e)}}static defaultCopyExternalImageOptions={image:void 0,sourceX:0,sourceY:0,width:void 0,height:void 0,depth:1,mipLevel:0,x:0,y:0,z:0,aspect:"all",colorSpace:"srgb",premultipliedAlpha:!1,flipY:!1};static normalizeProps(e,t){let r={...t};Object.assign(r,e?.props?._resourceDefaults?.texture||{});let{width:i,height:s}=r;return"number"==typeof i&&(r.width=Math.max(1,Math.ceil(i))),"number"==typeof s&&(r.height=Math.max(1,Math.ceil(s))),r}}},28131:(e,t,r)=>{r.d(t,{A:()=>o,k:()=>n});var i=r(20907);let s={};function n(e){s=e}function o(e,t,r,n){i.A.level>0&&s[e]&&s[e].call(null,t,r,n)}},30358:(e,t,r)=>{r.d(t,{Bd:()=>n});var i=r(49509);let s={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document};s.self||s.window||s.global,s.window||s.self||s.global,s.global||s.self||s.window,s.document;let n=("object"!=typeof i||String(i),!0),o=void 0!==i&&i.version&&/v([0-9]*)/.exec(i.version);o&&parseFloat(o[1])},31303:(e,t,r)=>{r.d(t,{p8:()=>i,tb:()=>s});let i=1e-6,s="undefined"!=typeof Float32Array?Float32Array:Array},32167:(e,t,r)=>{r.d(t,{F:()=>s});var i=r(67171);class s{static defaultProps={id:"undefined",handle:void 0,userData:void 0};toString(){return`${this[Symbol.toStringTag]||this.constructor.name}:"${this.id}"`}id;props;userData={};_device;destroyed=!1;allocatedBytes=0;_attachedResources=new Set;constructor(e,t,r){if(!e)throw Error("no device");this._device=e,this.props=function(e,t){let r={...t};for(let t in e)void 0!==e[t]&&(r[t]=e[t]);return r}(t,r);let s="undefined"!==this.props.id?this.props.id:(0,i.L)(this[Symbol.toStringTag]);this.props.id=s,this.id=s,this.userData=this.props.userData||{},this.addStats()}destroy(){this.destroyResource()}delete(){return this.destroy(),this}getProps(){return this.props}attachResource(e){this._attachedResources.add(e)}detachResource(e){this._attachedResources.delete(e)}destroyAttachedResource(e){this._attachedResources.delete(e)&&e.destroy()}destroyAttachedResources(){for(let e of Object.values(this._attachedResources))e.destroy();this._attachedResources=new Set}destroyResource(){this.destroyAttachedResources(),this.removeStats(),this.destroyed=!0}removeStats(){let e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get(`${t}s Active`).decrementCount()}trackAllocatedMemory(e,t=this[Symbol.toStringTag]){let r=this._device.statsManager.getStats("Resource Counts");r.get("GPU Memory").addCount(e),r.get(`${t} Memory`).addCount(e),this.allocatedBytes=e}trackDeallocatedMemory(e=this[Symbol.toStringTag]){let t=this._device.statsManager.getStats("Resource Counts");t.get("GPU Memory").subtractCount(this.allocatedBytes),t.get(`${e} Memory`).subtractCount(this.allocatedBytes),this.allocatedBytes=0}addStats(){let e=this._device.statsManager.getStats("Resource Counts"),t=this[Symbol.toStringTag];e.get("Resources Created").incrementCount(),e.get(`${t}s Created`).incrementCount(),e.get(`${t}s Active`).incrementCount()}}},32692:(e,t,r)=>{r.d(t,{$:()=>l,l:()=>h});var i,s=r(60263);!function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=0xffffffff]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.R16_EXT=33322]="R16_EXT",e[e.RG16_EXT=33324]="RG16_EXT",e[e.RGB16_EXT=32852]="RGB16_EXT",e[e.RGBA16_EXT=32859]="RGBA16_EXT",e[e.R16_SNORM_EXT=36760]="R16_SNORM_EXT",e[e.RG16_SNORM_EXT=36761]="RG16_SNORM_EXT",e[e.RGB16_SNORM_EXT=36762]="RGB16_SNORM_EXT",e[e.RGBA16_SNORM_EXT=36763]="RGBA16_SNORM_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",e[e.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",e[e.COMPRESSED_RED_RGTC1_EXT=36283]="COMPRESSED_RED_RGTC1_EXT",e[e.COMPRESSED_SIGNED_RED_RGTC1_EXT=36284]="COMPRESSED_SIGNED_RED_RGTC1_EXT",e[e.COMPRESSED_RED_GREEN_RGTC2_EXT=36285]="COMPRESSED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT=36286]="COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT",e[e.COMPRESSED_RGBA_BPTC_UNORM_EXT=36492]="COMPRESSED_RGBA_BPTC_UNORM_EXT",e[e.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT=36493]="COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT",e[e.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT=36494]="COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT",e[e.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT=36495]="COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",e[e.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",e[e.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",e[e.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",e[e.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",e[e.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",e[e.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",e[e.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",e[e.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",e[e.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT",e[e.COMPLETION_STATUS_KHR=37297]="COMPLETION_STATUS_KHR",e[e.DEPTH_CLAMP_EXT=34383]="DEPTH_CLAMP_EXT",e[e.FIRST_VERTEX_CONVENTION_WEBGL=36429]="FIRST_VERTEX_CONVENTION_WEBGL",e[e.LAST_VERTEX_CONVENTION_WEBGL=36430]="LAST_VERTEX_CONVENTION_WEBGL",e[e.PROVOKING_VERTEX_WEBL=36431]="PROVOKING_VERTEX_WEBL",e[e.POLYGON_MODE_WEBGL=2880]="POLYGON_MODE_WEBGL",e[e.POLYGON_OFFSET_LINE_WEBGL=10754]="POLYGON_OFFSET_LINE_WEBGL",e[e.LINE_WEBGL=6913]="LINE_WEBGL",e[e.FILL_WEBGL=6914]="FILL_WEBGL",e[e.MAX_CLIP_DISTANCES_WEBGL=3378]="MAX_CLIP_DISTANCES_WEBGL",e[e.MAX_CULL_DISTANCES_WEBGL=33529]="MAX_CULL_DISTANCES_WEBGL",e[e.MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL=33530]="MAX_COMBINED_CLIP_AND_CULL_DISTANCES_WEBGL",e[e.CLIP_DISTANCE0_WEBGL=12288]="CLIP_DISTANCE0_WEBGL",e[e.CLIP_DISTANCE1_WEBGL=12289]="CLIP_DISTANCE1_WEBGL",e[e.CLIP_DISTANCE2_WEBGL=12290]="CLIP_DISTANCE2_WEBGL",e[e.CLIP_DISTANCE3_WEBGL=12291]="CLIP_DISTANCE3_WEBGL",e[e.CLIP_DISTANCE4_WEBGL=12292]="CLIP_DISTANCE4_WEBGL",e[e.CLIP_DISTANCE5_WEBGL=12293]="CLIP_DISTANCE5_WEBGL",e[e.CLIP_DISTANCE6_WEBGL=12294]="CLIP_DISTANCE6_WEBGL",e[e.CLIP_DISTANCE7_WEBGL=12295]="CLIP_DISTANCE7_WEBGL",e[e.POLYGON_OFFSET_CLAMP_EXT=36379]="POLYGON_OFFSET_CLAMP_EXT",e[e.LOWER_LEFT_EXT=36001]="LOWER_LEFT_EXT",e[e.UPPER_LEFT_EXT=36002]="UPPER_LEFT_EXT",e[e.NEGATIVE_ONE_TO_ONE_EXT=37726]="NEGATIVE_ONE_TO_ONE_EXT",e[e.ZERO_TO_ONE_EXT=37727]="ZERO_TO_ONE_EXT",e[e.CLIP_ORIGIN_EXT=37724]="CLIP_ORIGIN_EXT",e[e.CLIP_DEPTH_MODE_EXT=37725]="CLIP_DEPTH_MODE_EXT",e[e.SRC1_COLOR_WEBGL=35065]="SRC1_COLOR_WEBGL",e[e.SRC1_ALPHA_WEBGL=34185]="SRC1_ALPHA_WEBGL",e[e.ONE_MINUS_SRC1_COLOR_WEBGL=35066]="ONE_MINUS_SRC1_COLOR_WEBGL",e[e.ONE_MINUS_SRC1_ALPHA_WEBGL=35067]="ONE_MINUS_SRC1_ALPHA_WEBGL",e[e.MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL=35068]="MAX_DUAL_SOURCE_DRAW_BUFFERS_WEBGL",e[e.MIRROR_CLAMP_TO_EDGE_EXT=34627]="MIRROR_CLAMP_TO_EDGE_EXT"}(i||(i={}));var n=r(83003),o=r(39007);function a(e){return e.luma=e.luma||{},e.luma}async function l(){(0,n.B)()&&!globalThis.WebGLDebugUtils&&(globalThis.global=globalThis.global||globalThis,globalThis.global.module={},await (0,o.k)("https://unpkg.com/webgl-debug@2.0.1/index.js"))}function h(e,t={}){return t.debugWebGL||t.traceWebGL?function(e,t){if(!globalThis.WebGLDebugUtils)return s.R.warn("webgl-debug not loaded")(),e;let r=a(e);if(r.debugContext)return r.debugContext;globalThis.WebGLDebugUtils.init({...i,...e});let n=globalThis.WebGLDebugUtils.makeDebugContext(e,c.bind(null,t),d.bind(null,t));for(let e in i)e in n||"number"!=typeof i[e]||(n[e]=i[e]);class o{}Object.setPrototypeOf(n,Object.getPrototypeOf(e)),Object.setPrototypeOf(o,n);let l=Object.create(o);return r.realContext=e,r.debugContext=l,l.debug=!0,l}(e,t):function(e){let t=a(e);return t.realContext?t.realContext:e}(e)}function u(e,t){t=Array.from(t).map(e=>void 0===e?"undefined":e);let r=globalThis.WebGLDebugUtils.glFunctionArgsToString(e,t);return r=`${r.slice(0,100)}${r.length>100?"...":""}`,`gl.${e}(${r})`}function c(e,t,r,i){i=Array.from(i).map(e=>void 0===e?"undefined":e);let n=globalThis.WebGLDebugUtils.glEnumToString(t),o=globalThis.WebGLDebugUtils.glFunctionArgsToString(r,i),a=`${n} in gl.${r}(${o})`;s.R.error(a)()}function d(e,t,r){let i="";for(let n of(s.R.level>=1&&(i=u(t,r),e.traceWebGL&&s.R.log(1,i)()),r))void 0===n&&(i=i||u(t,r))}},33021:(e,t,r)=>{r.d(t,{$Q:()=>s});var i=r(11179);function s(e){(0,i.$g)(e);let t={},r={};(function e(t){let{modules:r,level:i,moduleMap:s,moduleDepth:n}=t;if(i>=5)throw Error("Possible loop in shader dependency graph");for(let e of r)s[e.name]=e,(void 0===n[e.name]||n[e.name]<i)&&(n[e.name]=i);for(let t of r)t.dependencies&&e({modules:t.dependencies,level:i+1,moduleMap:s,moduleDepth:n})})({modules:e,level:0,moduleMap:t,moduleDepth:r});let s=Object.keys(r).sort((e,t)=>r[t]-r[e]).map(e=>t[e]);return(0,i.$g)(s),s}},33176:(e,t,r)=>{r.d(t,{Bw:()=>u,C:()=>o,Cc:()=>p,Om:()=>f,S8:()=>d,WQ:()=>l,Z0:()=>g,fA:()=>n,gL:()=>m,hZ:()=>a,hs:()=>h,m3:()=>c,o8:()=>s,t2:()=>_});var i=r(31303);function s(e){let t=new i.tb(4);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t}function n(e,t,r,s){let n=new i.tb(4);return n[0]=e,n[1]=t,n[2]=r,n[3]=s,n}function o(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e}function a(e,t,r,i,s){return e[0]=t,e[1]=r,e[2]=i,e[3]=s,e}function l(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e[3]=t[3]+r[3],e}function h(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function u(e){let t=e[0],r=e[1],i=e[2],s=e[3];return Math.sqrt(t*t+r*r+i*i+s*s)}function c(e){let t=e[0],r=e[1],i=e[2],s=e[3];return t*t+r*r+i*i+s*s}function d(e,t){let r=t[0],i=t[1],s=t[2],n=t[3],o=r*r+i*i+s*s+n*n;return o>0&&(o=1/Math.sqrt(o)),e[0]=r*o,e[1]=i*o,e[2]=s*o,e[3]=n*o,e}function f(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]}function p(e,t,r,i){let s=t[0],n=t[1],o=t[2],a=t[3];return e[0]=s+i*(r[0]-s),e[1]=n+i*(r[1]-n),e[2]=o+i*(r[2]-o),e[3]=a+i*(r[3]-a),e}function g(e,t,r){let i=t[0],s=t[1],n=t[2],o=t[3];return e[0]=r[0]*i+r[4]*s+r[8]*n+r[12]*o,e[1]=r[1]*i+r[5]*s+r[9]*n+r[13]*o,e[2]=r[2]*i+r[6]*s+r[10]*n+r[14]*o,e[3]=r[3]*i+r[7]*s+r[11]*n+r[15]*o,e}function m(e,t,r){let i=t[0],s=t[1],n=t[2],o=r[0],a=r[1],l=r[2],h=r[3],u=h*i+a*n-l*s,c=h*s+l*i-o*n,d=h*n+o*s-a*i,f=-o*i-a*s-l*n;return e[0]=u*h+-(f*o)+-(c*l)- -(d*a),e[1]=c*h+-(f*a)+-(d*o)- -(u*l),e[2]=d*h+-(f*l)+-(u*a)- -(c*o),e[3]=t[3],e}function _(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]}!function(){let e=new i.tb(4);i.tb!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0)}()},34752:(e,t,r)=>{r.d(t,{v:()=>i});function i(e,t){if(!e)throw Error(`math.gl assertion ${t}`)}},35510:(e,t,r)=>{r.d(t,{_:()=>y});var i=r(11179),s=r(33021),n=r(18117);let o=[[/^(#version[ \t]+(100|300[ \t]+es))?[ \t]*\n/,"#version 300 es\n"],[/\btexture(2D|2DProj|Cube)Lod(EXT)?\(/g,"textureLod("],[/\btexture(2D|2DProj|Cube)(EXT)?\(/g,"texture("]],a=[...o,[u("attribute"),"in $1"],[u("varying"),"out $1"]],l=[...o,[u("varying"),"in $1"]];function h(e,t){for(let[r,i]of t)e=e.replace(r,i);return e}function u(e){return RegExp(`\\b${e}[ \\t]+(\\w+[ \\t]+\\w+(\\[\\w+\\])?;)`,"g")}function c(e,t){let r="";for(let i in e){let s=e[i];if(r+=`void ${s.signature} {
`,s.header&&(r+=`  ${s.header}`),t[i]){let e=t[i];for(let t of(e.sort((e,t)=>e.order-t.order),e))r+=`  ${t.injection}
`}s.footer&&(r+=`  ${s.footer}`),r+="}\n"}return r}function d(e){let t={vertex:{},fragment:{}};for(let r of e){let e,i;"string"!=typeof r?i=(e=r).hook:(e={},i=r);let[s,n]=(i=i.trim()).split(":"),o=i.replace(/\(.+/,""),a=Object.assign(e,{signature:n});switch(s){case"vs":t.vertex[o]=a;break;case"fs":t.fragment[o]=a;break;default:throw Error(s)}}return t}function f(e,t){if(!e)throw Error(t||"shadertools: assertion failed.")}let p=`

${n.O_}
`,g=`\
precision highp float;
`;function m(e,t){let{id:r,source:s,stage:o,language:u="glsl",modules:m,defines:_={},hookFunctions:E=[],inject:b={},prologue:y=!0,log:T}=t;f("string"==typeof s,"shader source must be a string");let C="glsl"===u?({name:function(e,t="unnamed"){let r=/#define[^\S\r\n]*SHADER_NAME[^\S\r\n]*([A-Za-z0-9_-]+)\s*/.exec(e);return r?r[1]:t}(s,void 0),language:"glsl",version:function(e){let t=100,r=e.match(/[^\s]+/g);if(r&&r.length>=2&&"#version"===r[0]){let e=parseInt(r[1],10);Number.isFinite(e)&&(t=e)}if(100!==t&&300!==t)throw Error(`Invalid GLSL version ${t}`);return t}(s)}).version:-1,v=e.shaderLanguageVersion,R=100===C?"#version 100":"#version 300 es",S=s.split("\n").slice(1).join("\n"),B={};m.forEach(e=>{Object.assign(B,e.defines)}),Object.assign(B,_);let w="";switch(u){case"wgsl":break;case"glsl":w=y?`\
${R}

// ----- PROLOGUE -------------------------
${function(e){let{id:t,source:r,stage:i}=e;return t&&-1===r.indexOf("SHADER_NAME")?`
#define SHADER_NAME ${t}_${i}`:""}({id:r,source:s,stage:o})}
#define SHADER_TYPE_${o.toUpperCase()}

${function(e){switch(e?.gpu.toLowerCase()){case"apple":return`\
#define APPLE_GPU
// Apple optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"nvidia":return`\
#define NVIDIA_GPU
// Nvidia optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
`;case"intel":return`\
#define INTEL_GPU
// Intel optimizes away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Intel's built-in 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// Intel GPU doesn't have full 32 bits precision in same cases, causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`;case"amd":return`\
#define AMD_GPU
`;default:return`\
#define DEFAULT_GPU
// Prevent driver from optimizing away the calculation necessary for emulated fp64
#define LUMA_FP64_CODE_ELIMINATION_WORKAROUND 1
// Headless Chrome's software shader 'tan' function doesn't have acceptable precision
#define LUMA_FP32_TAN_PRECISION_WORKAROUND 1
// If the GPU doesn't have full 32 bits precision, will causes overflow
#define LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND 1
`}}(e)}
${"fragment"===o?g:""}

// ----- APPLICATION DEFINES -------------------------

${function(e={}){let t="";for(let r in e){let i=e[r];(i||Number.isFinite(i))&&(t+=`#define ${r.toUpperCase()} ${e[r]}
`)}return t}(B)}

`:`${R}
`}let M=d(E),I={},P={},L={};for(let e in b){let t="string"==typeof b[e]?{injection:b[e],order:0}:b[e],r=/^(v|f)s:(#)?([\w-]+)$/.exec(e);if(r){let i=r[2],s=r[3];i?"decl"===s?P[e]=[t]:L[e]=[t]:I[e]=[t]}else L[e]=[t]}for(let e of m){T&&(0,i.ZG)(e,S,T),w+=A(e,o);let t=e.instance?.normalizedInjections[o]||{};for(let e in t){let r=/^(v|f)s:#([\w-]+)$/.exec(e);if(r){let i="decl"===r[2]?P:L;i[e]=i[e]||[],i[e].push(t[e])}else I[e]=I[e]||[],I[e].push(t[e])}}return w+="// ----- MAIN SHADER SOURCE -------------------------",w+=p,w=(0,n.bv)(w,o,P)+c(M[o],I)+S,w=(0,n.bv)(w,o,L),"glsl"===u&&C!==v&&(w=function(e,t){if(300!==Number(e.match(/^#version[ \t]+(\d+)/m)?.[1]||100))throw Error("luma.gl v9 only supports GLSL 3.00 shader sources");switch(t){case"vertex":return e=h(e,a);case"fragment":return e=h(e,l);default:throw Error(t)}}(w,o)),w.trim()}function _(e){return function(t){let r={};for(let i of e){let e=i.getUniforms?.(t,r);Object.assign(r,e)}return r}}function A(e,t){let r;switch(t){case"vertex":r=e.vs||"";break;case"fragment":r=e.fs||"";break;case"wgsl":r=e.source||"";break;default:f(!1)}if(!e.name)throw Error("Shader module must have a name");let i=e.name.toUpperCase().replace(/[^0-9a-z]/gi,"_"),s=`\
// ----- MODULE ${e.name} ---------------

`;return"wgsl"!==t&&(s+=`#define MODULE_${i}
`),s+=`${r}
`}let E=/^\s*\#\s*ifdef\s*([a-zA-Z_]+)\s*$/,b=/^\s*\#\s*endif\s*$/;class y{static defaultShaderAssembler;_hookFunctions=[];_defaultModules=[];static getDefaultShaderAssembler(){return y.defaultShaderAssembler=y.defaultShaderAssembler||new y,y.defaultShaderAssembler}addDefaultModule(e){this._defaultModules.find(t=>t.name===("string"==typeof e?e:e.name))||this._defaultModules.push(e)}removeDefaultModule(e){let t="string"==typeof e?e:e.name;this._defaultModules=this._defaultModules.filter(e=>e.name!==t)}addShaderHook(e,t){t&&(e=Object.assign(t,{hook:e})),this._hookFunctions.push(e)}assembleWGSLShader(e){let t=this._getModuleList(e.modules),r=this._hookFunctions,{source:o,getUniforms:a}=function(e){let t=(0,s.$Q)(e.modules||[]);return{source:function(e,t){let{source:r,stage:s,modules:o,hookFunctions:a=[],inject:l={},log:h}=t;f("string"==typeof r,"shader source must be a string");let u="",g=d(a),m={},_={},E={};for(let e in l){let t="string"==typeof l[e]?{injection:l[e],order:0}:l[e],r=/^(v|f)s:(#)?([\w-]+)$/.exec(e);if(r){let i=r[2],s=r[3];i?"decl"===s?_[e]=[t]:E[e]=[t]:m[e]=[t]}else E[e]=[t]}for(let e of o){h&&(0,i.ZG)(e,r,h),u+=A(e,"wgsl");let t=e.injections?.[s]||{};for(let e in t){let r=/^(v|f)s:#([\w-]+)$/.exec(e);if(r){let i="decl"===r[2]?_:E;i[e]=i[e]||[],i[e].push(t[e])}else m[e]=m[e]||[],m[e].push(t[e])}}return u+=p,u=(0,n.bv)(u,s,_)+c(g[s],m)+r,u=(0,n.bv)(u,s,E)}(e.platformInfo,{...e,source:e.source,stage:"vertex",modules:t}),getUniforms:_(t)}}({...e,source:e.source,modules:t,hookFunctions:r});return{source:"wgsl"===e.platformInfo.shaderLanguage?function(e,t){let r=e.split("\n"),i=[],s=!0,n=null;for(let e of r){let t=e.match(E),r=e.match(b);t?(t[1],s=!1):r?s=!0:s&&i.push(e)}return i.join("\n")}(o):o,getUniforms:a,modules:t}}assembleGLSLShaderPair(e){let t=this._getModuleList(e.modules),r=this._hookFunctions;return{...function(e){let{vs:t,fs:r}=e,i=(0,s.$Q)(e.modules||[]);return{vs:m(e.platformInfo,{...e,source:t,stage:"vertex",modules:i}),fs:m(e.platformInfo,{...e,source:r,stage:"fragment",modules:i}),getUniforms:_(i)}}({...e,vs:e.vs,fs:e.fs,modules:t,hookFunctions:r}),modules:t}}_getModuleList(e=[]){let t=Array(this._defaultModules.length+e.length),r={},s=0;for(let e=0,i=this._defaultModules.length;e<i;++e){let i=this._defaultModules[e],n=i.name;t[s++]=i,r[n]=!0}for(let i=0,n=e.length;i<n;++i){let n=e[i],o=n.name;r[o]||(t[s++]=n,r[o]=!0)}return t.length=s,(0,i.$g)(t),t}}},35761:(e,t,r)=>{r.d(t,{VD:()=>i,YN:()=>l,fW:()=>n,jA:()=>a,r3:()=>s,uH:()=>o,vf:()=>h});let i={NO_STATE:"Awaiting state",MATCHED:"Matched. State transferred from previous layer",INITIALIZED:"Initialized",AWAITING_GC:"Discarded. Awaiting garbage collection",AWAITING_FINALIZATION:"No longer matched. Awaiting garbage collection",FINALIZED:"Finalized! Awaiting garbage collection"},s=Symbol.for("component"),n=Symbol.for("propTypes"),o=Symbol.for("deprecatedProps"),a=Symbol.for("asyncPropDefaults"),l=Symbol.for("asyncPropOriginal"),h=Symbol.for("asyncPropResolved")},36389:(e,t,r)=>{r.d(t,{$A:()=>u,Bw:()=>n,Cc:()=>c,Il:()=>b,Om:()=>h,S8:()=>l,Z0:()=>d,Z8:()=>m,eL:()=>g,ei:()=>f,fA:()=>o,g7:()=>A,gL:()=>p,jb:()=>E,uE:()=>y,vt:()=>s,x6:()=>_,ze:()=>a});var i=r(31303);function s(){let e=new i.tb(3);return i.tb!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function n(e){let t=e[0],r=e[1],i=e[2];return Math.sqrt(t*t+r*r+i*i)}function o(e,t,r){let s=new i.tb(3);return s[0]=e,s[1]=t,s[2]=r,s}function a(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function l(e,t){let r=t[0],i=t[1],s=t[2],n=r*r+i*i+s*s;return n>0&&(n=1/Math.sqrt(n)),e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e}function h(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function u(e,t,r){let i=t[0],s=t[1],n=t[2],o=r[0],a=r[1],l=r[2];return e[0]=s*l-n*a,e[1]=n*o-i*l,e[2]=i*a-s*o,e}function c(e,t,r,i){let s=t[0],n=t[1],o=t[2];return e[0]=s+i*(r[0]-s),e[1]=n+i*(r[1]-n),e[2]=o+i*(r[2]-o),e}function d(e,t,r){let i=t[0],s=t[1],n=t[2],o=r[3]*i+r[7]*s+r[11]*n+r[15];return o=o||1,e[0]=(r[0]*i+r[4]*s+r[8]*n+r[12])/o,e[1]=(r[1]*i+r[5]*s+r[9]*n+r[13])/o,e[2]=(r[2]*i+r[6]*s+r[10]*n+r[14])/o,e}function f(e,t,r){let i=t[0],s=t[1],n=t[2];return e[0]=i*r[0]+s*r[3]+n*r[6],e[1]=i*r[1]+s*r[4]+n*r[7],e[2]=i*r[2]+s*r[5]+n*r[8],e}function p(e,t,r){let i=r[0],s=r[1],n=r[2],o=r[3],a=t[0],l=t[1],h=t[2],u=s*h-n*l,c=n*a-i*h,d=i*l-s*a,f=s*d-n*c,p=n*u-i*d,g=i*c-s*u,m=2*o;return u*=m,c*=m,d*=m,f*=2,p*=2,g*=2,e[0]=a+u+f,e[1]=l+c+p,e[2]=h+d+g,e}function g(e,t,r,i){let s=[],n=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],n[0]=s[0],n[1]=s[1]*Math.cos(i)-s[2]*Math.sin(i),n[2]=s[1]*Math.sin(i)+s[2]*Math.cos(i),e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e}function m(e,t,r,i){let s=[],n=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],n[0]=s[2]*Math.sin(i)+s[0]*Math.cos(i),n[1]=s[1],n[2]=s[2]*Math.cos(i)-s[0]*Math.sin(i),e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e}function _(e,t,r,i){let s=[],n=[];return s[0]=t[0]-r[0],s[1]=t[1]-r[1],s[2]=t[2]-r[2],n[0]=s[0]*Math.cos(i)-s[1]*Math.sin(i),n[1]=s[0]*Math.sin(i)+s[1]*Math.cos(i),n[2]=s[2],e[0]=n[0]+r[0],e[1]=n[1]+r[1],e[2]=n[2]+r[2],e}function A(e,t){let r=e[0],i=e[1],s=e[2],n=t[0],o=t[1],a=t[2],l=Math.sqrt((r*r+i*i+s*s)*(n*n+o*o+a*a));return Math.acos(Math.min(Math.max(l&&h(e,t)/l,-1),1))}let E=function(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e},b=n,y=function(e){let t=e[0],r=e[1],i=e[2];return t*t+r*r+i*i};s()},37941:(e,t,r)=>{r.d(t,{Gv:()=>n,H1:()=>p,Pe:()=>c,Sv:()=>h,Td:()=>l,aC:()=>o,qf:()=>u,xZ:()=>a});let i=e=>"boolean"==typeof e,s=e=>"function"==typeof e,n=e=>null!==e&&"object"==typeof e,o=e=>n(e)&&e.constructor===({}).constructor,a=e=>!!e&&"function"==typeof e[Symbol.iterator],l=e=>e&&"function"==typeof e[Symbol.asyncIterator],h=e=>"undefined"!=typeof Response&&e instanceof Response||e&&e.arrayBuffer&&e.text&&e.json,u=e=>"undefined"!=typeof Blob&&e instanceof Blob,c=e=>e&&"object"==typeof e&&e.isBuffer,d=e=>"undefined"!=typeof ReadableStream&&e instanceof ReadableStream||n(e)&&s(e.tee)&&s(e.cancel)&&s(e.getReader),f=e=>n(e)&&s(e.read)&&s(e.pipe)&&i(e.readable),p=e=>d(e)||f(e)},39007:(e,t,r)=>{r.d(t,{k:()=>i});async function i(e,t){let r=document.getElementsByTagName("head")[0];if(!r)throw Error("loadScript");let i=document.createElement("script");return i.setAttribute("type","text/javascript"),i.setAttribute("src",e),t&&(i.id=t),new Promise((t,s)=>{i.onload=t,i.onerror=t=>s(Error(`Unable to load script '${e}': ${t}`)),r.appendChild(i)})}},39394:(e,t,r)=>{r.d(t,{u:()=>o});var i=r(5229),s=r(73801),n=r(75031);class o extends i.a{toString(){let e="[";if(n.$W.printRowMajor){e+="row-major:";for(let t=0;t<this.RANK;++t)for(let r=0;r<this.RANK;++r)e+=` ${this[r*this.RANK+t]}`}else{e+="column-major:";for(let t=0;t<this.ELEMENTS;++t)e+=` ${this[t]}`}return e+"]"}getElementIndex(e,t){return t*this.RANK+e}getElement(e,t){return this[t*this.RANK+e]}setElement(e,t,r){return this[t*this.RANK+e]=(0,s.ws)(r),this}getColumn(e,t=Array(this.RANK).fill(-0)){let r=e*this.RANK;for(let e=0;e<this.RANK;++e)t[e]=this[r+e];return t}setColumn(e,t){let r=e*this.RANK;for(let e=0;e<this.RANK;++e)this[r+e]=t[e];return this}}},40769:(e,t,r)=>{r.d(t,{v:()=>i});function i(e,t){if(!e)throw Error(t||"loaders.gl assertion failed.")}},42538:(e,t,r)=>{r.d(t,{Cc:()=>o,WQ:()=>s,Z0:()=>u,ZF:()=>a,ei:()=>h,l0:()=>l,ze:()=>n});var i=r(31303);function s(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function n(e,t){return e[0]=-t[0],e[1]=-t[1],e}function o(e,t,r,i){let s=t[0],n=t[1];return e[0]=s+i*(r[0]-s),e[1]=n+i*(r[1]-n),e}function a(e,t,r){let i=t[0],s=t[1];return e[0]=r[0]*i+r[2]*s,e[1]=r[1]*i+r[3]*s,e}function l(e,t,r){let i=t[0],s=t[1];return e[0]=r[0]*i+r[2]*s+r[4],e[1]=r[1]*i+r[3]*s+r[5],e}function h(e,t,r){let i=t[0],s=t[1];return e[0]=r[0]*i+r[3]*s+r[6],e[1]=r[1]*i+r[4]*s+r[7],e}function u(e,t,r){let i=t[0],s=t[1];return e[0]=r[0]*i+r[4]*s+r[12],e[1]=r[1]*i+r[5]*s+r[13],e}!function(){let e=new i.tb(2);i.tb!=Float32Array&&(e[0]=0,e[1]=0)}()},43210:(e,t,r)=>{r.d(t,{Kx:()=>o,We:()=>h,p5:()=>a,rf:()=>n,tg:()=>l});var i=r(20907),s=r(81810);let n={DEFAULT:-1,LNGLAT:1,METER_OFFSETS:2,LNGLAT_OFFSETS:3,CARTESIAN:0};Object.defineProperty(n,"IDENTITY",{get:()=>(i.A.deprecated("COORDINATE_SYSTEM.IDENTITY","COORDINATE_SYSTEM.CARTESIAN")(),0)});let o={WEB_MERCATOR:1,GLOBE:2,WEB_MERCATOR_AUTO_OFFSET:4,IDENTITY:0},a={common:0,meters:1,pixels:2},l={click:"onClick",panstart:"onDragStart",panmove:"onDrag",panend:"onDragEnd"},h={multipan:[s.uq,{threshold:10,direction:s.e8.Vertical,pointers:2}],pinch:[s.h1,{},null,["multipan"]],pan:[s.uq,{threshold:1},["pinch"],["multipan"]],dblclick:[s.Cx,{event:"dblclick",taps:2}],click:[s.Cx,{event:"click"},null,["dblclick"]]}},43558:(e,t,r)=>{r.d(t,{t:()=>m});var i,s=r(83003);let n="4.1.0";class o{constructor(e,t,r="sessionStorage"){this.storage=function(e){try{let t=window[e],r="__storage_test__";return t.setItem(r,r),t.removeItem(r),t}catch(e){return null}}(r),this.id=e,this.config=t,this._loadConfiguration()}getConfiguration(){return this.config}setConfiguration(e){if(Object.assign(this.config,e),this.storage){let e=JSON.stringify(this.config);this.storage.setItem(this.id,e)}}_loadConfiguration(){let e={};if(this.storage){let t=this.storage.getItem(this.id);e=t?JSON.parse(t):{}}return Object.assign(this.config,e),this}}function a(e){return"string"!=typeof e?e:i[e=e.toUpperCase()]||i.WHITE}function l(e,t){if(!e)throw Error(t||"Assertion failed")}!function(e){e[e.BLACK=30]="BLACK",e[e.RED=31]="RED",e[e.GREEN=32]="GREEN",e[e.YELLOW=33]="YELLOW",e[e.BLUE=34]="BLUE",e[e.MAGENTA=35]="MAGENTA",e[e.CYAN=36]="CYAN",e[e.WHITE=37]="WHITE",e[e.BRIGHT_BLACK=90]="BRIGHT_BLACK",e[e.BRIGHT_RED=91]="BRIGHT_RED",e[e.BRIGHT_GREEN=92]="BRIGHT_GREEN",e[e.BRIGHT_YELLOW=93]="BRIGHT_YELLOW",e[e.BRIGHT_BLUE=94]="BRIGHT_BLUE",e[e.BRIGHT_MAGENTA=95]="BRIGHT_MAGENTA",e[e.BRIGHT_CYAN=96]="BRIGHT_CYAN",e[e.BRIGHT_WHITE=97]="BRIGHT_WHITE"}(i||(i={}));var h=r(95694);function u(){let e;if((0,s.B)()&&h.x.performance)e=h.x?.performance?.now?.();else if("hrtime"in h.eh){let t=h.eh?.hrtime?.();e=1e3*t[0]+t[1]/1e6}else e=Date.now();return e}let c={debug:(0,s.B)()&&console.debug||console.log,log:console.log,info:console.info,warn:console.warn,error:console.error},d={enabled:!0,level:0};function f(){}let p={},g={once:!0};class m{constructor({id:e}={id:""}){this.VERSION=n,this._startTs=u(),this._deltaTs=u(),this.userData={},this.LOG_THROTTLE_TIMEOUT=0,this.id=e,this.userData={},this._storage=new o(`__probe-${this.id}__`,d),this.timeStamp(`${this.id} started`),function(e,t=["constructor"]){for(let r of Object.getOwnPropertyNames(Object.getPrototypeOf(e))){let i=e[r];"function"!=typeof i||t.find(e=>r===e)||(e[r]=i.bind(e))}}(this),Object.seal(this)}set level(e){this.setLevel(e)}get level(){return this.getLevel()}isEnabled(){return this._storage.config.enabled}getLevel(){return this._storage.config.level}getTotal(){return Number((u()-this._startTs).toPrecision(10))}getDelta(){return Number((u()-this._deltaTs).toPrecision(10))}set priority(e){this.level=e}get priority(){return this.level}getPriority(){return this.level}enable(e=!0){return this._storage.setConfiguration({enabled:e}),this}setLevel(e){return this._storage.setConfiguration({level:e}),this}get(e){return this._storage.config[e]}set(e,t){this._storage.setConfiguration({[e]:t})}settings(){console.table?console.table(this._storage.config):console.log(this._storage.config)}assert(e,t){if(!e)throw Error(t||"Assertion failed")}warn(e){return this._getLogFunction(0,e,c.warn,arguments,g)}error(e){return this._getLogFunction(0,e,c.error,arguments)}deprecated(e,t){return this.warn(`\`${e}\` is deprecated and will be removed \
in a later version. Use \`${t}\` instead`)}removed(e,t){return this.error(`\`${e}\` has been removed. Use \`${t}\` instead`)}probe(e,t){return this._getLogFunction(e,t,c.log,arguments,{time:!0,once:!0})}log(e,t){return this._getLogFunction(e,t,c.debug,arguments)}info(e,t){return this._getLogFunction(e,t,console.info,arguments)}once(e,t){return this._getLogFunction(e,t,c.debug||c.info,arguments,g)}table(e,t,r){return t?this._getLogFunction(e,t,console.table||f,r&&[r],{tag:function(e){for(let t in e)for(let r in e[t])return r||"untitled";return"empty"}(t)}):f}time(e,t){return this._getLogFunction(e,t,console.time?console.time:console.info)}timeEnd(e,t){return this._getLogFunction(e,t,console.timeEnd?console.timeEnd:console.info)}timeStamp(e,t){return this._getLogFunction(e,t,console.timeStamp||f)}group(e,t,r={collapsed:!1}){let i=A({logLevel:e,message:t,opts:r}),{collapsed:s}=r;return i.method=(s?console.groupCollapsed:console.group)||console.info,this._getLogFunction(i)}groupCollapsed(e,t,r={}){return this.group(e,t,Object.assign({},r,{collapsed:!0}))}groupEnd(e){return this._getLogFunction(e,"",console.groupEnd||f)}withGroup(e,t,r){this.group(e,t)();try{r()}finally{this.groupEnd(e)()}}trace(){console.trace&&console.trace()}_shouldLog(e){return this.isEnabled()&&this.getLevel()>=_(e)}_getLogFunction(e,t,r,i,n){if(this._shouldLog(e)){n=A({logLevel:e,message:t,args:i,opts:n}),l(r=r||n.method),n.total=this.getTotal(),n.delta=this.getDelta(),this._deltaTs=u();let o=n.tag||n.message;if(n.once&&o){if(p[o])return f;p[o]=u()}return t=function(e,t,r){if("string"==typeof t){var i;let n;let o=r.time?function(e,t=8){let r=Math.max(t-e.length,0);return`${" ".repeat(r)}${e}`}((i=r.total)<10?`${i.toFixed(2)}ms`:i<100?`${i.toFixed(1)}ms`:i<1e3?`${i.toFixed(0)}ms`:`${(i/1e3).toFixed(2)}s`):"";t=function(e,t,r){if(!s.B&&"string"==typeof e){if(t){let r=a(t);e=`\u001b[${r}m${e}\u001b[39m`}if(r){let t=a(r);e=`\u001b[${t+10}m${e}\u001b[49m`}}return e}(t=r.time?`${e}: ${o}  ${t}`:`${e}: ${t}`,r.color,r.background)}return t}(this.id,n.message,n),r.bind(console,t,...n.args)}return f}}function _(e){let t;if(!e)return 0;switch(typeof e){case"number":t=e;break;case"object":t=e.logLevel||e.priority||0;break;default:return 0}return l(Number.isFinite(t)&&t>=0),t}function A(e){let{logLevel:t,message:r}=e;e.logLevel=_(t);let i=e.args?Array.from(e.args):[];for(;i.length&&i.shift()!==r;);switch(typeof t){case"string":case"function":void 0!==r&&i.unshift(r),e.message=t;break;case"object":Object.assign(e,t)}"function"==typeof e.message&&(e.message=e.message());let s=typeof e.message;return l("string"===s||"object"===s),Object.assign(e,{args:i},e.opts)}m.VERSION=n},46123:(e,t,r)=>{r.d(t,{e:()=>eJ});var i=r(54169),s=r(60263);let n={3042:!1,32773:new Float32Array([0,0,0,0]),32777:32774,34877:32774,32969:1,32968:0,32971:1,32970:0,3106:new Float32Array([0,0,0,0]),3107:[!0,!0,!0,!0],2884:!1,2885:1029,2929:!1,2931:1,2932:513,2928:new Float32Array([0,1]),2930:!0,3024:!0,35725:null,36006:null,36007:null,34229:null,34964:null,2886:2305,33170:4352,2849:1,32823:!1,32824:0,10752:0,32926:!1,32928:!1,32938:1,32939:!1,3089:!1,3088:new Int32Array([0,0,1024,1024]),2960:!1,2961:0,2968:0xffffffff,36005:0xffffffff,2962:519,2967:0,2963:0xffffffff,34816:519,36003:0,36004:0xffffffff,2964:7680,2965:7680,2966:7680,34817:7680,34818:7680,34819:7680,2978:[0,0,1024,1024],36389:null,36662:null,36663:null,35053:null,35055:null,35723:4352,36010:null,35977:!1,3333:4,3317:4,37440:!1,37441:!1,37443:37444,3330:0,3332:0,3331:0,3314:0,32878:0,3316:0,3315:0,32877:0},o=(e,t,r)=>t?e.enable(r):e.disable(r),a=(e,t,r)=>e.hint(r,t),l=(e,t,r)=>e.pixelStorei(r,t),h=(e,t,r)=>e.bindFramebuffer(36006===r?36009:36008,t),u=(e,t,r)=>{e.bindBuffer({34964:34962,36662:36662,36663:36663,35053:35051,35055:35052}[r],t)};function c(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}let d={3042:o,32773:(e,t)=>e.blendColor(...t),32777:"blendEquation",34877:"blendEquation",32969:"blendFunc",32968:"blendFunc",32971:"blendFunc",32970:"blendFunc",3106:(e,t)=>e.clearColor(...t),3107:(e,t)=>e.colorMask(...t),2884:o,2885:(e,t)=>e.cullFace(t),2929:o,2931:(e,t)=>e.clearDepth(t),2932:(e,t)=>e.depthFunc(t),2928:(e,t)=>e.depthRange(...t),2930:(e,t)=>e.depthMask(t),3024:o,35723:a,35725:(e,t)=>e.useProgram(t),36007:(e,t)=>e.bindRenderbuffer(36161,t),36389:(e,t)=>e.bindTransformFeedback?.(36386,t),34229:(e,t)=>e.bindVertexArray(t),36006:h,36010:h,34964:u,36662:u,36663:u,35053:u,35055:u,2886:(e,t)=>e.frontFace(t),33170:a,2849:(e,t)=>e.lineWidth(t),32823:o,32824:"polygonOffset",10752:"polygonOffset",35977:o,32926:o,32928:o,32938:"sampleCoverage",32939:"sampleCoverage",3089:o,3088:(e,t)=>e.scissor(...t),2960:o,2961:(e,t)=>e.clearStencil(t),2968:(e,t)=>e.stencilMaskSeparate(1028,t),36005:(e,t)=>e.stencilMaskSeparate(1029,t),2962:"stencilFuncFront",2967:"stencilFuncFront",2963:"stencilFuncFront",34816:"stencilFuncBack",36003:"stencilFuncBack",36004:"stencilFuncBack",2964:"stencilOpFront",2965:"stencilOpFront",2966:"stencilOpFront",34817:"stencilOpBack",34818:"stencilOpBack",34819:"stencilOpBack",2978:(e,t)=>e.viewport(...t),34383:o,10754:o,12288:o,12289:o,12290:o,12291:o,12292:o,12293:o,12294:o,12295:o,3333:l,3317:l,37440:l,37441:l,37443:l,3330:l,3332:l,3331:l,3314:l,32878:l,3316:l,3315:l,32877:l,framebuffer:(e,t)=>{let r=t&&"handle"in t?t.handle:t;return e.bindFramebuffer(36160,r)},blend:(e,t)=>t?e.enable(3042):e.disable(3042),blendColor:(e,t)=>e.blendColor(...t),blendEquation:(e,t)=>{e.blendEquationSeparate(..."number"==typeof t?[t,t]:t)},blendFunc:(e,t)=>{let r=t?.length===2?[...t,...t]:t;e.blendFuncSeparate(...r)},clearColor:(e,t)=>e.clearColor(...t),clearDepth:(e,t)=>e.clearDepth(t),clearStencil:(e,t)=>e.clearStencil(t),colorMask:(e,t)=>e.colorMask(...t),cull:(e,t)=>t?e.enable(2884):e.disable(2884),cullFace:(e,t)=>e.cullFace(t),depthTest:(e,t)=>t?e.enable(2929):e.disable(2929),depthFunc:(e,t)=>e.depthFunc(t),depthMask:(e,t)=>e.depthMask(t),depthRange:(e,t)=>e.depthRange(...t),dither:(e,t)=>t?e.enable(3024):e.disable(3024),derivativeHint:(e,t)=>{e.hint(35723,t)},frontFace:(e,t)=>e.frontFace(t),mipmapHint:(e,t)=>e.hint(33170,t),lineWidth:(e,t)=>e.lineWidth(t),polygonOffsetFill:(e,t)=>t?e.enable(32823):e.disable(32823),polygonOffset:(e,t)=>e.polygonOffset(...t),sampleCoverage:(e,t)=>e.sampleCoverage(t[0],t[1]||!1),scissorTest:(e,t)=>t?e.enable(3089):e.disable(3089),scissor:(e,t)=>e.scissor(...t),stencilTest:(e,t)=>t?e.enable(2960):e.disable(2960),stencilMask:(e,t)=>{let[r,i]=t=c(t)?t:[t,t];e.stencilMaskSeparate(1028,r),e.stencilMaskSeparate(1029,i)},stencilFunc:(e,t)=>{let[r,i,s,n,o,a]=t=c(t)&&3===t.length?[...t,...t]:t;e.stencilFuncSeparate(1028,r,i,s),e.stencilFuncSeparate(1029,n,o,a)},stencilOp:(e,t)=>{let[r,i,s,n,o,a]=t=c(t)&&3===t.length?[...t,...t]:t;e.stencilOpSeparate(1028,r,i,s),e.stencilOpSeparate(1029,n,o,a)},viewport:(e,t)=>e.viewport(...t)};function f(e,t,r){return void 0!==t[e]?t[e]:r[e]}let p={blendEquation:(e,t,r)=>e.blendEquationSeparate(f(32777,t,r),f(34877,t,r)),blendFunc:(e,t,r)=>e.blendFuncSeparate(f(32969,t,r),f(32968,t,r),f(32971,t,r),f(32970,t,r)),polygonOffset:(e,t,r)=>e.polygonOffset(f(32824,t,r),f(10752,t,r)),sampleCoverage:(e,t,r)=>e.sampleCoverage(f(32938,t,r),f(32939,t,r)),stencilFuncFront:(e,t,r)=>e.stencilFuncSeparate(1028,f(2962,t,r),f(2967,t,r),f(2963,t,r)),stencilFuncBack:(e,t,r)=>e.stencilFuncSeparate(1029,f(34816,t,r),f(36003,t,r),f(36004,t,r)),stencilOpFront:(e,t,r)=>e.stencilOpSeparate(1028,f(2964,t,r),f(2965,t,r),f(2966,t,r)),stencilOpBack:(e,t,r)=>e.stencilOpSeparate(1029,f(34817,t,r),f(34818,t,r),f(34819,t,r))},g={enable:(e,t)=>e({[t]:!0}),disable:(e,t)=>e({[t]:!1}),pixelStorei:(e,t,r)=>e({[t]:r}),hint:(e,t,r)=>e({[t]:r}),useProgram:(e,t)=>e({35725:t}),bindRenderbuffer:(e,t,r)=>e({36007:r}),bindTransformFeedback:(e,t,r)=>e({36389:r}),bindVertexArray:(e,t)=>e({34229:t}),bindFramebuffer:(e,t,r)=>{switch(t){case 36160:return e({36006:r,36010:r});case 36009:return e({36006:r});case 36008:return e({36010:r});default:return null}},bindBuffer:(e,t,r)=>{let i={34962:[34964],36662:[36662],36663:[36663],35051:[35053],35052:[35055]}[t];return i?e({[i]:r}):{valueChanged:!0}},blendColor:(e,t,r,i,s)=>e({32773:new Float32Array([t,r,i,s])}),blendEquation:(e,t)=>e({32777:t,34877:t}),blendEquationSeparate:(e,t,r)=>e({32777:t,34877:r}),blendFunc:(e,t,r)=>e({32969:t,32968:r,32971:t,32970:r}),blendFuncSeparate:(e,t,r,i,s)=>e({32969:t,32968:r,32971:i,32970:s}),clearColor:(e,t,r,i,s)=>e({3106:new Float32Array([t,r,i,s])}),clearDepth:(e,t)=>e({2931:t}),clearStencil:(e,t)=>e({2961:t}),colorMask:(e,t,r,i,s)=>e({3107:[t,r,i,s]}),cullFace:(e,t)=>e({2885:t}),depthFunc:(e,t)=>e({2932:t}),depthRange:(e,t,r)=>e({2928:new Float32Array([t,r])}),depthMask:(e,t)=>e({2930:t}),frontFace:(e,t)=>e({2886:t}),lineWidth:(e,t)=>e({2849:t}),polygonOffset:(e,t,r)=>e({32824:t,10752:r}),sampleCoverage:(e,t,r)=>e({32938:t,32939:r}),scissor:(e,t,r,i,s)=>e({3088:new Int32Array([t,r,i,s])}),stencilMask:(e,t)=>e({2968:t,36005:t}),stencilMaskSeparate:(e,t,r)=>e({[1028===t?2968:36005]:r}),stencilFunc:(e,t,r,i)=>e({2962:t,2967:r,2963:i,34816:t,36003:r,36004:i}),stencilFuncSeparate:(e,t,r,i,s)=>e({[1028===t?2962:34816]:r,[1028===t?2967:36003]:i,[1028===t?2963:36004]:s}),stencilOp:(e,t,r,i)=>e({2964:t,2965:r,2966:i,34817:t,34818:r,34819:i}),stencilOpSeparate:(e,t,r,i,s)=>e({[1028===t?2964:34817]:r,[1028===t?2965:34818]:i,[1028===t?2966:34819]:s}),viewport:(e,t,r,i,s)=>e({2978:[t,r,i,s]})},m=(e,t)=>e.isEnabled(t),_={3042:m,2884:m,2929:m,3024:m,32823:m,32926:m,32928:m,3089:m,2960:m,35977:m},A=new Set([34016,36388,36387,35983,35368,34965,35739,35738,3074,34853,34854,34855,34856,34857,34858,34859,34860,34861,34862,34863,34864,34865,34866,34867,34868,35097,32873,35869,32874,34068]);function E(e,t){if(function(e){for(let t in e)return!1;return!0}(t))return;let r={};for(let i in t){let s=Number(i),n=d[i];n&&("string"==typeof n?r[n]=!0:n(e,t[i],s))}let i=e.state&&e.state.cache;if(i)for(let s in r)(0,p[s])(e,t,i)}function b(e,t=n){if("number"==typeof t){let r=_[t];return r?r(e,t):e.getParameter(t)}let r=Array.isArray(t)?t:Object.keys(t),i={};for(let t of r){let r=_[t];i[t]=r?r(e,Number(t)):e.getParameter(Number(t))}return i}class y{static get(e){return e.state}gl;program=null;stateStack=[];enable=!0;cache=null;log;initialized=!1;constructor(e,t){this.gl=e,this.log=t?.log||(()=>{}),this._updateCache=this._updateCache.bind(this),Object.seal(this)}push(e={}){this.stateStack.push({})}pop(){let e=this.stateStack[this.stateStack.length-1];E(this.gl,e),this.stateStack.pop()}trackState(e,t){if(this.cache=t.copyState?b(e):Object.assign({},n),this.initialized)throw Error("WebGLStateTracker");for(let t in this.initialized=!0,this.gl.state=this,function(e){let t=e.useProgram.bind(e);e.useProgram=function(r){let i=y.get(e);i.program!==r&&(t(r),i.program=r)}}(e),g){let r=g[t];!function(e,t,r){if(!e[t])return;let i=e[t].bind(e);e[t]=function(...t){let{valueChanged:s,oldValue:n}=r(y.get(e)._updateCache,...t);return s&&i(...t),n},Object.defineProperty(e[t],"name",{value:`${t}-to-cache`,configurable:!1})}(e,t,r)}T(e,"getParameter"),T(e,"isEnabled")}_updateCache(e){let t,r=!1,i=this.stateStack.length>0?this.stateStack[this.stateStack.length-1]:null;for(let s in e){let n=e[s],o=this.cache[s];!function(e,t){if(e===t)return!0;let r=Array.isArray(e)||ArrayBuffer.isView(e),i=Array.isArray(t)||ArrayBuffer.isView(t);if(r&&i&&e.length===t.length){for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}return!1}(n,o)&&(r=!0,t=o,!i||s in i||(i[s]=o),this.cache[s]=n)}return{valueChanged:r,oldValue:t}}}function T(e,t){let r=e[t].bind(e);e[t]=function(t){if(void 0===t||A.has(t))return r(t);let i=y.get(e);return t in i.cache||(i.cache[t]=r(t)),i.enable?i.cache[t]:r(t)},Object.defineProperty(e[t],"name",{value:`${t}-from-cache`,configurable:!1})}function C(e,t,r){return void 0===r[t]&&(r[t]=e.getExtension(t)||null),r[t]}function v(e,t){return/NVIDIA/i.exec(e)||/NVIDIA/i.exec(t)?"nvidia":/INTEL/i.exec(e)||/INTEL/i.exec(t)?"intel":/Apple/i.exec(e)||/Apple/i.exec(t)?"apple":/AMD/i.exec(e)||/AMD/i.exec(t)||/ATI/i.exec(e)||/ATI/i.exec(t)?"amd":/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t)?"software":"unknown"}var R=r(58419);function S(e){switch(e){case"uint8":case"unorm8":return 5121;case"sint8":case"snorm8":return 5120;case"uint16":case"unorm16":return 5123;case"sint16":case"snorm16":return 5122;case"uint32":return 5125;case"sint32":return 5124;case"float16":return 5131;case"float32":return 5126}throw Error(String(e))}let B="WEBGL_compressed_texture_s3tc",w="WEBGL_compressed_texture_s3tc_srgb",M="EXT_texture_compression_rgtc",I="EXT_texture_compression_bptc",P="EXT_texture_norm16",L="EXT_render_snorm",O={"float32-renderable-webgl":["EXT_color_buffer_float"],"float16-renderable-webgl":["EXT_color_buffer_half_float"],"rgb9e5ufloat-renderable-webgl":["WEBGL_render_shared_exponent"],"snorm8-renderable-webgl":[L],"norm16-renderable-webgl":[P],"snorm16-renderable-webgl":[P,L],"float32-filterable":["OES_texture_float_linear"],"float16-filterable-webgl":["OES_texture_half_float_linear"],"texture-filterable-anisotropic-webgl":["EXT_texture_filter_anisotropic"],"texture-blend-float-webgl":["EXT_float_blend"],"texture-compression-bc":[B,w,M,I],"texture-compression-bc5-webgl":[M],"texture-compression-bc7-webgl":[I],"texture-compression-etc2":["WEBGL_compressed_texture_etc"],"texture-compression-astc":["WEBGL_compressed_texture_astc"],"texture-compression-etc1-webgl":["WEBGL_compressed_texture_etc1"],"texture-compression-pvrtc-webgl":["WEBGL_compressed_texture_pvrtc"],"texture-compression-atc-webgl":["WEBGL_compressed_texture_atc"]},x={r8unorm:{gl:33321,rb:!0},r8snorm:{gl:36756},r8uint:{gl:33330,rb:!0},r8sint:{gl:33329,rb:!0},rg8unorm:{gl:33323,rb:!0},rg8snorm:{gl:36757},rg8uint:{gl:33336,rb:!0},rg8sint:{gl:33335,rb:!0},r16uint:{gl:33332,rb:!0},r16sint:{gl:33331,rb:!0},r16float:{gl:33325,rb:!0},"r16unorm-webgl":{gl:33322,rb:!0},"r16snorm-webgl":{gl:36760},"rgba4unorm-webgl":{gl:32854,rb:!0},"rgb565unorm-webgl":{gl:36194,rb:!0},"rgb5a1unorm-webgl":{gl:32855,rb:!0},"rgb8unorm-webgl":{gl:32849},"rgb8snorm-webgl":{gl:36758},rgba8unorm:{gl:32856},"rgba8unorm-srgb":{gl:35907},rgba8snorm:{gl:36759},rgba8uint:{gl:36220},rgba8sint:{gl:36238},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{gl:33338},rg16sint:{gl:33337},rg16float:{gl:33327,rb:!0},"rg16unorm-webgl":{gl:33324},"rg16snorm-webgl":{gl:36761},r32uint:{gl:33334,rb:!0},r32sint:{gl:33333,rb:!0},r32float:{gl:33326},rgb9e5ufloat:{gl:35901},rg11b10ufloat:{gl:35898,rb:!0},rgb10a2unorm:{gl:32857,rb:!0},"rgb10a2uint-webgl":{gl:36975,rb:!0},"rgb16unorm-webgl":{gl:32852},"rgb16snorm-webgl":{gl:36762},rg32uint:{gl:33340,rb:!0},rg32sint:{gl:33339,rb:!0},rg32float:{gl:33328,rb:!0},rgba16uint:{gl:36214,rb:!0},rgba16sint:{gl:36232,rb:!0},rgba16float:{gl:34842},"rgba16unorm-webgl":{gl:32859,rb:!0},"rgba16snorm-webgl":{gl:36763},"rgb32float-webgl":{gl:34837,x:"EXT_color_buffer_float",dataFormat:6407,types:[5126]},rgba32uint:{gl:36208,rb:!0},rgba32sint:{gl:36226,rb:!0},rgba32float:{gl:34836,rb:!0},stencil8:{gl:36168,rb:!0},depth16unorm:{gl:33189,dataFormat:6402,types:[5123],rb:!0},depth24plus:{gl:33190,dataFormat:6402,types:[5125]},depth32float:{gl:36012,dataFormat:6402,types:[5126],rb:!0},"depth24plus-stencil8":{gl:35056,rb:!0,depthTexture:!0,dataFormat:34041,types:[34042]},"depth32float-stencil8":{gl:36013,dataFormat:34041,types:[36269],rb:!0},"bc1-rgb-unorm-webgl":{gl:33776,x:B},"bc1-rgb-unorm-srgb-webgl":{gl:35916,x:w},"bc1-rgba-unorm":{gl:33777,x:B},"bc1-rgba-unorm-srgb":{gl:35916,x:w},"bc2-rgba-unorm":{gl:33778,x:B},"bc2-rgba-unorm-srgb":{gl:35918,x:w},"bc3-rgba-unorm":{gl:33779,x:B},"bc3-rgba-unorm-srgb":{gl:35919,x:w},"bc4-r-unorm":{gl:36283,x:M},"bc4-r-snorm":{gl:36284,x:M},"bc5-rg-unorm":{gl:36285,x:M},"bc5-rg-snorm":{gl:36286,x:M},"bc6h-rgb-ufloat":{gl:36495,x:I},"bc6h-rgb-float":{gl:36494,x:I},"bc7-rgba-unorm":{gl:36492,x:I},"bc7-rgba-unorm-srgb":{gl:36493,x:I},"etc2-rgb8unorm":{gl:37492},"etc2-rgb8unorm-srgb":{gl:37494},"etc2-rgb8a1unorm":{gl:37496},"etc2-rgb8a1unorm-srgb":{gl:37497},"etc2-rgba8unorm":{gl:37493},"etc2-rgba8unorm-srgb":{gl:37495},"eac-r11unorm":{gl:37488},"eac-r11snorm":{gl:37489},"eac-rg11unorm":{gl:37490},"eac-rg11snorm":{gl:37491},"astc-4x4-unorm":{gl:37808},"astc-4x4-unorm-srgb":{gl:37840},"astc-5x4-unorm":{gl:37809},"astc-5x4-unorm-srgb":{gl:37841},"astc-5x5-unorm":{gl:37810},"astc-5x5-unorm-srgb":{gl:37842},"astc-6x5-unorm":{gl:37811},"astc-6x5-unorm-srgb":{gl:37843},"astc-6x6-unorm":{gl:37812},"astc-6x6-unorm-srgb":{gl:37844},"astc-8x5-unorm":{gl:37813},"astc-8x5-unorm-srgb":{gl:37845},"astc-8x6-unorm":{gl:37814},"astc-8x6-unorm-srgb":{gl:37846},"astc-8x8-unorm":{gl:37815},"astc-8x8-unorm-srgb":{gl:37847},"astc-10x5-unorm":{gl:37819},"astc-10x5-unorm-srgb":{gl:37851},"astc-10x6-unorm":{gl:37817},"astc-10x6-unorm-srgb":{gl:37849},"astc-10x8-unorm":{gl:37818},"astc-10x8-unorm-srgb":{gl:37850},"astc-10x10-unorm":{gl:37819},"astc-10x10-unorm-srgb":{gl:37851},"astc-12x10-unorm":{gl:37820},"astc-12x10-unorm-srgb":{gl:37852},"astc-12x12-unorm":{gl:37821},"astc-12x12-unorm-srgb":{gl:37853},"pvrtc-rgb4unorm-webgl":{gl:35840},"pvrtc-rgba4unorm-webgl":{gl:35842},"pvrtc-rbg2unorm-webgl":{gl:35841},"pvrtc-rgba2unorm-webgl":{gl:35843},"etc1-rbg-unorm-webgl":{gl:36196},"atc-rgb-unorm-webgl":{gl:35986},"atc-rgba-unorm-webgl":{gl:35986},"atc-rgbai-unorm-webgl":{gl:34798}};function N(e){let t=x[e],r=function(e){let t=x[e],r=t?.gl;if(void 0===r)throw Error(`Unsupported texture format ${e}`);return r}(e),i=(0,R.z)(e);return{internalFormat:r,format:t?.dataFormat||function(e,t,r,i){if(6408===i||6407===i)return i;switch(e){case"r":return t&&!r?36244:6403;case"rg":return t&&!r?33320:33319;case"rgb":return t&&!r?36248:6407;case"rgba":return t&&!r?36249:6408;case"bgra":throw Error("bgra pixels not supported by WebGL");default:return 6408}}(i.channels,i.integer,i.normalized,r),type:i.dataType?S(i.dataType):t?.types?.[0]||5121,compressed:i.compressed||!1}}let F={"depth-clip-control":"EXT_depth_clamp","timer-query-webgl":"EXT_disjoint_timer_query_webgl2","compilation-status-async-webgl":"KHR_parallel_shader_compile","polygon-mode-webgl":"WEBGL_polygon_mode","provoking-vertex-webgl":"WEBGL_provoking_vertex","shader-clip-cull-distance-webgl":"WEBGL_clip_cull_distance","shader-noperspective-interpolation-webgl":"NV_shader_noperspective_interpolation","shader-conservative-depth-webgl":"EXT_conservative_depth"};class D extends i.I7{gl;extensions;testedFeatures=new Set;constructor(e,t,r){super([],r),this.gl=e,this.extensions=t,C(e,"EXT_color_buffer_float",t)}*[Symbol.iterator](){for(let e of this.getFeatures())this.has(e)&&(yield e);return[]}has(e){if(this.disabledFeatures?.[e])return!1;if(!this.testedFeatures.has(e)){var t,r;this.testedFeatures.add(e),e in O&&(t=this.gl,r=this.extensions,(O[e]||[]).every(e=>C(t,e,r)))&&this.features.add(e),this.getWebGLFeature(e)&&this.features.add(e)}return this.features.has(e)}initializeFeatures(){for(let e of this.getFeatures().filter(e=>"polygon-mode-webgl"!==e))this.has(e)}getFeatures(){return[...Object.keys(F),...Object.keys(O)]}getWebGLFeature(e){let t=F[e];return"string"==typeof t?!!C(this.gl,t,this.extensions):!!t}}class U extends i.PI{get maxTextureDimension1D(){return 0}get maxTextureDimension2D(){return this.getParameter(3379)}get maxTextureDimension3D(){return this.getParameter(32883)}get maxTextureArrayLayers(){return this.getParameter(35071)}get maxBindGroups(){return 0}get maxDynamicUniformBuffersPerPipelineLayout(){return 0}get maxDynamicStorageBuffersPerPipelineLayout(){return 0}get maxSampledTexturesPerShaderStage(){return this.getParameter(35660)}get maxSamplersPerShaderStage(){return this.getParameter(35661)}get maxStorageBuffersPerShaderStage(){return 0}get maxStorageTexturesPerShaderStage(){return 0}get maxUniformBuffersPerShaderStage(){return this.getParameter(35375)}get maxUniformBufferBindingSize(){return this.getParameter(35376)}get maxStorageBufferBindingSize(){return 0}get minUniformBufferOffsetAlignment(){return this.getParameter(35380)}get minStorageBufferOffsetAlignment(){return 0}get maxVertexBuffers(){return 16}get maxVertexAttributes(){return this.getParameter(34921)}get maxVertexBufferArrayStride(){return 2048}get maxInterStageShaderComponents(){return this.getParameter(35659)}get maxComputeWorkgroupStorageSize(){return 0}get maxComputeInvocationsPerWorkgroup(){return 0}get maxComputeWorkgroupSizeX(){return 0}get maxComputeWorkgroupSizeY(){return 0}get maxComputeWorkgroupSizeZ(){return 0}get maxComputeWorkgroupsPerDimension(){return 0}gl;limits={};constructor(e){super(),this.gl=e}getParameter(e){return void 0===this.limits[e]&&(this.limits[e]=this.gl.getParameter(e)),this.limits[e]||0}}var G=r(83003),k=r(67171);class H{static defaultProps={canvas:null,width:800,height:600,useDevicePixels:!0,autoResize:!0,container:null,visible:!0,alphaMode:"opaque",colorSpace:"srgb"};id;props;canvas;htmlCanvas;offscreenCanvas;type;width=1;height=1;resizeObserver;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};toString(){return`${this[Symbol.toStringTag]}(${this.id})`}constructor(e){if(this.props={...H.defaultProps,...e},e=this.props,!(0,G.B)()){this.id="node-canvas-context",this.type="node",this.width=this.props.width,this.height=this.props.height,this.canvas=null;return}if(e.canvas)"string"==typeof e.canvas?this.canvas=function(e){let t=document.getElementById(e);if(!(t instanceof HTMLCanvasElement))throw Error("Object is not a canvas element");return t}(e.canvas):this.canvas=e.canvas;else{let t=function(e){let{width:t,height:r}=e,i=document.createElement("canvas");return i.id=(0,k.L)("lumagl-auto-created-canvas"),i.width=t||1,i.height=r||1,i.style.width=Number.isFinite(t)?`${t}px`:"100%",i.style.height=Number.isFinite(r)?`${r}px`:"100%",i}(e),r=function(e){if("string"==typeof e){let t=document.getElementById(e);if(!t)throw Error(`${e} is not an HTML element`);return t}return e||document.body}(e?.container||null);r.insertBefore(t,r.firstChild),this.canvas=t,e?.visible||(this.canvas.style.visibility="hidden")}this.canvas instanceof HTMLCanvasElement?(this.id=this.canvas.id,this.type="html-canvas",this.htmlCanvas=this.canvas):(this.id="offscreen-canvas",this.type="offscreen-canvas",this.offscreenCanvas=this.canvas),this.canvas instanceof HTMLCanvasElement&&e.autoResize&&(this.resizeObserver=new ResizeObserver(e=>{for(let t of e)t.target===this.canvas&&this.update()}),this.resizeObserver.observe(this.canvas))}getDevicePixelRatio(e){return"undefined"!=typeof OffscreenCanvas&&this.canvas instanceof OffscreenCanvas||!(e=void 0===e?this.props.useDevicePixels:e)||e<=0?1:!0===e?"undefined"!=typeof window&&window.devicePixelRatio||1:e}getPixelSize(){switch(this.type){case"node":return[this.width,this.height];case"offscreen-canvas":return[this.canvas.width,this.canvas.height];case"html-canvas":let e=this.getDevicePixelRatio(),t=this.canvas;return t.parentElement?[t.clientWidth*e,t.clientHeight*e]:[this.canvas.width,this.canvas.height];default:throw Error(this.type)}}getAspect(){let[e,t]=this.getPixelSize();return e/t}cssToDeviceRatio(){try{let[e]=this.getDrawingBufferSize(),t=this._canvasSizeInfo.clientWidth||this.htmlCanvas?.clientWidth;return t?e/t:1}catch{return 1}}cssToDevicePixels(e,t=!0){let r=this.cssToDeviceRatio(),[i,s]=this.getDrawingBufferSize();return function(e,t,r,i,s){let n;let o=V(e[0],t,r),a=j(e[1],t,i,s),l=V(e[0]+1,t,r),h=l===r-1?l:l-1;return l=j(e[1]+1,t,i,s),s?(l=0===l?l:l+1,n=a,a=l):n=l===i-1?l:l-1,{x:o,y:a,width:Math.max(h-o+1,1),height:Math.max(n-a+1,1)}}(e,r,i,s,t)}setDevicePixelRatio(e,t={}){if(!this.htmlCanvas)return;let r="width"in t?t.width:this.htmlCanvas.clientWidth,i="height"in t?t.height:this.htmlCanvas.clientHeight;r&&i||(s.R.log(1,"Canvas clientWidth/clientHeight is 0")(),e=1,r=this.htmlCanvas.width||1,i=this.htmlCanvas.height||1);let n=this._canvasSizeInfo;if(n.clientWidth!==r||n.clientHeight!==i||n.devicePixelRatio!==e){let t=e,n=Math.floor(r*t),o=Math.floor(i*t);if(this.htmlCanvas.width=n,this.htmlCanvas.height=o,this.device.gl){let[a,l]=this.getDrawingBufferSize();(a!==n||l!==o)&&(t=Math.min(a/r,l/i),this.htmlCanvas.width=Math.floor(r*t),this.htmlCanvas.height=Math.floor(i*t),s.R.warn("Device pixel ratio clamped")()),this._canvasSizeInfo.clientWidth=r,this._canvasSizeInfo.clientHeight=i,this._canvasSizeInfo.devicePixelRatio=e}}}getDrawingBufferSize(){let e=this.device.gl;return e?[e.drawingBufferWidth,e.drawingBufferHeight]:this.getPixelSize()}_setAutoCreatedCanvasId(e){this.htmlCanvas?.id==="lumagl-auto-created-canvas"&&(this.htmlCanvas.id=e)}}function V(e,t,r){return Math.min(Math.round(e*t),r-1)}function j(e,t,r,i){return i?Math.max(0,r-1-Math.round(e*t)):Math.min(Math.round(e*t),r-1)}var W=r(32167),z=r(26106);class X extends W.F{static defaultProps={...W.F.defaultProps,width:1,height:1,colorAttachments:[],depthStencilAttachment:null};get[Symbol.toStringTag](){return"Framebuffer"}width;height;constructor(e,t={}){super(e,t,X.defaultProps),this.width=this.props.width,this.height=this.props.height}clone(e){let t=this.colorAttachments.map(t=>t.texture.clone(e)),r=this.depthStencilAttachment&&this.depthStencilAttachment.texture.clone(e);return this.device.createFramebuffer({...this.props,colorAttachments:t,depthStencilAttachment:r})}resize(e){let t=!e;if(e){let[r,i]=Array.isArray(e)?e:[e.width,e.height];t=t||i!==this.height||r!==this.width,this.width=r,this.height=i}t&&(s.R.log(2,`Resizing framebuffer ${this.id} to ${this.width}x${this.height}`)(),this.resizeAttachments(this.width,this.height))}autoCreateAttachmentTextures(){if(0===this.props.colorAttachments.length&&!this.props.depthStencilAttachment)throw Error("Framebuffer has noattachments");this.colorAttachments=this.props.colorAttachments.map((e,t)=>{if("string"==typeof e){let r=this.createColorTexture(e,t);return this.attachResource(r),r.view}return e instanceof z.g?e.view:e});let e=this.props.depthStencilAttachment;if(e){if("string"==typeof e){let t=this.createDepthStencilTexture(e);this.attachResource(t),this.depthStencilAttachment=t.view}else e instanceof z.g?this.depthStencilAttachment=e.view:this.depthStencilAttachment=e}}createColorTexture(e,t){return this.device.createTexture({id:`${this.id}-color-attachment-${t}`,usage:z.g.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,sampler:{magFilter:"linear",minFilter:"linear"}})}createDepthStencilTexture(e){return this.device.createTexture({id:`${this.id}-depth-stencil-attachment`,usage:z.g.RENDER_ATTACHMENT,format:e,width:this.width,height:this.height,mipmaps:!1})}resizeAttachments(e,t){for(let r=0;r<this.colorAttachments.length;++r)if(this.colorAttachments[r]){let i=this.colorAttachments[r].texture.clone({width:e,height:t});this.destroyAttachedResource(this.colorAttachments[r]),this.colorAttachments[r]=i.view,this.attachResource(i.view)}if(this.depthStencilAttachment){let r=this.depthStencilAttachment.texture.clone({width:e,height:t});this.destroyAttachedResource(this.depthStencilAttachment),this.depthStencilAttachment=r.view,this.attachResource(r)}this.updateAttachments()}}class K extends X{device;gl;handle;colorAttachments=[];depthStencilAttachment=null;constructor(e,t){super(e,t);let r=null===t.handle;this.device=e,this.gl=e.gl,this.handle=this.props.handle||r?this.props.handle:this.gl.createFramebuffer(),r||(e.setSpectorMetadata(this.handle,{id:this.props.id,props:this.props}),this.autoCreateAttachmentTextures(),this.updateAttachments())}destroy(){super.destroy(),this.destroyed||null===this.handle||this.gl.deleteFramebuffer(this.handle)}updateAttachments(){let e=this.gl.bindFramebuffer(36160,this.handle);for(let e=0;e<this.colorAttachments.length;++e){let t=this.colorAttachments[e];if(t){let r=36064+e;this._attachTextureView(r,t)}}if(this.depthStencilAttachment){let e=function(e){switch((0,R.z)(e).attachment){case"depth":return 36096;case"stencil":return 36128;case"depth-stencil":return 33306;default:throw Error(`Not a depth stencil format: ${e}`)}}(this.depthStencilAttachment.props.format);this._attachTextureView(e,this.depthStencilAttachment)}if(this.device.props.debug){let e=this.gl.checkFramebufferStatus(36160);if(36053!==e)throw Error(`Framebuffer ${function(e){switch(e){case 36053:return"success";case 36054:return"Mismatched attachments";case 36055:return"No attachments";case 36057:return"Height/width mismatch";case 36061:return"Unsupported or split attachments";case 36182:return"Samples mismatch";default:return`${e}`}}(e)}`)}this.gl.bindFramebuffer(36160,e)}_attachTextureView(e,t){let{gl:r}=this.device,{texture:i}=t,s=t.props.baseMipLevel,n=t.props.baseArrayLayer;switch(r.bindTexture(i.glTarget,i.handle),i.glTarget){case 35866:case 32879:r.framebufferTextureLayer(36160,e,i.handle,s,n);break;case 34067:var o;let a=(o=n)<34069?o+34069:o;r.framebufferTexture2D(36160,e,a,i.handle,s);break;case 3553:r.framebufferTexture2D(36160,e,3553,i.handle,s);break;default:throw Error("Illegal texture type")}r.bindTexture(i.glTarget,null)}}class J extends H{device;format="rgba8unorm";depthStencilFormat="depth24plus";presentationSize;_framebuffer=null;get[Symbol.toStringTag](){return"WebGLCanvasContext"}constructor(e,t){super(t),this.device=e,this.presentationSize=[-1,-1],this._setAutoCreatedCanvasId(`${this.device.id}-canvas`),this.update()}getCurrentFramebuffer(){return this.update(),this._framebuffer=this._framebuffer||new K(this.device,{handle:null}),this._framebuffer}update(){let e=this.getPixelSize();(e[0]!==this.presentationSize[0]||e[1]!==this.presentationSize[1])&&(this.presentationSize=e,this.resize())}resize(e){if(this.device.gl&&this.canvas){let t=this.getDevicePixelRatio(e?.useDevicePixels);this.setDevicePixelRatio(t,e);return}}commit(){}}var $=r(22217),Y=r(32692);let q={};var Q=r(609);class Z extends Q.h{device;gl;handle;glTarget;glUsage;glIndexType=5123;byteLength;bytesUsed;constructor(e,t={}){super(e,t),this.device=e,this.gl=this.device.gl;let r="object"==typeof t?t.handle:void 0;this.handle=r||this.gl.createBuffer(),e.setSpectorMetadata(this.handle,{...this.props,data:typeof this.props.data}),this.glTarget=function(e){return e&Q.h.INDEX?34963:e&Q.h.VERTEX?34962:e&Q.h.UNIFORM?35345:34962}(this.props.usage),this.glUsage=function(e){return e&Q.h.INDEX||e&Q.h.VERTEX?35044:e&Q.h.UNIFORM?35048:35044}(this.props.usage),this.glIndexType="uint32"===this.props.indexType?5125:5123,t.data?this._initWithData(t.data,t.byteOffset,t.byteLength):this._initWithByteLength(t.byteLength||0)}_initWithData(e,t=0,r=e.byteLength+t){let i=this.glTarget;this.gl.bindBuffer(i,this.handle),this.gl.bufferData(i,r,this.glUsage),this.gl.bufferSubData(i,t,e),this.gl.bindBuffer(i,null),this.bytesUsed=r,this.byteLength=r,this._setDebugData(e,t,r),this.trackAllocatedMemory(r)}_initWithByteLength(e){let t=e;0===e&&(t=new Float32Array(0));let r=this.glTarget;return this.gl.bindBuffer(r,this.handle),this.gl.bufferData(r,t,this.glUsage),this.gl.bindBuffer(r,null),this.bytesUsed=e,this.byteLength=e,this._setDebugData(null,0,e),this.trackAllocatedMemory(e),this}destroy(){!this.destroyed&&this.handle&&(this.removeStats(),this.trackDeallocatedMemory(),this.gl.deleteBuffer(this.handle),this.destroyed=!0,this.handle=null)}write(e,t=0){let r=void 0;this.gl.bindBuffer(36663,this.handle),void 0!==r?this.gl.bufferSubData(36663,t,e,0,r):this.gl.bufferSubData(36663,t,e),this.gl.bindBuffer(36663,null),this._setDebugData(e,t,e.byteLength)}async readAsync(e=0,t){return this.readSyncWebGL(e,t)}readSyncWebGL(e=0,t){let r=new Uint8Array(t=t??this.byteLength-e);return this.gl.bindBuffer(36662,this.handle),this.gl.getBufferSubData(36662,e,r,0,t),this.gl.bindBuffer(36662,null),this._setDebugData(r,e,t),r}}var ee=r(53422);function et(e){let t=e.toLowerCase();return["warning","error","info"].includes(t)?t:"info"}class er extends ee.M{device;handle;constructor(e,t){switch(super(e,t),this.device=e,this.props.stage){case"vertex":this.handle=this.props.handle||this.device.gl.createShader(35633);break;case"fragment":this.handle=this.props.handle||this.device.gl.createShader(35632);break;default:throw Error(this.props.stage)}this._compile(this.source)}destroy(){this.handle&&(this.removeStats(),this.device.gl.deleteShader(this.handle),this.destroyed=!0)}get asyncCompilationStatus(){return this._waitForCompilationComplete().then(()=>this.compilationStatus)}async getCompilationInfo(){return await this._waitForCompilationComplete(),this.getCompilationInfoSync()}getCompilationInfoSync(){let e=this.device.gl.getShaderInfoLog(this.handle);return e?function(e){let t=e.split(/\r?\n/),r=[];for(let e of t){if(e.length<=1)continue;let t=e.split(":");if(2===t.length){let[e,i]=t;r.push({message:i.trim(),type:et(e),lineNum:0,linePos:0});continue}let[i,s,n,...o]=t,a=parseInt(n,10);isNaN(a)&&(a=0);let l=parseInt(s,10);isNaN(l)&&(l=0),r.push({message:o.join(":").trim(),type:et(i),lineNum:a,linePos:l})}return r}(e):[]}getTranslatedSource(){let e=this.device.getExtension("WEBGL_debug_shaders").WEBGL_debug_shaders;return e?.getTranslatedShaderSource(this.handle)||null}async _compile(e){e=e.startsWith("#version ")?e:`#version 300 es
${e}`;let{gl:t}=this.device;if(t.shaderSource(this.handle,e),t.compileShader(this.handle),!this.device.props.debug){this.compilationStatus="pending";return}if(!this.device.features.has("compilation-status-async-webgl")){if(this._getCompilationStatus(),this.debugShader(),"error"===this.compilationStatus)throw Error(`GLSL compilation errors in ${this.props.stage} shader ${this.props.id}`);return}s.R.once(1,"Shader compilation is asynchronous")(),await this._waitForCompilationComplete(),s.R.info(2,`Shader ${this.id} - async compilation complete: ${this.compilationStatus}`)(),this._getCompilationStatus(),this.debugShader()}async _waitForCompilationComplete(){let e=async e=>await new Promise(t=>setTimeout(t,e));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}let{gl:t}=this.device;for(;;){if(t.getShaderParameter(this.handle,37297))return;await e(10)}}_getCompilationStatus(){this.compilationStatus=this.device.gl.getShaderParameter(this.handle,35713)?"success":"error"}}var ei=r(15101);function es(e,t){return el(e,t,{never:512,less:513,equal:514,"less-equal":515,greater:516,"not-equal":517,"greater-equal":518,always:519})}function en(e,t){return el(e,t,{keep:7680,zero:0,replace:7681,invert:5386,"increment-clamp":7682,"decrement-clamp":7683,"increment-wrap":34055,"decrement-wrap":34056})}function eo(e,t){return el(e,t,{add:32774,subtract:32778,"reverse-subtract":32779,min:32775,max:32776})}function ea(e,t){return el(e,t,{one:1,zero:0,"src-color":768,"one-minus-src-color":769,"dst-color":774,"one-minus-dst-color":775,"src-alpha":770,"one-minus-src-alpha":771,"dst-alpha":772,"one-minus-dst-alpha":773,"src-alpha-saturated":776,"constant-color":32769,"one-minus-constant-color":32770,"constant-alpha":32771,"one-minus-constant-alpha":32772})}function el(e,t,r){if(!(t in r))throw Error(`Illegal parameter ${t} for ${e}`);return r[t]}function eh(e){let t={};return e.addressModeU&&(t[10242]=eu(e.addressModeU)),e.addressModeV&&(t[10243]=eu(e.addressModeV)),e.addressModeW&&(t[32882]=eu(e.addressModeW)),e.magFilter&&(t[10240]=ec(e.magFilter)),(e.minFilter||e.mipmapFilter)&&(t[10241]=function(e,t="none"){if(!t)return ec(e);switch(t){case"none":return ec(e);case"nearest":return"nearest"===e?9984:9986;case"linear":return"nearest"===e?9985:9987}}(e.minFilter||"linear",e.mipmapFilter)),void 0!==e.lodMinClamp&&(t[33082]=e.lodMinClamp),void 0!==e.lodMaxClamp&&(t[33083]=e.lodMaxClamp),"comparison-sampler"===e.type&&(t[34892]=34894),e.compare&&(t[34893]=es("compare",e.compare)),e.maxAnisotropy&&(t[34046]=e.maxAnisotropy),t}function eu(e){switch(e){case"clamp-to-edge":return 33071;case"repeat":return 10497;case"mirror-repeat":return 33648}}function ec(e){switch(e){case"nearest":return 9728;case"linear":return 9729}}class ed extends ei.L{device;handle;parameters;constructor(e,t){super(e,t),this.device=e,this.parameters=eh(t),this.handle=this.handle||this.device.gl.createSampler(),this._setSamplerParameters(this.parameters)}destroy(){this.handle&&(this.device.gl.deleteSampler(this.handle),this.handle=void 0)}toString(){return`Sampler(${this.id},${JSON.stringify(this.props)})`}_setSamplerParameters(e){for(let[t,r]of Object.entries(e)){let e=Number(t);switch(e){case 33082:case 33083:this.device.gl.samplerParameterf(this.handle,e,r);break;default:this.device.gl.samplerParameteri(this.handle,e,r)}}}}var ef=r(10184);class ep extends ef.X{device;gl;handle;texture;constructor(e,t){super(e,{...z.g.defaultProps,...t}),this.device=e,this.gl=this.device.gl,this.handle=null,this.texture=t.texture}}function eg(e){switch(e){case 6406:case 33326:case 6403:case 36244:return 1;case 33339:case 33340:case 33328:case 33320:case 33319:return 2;case 6407:case 36248:case 34837:return 3;case 6408:case 36249:case 34836:return 4;default:return 0}}function em(e,t,r){let i;if(function(e){for(let t in e)return!1;return!0}(t))return r(e);let{nocatch:s=!0}=t,n=y.get(e);if(n.push(),E(e,t),s)i=r(e),n.pop();else try{i=r(e)}finally{n.pop()}return i}function e_(e,t,r,i){let{width:s,height:n}=i,{dimension:o,depth:a=0,mipLevel:l=0}=i,{x:h=0,y:u=0,z:c=0}=i,{glFormat:d,glType:f}=i,p=eE(i.glTarget,o,a);em(e,i.flipY?{37440:!0}:{},()=>{switch(o){case"2d-array":case"3d":e.bindTexture(p,t),e.texSubImage3D(p,l,h,u,c,s,n,a,d,f,r),e.bindTexture(p,null);break;case"2d":case"cube":e.bindTexture(p,t),e.texSubImage2D(p,l,h,u,s,n,d,f,r),e.bindTexture(p,null);break;default:throw Error(o)}})}function eA(e,t,r){let{dimension:i,width:s,height:n,depth:o=0,mipLevel:a=0,byteOffset:l=0}=r,{x:h=0,y:u=0,z:c=0}=r,{glFormat:d,glType:f,compressed:p}=r,g=eE(r.glTarget,i,o);switch(i){case"2d-array":case"3d":p?e.compressedTexSubImage3D(g,a,h,u,c,s,n,o,d,t,l):e.texSubImage3D(g,a,h,u,c,s,n,o,d,f,t,l);break;case"2d":case"cube":p?e.compressedTexSubImage2D(g,a,h,u,s,n,d,t,l):e.texSubImage2D(g,a,h,u,s,n,d,f,t,l);break;default:throw Error(i)}}function eE(e,t,r){return"cube"===t?34069+r:e}function eb(e){return e instanceof X?{framebuffer:e,deleteFramebuffer:!1}:{framebuffer:function(e,t){let{device:r,width:i,height:s,id:n}=e;return r.createFramebuffer({id:`framebuffer-for-${n}`,width:i,height:s,colorAttachments:[e]})}(e),deleteFramebuffer:!0}}class ey extends z.g{device;gl;handle;sampler=void 0;view=void 0;mipmaps;compressed;glTarget;glFormat;glType;glInternalFormat;textureUnit=0;constructor(e,t){super(e,t);let r={...this.props};r.data=t.data,this.device=e,this.gl=this.device.gl,this.glTarget=function(e){switch(e){case"1d":break;case"2d":return 3553;case"3d":return 32879;case"cube":return 34067;case"2d-array":return 35866}throw Error(e)}(this.props.dimension);let i=N(this.props.format);this.glInternalFormat=i.internalFormat,this.glFormat=i.format,this.glType=i.type,this.compressed=i.compressed,this.mipmaps=!!this.props.mipmaps,this._initialize(r),Object.seal(this)}_initialize(e){this.handle=this.props.handle||this.gl.createTexture(),this.device.setSpectorMetadata(this.handle,{...this.props,data:e.data});let{width:t,height:r}=e;if(!t||!r){let i=z.g.getTextureDataSize(e.data);t=i?.width||1,r=i?.height||1}if(this.width=t,this.height=r,this.depth=e.depth,this.setSampler(e.sampler),this.view=new ep(this.device,{...this.props,texture:this}),this.bind(),!function(e,t,r){let{dimension:i,width:s,height:n,depth:o=0}=r,{glInternalFormat:a}=r,l=r.glTarget;switch(i){case"2d-array":case"3d":e.texStorage3D(l,t,a,s,n,o);break;default:e.texStorage2D(l,t,a,s,n)}}(this.gl,this.mipLevels,this),e.data)switch(e.dimension){case"1d":this.setTexture1DData(e.data);break;case"2d":this.setTexture2DData(e.data);break;case"3d":this.setTexture3DData(e.data);break;case"cube":this.setTextureCubeData(e.data);break;case"2d-array":this.setTextureArrayData(e.data);break;case"cube-array":this.setTextureCubeArrayData(e.data);break;default:throw Error(e.dimension)}this.mipmaps&&this.generateMipmap()}destroy(){this.handle&&(this.gl.deleteTexture(this.handle),this.removeStats(),this.trackDeallocatedMemory("Texture"),this.destroyed=!0)}createView(e){return new ep(this.device,{...e,texture:this})}setSampler(e={}){let t;e instanceof ed?(this.sampler=e,t=e.props):(this.sampler=new ed(this.device,e),t=e);let r=eh(t);this._setSamplerParameters(r)}generateMipmap(e){if(this.device.isTextureFormatRenderable(this.props.format)&&this.device.isTextureFormatFilterable(this.props.format)||(s.R.warn(`${this} is not renderable or filterable, may not be able to generate mipmaps`)(),e?.force))try{this.gl.bindTexture(this.glTarget,this.handle),this.gl.generateMipmap(this.glTarget)}catch(e){s.R.warn(`Error generating mipmap for ${this}: ${e.message}`)()}finally{this.gl.bindTexture(this.glTarget,null)}}copyExternalImage(e){let t=z.g.getExternalImageSize(e.image),r={...z.g.defaultCopyExternalImageOptions,...t,...e},{image:i,depth:s,mipLevel:n,x:o,y:a,z:l,flipY:h}=r,{width:u,height:c}=r,{dimension:d,glTarget:f,glFormat:p,glInternalFormat:g,glType:m}=this;if(u=Math.min(u,this.width-o),c=Math.min(c,this.height-a),e.sourceX||e.sourceY)throw Error("WebGL does not support sourceX/sourceY)");return e_(this.device.gl,this.handle,i,{dimension:d,mipLevel:n,x:o,y:a,z:l,width:u,height:c,depth:s,glFormat:p,glInternalFormat:g,glType:m,glTarget:f,flipY:h}),{width:r.width,height:r.height}}setTexture1DData(e){throw Error("setTexture1DData not supported in WebGL.")}setTexture2DData(e,t=0){this.bind();let r=z.g.normalizeTextureData(e,this);r.length>1&&!1!==this.props.mipmaps&&s.R.warn(`Texture ${this.id} mipmap and multiple LODs.`)();for(let e=0;e<r.length;e++){let i=r[e];this._setMipLevel(t,e,i)}this.unbind()}setTexture3DData(e){if("3d"!==this.props.dimension)throw Error(this.id);ArrayBuffer.isView(e)&&(this.bind(),eA(this.device.gl,e,this),this.unbind())}setTextureCubeData(e,t=0){if("cube"!==this.props.dimension)throw Error(this.id);for(let t of z.g.CubeFaces)this.setTextureCubeFaceData(e[t],t)}setTextureArrayData(e){if("2d-array"!==this.props.dimension)throw Error(this.id);throw Error("setTextureArrayData not implemented.")}setTextureCubeArrayData(e){throw Error("setTextureCubeArrayData not supported in WebGL2.")}setTextureCubeFaceData(e,t,r=0){Array.isArray(e)&&e.length>1&&!1!==this.props.mipmaps&&s.R.warn(`${this.id} has mipmap and multiple LODs.`)();let i=z.g.CubeFaces.indexOf(t);this.setTexture2DData(e,i)}update(){throw Error("Texture.update() not implemented. Use ExternalTexture")}setImageDataForFace(e){let{face:t,width:r,height:i,pixels:s,data:n,format:o=6408,type:a=5121}=e,{gl:l}=this,h=s||n;this.bind(),h instanceof Promise?h.then(r=>this.setImageDataForFace(Object.assign({},e,{face:t,data:r,pixels:r}))):this.width||this.height?l.texImage2D(t,0,o,r,i,0,o,a,h):l.texImage2D(t,0,o,o,a,h)}_getImageDataMap(e){for(let t=0;t<z.g.CubeFaces.length;++t){let r=z.g.CubeFaces[t];e[r]&&(e[34069+t]=e[r],delete e[r])}return e}_setSamplerParameters(e){for(let[t,r]of(s.R.log(1,`${this.id} sampler parameters`,this.device.getGLKeys(e))(),this.gl.bindTexture(this.glTarget,this.handle),Object.entries(e))){let e=Number(t);switch(e){case 33082:case 33083:this.gl.texParameterf(this.glTarget,e,r);break;case 10241:case 10242:case 10243:default:this.gl.texParameteri(this.glTarget,e,r);break;case 34046:this.device.features.has("texture-filterable-anisotropic-webgl")&&this.gl.texParameteri(this.glTarget,e,r)}}this.gl.bindTexture(this.glTarget,null)}_setMipLevel(e,t,r,i=this.glTarget){if(z.g.isExternalImage(r)){e_(this.device.gl,this.handle,r,{...this,depth:e,mipLevel:t,glTarget:i,flipY:this.props.flipY});return}if(z.g.isTextureLevelData(r)){eA(this.device.gl,r.data,{...this,depth:e,mipLevel:t,glTarget:i});return}throw Error("Texture: invalid image data")}getActiveUnit(){return this.gl.getParameter(34016)-33984}bind(e){let{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,this.handle),e}unbind(e){let{gl:t}=this;return void 0!==e&&(this.textureUnit=e,t.activeTexture(33984+e)),t.bindTexture(this.glTarget,null),e}}class eT extends W.F{static defaultClearColor=[0,0,0,1];static defaultClearDepth=1;static defaultClearStencil=0;static defaultProps={...W.F.defaultProps,framebuffer:null,parameters:void 0,clearColor:eT.defaultClearColor,clearColors:void 0,clearDepth:eT.defaultClearDepth,clearStencil:eT.defaultClearStencil,depthReadOnly:!1,stencilReadOnly:!1,discard:!1,occlusionQuerySet:void 0,timestampQuerySet:void 0,beginTimestampIndex:void 0,endTimestampIndex:void 0};get[Symbol.toStringTag](){return"RenderPass"}constructor(e,t){super(e,t=eT.normalizeProps(e,t),eT.defaultProps)}static normalizeProps(e,t){return{...e.props._resourceDefaults?.renderPass,...t}}}let eC=[1,2,4,8];class ev extends eT{device;glParameters;constructor(e,t){let r;if(super(e,t),this.device=e,!t?.parameters?.viewport){if(t?.framebuffer){let{width:e,height:i}=t.framebuffer;r=[0,0,e,i]}else{let[t,i]=e.getCanvasContext().getDrawingBufferSize();r=[0,0,t,i]}}this.device.pushState(),this.setParameters({viewport:r,...this.props.parameters});let i=this.props.framebuffer;if(i?.handle){if(this.props.framebuffer){let e=this.props.framebuffer.colorAttachments.map((e,t)=>36064+t);this.device.gl.drawBuffers(e)}else this.device.gl.drawBuffers([1029])}this.clear()}end(){this.device.popState()}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}setParameters(e={}){let t={...this.glParameters};t.framebuffer=this.props.framebuffer||null,this.props.depthReadOnly&&(t.depthMask=!this.props.depthReadOnly),t.stencilMask=+!this.props.stencilReadOnly,t[35977]=this.props.discard,e.viewport&&(e.viewport.length>=6?(t.viewport=e.viewport.slice(0,4),t.depthRange=[e.viewport[4],e.viewport[5]]):t.viewport=e.viewport),e.scissorRect&&(t.scissorTest=!0,t.scissor=e.scissorRect),e.blendConstant&&(t.blendColor=e.blendConstant),e.stencilReference&&(console.warn("RenderPassParameters.stencilReference not yet implemented in WebGL"),e[2967]=e.stencilReference),e.colorMask&&(t.colorMask=eC.map(t=>!!(t&e.colorMask))),this.glParameters=t,E(this.device.gl,t)}beginOcclusionQuery(e){let t=this.props.occlusionQuerySet;t?.beginOcclusionQuery()}endOcclusionQuery(){let e=this.props.occlusionQuerySet;e?.endOcclusionQuery()}clear(){let e={...this.glParameters},t=0;this.props.clearColors&&this.props.clearColors.forEach((e,t)=>{e&&this.clearColorBuffer(t,e)}),!1!==this.props.clearColor&&void 0===this.props.clearColors&&(t|=16384,e.clearColor=this.props.clearColor),!1!==this.props.clearDepth&&(t|=256,e.clearDepth=this.props.clearDepth),!1!==this.props.clearStencil&&(t|=1024,e.clearStencil=this.props.clearStencil),0!==t&&em(this.device.gl,e,()=>{this.device.gl.clear(t)})}clearColorBuffer(e=0,t=[0,0,0,0]){em(this.device.gl,{framebuffer:this.props.framebuffer},()=>{switch(t.constructor){case Int8Array:case Int16Array:case Int32Array:this.device.gl.clearBufferiv(6144,e,t);break;case Uint8Array:case Uint8ClampedArray:case Uint16Array:case Uint32Array:this.device.gl.clearBufferuiv(6144,e,t);break;case Float32Array:this.device.gl.clearBufferfv(6144,e,t);break;default:throw Error("clearColorBuffer: color must be typed array")}})}}var eR=r(64920);let eS=[35678,35680,35679,35682,36289,36292,36293,36298,36299,36300,36303,36306,36307,36308,36311],eB={5126:[5126,1,"float","f32","float32"],35664:[5126,2,"vec2","vec2<f32>","float32x2"],35665:[5126,3,"vec3","vec3<f32>","float32x3"],35666:[5126,4,"vec4","vec4<f32>","float32x4"],5124:[5124,1,"int","i32","sint32"],35667:[5124,2,"ivec2","vec2<i32>","sint32x2"],35668:[5124,3,"ivec3","vec3<i32>","sint32x3"],35669:[5124,4,"ivec4","vec4<i32>","sint32x4"],5125:[5125,1,"uint","u32","uint32"],36294:[5125,2,"uvec2","vec2<u32>","uint32x2"],36295:[5125,3,"uvec3","vec3<u32>","uint32x3"],36296:[5125,4,"uvec4","vec4<u32>","uint32x4"],35670:[5126,1,"bool","f32","float32"],35671:[5126,2,"bvec2","vec2<f32>","float32x2"],35672:[5126,3,"bvec3","vec3<f32>","float32x3"],35673:[5126,4,"bvec4","vec4<f32>","float32x4"],35674:[5126,8,"mat2","mat2x2<f32>"],35685:[5126,8,"mat2x3","mat2x3<f32>"],35686:[5126,8,"mat2x4","mat2x4<f32>"],35687:[5126,12,"mat3x2","mat3x2<f32>"],35675:[5126,12,"mat3","mat3x3<f32>"],35688:[5126,12,"mat3x4","mat3x4<f32>"],35689:[5126,16,"mat4x2","mat4x2<f32>"],35690:[5126,16,"mat4x3","mat4x3<f32>"],35676:[5126,16,"mat4","mat4x4<f32>"]};function ew(e){let t=eB[e];if(!t)throw Error("uniform");let[r,i,,s]=t;return{format:s,components:i,glType:r}}let eM={35678:["2d","float"],35680:["cube","float"],35679:["3d","float"],35682:["3d","depth"],36289:["2d-array","float"],36292:["2d-array","depth"],36293:["cube","float"],36298:["2d","sint"],36299:["3d","sint"],36300:["cube","sint"],36303:["2d-array","uint"],36306:["2d","uint"],36307:["3d","uint"],36308:["cube","uint"],36311:["2d-array","uint"]};var eI=r(15026);class eP extends eR.r{device;handle;vs;fs;introspectedLayout;uniforms={};bindings={};varyings=null;_uniformCount=0;_uniformSetters={};constructor(e,t){super(e,t),this.device=e,this.handle=this.props.handle||this.device.gl.createProgram(),this.device.setSpectorMetadata(this.handle,{id:this.props.id}),this.vs=t.vs,this.fs=t.fs;let{varyings:r,bufferMode:i=35981}=t;r&&r.length>0&&(this.varyings=r,this.device.gl.transformFeedbackVaryings(this.handle,r,i)),this._linkShaders(),s.R.time(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.introspectedLayout=function(e,t){let r={attributes:[],bindings:[]};for(let i of(r.attributes=function(e,t){let r=[],i=e.getProgramParameter(t,35721);for(let s=0;s<i;s++){let i=e.getActiveAttrib(t,s);if(!i)throw Error("activeInfo");let{name:n,type:o}=i,a=e.getAttribLocation(t,n);if(a>=0){let{attributeType:e}=function(e){let t=eB[e];if(!t)throw Error("attribute");let[,r,,i,s]=t;return{attributeType:i,vertexFormat:s,components:r}}(o),t=/instance/i.test(n)?"instance":"vertex";r.push({name:n,location:a,stepMode:t,type:e})}}return r.sort((e,t)=>e.location-t.location),r}(e,t),function(e,t){let r=(r,i)=>e.getActiveUniformBlockParameter(t,r,i),i=[],s=e.getProgramParameter(t,35382);for(let n=0;n<s;n++){let s={name:e.getActiveUniformBlockName(t,n)||"",location:r(n,35391),byteLength:r(n,35392),vertex:r(n,35396),fragment:r(n,35398),uniformCount:r(n,35394),uniforms:[]},o=r(n,35395)||[],a=e.getActiveUniforms(t,o,35383),l=e.getActiveUniforms(t,o,35384),h=e.getActiveUniforms(t,o,35387),u=e.getActiveUniforms(t,o,35388);for(let r=0;r<s.uniformCount;++r){let i=e.getActiveUniform(t,o[r]);if(!i)throw Error("activeInfo");s.uniforms.push({name:i.name,format:ew(a[r]).format,type:a[r],arrayLength:l[r],byteOffset:h[r],byteStride:u[r]})}i.push(s)}return i.sort((e,t)=>e.location-t.location),i}(e,t))){let e=i.uniforms.map(e=>({name:e.name,format:e.format,byteOffset:e.byteOffset,byteStride:e.byteStride,arrayLength:e.arrayLength}));r.bindings.push({type:"uniform",name:i.name,group:0,location:i.location,visibility:+!!i.vertex&2*!!i.fragment,minBindingSize:i.byteLength,uniforms:e})}let i=function(e,t){let r=[],i=e.getProgramParameter(t,35718);for(let s=0;s<i;s++){let i=e.getActiveUniform(t,s);if(!i)throw Error("activeInfo");let{name:n,size:o,type:a}=i,{name:l,isArray:h}=function(e){if("]"!==e[e.length-1])return{name:e,length:1,isArray:!1};let t=/([^[]*)(\[[0-9]+\])?/.exec(e);if(!t||t.length<2)throw Error(`Failed to parse GLSL uniform name ${e}`);return{name:t[1],length:+!!t[2],isArray:!!t[2]}}(n),u=e.getUniformLocation(t,l),c={location:u,name:l,size:o,type:a,isArray:h};if(r.push(c),c.size>1)for(let i=0;i<c.size;i++){let s=`${l}[${i}]`;u=e.getUniformLocation(t,s);let n={...c,name:s,location:u};r.push(n)}}return r}(e,t),s=0;for(let e of i)if(eS.includes(e.type)){let{viewDimension:t,sampleType:i}=function(e){let t=eM[e];if(!t)throw Error("sampler");let[r,i]=t;return{viewDimension:r,sampleType:i}}(e.type);r.bindings.push({type:"texture",name:e.name,group:0,location:s,viewDimension:t,sampleType:i}),e.textureUnit=s,s+=1}i.length&&(r.uniforms=i);let n=function(e,t){let r=[],i=e.getProgramParameter(t,35971);for(let s=0;s<i;s++){let i=e.getTransformFeedbackVarying(t,s);if(!i)throw Error("activeInfo");let{name:n,type:o,size:a}=i,{glType:l,components:h}=ew(o),u={location:s,name:n,type:l,size:a*h};r.push(u)}return r.sort((e,t)=>e.location-t.location),r}(e,t);return n?.length&&(r.varyings=n),r}(this.device.gl,this.handle),s.R.timeEnd(1,`RenderPipeline ${this.id} - shaderLayout introspection`)(),this.shaderLayout=function(e,t){let r={...e,attributes:e.attributes.map(e=>({...e}))};for(let e of t?.attributes||[]){let t=r.attributes.find(t=>t.name===e.name);t?(t.type=e.type||t.type,t.stepMode=e.stepMode||t.stepMode):s.R.warn(`shader layout attribute ${e.name} not present in shader`)}return r}(this.introspectedLayout,t.shaderLayout)}destroy(){this.handle&&(this.device.gl.deleteProgram(this.handle),this.destroyed=!0)}setBindings(e,t){for(let[r,i]of Object.entries(e)){let e=this.shaderLayout.bindings.find(e=>e.name===r)||this.shaderLayout.bindings.find(e=>e.name===`${r}Uniforms`);if(!e){let e=this.shaderLayout.bindings.map(e=>`"${e.name}"`).join(", ");t?.disableWarnings||s.R.warn(`No binding "${r}" in render pipeline "${this.id}", expected one of ${e}`,i)();continue}switch(i||s.R.warn(`Unsetting binding "${r}" in render pipeline "${this.id}"`)(),e.type){case"uniform":if(!(i instanceof Z)&&!(i.buffer instanceof Z))throw Error("buffer value");break;case"texture":if(!(i instanceof ep||i instanceof ey||i instanceof K))throw Error("texture value");break;case"sampler":s.R.warn(`Ignoring sampler ${r}`)();break;default:throw Error(e.type)}this.bindings[r]=i}}draw(e){let{renderPass:t,parameters:r=this.props.parameters,topology:i=this.props.topology,vertexArray:n,vertexCount:o,instanceCount:a,isInstanced:l=!1,firstVertex:h=0,transformFeedback:u}=e,c=function(e){switch(e){case"point-list":return 0;case"line-list":return 1;case"line-strip":return 3;case"triangle-list":return 4;case"triangle-strip":return 5;default:throw Error(e)}}(i),d=!!n.indexBuffer,f=n.indexBuffer?.glIndexType;return"success"!==this.linkStatus?(s.R.info(2,`RenderPipeline:${this.id}.draw() aborted - waiting for shader linking`)(),!1):this._areTexturesRenderable()?(this.device.gl.useProgram(this.handle),n.bindBeforeRender(t),u&&u.begin(this.props.topology),this._applyBindings(),this._applyUniforms(),!function(e,t,r,i){if(function(e){let t=!0;for(let r in e){t=!1;break}return t}(t))return i(e);e.pushState();try{return function(e,t){var r;let{gl:i}=e;if(t.cullMode)switch(t.cullMode){case"none":i.disable(2884);break;case"front":i.enable(2884),i.cullFace(1028);break;case"back":i.enable(2884),i.cullFace(1029)}if(t.frontFace&&i.frontFace(el("frontFace",t.frontFace,{ccw:2305,cw:2304})),t.unclippedDepth&&e.features.has("depth-clip-control")&&i.enable(34383),void 0!==t.depthBias&&(i.enable(32823),i.polygonOffset(t.depthBias,t.depthBiasSlopeScale||0)),t.provokingVertex&&e.features.has("provoking-vertex-webgl")){let r=e.getExtension("WEBGL_provoking_vertex").WEBGL_provoking_vertex,i=el("provokingVertex",t.provokingVertex,{first:36429,last:36430});r?.provokingVertexWEBGL(i)}if((t.polygonMode||t.polygonOffsetLine)&&e.features.has("polygon-mode-webgl")){if(t.polygonMode){let r=e.getExtension("WEBGL_polygon_mode").WEBGL_polygon_mode,i=el("polygonMode",t.polygonMode,{fill:6914,line:6913});r?.polygonModeWEBGL(1028,i),r?.polygonModeWEBGL(1029,i)}t.polygonOffsetLine&&i.enable(10754)}if(e.features.has("shader-clip-cull-distance-webgl")&&(t.clipDistance0&&i.enable(12288),t.clipDistance1&&i.enable(12289),t.clipDistance2&&i.enable(12290),t.clipDistance3&&i.enable(12291),t.clipDistance4&&i.enable(12292),t.clipDistance5&&i.enable(12293),t.clipDistance6&&i.enable(12294),t.clipDistance7&&i.enable(12295)),void 0!==t.depthWriteEnabled&&i.depthMask((r=0,t.depthWriteEnabled)),t.depthCompare&&("always"!==t.depthCompare?i.enable(2929):i.disable(2929),i.depthFunc(es("depthCompare",t.depthCompare))),t.stencilWriteMask){let e=t.stencilWriteMask;i.stencilMaskSeparate(1028,e),i.stencilMaskSeparate(1029,e)}if(t.stencilReadMask&&s.R.warn("stencilReadMask not supported under WebGL"),t.stencilCompare){let e=t.stencilReadMask||0xffffffff,r=es("depthCompare",t.stencilCompare);"always"!==t.stencilCompare?i.enable(2960):i.disable(2960),i.stencilFuncSeparate(1028,r,0,e),i.stencilFuncSeparate(1029,r,0,e)}if(t.stencilPassOperation&&t.stencilFailOperation&&t.stencilDepthFailOperation){let e=en("stencilPassOperation",t.stencilPassOperation),r=en("stencilFailOperation",t.stencilFailOperation),s=en("stencilDepthFailOperation",t.stencilDepthFailOperation);i.stencilOpSeparate(1028,r,s,e),i.stencilOpSeparate(1029,r,s,e)}switch(t.blend){case!0:i.enable(3042);break;case!1:i.disable(3042)}if(t.blendColorOperation||t.blendAlphaOperation){let e=eo("blendColorOperation",t.blendColorOperation||"add"),r=eo("blendAlphaOperation",t.blendAlphaOperation||"add");i.blendEquationSeparate(e,r);let s=ea("blendColorSrcFactor",t.blendColorSrcFactor||"one"),n=ea("blendColorDstFactor",t.blendColorDstFactor||"zero"),o=ea("blendAlphaSrcFactor",t.blendAlphaSrcFactor||"one"),a=ea("blendAlphaDstFactor",t.blendAlphaDstFactor||"zero");i.blendFuncSeparate(s,n,o,a)}}(e,t),E(e.gl,r),i(e)}finally{e.popState()}}(this.device,r,t.glParameters,()=>{d&&l?this.device.gl.drawElementsInstanced(c,o||0,f,h,a||0):d?this.device.gl.drawElements(c,o||0,f,h):l?this.device.gl.drawArraysInstanced(c,h,o||0,a||0):this.device.gl.drawArrays(c,h,o||0),u&&u.end()}),n.unbindAfterRender(t),!0):(s.R.info(2,`RenderPipeline:${this.id}.draw() aborted - textures not yet loaded`)(),!1)}setUniformsWebGL(e){let{bindings:t}=function(e){let t={bindings:{},uniforms:{}};return Object.keys(e).forEach(r=>{let i=e[r];null!==(0,eI.H9)(i)||"number"==typeof i||"boolean"==typeof i?t.uniforms[r]=i:t.bindings[r]=i}),t}(e);Object.keys(t).forEach(e=>{s.R.warn(`Unsupported value "${JSON.stringify(t[e])}" used in setUniforms() for key ${e}. Use setBindings() instead?`)()}),Object.assign(this.uniforms,e)}async _linkShaders(){let{gl:e}=this.device;if(e.attachShader(this.handle,this.vs.handle),e.attachShader(this.handle,this.fs.handle),s.R.time(4,`linkProgram for ${this.id}`)(),e.linkProgram(this.handle),s.R.timeEnd(4,`linkProgram for ${this.id}`)(),s.R.level,!this.device.features.has("compilation-status-async-webgl")){let e=this._getLinkStatus();this._reportLinkStatus(e);return}s.R.once(1,"RenderPipeline linking is asynchronous")(),await this._waitForLinkComplete(),s.R.info(2,`RenderPipeline ${this.id} - async linking complete: ${this.linkStatus}`)();let t=this._getLinkStatus();this._reportLinkStatus(t)}async _reportLinkStatus(e){if("success"!==e){switch(this.vs.compilationStatus){case"error":throw this.vs.debugShader(),Error(`Error during compilation of shader ${this.vs.id}`);case"pending":this.vs.asyncCompilationStatus.then(()=>this.vs.debugShader())}switch(this.fs?.compilationStatus){case"error":throw this.fs.debugShader(),Error(`Error during compilation of shader ${this.fs.id}`);case"pending":this.fs.asyncCompilationStatus.then(()=>this.fs.debugShader())}let t=this.device.gl.getProgramInfoLog(this.handle);throw Error(`Error during ${e}: ${t}`)}}_getLinkStatus(){let{gl:e}=this.device;return e.getProgramParameter(this.handle,35714)?(e.validateProgram(this.handle),e.getProgramParameter(this.handle,35715))?(this.linkStatus="success","success"):(this.linkStatus="error","validation"):(this.linkStatus="error","linking")}async _waitForLinkComplete(){let e=async e=>await new Promise(t=>setTimeout(t,e));if(!this.device.features.has("compilation-status-async-webgl")){await e(10);return}let{gl:t}=this.device;for(;;){if(t.getProgramParameter(this.handle,37297))return;await e(10)}}_areTexturesRenderable(){let e=!0;for(let t of this.shaderLayout.bindings)this.bindings[t.name]||this.bindings[t.name.replace(/Uniforms$/,"")]||(s.R.warn(`Binding ${t.name} not found in ${this.id}`)(),e=!1);return e}_applyBindings(){if("success"!==this.linkStatus)return;let{gl:e}=this.device;e.useProgram(this.handle);let t=0,r=0;for(let i of this.shaderLayout.bindings){let n=this.bindings[i.name]||this.bindings[i.name.replace(/Uniforms$/,"")];if(!n)throw Error(`No value for binding ${i.name} in ${this.id}`);switch(i.type){case"uniform":let{name:o}=i,a=e.getUniformBlockIndex(this.handle,o);if(0xffffffff===a)throw Error(`Invalid uniform block name ${o}`);e.uniformBlockBinding(this.handle,r,a),n instanceof Z?e.bindBufferBase(35345,r,n.handle):e.bindBufferRange(35345,r,n.buffer.handle,n.offset||0,n.size||n.buffer.byteLength-n.offset),r+=1;break;case"texture":let l;if(!(n instanceof ep||n instanceof ey||n instanceof K))throw Error("texture");if(n instanceof ep)l=n.texture;else if(n instanceof ey)l=n;else if(n instanceof K&&n.colorAttachments[0]instanceof ep)s.R.warn("Passing framebuffer in texture binding may be deprecated. Use fbo.colorAttachments[0] instead")(),l=n.colorAttachments[0].texture;else throw Error("No texture");e.activeTexture(33984+t),e.bindTexture(l.glTarget,l.handle),t+=1;break;case"sampler":break;case"storage":case"read-only-storage":throw Error(`binding type '${i.type}' not supported in WebGL`)}}}_applyUniforms(){for(let e of this.shaderLayout.uniforms||[]){let{name:t,location:r,type:i,textureUnit:s}=e,n=this.uniforms[t]??s;void 0!==n&&function(e,t,r,i){let s=i;!0===s&&(s=1),!1===s&&(s=0);let n="number"==typeof s?[s]:s;switch(r){case 35678:case 35680:case 35679:case 35682:case 36289:case 36292:case 36293:case 36298:case 36299:case 36300:case 36303:case 36306:case 36307:case 36308:case 36311:if("number"!=typeof i)throw Error("samplers must be set to integers");return e.uniform1i(t,i);case 5126:return e.uniform1fv(t,n);case 35664:return e.uniform2fv(t,n);case 35665:return e.uniform3fv(t,n);case 35666:return e.uniform4fv(t,n);case 5124:case 35670:return e.uniform1iv(t,n);case 35667:case 35671:return e.uniform2iv(t,n);case 35668:case 35672:return e.uniform3iv(t,n);case 35669:case 35673:return e.uniform4iv(t,n);case 5125:return e.uniform1uiv(t,n,1);case 36294:return e.uniform2uiv(t,n,2);case 36295:return e.uniform3uiv(t,n,3);case 36296:return e.uniform4uiv(t,n,4);case 35674:return e.uniformMatrix2fv(t,!1,n);case 35675:return e.uniformMatrix3fv(t,!1,n);case 35676:return e.uniformMatrix4fv(t,!1,n);case 35685:return e.uniformMatrix2x3fv(t,!1,n);case 35686:return e.uniformMatrix2x4fv(t,!1,n);case 35687:return e.uniformMatrix3x2fv(t,!1,n);case 35688:return e.uniformMatrix3x4fv(t,!1,n);case 35689:return e.uniformMatrix4x2fv(t,!1,n);case 35690:return e.uniformMatrix4x3fv(t,!1,n)}throw Error("Illegal uniform")}(this.device.gl,r,i,n)}}}class eL extends W.F{static defaultProps={...W.F.defaultProps,measureExecutionTime:void 0};get[Symbol.toStringTag](){return"CommandEncoder"}constructor(e,t){super(e,t,eL.defaultProps)}}class eO extends W.F{static defaultProps={...W.F.defaultProps};get[Symbol.toStringTag](){return"CommandBuffer"}constructor(e,t){super(e,t,eO.defaultProps)}}class ex extends eO{device;commands=[];constructor(e){super(e,{}),this.device=e}submitCommands(e=this.commands){for(let t of e)switch(t.name){case"copy-buffer-to-buffer":!function(e,t){let r=t.sourceBuffer,i=t.destinationBuffer;e.gl.bindBuffer(36662,r.handle),e.gl.bindBuffer(36663,i.handle),e.gl.copyBufferSubData(36662,36663,t.sourceOffset??0,t.destinationOffset??0,t.size),e.gl.bindBuffer(36662,null),e.gl.bindBuffer(36663,null)}(this.device,t.options);break;case"copy-buffer-to-texture":!function(e,t){throw Error("Not implemented")}(this.device,t.options);break;case"copy-texture-to-buffer":!function(e,t){let r;let{sourceTexture:i,mipLevel:s=0,aspect:n="all",width:o=t.sourceTexture.width,height:a=t.sourceTexture.height,depthOrArrayLayers:l=0,origin:h=[0,0],destinationBuffer:u,byteOffset:c=0,bytesPerRow:d,rowsPerImage:f}=t;if("all"!==n)throw Error("aspect not supported in WebGL");if(0!==s||0!==l||d||f)throw Error("not implemented");let{framebuffer:p,destroyFramebuffer:g}=eN(i);try{let t=o||p.width,i=a||p.height,s=N(p.colorAttachments[0].texture.props.format),n=s.format,l=s.type;e.gl.bindBuffer(35051,u.handle),r=e.gl.bindFramebuffer(36160,p.handle),e.gl.readPixels(h[0],h[1],t,i,n,l,c)}finally{e.gl.bindBuffer(35051,null),void 0!==r&&e.gl.bindFramebuffer(36160,r),g&&p.destroy()}}(this.device,t.options);break;case"copy-texture-to-texture":!function(e,t){let r;let{sourceTexture:i,destinationMipLevel:s=0,origin:n=[0,0],destinationOrigin:o=[0,0],destinationTexture:a}=t,{width:l=t.destinationTexture.width,height:h=t.destinationTexture.height}=t,{framebuffer:u,destroyFramebuffer:c}=eN(i),[d,f]=n,[p,g,m]=o,_=e.gl.bindFramebuffer(36160,u.handle),A=null;if(a instanceof ey)A=a,l=Number.isFinite(l)?l:A.width,h=Number.isFinite(h)?h:A.height,A.bind(0),r=A.glTarget;else throw Error("invalid destination");switch(r){case 3553:case 34067:e.gl.copyTexSubImage2D(r,s,p,g,d,f,l,h);break;case 35866:case 32879:e.gl.copyTexSubImage3D(r,s,p,g,m,d,f,l,h)}A&&A.unbind(),e.gl.bindFramebuffer(36160,_),c&&u.destroy()}(this.device,t.options);break;default:throw Error(t.name)}}}function eN(e){if(e instanceof z.g){let{width:t,height:r,id:i}=e;return{framebuffer:e.device.createFramebuffer({id:`framebuffer-for-${i}`,width:t,height:r,colorAttachments:[e]}),destroyFramebuffer:!0}}return{framebuffer:e,destroyFramebuffer:!1}}class eF extends eL{device;commandBuffer;constructor(e,t){super(e,t),this.device=e,this.commandBuffer=new ex(e)}destroy(){}finish(){this.commandBuffer.submitCommands()}copyBufferToBuffer(e){this.commandBuffer.commands.push({name:"copy-buffer-to-buffer",options:e})}copyBufferToTexture(e){this.commandBuffer.commands.push({name:"copy-buffer-to-texture",options:e})}copyTextureToBuffer(e){this.commandBuffer.commands.push({name:"copy-texture-to-buffer",options:e})}copyTextureToTexture(e){this.commandBuffer.commands.push({name:"copy-texture-to-texture",options:e})}pushDebugGroup(e){}popDebugGroup(){}insertDebugMarker(e){}resolveQuerySet(e,t,r){}}var eD=r(51465);class eU extends W.F{static defaultProps={...W.F.defaultProps,renderPipeline:null};get[Symbol.toStringTag](){return"VertexArray"}maxVertexAttributes;attributeInfos;indexBuffer=null;attributes;constructor(e,t){super(e,t,eU.defaultProps),this.maxVertexAttributes=e.limits.maxVertexAttributes,this.attributes=Array(this.maxVertexAttributes).fill(null);let{shaderLayout:r,bufferLayout:i}=t.renderPipeline||{};if(!r||!i)throw Error("VertexArray");this.attributeInfos=(0,eD.M)(r,i,this.maxVertexAttributes)}setConstantWebGL(e,t){this.device.reportError(Error("constant attributes not supported"))}}var eG=r(11304),ek=r(50947),eH=r(95694);class eV extends eU{get[Symbol.toStringTag](){return"VertexArray"}device;handle;buffer=null;bufferValue=null;static isConstantAttributeZeroSupported(e){var t;return"Chrome"===((0,G.B)()?(0,ek.b)(t)?"Electron":(t||eH.gM.userAgent||"").indexOf("Edge")>-1?"Edge":globalThis.chrome?"Chrome":globalThis.safari?"Safari":globalThis.mozInnerScreenX?"Firefox":"Unknown":"Node")}constructor(e,t){super(e,t),this.device=e,this.handle=this.device.gl.createVertexArray()}destroy(){super.destroy(),this.buffer&&this.buffer?.destroy(),this.handle&&(this.device.gl.deleteVertexArray(this.handle),this.handle=void 0)}setIndexBuffer(e){if(e&&34963!==e.glTarget)throw Error("Use .setBuffer()");this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34963,e?e.handle:null),this.indexBuffer=e,this.device.gl.bindVertexArray(null)}setBuffer(e,t){if(34963===t.glTarget)throw Error("Use .setIndexBuffer()");let{size:r,type:i,stride:s,offset:n,normalized:o,integer:a,divisor:l}=this._getAccessor(e);this.device.gl.bindVertexArray(this.handle),this.device.gl.bindBuffer(34962,t.handle),a?this.device.gl.vertexAttribIPointer(e,r,i,s,n):this.device.gl.vertexAttribPointer(e,r,i,o,s,n),this.device.gl.bindBuffer(34962,null),this.device.gl.enableVertexAttribArray(e),this.device.gl.vertexAttribDivisor(e,l||0),this.attributes[e]=t,this.device.gl.bindVertexArray(null)}setConstantWebGL(e,t){this._enable(e,!1),this.attributes[e]=t}bindBeforeRender(){this.device.gl.bindVertexArray(this.handle),this._applyConstantAttributes()}unbindAfterRender(){this.device.gl.bindVertexArray(null)}_applyConstantAttributes(){for(let e=0;e<this.maxVertexAttributes;++e){let t=this.attributes[e];ArrayBuffer.isView(t)&&this.device.setConstantAttributeWebGL(e,t)}}_getAccessor(e){let t=this.attributeInfos[e];if(!t)throw Error(`Unknown attribute location ${e}`);let r=S(t.bufferDataType);return{size:t.bufferComponents,type:r,stride:t.byteStride,offset:t.byteOffset,normalized:t.normalized,integer:t.integer,divisor:+("instance"===t.stepMode)}}_enable(e,t=!0){let r=eV.isConstantAttributeZeroSupported(this.device)||0!==e;(t||r)&&(e=Number(e),this.device.gl.bindVertexArray(this.handle),t?this.device.gl.enableVertexAttribArray(e):this.device.gl.disableVertexAttribArray(e),this.device.gl.bindVertexArray(null))}getConstantBuffer(e,t){var r;let i=Array.isArray(r=t)?new Float32Array(r):r,s=i.byteLength*e,n=i.length*e;if(this.buffer&&s!==this.buffer.byteLength)throw Error(`Buffer size is immutable, byte length ${s} !== ${this.buffer.byteLength}.`);let o=!this.buffer;if(this.buffer=this.buffer||this.device.createBuffer({byteLength:s}),o=o||!function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}(i,this.bufferValue)){let e=(0,eG.X)(t.constructor,n);!function(e){let{target:t,source:r,start:i=0,count:s=1}=e,n=r.length,o=s*n,a=0;for(let e=i;a<n;a++)t[e++]=r[a];for(;a<o;)a<o-a?(t.copyWithin(i+a,i,i+a),a*=2):(t.copyWithin(i+a,i,i+o-a),a=o);e.target}({target:e,source:i,start:0,count:n}),this.buffer.write(e),this.bufferValue=t}return this.buffer}}class ej extends W.F{static defaultProps={...W.F.defaultProps,layout:void 0,buffers:{}};get[Symbol.toStringTag](){return"TransformFeedback"}constructor(e,t){super(e,t,ej.defaultProps)}}class eW extends ej{device;gl;handle;layout;buffers={};unusedBuffers={};bindOnUse=!0;_bound=!1;constructor(e,t){super(e,t),this.device=e,this.gl=e.gl,this.handle=this.props.handle||this.gl.createTransformFeedback(),this.layout=this.props.layout,t.buffers&&this.setBuffers(t.buffers),Object.seal(this)}destroy(){this.gl.deleteTransformFeedback(this.handle),super.destroy()}begin(e="point-list"){this.gl.bindTransformFeedback(36386,this.handle),this.bindOnUse&&this._bindBuffers(),this.gl.beginTransformFeedback(function(e){switch(e){case"point-list":return 0;case"line-list":case"line-strip":return 1;case"triangle-list":case"triangle-strip":return 4;default:throw Error(e)}}(e))}end(){this.gl.endTransformFeedback(),this.bindOnUse&&this._unbindBuffers(),this.gl.bindTransformFeedback(36386,null)}setBuffers(e){this.buffers={},this.unusedBuffers={},this.bind(()=>{for(let t in e)this.setBuffer(t,e[t])})}setBuffer(e,t){let r=this._getVaryingIndex(e),{buffer:i,byteLength:n,byteOffset:o}=this._getBufferRange(t);if(r<0){this.unusedBuffers[e]=i,s.R.warn(`${this.id} unusedBuffers varying buffer ${e}`)();return}this.buffers[r]={buffer:i,byteLength:n,byteOffset:o},this.bindOnUse||this._bindBuffer(r,i,o,n)}getBuffer(e){if(ez(e))return this.buffers[e]||null;let t=this._getVaryingIndex(e);return t>=0?this.buffers[t]:null}bind(e=this.handle){let t;return"function"!=typeof e?(this.gl.bindTransformFeedback(36386,e),this):(this._bound?t=e():(this.gl.bindTransformFeedback(36386,this.handle),this._bound=!0,t=e(),this._bound=!1,this.gl.bindTransformFeedback(36386,null)),t)}unbind(){this.bind(null)}_getBufferRange(e){if(e instanceof Z)return{buffer:e,byteOffset:0,byteLength:e.byteLength};let{buffer:t,byteOffset:r=0,byteLength:i=e.buffer.byteLength}=e;return{buffer:t,byteOffset:r,byteLength:i}}_getVaryingIndex(e){if(ez(e))return Number(e);for(let t of this.layout.varyings)if(e===t.name)return t.location;return -1}_bindBuffers(){for(let e in this.buffers){let{buffer:t,byteLength:r,byteOffset:i}=this._getBufferRange(this.buffers[e]);this._bindBuffer(Number(e),t,i,r)}}_unbindBuffers(){for(let e in this.buffers)this.gl.bindBufferBase(35982,Number(e),null)}_bindBuffer(e,t,r=0,i){let s=t&&t.handle;s&&void 0!==i?this.gl.bindBufferRange(35982,e,s,r,i):this.gl.bindBufferBase(35982,e,s)}}function ez(e){return"number"==typeof e?Number.isInteger(e):/^\d+$/.test(e)}class eX extends W.F{static defaultProps={...W.F.defaultProps,type:void 0,count:void 0};get[Symbol.toStringTag](){return"QuerySet"}constructor(e,t){super(e,t,eX.defaultProps)}}class eK extends eX{device;handle;target=null;_queryPending=!1;_pollingPromise=null;get[Symbol.toStringTag](){return"Query"}constructor(e,t){if(super(e,t),this.device=e,t.count>1)throw Error("WebGL QuerySet can only have one value");this.handle=this.device.gl.createQuery(),Object.seal(this)}destroy(){this.device.gl.deleteQuery(this.handle)}beginTimestampQuery(){return this._begin(35007)}endTimestampQuery(){this._end()}beginOcclusionQuery(e){return this._begin(e?.conservative?36202:35887)}endOcclusionQuery(){this._end()}beginTransformFeedbackQuery(){return this._begin(35976)}endTransformFeedbackQuery(){this._end()}async resolveQuery(){return[await this.pollQuery()]}_begin(e){!this._queryPending&&(this.target=e,this.device.gl.beginQuery(this.target,this.handle))}_end(){!this._queryPending&&this.target&&(this.device.gl.endQuery(this.target),this.target=null,this._queryPending=!0)}isResultAvailable(){if(!this._queryPending)return!1;let e=this.device.gl.getQueryParameter(this.handle,34919);return e&&(this._queryPending=!1),e}isTimerDisjoint(){return this.device.gl.getParameter(36795)}getResult(){return this.device.gl.getQueryParameter(this.handle,34918)}getTimerMilliseconds(){return this.getResult()/1e6}pollQuery(e=Number.POSITIVE_INFINITY){if(this._pollingPromise)return this._pollingPromise;let t=0;return this._pollingPromise=new Promise((r,i)=>{let s=()=>{this.isResultAvailable()?(r(this.getResult()),this._pollingPromise=null):t++>e?(i("Timed out"),this._pollingPromise=null):requestAnimationFrame(s)};requestAnimationFrame(s)}),this._pollingPromise}}class eJ extends i.pF{type="webgl";handle;features;limits;info;canvasContext;lost;_resolveContextLost;gl;debug=!1;_canvasSizeInfo={clientWidth:0,clientHeight:0,devicePixelRatio:1};_extensions={};_polyfilled=!1;spectorJS;constructor(e){super({...e,id:e.id||function(e="id"){q[e]=q[e]||1;let t=q[e]++;return`${e}-${t}`}("webgl-device")});let t=i.pF._getCanvasContextProps(e);if(!t)throw Error("WebGLDevice requires props.createCanvasContext to be set");let r=t.canvas?.gl?.device;if(r)throw Error(`WebGL context already attached to device ${r.id}`);this.canvasContext=new J(this,t),this.lost=new Promise(e=>{this._resolveContextLost=e});let n={...e.webgl};"premultiplied"===t.alphaMode&&(n.premultipliedAlpha=!0),void 0!==e.powerPreference&&(n.powerPreference=e.powerPreference);let o=this.props._handle||function(e,t,r){let i="",s={preserveDrawingBuffer:!0,...r},n=null;if(n||=e.getContext("webgl2",s),s.failIfMajorPerformanceCaveat&&(i||="Only software GPU is available. Set `failIfMajorPerformanceCaveat: false` to allow."),n||r.failIfMajorPerformanceCaveat||(s.failIfMajorPerformanceCaveat=!1,n=e.getContext("webgl2",s),n.luma||={},n.luma.softwareRenderer=!0),!n&&(n=e.getContext("webgl",{}))&&(n=null,i||="Your browser only supports WebGL1"),!n)throw i||="Your browser does not support WebGL",Error(`Failed to create WebGL context: ${i}`);let{onContextLost:o,onContextRestored:a}=t;return e.addEventListener("webglcontextlost",e=>o(e),!1),e.addEventListener("webglcontextrestored",e=>a(e),!1),n.luma||={},n}(this.canvasContext.canvas,{onContextLost:e=>this._resolveContextLost?.({reason:"destroyed",message:"Entered sleep mode, or too many apps or browser tabs are using the GPU."}),onContextRestored:e=>console.log("WebGL context restored")},n);if(!o)throw Error("WebGL context creation failed");if(r=o.device){if(e._reuseDevices)return s.R.log(1,`Not creating a new Device, instead returning a reference to Device ${r.id} already attached to WebGL context`,r)(),r._reused=!0,r;throw Error(`WebGL context already attached to device ${r.id}`)}this.handle=o,this.gl=o,this.spectorJS=(0,$.k2)({...this.props,gl:this.handle}),this.gl.device=this,this.gl._version=2,this.info=function(e,t){var r,i;let s=e.getParameter(7936),n=e.getParameter(7937);C(e,"WEBGL_debug_renderer_info",t);let o=t.WEBGL_debug_renderer_info,a=e.getParameter(o?o.UNMASKED_VENDOR_WEBGL:7936),l=e.getParameter(o?o.UNMASKED_RENDERER_WEBGL:7937),h=a||s,u=l||n,c=e.getParameter(7938),d=v(h,u),f=(r=h,i=u,/Metal/i.exec(r)||/Metal/i.exec(i)?"metal":/ANGLE/i.exec(r)||/ANGLE/i.exec(i)?"opengl":"unknown");return{type:"webgl",gpu:d,gpuType:function(e,t){if(/SwiftShader/i.exec(e)||/SwiftShader/i.exec(t))return"cpu";switch(v(e,t)){case"intel":return"integrated";case"software":return"cpu";case"unknown":return"unknown";default:return"discrete"}}(h,u),gpuBackend:f,vendor:h,renderer:u,version:c,shadingLanguage:"glsl",shadingLanguageVersion:300}}(this.gl,this._extensions),this.limits=new U(this.gl),this.features=new D(this.gl,this._extensions,this.props._disabledFeatures),this.props._initializeFeatures&&this.features.initializeFeatures(),!1!==t.autoResize&&this.canvasContext.resize(),new y(this.gl,{log:(...e)=>s.R.log(1,...e)()}).trackState(this.gl,{copyState:!1});let a=e.debugWebGL||e.debug,l=e.debugWebGL;a&&(this.gl=(0,Y.l)(this.gl,{debugWebGL:a,traceWebGL:l}),s.R.warn("WebGL debug mode activated. Performance reduced.")(),e.debugWebGL&&(s.R.level=Math.max(s.R.level,1)))}destroy(){this.props._reuseDevices||this._reused||delete this.gl.device}get isLost(){return this.gl.isContextLost()}createCanvasContext(e){throw Error("WebGL only supports a single canvas")}createBuffer(e){return new Z(this,this._normalizeBufferProps(e))}createTexture(e){return new ey(this,e)}createExternalTexture(e){throw Error("createExternalTexture() not implemented")}createSampler(e){return new ed(this,e)}createShader(e){return new er(this,e)}createFramebuffer(e){return new K(this,e)}createVertexArray(e){return new eV(this,e)}createTransformFeedback(e){return new eW(this,e)}createQuerySet(e){return new eK(this,e)}createRenderPipeline(e){return new eP(this,e)}beginRenderPass(e){return new ev(this,e)}createComputePipeline(e){throw Error("ComputePipeline not supported in WebGL")}beginComputePass(e){throw Error("ComputePass not supported in WebGL")}renderPass=null;createCommandEncoder(e={}){return new eF(this,e)}submit(){this.renderPass?.end(),this.renderPass=null}readPixelsToArrayWebGL(e,t){return function(e,t){var r,i,s,n,o,a;let{sourceX:l=0,sourceY:h=0,sourceAttachment:u=0}=t||{},{target:c=null,sourceWidth:d,sourceHeight:f,sourceDepth:p,sourceFormat:g,sourceType:m}=t||{},{framebuffer:_,deleteFramebuffer:A}=eb(e),{gl:E,handle:b}=_;d||=_.width,f||=_.height;let y=_.colorAttachments[u]?.texture;if(!y)throw Error(`Invalid framebuffer attachment ${u}`);p=y?.depth||1,g||=y?.glFormat||6408,m||=y?.glType||5121,r=c,i=m,s=g,n=d,o=f,a=0,c=r?r:new(function(e,t){let{clamped:r=!0}=t||{};switch(e){case 5126:return Float32Array;case 5123:case 33635:case 32819:case 32820:return Uint16Array;case 5125:return Uint32Array;case 5121:return r?Uint8ClampedArray:Uint8Array;case 5120:return Int8Array;case 5122:return Int16Array;case 5124:return Int32Array;default:throw Error("Failed to deduce typed array type from GL constant")}}(i||=5121,{clamped:!1}))(n*o*eg(s)),m=m||function(e){switch(ArrayBuffer.isView(e)?e.constructor:e){case Float32Array:return 5126;case Uint16Array:return 5123;case Uint32Array:return 5125;case Uint8Array:case Uint8ClampedArray:return 5121;case Int8Array:return 5120;case Int16Array:return 5122;case Int32Array:return 5124;default:throw Error("Failed to deduce GL constant from typed array")}}(c);let T=E.bindFramebuffer(36160,b);return E.readBuffer(36064+u),E.readPixels(l,h,d,f,g,m,c),E.readBuffer(36064),E.bindFramebuffer(36160,T||null),A&&_.destroy(),c}(e,t)}readPixelsToBufferWebGL(e,t){return function(e,t){let{target:r,sourceX:i=0,sourceY:s=0,sourceFormat:n=6408,targetByteOffset:o=0}=t||{},{sourceWidth:a,sourceHeight:l,sourceType:h}=t||{},{framebuffer:u,deleteFramebuffer:c}=eb(e);a=a||u.width,l=l||u.height,h=h||5121;let d=r;if(!d){let e=o+a*l*eg(n)*function(e){switch(e){case 5121:return 1;case 33635:case 32819:case 32820:return 2;case 5126:return 4;default:return 0}}(h);d=u.device.createBuffer({byteLength:e})}let f=e.device.createCommandEncoder();return f.copyTextureToBuffer({sourceTexture:e,width:a,height:l,origin:[i,s],destinationBuffer:d,byteOffset:o}),f.destroy(),c&&u.destroy(),d}(e,t)}setParametersWebGL(e){E(this.gl,e)}getParametersWebGL(e){return b(this.gl,e)}withParametersWebGL(e,t){return em(this.gl,e,t)}resetWebGL(){s.R.warn("WebGLDevice.resetWebGL is deprecated, use only for debugging")(),E(this.gl,n)}_getDeviceSpecificTextureFormatCapabilities(e){return function(e,t,r){let i=t.create,s=x[t.format];return s?.gl===void 0&&(i=!1),s?.x&&(i=i&&!!C(e,s.x,r)),{format:t.format,create:i&&t.create,render:i&&t.render,filter:i&&t.filter,blend:i&&t.blend,store:i&&t.store}}(this.gl,e,this._extensions)}loseDevice(){let e=!1,t=this.getExtension("WEBGL_lose_context").WEBGL_lose_context;return t&&(e=!0,t.loseContext()),this._resolveContextLost?.({reason:"destroyed",message:"Application triggered context loss"}),e}pushState(){y.get(this.gl).push()}popState(){y.get(this.gl).pop()}setSpectorMetadata(e,t){e.__SPECTOR_Metadata=t}getGLKey(e,t){let r=Number(e);for(let e in this.gl)if(this.gl[e]===r)return`GL.${e}`;return t?.emptyIfUnknown?"":String(e)}getGLKeys(e){let t={emptyIfUnknown:!0};return Object.entries(e).reduce((e,[r,i])=>(e[`${r}:${this.getGLKey(r,t)}`]=`${i}:${this.getGLKey(i,t)}`,e),{})}_constants;setConstantAttributeWebGL(e,t){let r=this.limits.maxVertexAttributes;this._constants=this._constants||Array(r).fill(null);let i=this._constants[e];switch(i&&function(e,t){if(!e||!t||e.length!==t.length||e.constructor!==t.constructor)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}(i,t)&&s.R.info(1,`setConstantAttributeWebGL(${e}) could have been skipped, value unchanged`)(),this._constants[e]=t,t.constructor){case Float32Array:!function(e,t,r){switch(r.length){case 1:e.gl.vertexAttrib1fv(t,r);break;case 2:e.gl.vertexAttrib2fv(t,r);break;case 3:e.gl.vertexAttrib3fv(t,r);break;case 4:e.gl.vertexAttrib4fv(t,r)}}(this,e,t);break;case Int32Array:!function(e,t,r){e.gl.vertexAttribI4iv(t,r)}(this,e,t);break;case Uint32Array:!function(e,t,r){e.gl.vertexAttribI4uiv(t,r)}(this,e,t);break;default:throw Error("constant")}}getExtension(e){return C(this.gl,e,this._extensions),this._extensions}}},50947:(e,t,r)=>{r.d(t,{b:()=>s});var i=r(49509);function s(e){if("undefined"!=typeof window&&window.process?.type==="renderer"||void 0!==i&&i.versions?.electron)return!0;let t="undefined"!=typeof navigator&&navigator.userAgent,r=e||t;return!!(r&&r.indexOf("Electron")>=0)}},51465:(e,t,r)=>{r.d(t,{M:()=>h,P:()=>l});var i=r(60263);let s={f32:["f32",1],"vec2<f32>":["f32",2],"vec3<f32>":["f32",3],"vec4<f32>":["f32",4],f16:["f16",1],"vec2<f16>":["f16",2],"vec3<f16>":["f16",3],"vec4<f16>":["f16",4],i32:["i32",1],"vec2<i32>":["i32",2],"vec3<i32>":["i32",3],"vec4<i32>":["i32",4],u32:["u32",1],"vec2<u32>":["u32",2],"vec3<u32>":["u32",3],"vec4<u32>":["u32",4]},n={f32:4,f16:2,i32:4,u32:4};var o=r(89037);function a(e){let t;e.endsWith("-webgl")&&(e.replace("-webgl",""),t=!0);let[r,i]=e.split("x"),s=i?parseInt(i):1,n=(0,o.l)(r),a={type:r,components:s,byteLength:n.byteLength*s,integer:n.integer,signed:n.signed,normalized:n.normalized};return t&&(a.webglOnly=!0),a}function l(e,t){let r={};for(let o of e.attributes){let l=function(e,t,r){let o=function(e,t){let r=e.attributes.find(e=>e.name===t);return r||i.R.warn(`shader layout attribute "${t}" not present in shader`),r||null}(e,r),l=function(e,t){!function(e){for(let t of e)(t.attributes&&t.format||!t.attributes&&!t.format)&&i.R.warn(`BufferLayout ${name} must have either 'attributes' or 'format' field`)}(e);let r=function(e,t){for(let r of e)if(r.format&&r.name===t)return{attributeName:r.name,bufferName:t,stepMode:r.stepMode,vertexFormat:r.format,byteOffset:0,byteStride:r.byteStride||0};return null}(e,t);return r||(r=function(e,t){for(let r of e){let e=r.byteStride;if("number"!=typeof r.byteStride)for(let t of r.attributes||[])e+=a(t.format).byteLength;let i=r.attributes?.find(e=>e.attribute===t);if(i)return{attributeName:i.attribute,bufferName:r.name,stepMode:r.stepMode,vertexFormat:i.format,byteOffset:i.byteOffset,byteStride:e}}return null}(e,t))?r:(i.R.warn(`layout for attribute "${t}" not present in buffer layout`),null)}(t,r);if(!o)return null;let h=function(e){let[t,r]=s[e],i="i32"===t||"u32"===t,o="u32"!==t,a=n[t]*r,l=function(e,t){let r;switch(e){case"f32":r="float32";break;case"i32":r="sint32";break;case"u32":r="uint32";break;case"f16":return t<=2?"float16x2":"float16x4"}return 1===t?r:`${r}x${t}`}(t,r);return{dataType:t,components:r,defaultVertexFormat:l,byteLength:a,integer:i,signed:o}}(o.type),u=l?.vertexFormat||h.defaultVertexFormat,c=a(u);return{attributeName:l?.attributeName||o.name,bufferName:l?.bufferName||o.name,location:o.location,shaderType:o.type,shaderDataType:h.dataType,shaderComponents:h.components,vertexFormat:u,bufferDataType:c.type,bufferComponents:c.components,normalized:c.normalized,integer:h.integer,stepMode:l?.stepMode||o.stepMode||"vertex",byteOffset:l?.byteOffset||0,byteStride:l?.byteStride||0}}(e,t,o.name);l&&(r[o.name]=l)}return r}function h(e,t,r=16){let i=l(e,t),s=Array(r).fill(null);for(let e of Object.values(i))s[e.location]=e;return s}},53028:(e,t,r)=>{r.d(t,{M:()=>o});var i=r(5229),s=r(73801),n=r(34752);class o extends i.a{get x(){return this[0]}set x(e){this[0]=(0,s.ws)(e)}get y(){return this[1]}set y(e){this[1]=(0,s.ws)(e)}len(){return Math.sqrt(this.lengthSquared())}magnitude(){return this.len()}lengthSquared(){let e=0;for(let t=0;t<this.ELEMENTS;++t)e+=this[t]*this[t];return e}magnitudeSquared(){return this.lengthSquared()}distance(e){return Math.sqrt(this.distanceSquared(e))}distanceSquared(e){let t=0;for(let r=0;r<this.ELEMENTS;++r){let i=this[r]-e[r];t+=i*i}return(0,s.ws)(t)}dot(e){let t=0;for(let r=0;r<this.ELEMENTS;++r)t+=this[r]*e[r];return(0,s.ws)(t)}normalize(){let e=this.magnitude();if(0!==e)for(let t=0;t<this.ELEMENTS;++t)this[t]/=e;return this.check()}multiply(...e){for(let t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]*=t[e];return this.check()}divide(...e){for(let t of e)for(let e=0;e<this.ELEMENTS;++e)this[e]/=t[e];return this.check()}lengthSq(){return this.lengthSquared()}distanceTo(e){return this.distance(e)}distanceToSquared(e){return this.distanceSquared(e)}getComponent(e){return(0,n.v)(e>=0&&e<this.ELEMENTS,"index is out of range"),(0,s.ws)(this[e])}setComponent(e,t){return(0,n.v)(e>=0&&e<this.ELEMENTS,"index is out of range"),this[e]=t,this.check()}addVectors(e,t){return this.copy(e).add(t)}subVectors(e,t){return this.copy(e).subtract(t)}multiplyVectors(e,t){return this.copy(e).multiply(t)}addScaledVector(e,t){return this.add(new this.constructor(e).multiplyScalar(t))}}},53135:(e,t,r)=>{r.d(t,{A:()=>m});var i=r(20907),s=r(15273),n=r(74502),o=r(75031),a=r(1673),l=r(74456),h=r(81465),u=r(43210);let c=Math.PI/180,d=(0,s.$M)(),f=[0,0,0],p={unitsPerMeter:[1,1,1],metersPerUnit:[1,1,1]};class g{constructor(e={}){this._frustumPlanes={},this.id=e.id||this.constructor.displayName||"viewport",this.x=e.x||0,this.y=e.y||0,this.width=e.width||1,this.height=e.height||1,this.zoom=e.zoom||0,this.padding=e.padding,this.distanceScales=e.distanceScales||p,this.focalDistance=e.focalDistance||1,this.position=e.position||f,this.modelMatrix=e.modelMatrix||null;let{longitude:t,latitude:r}=e;this.isGeospatial=Number.isFinite(r)&&Number.isFinite(t),this._initProps(e),this._initMatrices(e),this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}get subViewports(){return null}get metersPerPixel(){return this.distanceScales.metersPerUnit[2]/this.scale}get projectionMode(){return this.isGeospatial?this.zoom<12?u.Kx.WEB_MERCATOR:u.Kx.WEB_MERCATOR_AUTO_OFFSET:u.Kx.IDENTITY}equals(e){return e instanceof g&&(this===e||e.width===this.width&&e.height===this.height&&e.scale===this.scale&&(0,o.aI)(e.projectionMatrix,this.projectionMatrix)&&(0,o.aI)(e.viewMatrix,this.viewMatrix))}project(e,{topLeft:t=!0}={}){let r=this.projectPosition(e),i=(0,h.VJ)(r,this.pixelProjectionMatrix),[s,n]=i,o=t?n:this.height-n;return 2===e.length?[s,o]:[s,o,i[2]]}unproject(e,{topLeft:t=!0,targetZ:r}={}){let[i,s,n]=e,o=t?s:this.height-s,a=r&&r*this.distanceScales.unitsPerMeter[2],l=(0,h.xJ)([i,o,n],this.pixelUnprojectionMatrix,a),[u,c,d]=this.unprojectPosition(l);return Number.isFinite(n)?[u,c,d]:Number.isFinite(r)?[u,c,r]:[u,c]}projectPosition(e){let[t,r]=this.projectFlat(e);return[t,r,(e[2]||0)*this.distanceScales.unitsPerMeter[2]]}unprojectPosition(e){let[t,r]=this.unprojectFlat(e);return[t,r,(e[2]||0)*this.distanceScales.metersPerUnit[2]]}projectFlat(e){if(this.isGeospatial){let t=(0,h.Gw)(e);return t[1]=(0,o.qE)(t[1],-318,830),t}return e}unprojectFlat(e){return this.isGeospatial?(0,h.iV)(e):e}getBounds(e={}){let t={targetZ:e.z||0},r=this.unproject([0,0],t),i=this.unproject([this.width,0],t),s=this.unproject([0,this.height],t),n=this.unproject([this.width,this.height],t);return[Math.min(r[0],i[0],s[0],n[0]),Math.min(r[1],i[1],s[1],n[1]),Math.max(r[0],i[0],s[0],n[0]),Math.max(r[1],i[1],s[1],n[1])]}getDistanceScales(e){return e&&this.isGeospatial?(0,h.nI)({longitude:e[0],latitude:e[1],highPrecision:!0}):this.distanceScales}containsPixel({x:e,y:t,width:r=1,height:i=1}){return e<this.x+this.width&&this.x<e+r&&t<this.y+this.height&&this.y<t+i}getFrustumPlanes(){return this._frustumPlanes.near||Object.assign(this._frustumPlanes,(0,s.on)(this.viewProjectionMatrix)),this._frustumPlanes}panByPosition(e,t){return null}_initProps(e){let t=e.longitude,r=e.latitude;this.isGeospatial&&(Number.isFinite(e.zoom)||(this.zoom=(0,h.fO)({latitude:r})+Math.log2(this.focalDistance)),this.distanceScales=e.distanceScales||(0,h.nI)({latitude:r,longitude:t}));let i=Math.pow(2,this.zoom);this.scale=i;let{position:s,modelMatrix:o}=e,l=f;if(s&&(l=o?new n.k(o).transformAsVector(s,[]):s),this.isGeospatial){let e=this.projectPosition([t,r,0]);this.center=new a.P(l).scale(this.distanceScales.unitsPerMeter).add(e)}else this.center=this.projectPosition(l)}_initMatrices(e){let{viewMatrix:t=d,projectionMatrix:r=null,orthographic:h=!1,fovyRadians:u,fovy:f=75,near:p=.1,far:g=1e3,padding:m=null,focalDistance:_=1}=e;this.viewMatrixUncentered=t,this.viewMatrix=new n.k().multiplyRight(t).translate(new a.P(this.center).negate()),this.projectionMatrix=r||function({width:e,height:t,orthographic:r,fovyRadians:i,focalDistance:s,padding:a,near:l,far:h}){let u=e/t,c=r?new n.k().orthographic({fovy:i,aspect:u,focalDistance:s,near:l,far:h}):new n.k().perspective({fovy:i,aspect:u,near:l,far:h});if(a){let{left:r=0,right:i=0,top:s=0,bottom:n=0}=a,l=(0,o.qE)((r+e-i)/2,0,e)-e/2,h=(0,o.qE)((s+t-n)/2,0,t)-t/2;c[8]-=2*l/e,c[9]+=2*h/t}return c}({width:this.width,height:this.height,orthographic:h,fovyRadians:u||f*c,focalDistance:_,padding:m,near:p,far:g});let A=(0,s.$M)();l.lw(A,A,this.projectionMatrix),l.lw(A,A,this.viewMatrix),this.viewProjectionMatrix=A,this.viewMatrixInverse=l.B8([],this.viewMatrix)||this.viewMatrix,this.cameraPosition=(0,s.Vl)(this.viewMatrixInverse);let E=(0,s.$M)(),b=(0,s.$M)();l.hs(E,E,[this.width/2,-this.height/2,1]),l.Tl(E,E,[1,-1,0]),l.lw(b,E,this.viewProjectionMatrix),this.pixelProjectionMatrix=b,this.pixelUnprojectionMatrix=l.B8((0,s.$M)(),this.pixelProjectionMatrix),this.pixelUnprojectionMatrix||i.A.warn("Pixel project matrix not invertible")()}}g.displayName="Viewport";let m=g},53422:(e,t,r)=>{r.d(t,{M:()=>a});var i=r(32167),s=r(67171);function n(e,t,r,i){if(i?.inlineSource){let i=function(e,t,r){let i="";for(let r=t-2;r<=t;r++){let s=e[r-1];void 0!==s&&(i+=o(s,t,void 0))}return i}(t,r),s=e.linePos>0?`${" ".repeat(e.linePos+5)}^^^
`:"";return`
${i}${s}${e.type.toUpperCase()}: ${e.message}

`}let s="error"===e.type?"red":"#8B4000";return i?.html?`<div class='luma-compiler-log-error' style="color:${s};"><b> ${e.type.toUpperCase()}: ${e.message}</b></div>`:`${e.type.toUpperCase()}: ${e.message}`}function o(e,t,r){let i=r?.html?e.replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;").replaceAll('"',"&quot;").replaceAll("'","&#039;"):e;return`${function(e,t){let r="";for(let t=e.length;t<4;++t)r+=" ";return r+e}(String(t),4)}: ${i}${r?.html?"<br/>":"\n"}`}class a extends i.F{static defaultProps={...i.F.defaultProps,language:"auto",stage:void 0,source:"",sourceMap:null,entryPoint:"main",debugShaders:void 0};get[Symbol.toStringTag](){return"Shader"}stage;source;compilationStatus="pending";constructor(e,t){t={...t,debugShaders:t.debugShaders||e.props.debugShaders||"errors"},super(e,{id:function(e){return l(e.source)||e.id||(0,s.L)(`unnamed ${e.stage}-shader`)}(t),...t},a.defaultProps),this.stage=this.props.stage,this.source=this.props.source}getCompilationInfoSync(){return null}getTranslatedSource(){return null}async debugShader(){let e=this.props.debugShaders;switch(e){case"never":return;case"errors":if("success"===this.compilationStatus)return}let t=await this.getCompilationInfo();("warnings"!==e||t?.length!==0)&&this._displayShaderLog(t)}_displayShaderLog(e){if("undefined"==typeof document||!document?.createElement)return;let t=l(this.source),r=`${this.stage} ${t}`,i=function(e,t,r){let i="",s=t.split(/\r?\n/),a=e.slice().sort((e,t)=>e.lineNum-t.lineNum);switch(r?.showSourceCode||"no"){case"all":let l=0;for(let e=1;e<=s.length;e++)for(i+=o(s[e-1],e,r);a.length>l&&a[l].lineNum===e;){let e=a[l++];i+=n(e,s,e.lineNum,{...r,inlineSource:!1})}return i;case"issues":case"no":for(let t of e)i+=n(t,s,t.lineNum,{inlineSource:r?.showSourceCode!=="no"});return i}}(e,this.source,{showSourceCode:"all",html:!0}),s=this.getTranslatedSource();s&&(i+=`<br /><br /><h1>Translated Source</h1><br /><br /><code style="user-select:text;"><pre>${s}</pre></code>`);let a=document.createElement("Button");a.innerHTML=`
<h1>Shader Compilation Error in ${r}</h1><br /><br />
<code style="user-select:text;"><pre>
${i}
</pre></code>`,a.style.top="10px",a.style.left="10px",a.style.position="absolute",a.style.zIndex="9999",a.style.width="100%",a.style.textAlign="left",document.body.appendChild(a);let h=document.getElementsByClassName("luma-compiler-log-error");h[0]?.scrollIntoView(),a.onclick=()=>{let e=`data:text/plain,${encodeURIComponent(this.source)}`;navigator.clipboard.writeText(e)}}}function l(e,t="unnamed"){let r=/#define[\s*]SHADER_NAME[\s*]([A-Za-z0-9_-]+)[\s*]/.exec(e);return r?r[1]:t}},54169:(e,t,r)=>{r.d(t,{pF:()=>c,I7:()=>u,PI:()=>h});var i=r(90288),s=r(60263),n=r(67171),o=r(609),a=r(58419),l=r(78333);class h{}class u{features;disabledFeatures;constructor(e=[],t){this.features=new Set(e),this.disabledFeatures=t||{}}*[Symbol.iterator](){yield*this.features}has(e){return!this.disabledFeatures?.[e]&&this.features.has(e)}}class c{static defaultProps={id:null,powerPreference:"high-performance",failIfMajorPerformanceCaveat:!1,createCanvasContext:void 0,onError:e=>s.R.error(e.message)(),_reuseDevices:!1,_requestMaxLimits:!0,_factoryDestroyPolicy:"unused",_initializeFeatures:!0,_disabledFeatures:{"compilation-status-async-webgl":!0},_resourceDefaults:{},webgl:{},debug:s.R.get("debug")||void 0,debugShaders:s.R.get("debug-shaders")||void 0,debugFramebuffers:!!s.R.get("debug-framebuffers"),debugWebGL:!!s.R.get("debug-webgl"),debugSpectorJS:void 0,debugSpectorJSUrl:void 0,_handle:void 0};get[Symbol.toStringTag](){return"Device"}constructor(e){this.props={...c.defaultProps,...e},this.id=this.props.id||(0,n.L)(this[Symbol.toStringTag].toLowerCase())}id;props;userData={};statsManager=i.d;timestamp=0;_reused=!1;_lumaData={};getTextureFormatCapabilities(e){let t=function(e){let t=(0,l.q)(e),r={format:e,create:t.f??!0,render:t.render??!0,filter:t.filter??!0,blend:t.blend??!0,store:t.store??!0},i=(0,a.z)(e),s=e.startsWith("depth")||e.startsWith("stencil"),n=i?.signed,o=i?.integer,h=i?.webgl;return r.render&&=!n,r.filter&&=!s&&!n&&!o&&!h,r}(e),r=e=>("string"==typeof e?this.features.has(e):e)??!0,i=r(t.create),s={format:e,create:i,render:i&&r(t.render),filter:i&&r(t.filter),blend:i&&r(t.blend),store:i&&r(t.store)};return this._getDeviceSpecificTextureFormatCapabilities(s)}isTextureFormatSupported(e,t){return this.getTextureFormatCapabilities(e).create}isTextureFormatFilterable(e){return this.getTextureFormatCapabilities(e).filter}isTextureFormatRenderable(e){return this.getTextureFormatCapabilities(e).render}isTextureFormatCompressed(e){return(0,a.Y)(e)}loseDevice(){return!1}reportError(e){this.props.onError(e)}getDefaultCanvasContext(){if(!this.canvasContext)throw Error("Device has no default CanvasContext. See props.createCanvasContext");return this.canvasContext}createCommandEncoder(e={}){throw Error("not implemented")}incrementTimestamp(){return this.timestamp++}onError(e){this.props.onError(e)}getCanvasContext(){return this.getDefaultCanvasContext()}readPixelsToArrayWebGL(e,t){throw Error("not implemented")}readPixelsToBufferWebGL(e,t){throw Error("not implemented")}setParametersWebGL(e){throw Error("not implemented")}getParametersWebGL(e){throw Error("not implemented")}withParametersWebGL(e,t){throw Error("not implemented")}clearWebGL(e){throw Error("not implemented")}resetWebGL(){throw Error("not implemented")}static _getCanvasContextProps(e){return!0===e.createCanvasContext?{}:e.createCanvasContext}_normalizeBufferProps(e){(e instanceof ArrayBuffer||ArrayBuffer.isView(e))&&(e={data:e});let t={...e};return(e.usage||0)&o.h.INDEX&&!e.indexType&&(e.data instanceof Uint32Array?t.indexType="uint32":e.data instanceof Uint16Array?t.indexType="uint16":s.R.warn("indices buffer content must be of integer type")()),t}}},55927:(e,t,r)=>{r.d(t,{A:()=>tO});let i=1,s=1;class n{time=0;channels=new Map;animations=new Map;playing=!1;lastEngineTime=-1;constructor(){}addChannel(e){let{delay:t=0,duration:r=Number.POSITIVE_INFINITY,rate:s=1,repeat:n=1}=e,o=i++,a={time:0,delay:t,duration:r,rate:s,repeat:n};return this._setChannelTime(a,this.time),this.channels.set(o,a),o}removeChannel(e){for(let[t,r]of(this.channels.delete(e),this.animations))r.channel===e&&this.detachAnimation(t)}isFinished(e){let t=this.channels.get(e);return void 0!==t&&this.time>=t.delay+t.duration*t.repeat}getTime(e){if(void 0===e)return this.time;let t=this.channels.get(e);return void 0===t?-1:t.time}setTime(e){for(let t of(this.time=Math.max(0,e),this.channels.values()))this._setChannelTime(t,this.time);for(let e of this.animations.values()){let{animation:t,channel:r}=e;t.setTime(this.getTime(r))}}play(){this.playing=!0}pause(){this.playing=!1,this.lastEngineTime=-1}reset(){this.setTime(0)}attachAnimation(e,t){let r=s++;return this.animations.set(r,{animation:e,channel:t}),e.setTime(this.getTime(t)),r}detachAnimation(e){this.animations.delete(e)}update(e){this.playing&&(-1===this.lastEngineTime&&(this.lastEngineTime=e),this.setTime(this.time+(e-this.lastEngineTime)),this.lastEngineTime=e)}_setChannelTime(e,t){let r=t-e.delay;r>=e.duration*e.repeat?e.time=e.duration*e.rate:(e.time=Math.max(0,r)%e.duration,e.time*=e.rate)}}var o=r(35510);let a=[r(70213).A],l=["vs:DECKGL_FILTER_SIZE(inout vec3 size, VertexGeometry geometry)","vs:DECKGL_FILTER_GL_POSITION(inout vec4 position, VertexGeometry geometry)","vs:DECKGL_FILTER_COLOR(inout vec4 color, VertexGeometry geometry)","fs:DECKGL_FILTER_COLOR(inout vec4 color, FragmentGeometry geometry)"],h=[],u=`\
uniform layerUniforms {
  uniform float opacity;
} layer;
`,c={name:"layer",vs:u,fs:u,getUniforms:e=>({opacity:Math.pow(e.opacity,1/2.2)}),uniformTypes:{opacity:"f32"}};var d=r(35761),f=r(20907),p=r(28131),g=r(68323),m=r(7840),_=r(22662);class A{constructor(e,t,r){this._loadCount=0,this._subscribers=new Set,this.id=e,this.context=r,this.setData(t)}subscribe(e){this._subscribers.add(e)}unsubscribe(e){this._subscribers.delete(e)}inUse(){return this._subscribers.size>0}delete(){}getData(){return this.isLoaded?this._error?Promise.reject(this._error):this._content:this._loader.then(()=>this.getData())}setData(e,t){if(e===this._data&&!t)return;this._data=e;let r=++this._loadCount,i=e;for(let t of("string"==typeof e&&(i=(0,_.H)(e)),i instanceof Promise?(this.isLoaded=!1,this._loader=i.then(e=>{this._loadCount===r&&(this.isLoaded=!0,this._error=void 0,this._content=e)}).catch(e=>{this._loadCount===r&&(this.isLoaded=!0,this._error=e||!0)})):(this.isLoaded=!0,this._error=void 0,this._content=e),this._subscribers))t.onChange(this.getData())}}class E{constructor(e){this.protocol=e.protocol||"resource://",this._context={device:e.device,gl:e.device?.gl,resourceManager:this},this._resources={},this._consumers={},this._pruneRequest=null}contains(e){return!!e.startsWith(this.protocol)||e in this._resources}add({resourceId:e,data:t,forceUpdate:r=!1,persistent:i=!0}){let s=this._resources[e];s?s.setData(t,r):(s=new A(e,t,this._context),this._resources[e]=s),s.persistent=i}remove(e){let t=this._resources[e];t&&(t.delete(),delete this._resources[e])}unsubscribe({consumerId:e}){let t=this._consumers[e];if(t){for(let e in t){let r=t[e],i=this._resources[r.resourceId];i&&i.unsubscribe(r)}delete this._consumers[e],this.prune()}}subscribe({resourceId:e,onChange:t,consumerId:r,requestId:i="default"}){let{_resources:s,protocol:n}=this;e.startsWith(n)&&!s[e=e.replace(n,"")]&&this.add({resourceId:e,data:null,persistent:!1});let o=s[e];if(this._track(r,i,o,t),o)return o.getData()}prune(){this._pruneRequest||(this._pruneRequest=setTimeout(()=>this._prune(),0))}finalize(){for(let e in this._resources)this._resources[e].delete()}_track(e,t,r,i){let s=this._consumers,n=s[e]=s[e]||{},o=n[t],a=o&&o.resourceId&&this._resources[o.resourceId];a&&(a.unsubscribe(o),this.prune()),r&&(o?(o.onChange=i,o.resourceId=r.id):o={onChange:i,resourceId:r.id},n[t]=o,r.subscribe(o))}_prune(){for(let e of(this._pruneRequest=null,Object.keys(this._resources))){let t=this._resources[e];t.persistent||t.inUse()||(t.delete(),delete this._resources[e])}}}var b=r(53135);class y{constructor(e,t){this._lastRenderedLayers=[],this._needsRedraw=!1,this._needsUpdate=!1,this._nextLayers=null,this._debug=!1,this._defaultShaderModulesChanged=!1,this.activateViewport=e=>{(0,p.A)("layerManager.activateViewport",this,e),e&&(this.context.viewport=e)};let{deck:r,stats:i,viewport:s,timeline:u}=t||{};this.layers=[],this.resourceManager=new E({device:e,protocol:"deck://"}),this.context={mousePosition:null,userData:{},layerManager:this,device:e,gl:e?.gl,deck:r,shaderAssembler:function(e){let t=o._.getDefaultShaderAssembler();for(let e of a)t.addDefaultModule(e);for(let r of"glsl"===e?l:h)t.addShaderHook(r);return t}(e?.info?.shadingLanguage||"glsl"),defaultShaderModules:[c],renderPass:void 0,stats:i||new m.Uz({id:"deck.gl"}),viewport:s||new b.A({id:"DEFAULT-INITIAL-VIEWPORT"}),timeline:u||new n,resourceManager:this.resourceManager,onError:void 0},Object.seal(this)}finalize(){for(let e of(this.resourceManager.finalize(),this.layers))this._finalizeLayer(e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;for(let r of(e.clearRedrawFlags&&(this._needsRedraw=!1),this.layers)){let i=r.getNeedsRedraw(e);t=t||i}return t}needsUpdate(){return this._nextLayers&&this._nextLayers!==this._lastRenderedLayers?"layers changed":this._defaultShaderModulesChanged?"shader modules changed":this._needsUpdate}setNeedsRedraw(e){this._needsRedraw=this._needsRedraw||e}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e}getLayers({layerIds:e}={}){return e?this.layers.filter(t=>e.find(e=>0===t.id.indexOf(e))):this.layers}setProps(e){"debug"in e&&(this._debug=e.debug),"userData"in e&&(this.context.userData=e.userData),"layers"in e&&(this._nextLayers=e.layers),"onError"in e&&(this.context.onError=e.onError)}setLayers(e,t){(0,p.A)("layerManager.setLayers",this,t,e),this._lastRenderedLayers=e;let r=(0,g.B)(e,Boolean);for(let e of r)e.context=this.context;this._updateLayers(this.layers,r)}updateLayers(){let e=this.needsUpdate();e&&(this.setNeedsRedraw(`updating layers: ${e}`),this.setLayers(this._nextLayers||this._lastRenderedLayers,e)),this._nextLayers=null}addDefaultShaderModule(e){let{defaultShaderModules:t}=this.context;t.find(t=>t.name===e.name)||(t.push(e),this._defaultShaderModulesChanged=!0)}removeDefaultShaderModule(e){let{defaultShaderModules:t}=this.context,r=t.findIndex(t=>t.name===e.name);r>=0&&(t.splice(r,1),this._defaultShaderModulesChanged=!0)}_handleError(e,t,r){r.raiseError(t,`${e} of ${r}`)}_updateLayers(e,t){let r={};for(let t of e)r[t.id]?f.A.warn(`Multiple old layers with same id ${t.id}`)():r[t.id]=t;if(this._defaultShaderModulesChanged){for(let t of e)t.setNeedsUpdate(),t.setChangeFlags({extensionsChanged:!0});this._defaultShaderModulesChanged=!1}let i=[];this._updateSublayersRecursively(t,r,i),this._finalizeOldLayers(r);let s=!1;for(let e of i)if(e.hasUniformTransition()){s=`Uniform transition in ${e}`;break}this._needsUpdate=s,this.layers=i}_updateSublayersRecursively(e,t,r){for(let i of e){i.context=this.context;let e=t[i.id];null===e&&f.A.warn(`Multiple new layers with same id ${i.id}`)(),t[i.id]=null;let s=null;try{this._debug&&e!==i&&i.validateProps(),e?(this._transferLayerState(e,i),this._updateLayer(i)):this._initializeLayer(i),r.push(i),s=i.isComposite?i.getSubLayers():null}catch(e){this._handleError("matching",e,i)}s&&this._updateSublayersRecursively(s,t,r)}}_finalizeOldLayers(e){for(let t in e){let r=e[t];r&&this._finalizeLayer(r)}}_initializeLayer(e){try{e._initialize(),e.lifecycle=d.VD.INITIALIZED}catch(t){this._handleError("initialization",t,e)}}_transferLayerState(e,t){t._transferState(e),t.lifecycle=d.VD.MATCHED,t!==e&&(e.lifecycle=d.VD.AWAITING_GC)}_updateLayer(e){try{e._update()}catch(t){this._handleError("update",t,e)}}_finalizeLayer(e){this._needsRedraw=this._needsRedraw||`finalized ${e}`,e.lifecycle=d.VD.AWAITING_FINALIZATION;try{e._finalize(),e.lifecycle=d.VD.FINALIZED}catch(t){this._handleError("finalization",t,e)}}}var T=r(91852);class C{constructor(e){this.views=[],this.width=100,this.height=100,this.viewState={},this.controllers={},this.timeline=e.timeline,this._viewports=[],this._viewportMap={},this._isUpdating=!1,this._needsRedraw="First render",this._needsUpdate="Initialize",this._eventManager=e.eventManager,this._eventCallbacks={onViewStateChange:e.onViewStateChange,onInteractionStateChange:e.onInteractionStateChange},Object.seal(this),this.setProps(e)}finalize(){for(let e in this.controllers){let t=this.controllers[e];t&&t.finalize()}this.controllers={}}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}setNeedsUpdate(e){this._needsUpdate=this._needsUpdate||e,this._needsRedraw=this._needsRedraw||e}updateViewStates(){for(let e in this.controllers){let t=this.controllers[e];t&&t.updateTransition()}}getViewports(e){return e?this._viewports.filter(t=>t.containsPixel(e)):this._viewports}getViews(){let e={};return this.views.forEach(t=>{e[t.id]=t}),e}getView(e){return this.views.find(t=>t.id===e)}getViewState(e){let t="string"==typeof e?this.getView(e):e,r=t&&this.viewState[t.getViewStateId()]||this.viewState;return t?t.filterViewState(r):r}getViewport(e){return this._viewportMap[e]}unproject(e,t){let r=this.getViewports(),i={x:e[0],y:e[1]};for(let s=r.length-1;s>=0;--s){let n=r[s];if(n.containsPixel(i)){let r=e.slice();return r[0]-=n.x,r[1]-=n.y,n.unproject(r,t)}}return null}setProps(e){e.views&&this._setViews(e.views),e.viewState&&this._setViewState(e.viewState),("width"in e||"height"in e)&&this._setSize(e.width,e.height),this._isUpdating||this._update()}_update(){this._isUpdating=!0,this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._needsUpdate&&(this._needsUpdate=!1,this._rebuildViewports()),this._isUpdating=!1}_setSize(e,t){(e!==this.width||t!==this.height)&&(this.width=e,this.height=t,this.setNeedsUpdate("Size changed"))}_setViews(e){e=(0,g.B)(e,Boolean),this._diffViews(e,this.views)&&this.setNeedsUpdate("views changed"),this.views=e}_setViewState(e){e?((0,T.b)(e,this.viewState,3)||this.setNeedsUpdate("viewState changed"),this.viewState=e):f.A.warn("missing `viewState` or `initialViewState`")()}_createController(e,t){return new t.type({timeline:this.timeline,eventManager:this._eventManager,onViewStateChange:this._eventCallbacks.onViewStateChange,onStateChange:this._eventCallbacks.onInteractionStateChange,makeViewport:t=>this.getView(e.id)?.makeViewport({viewState:t,width:this.width,height:this.height})})}_updateController(e,t,r,i){let s=e.controller;if(s&&r){let n={...t,...s,id:e.id,x:r.x,y:r.y,width:r.width,height:r.height};return i&&i.constructor===s.type||(i=this._createController(e,n)),i&&i.setProps(n),i}return null}_rebuildViewports(){let{views:e}=this,t=this.controllers;this._viewports=[],this.controllers={};let r=!1;for(let i=e.length;i--;){let s=e[i],n=this.getViewState(s),o=s.makeViewport({viewState:n,width:this.width,height:this.height}),a=t[s.id],l=!!s.controller;l&&!a&&(r=!0),(r||!l)&&a&&(a.finalize(),a=null),this.controllers[s.id]=this._updateController(s,n,o,a),o&&this._viewports.unshift(o)}for(let e in t){let r=t[e];r&&!this.controllers[e]&&r.finalize()}this._buildViewportMap()}_buildViewportMap(){this._viewportMap={},this._viewports.forEach(e=>{e.id&&(this._viewportMap[e.id]=this._viewportMap[e.id]||e)})}_diffViews(e,t){return e.length!==t.length||e.some((r,i)=>!e[i].equals(t[i]))}}let v=/([0-9]+\.?[0-9]*)(%|px)/;function R(e){switch(typeof e){case"number":return{position:e,relative:!1};case"string":let t=v.exec(e);if(t&&t.length>=3){let e="%"===t[2],r=parseFloat(t[1]);return{position:e?r/100:r,relative:e}}default:throw Error(`Could not parse position string ${e}`)}}function S(e,t){return e.relative?Math.round(e.position*t):e.position}class B{constructor(e){let{id:t,x:r=0,y:i=0,width:s="100%",height:n="100%",padding:o=null}=e;this.id=t||this.constructor.displayName||"view",this.props={...e,id:this.id},this._x=R(r),this._y=R(i),this._width=R(s),this._height=R(n),this._padding=o&&{left:R(o.left||0),right:R(o.right||0),top:R(o.top||0),bottom:R(o.bottom||0)},this.equals=this.equals.bind(this),Object.seal(this)}equals(e){return this===e||this.constructor===e.constructor&&(0,T.b)(this.props,e.props,2)}makeViewport({width:e,height:t,viewState:r}){r=this.filterViewState(r);let i=this.getDimensions({width:e,height:t});return i.height&&i.width?new(this.getViewportType(r))({...r,...this.props,...i}):null}getViewStateId(){let{viewState:e}=this.props;return"string"==typeof e?e:e?.id||this.id}filterViewState(e){if(this.props.viewState&&"object"==typeof this.props.viewState){if(!this.props.viewState.id)return this.props.viewState;let t={...e};for(let e in this.props.viewState)"id"!==e&&(t[e]=this.props.viewState[e]);return t}return e}getDimensions({width:e,height:t}){let r={x:S(this._x,e),y:S(this._y,t),width:S(this._width,e),height:S(this._height,t)};return this._padding&&(r.padding={left:S(this._padding.left,e),top:S(this._padding.top,t),right:S(this._padding.right,e),bottom:S(this._padding.bottom,t)}),r}get controller(){let e=this.props.controller;return e?!0===e?{type:this.ControllerType}:"function"==typeof e?{type:e}:{type:this.ControllerType,...e}:null}}var w=r(16186),M=r(75031),I=r(86043);let P=()=>{},L={BREAK:1,SNAP_TO_END:2,IGNORE:3},O=e=>e,x=L.BREAK;class N{constructor(e){this._onTransitionUpdate=e=>{let{time:t,settings:{interpolator:r,startProps:i,endProps:s,duration:n,easing:o}}=e,a=o(t/n),l=r.interpolateProps(i,s,a);this.propsInTransition=this.getControllerState({...this.props,...l}).getViewportProps(),this.onViewStateChange({viewState:this.propsInTransition,oldViewState:this.props})},this.getControllerState=e.getControllerState,this.propsInTransition=null,this.transition=new I.A(e.timeline),this.onViewStateChange=e.onViewStateChange||P,this.onStateChange=e.onStateChange||P}finalize(){this.transition.cancel()}getViewportInTransition(){return this.propsInTransition}processViewStateChange(e){let t=!1,r=this.props;if(this.props=e,!r||this._shouldIgnoreViewportChange(r,e))return!1;if(this._isTransitionEnabled(e)){let i=r;if(this.transition.inProgress){let{interruption:e,endProps:t}=this.transition.settings;i={...r,...e===L.SNAP_TO_END?t:this.propsInTransition||r}}this._triggerTransition(i,e),t=!0}else this.transition.cancel();return t}updateTransition(){this.transition.update()}_isTransitionEnabled(e){let{transitionDuration:t,transitionInterpolator:r}=e;return(t>0||"auto"===t)&&!!r}_isUpdateDueToCurrentTransition(e){return!!this.transition.inProgress&&!!this.propsInTransition&&this.transition.settings.interpolator.arePropsEqual(e,this.propsInTransition)}_shouldIgnoreViewportChange(e,t){return this.transition.inProgress?this.transition.settings.interruption===L.IGNORE||this._isUpdateDueToCurrentTransition(t):!this._isTransitionEnabled(t)||t.transitionInterpolator.arePropsEqual(e,t)}_triggerTransition(e,t){let r=this.getControllerState(e),i=this.getControllerState(t).shortestPathFrom(r),s=t.transitionInterpolator,n=s.getDuration?s.getDuration(e,t):t.transitionDuration;if(0===n)return;let o=s.initializeProps(e,i);this.propsInTransition={};let a={duration:n,easing:t.transitionEasing||O,interpolator:s,interruption:t.transitionInterruption||x,startProps:o.start,endProps:o.end,onStart:t.onTransitionStart,onUpdate:this._onTransitionUpdate,onInterrupt:this._onTransitionEnd(t.onTransitionInterrupt),onEnd:this._onTransitionEnd(t.onTransitionEnd)};this.transition.start(a),this.onStateChange({inTransition:!0}),this.updateTransition()}_onTransitionEnd(e){return t=>{this.propsInTransition=null,this.onStateChange({inTransition:!1,isZooming:!1,isPanning:!1,isRotating:!1}),e?.(t)}}}var F=r(72593);class D{constructor(e){let{compare:t,extract:r,required:i}=e;this._propsToCompare=t,this._propsToExtract=r||t,this._requiredProps=i}arePropsEqual(e,t){for(let r of this._propsToCompare)if(!(r in e)||!(r in t)||!(0,M.aI)(e[r],t[r]))return!1;return!0}initializeProps(e,t){let r={},i={};for(let s of this._propsToExtract)(s in e||s in t)&&(r[s]=e[s],i[s]=t[s]);return this._checkRequiredProps(r),this._checkRequiredProps(i),{start:r,end:i}}getDuration(e,t){return t.transitionDuration}_checkRequiredProps(e){this._requiredProps&&this._requiredProps.forEach(t=>{let r=e[t];(0,F.A)(Number.isFinite(r)||Array.isArray(r),`${t} is required for transition`)})}}let U=["longitude","latitude","zoom","bearing","pitch"],G=["longitude","latitude","zoom"];class k extends D{constructor(e={}){let t=Array.isArray(e)?e:e.transitionProps,r=Array.isArray(e)?{}:e;r.transitionProps=Array.isArray(t)?{compare:t,required:t}:t||{compare:U,required:G},super(r.transitionProps),this.opts=r}initializeProps(e,t){let r=super.initializeProps(e,t),{makeViewport:i,around:s}=this.opts;if(i&&s){let n=i(e),o=i(t),a=n.unproject(s);r.start.around=s,Object.assign(r.end,{around:o.project(a),aroundPosition:a,width:t.width,height:t.height})}return r}interpolateProps(e,t,r){let i={};for(let s of this._propsToExtract)i[s]=(0,M.Cc)(e[s]||0,t[s]||0,r);if(t.aroundPosition&&this.opts.makeViewport){let s=this.opts.makeViewport({...t,...i});Object.assign(i,s.panByPosition(t.aroundPosition,(0,M.Cc)(e.around,t.around,r)))}return i}}let H={transitionDuration:0},V=e=>1-(1-e)*(1-e),j={WHEEL:["wheel"],PAN:["panstart","panmove","panend"],PINCH:["pinchstart","pinchmove","pinchend"],MULTI_PAN:["multipanstart","multipanmove","multipanend"],DOUBLE_CLICK:["dblclick"],KEYBOARD:["keydown"]},W={};class z{constructor(e){this.state={},this._events={},this._interactionState={isDragging:!1},this._customEvents=[],this._eventStartBlocked=null,this._panMove=!1,this.invertPan=!1,this.dragMode="rotate",this.inertia=0,this.scrollZoom=!0,this.dragPan=!0,this.dragRotate=!0,this.doubleClickZoom=!0,this.touchZoom=!0,this.touchRotate=!1,this.keyboard=!0,this.transitionManager=new N({...e,getControllerState:e=>new this.ControllerState(e),onViewStateChange:this._onTransition.bind(this),onStateChange:this._setInteractionState.bind(this)}),this.handleEvent=this.handleEvent.bind(this),this.eventManager=e.eventManager,this.onViewStateChange=e.onViewStateChange||(()=>{}),this.onStateChange=e.onStateChange||(()=>{}),this.makeViewport=e.makeViewport}set events(e){this.toggleEvents(this._customEvents,!1),this.toggleEvents(e,!0),this._customEvents=e,this.props&&this.setProps(this.props)}finalize(){for(let e in this._events)this._events[e]&&this.eventManager?.off(e,this.handleEvent);this.transitionManager.finalize()}handleEvent(e){this._controllerState=void 0;let t=this._eventStartBlocked;switch(e.type){case"panstart":return!t&&this._onPanStart(e);case"panmove":return this._onPan(e);case"panend":return this._onPanEnd(e);case"pinchstart":return!t&&this._onPinchStart(e);case"pinchmove":return this._onPinch(e);case"pinchend":return this._onPinchEnd(e);case"multipanstart":return!t&&this._onMultiPanStart(e);case"multipanmove":return this._onMultiPan(e);case"multipanend":return this._onMultiPanEnd(e);case"dblclick":return this._onDoubleClick(e);case"wheel":return this._onWheel(e);case"keydown":return this._onKeyDown(e);default:return!1}}get controllerState(){return this._controllerState=this._controllerState||new this.ControllerState({makeViewport:this.makeViewport,...this.props,...this.state}),this._controllerState}getCenter(e){let{x:t,y:r}=this.props,{offsetCenter:i}=e;return[i.x-t,i.y-r]}isPointInBounds(e,t){let{width:r,height:i}=this.props;if(t&&t.handled)return!1;let s=e[0]>=0&&e[0]<=r&&e[1]>=0&&e[1]<=i;return s&&t&&t.stopPropagation(),s}isFunctionKeyPressed(e){let{srcEvent:t}=e;return!!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)}isDragging(){return this._interactionState.isDragging||!1}blockEvents(e){let t=setTimeout(()=>{this._eventStartBlocked===t&&(this._eventStartBlocked=null)},e);this._eventStartBlocked=t}setProps(e){e.dragMode&&(this.dragMode=e.dragMode),this.props=e,"transitionInterpolator"in e||(e.transitionInterpolator=this._getTransitionProps().transitionInterpolator),this.transitionManager.processViewStateChange(e);let{inertia:t}=e;this.inertia=Number.isFinite(t)?t:300*(!0===t);let{scrollZoom:r=!0,dragPan:i=!0,dragRotate:s=!0,doubleClickZoom:n=!0,touchZoom:o=!0,touchRotate:a=!1,keyboard:l=!0}=e,h=!!this.onViewStateChange;this.toggleEvents(j.WHEEL,h&&r),this.toggleEvents(j.PAN,h),this.toggleEvents(j.PINCH,h&&(o||a)),this.toggleEvents(j.MULTI_PAN,h&&a),this.toggleEvents(j.DOUBLE_CLICK,h&&n),this.toggleEvents(j.KEYBOARD,h&&l),this.scrollZoom=r,this.dragPan=i,this.dragRotate=s,this.doubleClickZoom=n,this.touchZoom=o,this.touchRotate=a,this.keyboard=l}updateTransition(){this.transitionManager.updateTransition()}toggleEvents(e,t){this.eventManager&&e.forEach(e=>{this._events[e]!==t&&(this._events[e]=t,t?this.eventManager.on(e,this.handleEvent):this.eventManager.off(e,this.handleEvent))})}updateViewport(e,t=null,r={}){let i={...e.getViewportProps(),...t},s=this.controllerState!==e;if(this.state=e.getState(),this._setInteractionState(r),s){let e=this.controllerState&&this.controllerState.getViewportProps();this.onViewStateChange&&this.onViewStateChange({viewState:i,interactionState:this._interactionState,oldViewState:e,viewId:this.props.id})}}_onTransition(e){this.onViewStateChange({...e,interactionState:this._interactionState,viewId:this.props.id})}_setInteractionState(e){Object.assign(this._interactionState,e),this.onStateChange(this._interactionState)}_onPanStart(e){let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.isFunctionKeyPressed(e)||e.rightButton||!1;(this.invertPan||"pan"===this.dragMode)&&(r=!r);let i=this.controllerState[r?"panStart":"rotateStart"]({pos:t});return this._panMove=r,this.updateViewport(i,H,{isDragging:!0}),!0}_onPan(e){return!!this.isDragging()&&(this._panMove?this._onPanMove(e):this._onPanRotate(e))}_onPanEnd(e){return!!this.isDragging()&&(this._panMove?this._onPanMoveEnd(e):this._onPanRotateEnd(e))}_onPanMove(e){if(!this.dragPan)return!1;let t=this.getCenter(e),r=this.controllerState.pan({pos:t});return this.updateViewport(r,H,{isDragging:!0,isPanning:!0}),!0}_onPanMoveEnd(e){let{inertia:t}=this;if(this.dragPan&&t&&e.velocity){let r=this.getCenter(e),i=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],s=this.controllerState.pan({pos:i}).panEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:V},{isDragging:!1,isPanning:!0})}else{let e=this.controllerState.panEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1})}return!0}_onPanRotate(e){if(!this.dragRotate)return!1;let t=this.getCenter(e),r=this.controllerState.rotate({pos:t});return this.updateViewport(r,H,{isDragging:!0,isRotating:!0}),!0}_onPanRotateEnd(e){let{inertia:t}=this;if(this.dragRotate&&t&&e.velocity){let r=this.getCenter(e),i=[r[0]+e.velocityX*t/2,r[1]+e.velocityY*t/2],s=this.controllerState.rotate({pos:i}).rotateEnd();this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:V},{isDragging:!1,isRotating:!0})}else{let e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onWheel(e){if(!this.scrollZoom)return!1;let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;e.srcEvent.preventDefault();let{speed:r=.01,smooth:i=!1}=!0===this.scrollZoom?{}:this.scrollZoom,{delta:s}=e,n=2/(1+Math.exp(-Math.abs(s*r)));s<0&&0!==n&&(n=1/n);let o=this.controllerState.zoom({pos:t,scale:n});return this.updateViewport(o,{...this._getTransitionProps({around:t}),transitionDuration:i?250:1},{isZooming:!0,isPanning:!0}),!0}_onMultiPanStart(e){let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.controllerState.rotateStart({pos:t});return this.updateViewport(r,H,{isDragging:!0}),!0}_onMultiPan(e){if(!this.touchRotate||!this.isDragging())return!1;let t=this.getCenter(e);t[0]-=e.deltaX;let r=this.controllerState.rotate({pos:t});return this.updateViewport(r,H,{isDragging:!0,isRotating:!0}),!0}_onMultiPanEnd(e){if(!this.isDragging())return!1;let{inertia:t}=this;if(this.touchRotate&&t&&e.velocityY){let r=this.getCenter(e),i=[r[0],r[1]+=e.velocityY*t/2],s=this.controllerState.rotate({pos:i});this.updateViewport(s,{...this._getTransitionProps(),transitionDuration:t,transitionEasing:V},{isDragging:!1,isRotating:!0}),this.blockEvents(t)}else{let e=this.controllerState.rotateEnd();this.updateViewport(e,null,{isDragging:!1,isRotating:!1})}return!0}_onPinchStart(e){let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.controllerState.zoomStart({pos:t}).rotateStart({pos:t});return W._startPinchRotation=e.rotation,W._lastPinchEvent=e,this.updateViewport(r,H,{isDragging:!0}),!0}_onPinch(e){if(!this.touchZoom&&!this.touchRotate||!this.isDragging())return!1;let t=this.controllerState;if(this.touchZoom){let{scale:r}=e,i=this.getCenter(e);t=t.zoom({pos:i,scale:r})}if(this.touchRotate){let{rotation:r}=e;t=t.rotate({deltaAngleX:W._startPinchRotation-r})}return this.updateViewport(t,H,{isDragging:!0,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:this.touchRotate}),W._lastPinchEvent=e,!0}_onPinchEnd(e){if(!this.isDragging())return!1;let{inertia:t}=this,{_lastPinchEvent:r}=W;if(this.touchZoom&&t&&r&&e.scale!==r.scale){let i=this.getCenter(e),s=this.controllerState.rotateEnd(),n=Math.log2(e.scale),o=(n-Math.log2(r.scale))/(e.deltaTime-r.deltaTime),a=Math.pow(2,n+o*t/2);s=s.zoom({pos:i,scale:a}).zoomEnd(),this.updateViewport(s,{...this._getTransitionProps({around:i}),transitionDuration:t,transitionEasing:V},{isDragging:!1,isPanning:this.touchZoom,isZooming:this.touchZoom,isRotating:!1}),this.blockEvents(t)}else{let e=this.controllerState.zoomEnd().rotateEnd();this.updateViewport(e,null,{isDragging:!1,isPanning:!1,isZooming:!1,isRotating:!1})}return W._startPinchRotation=null,W._lastPinchEvent=null,!0}_onDoubleClick(e){if(!this.doubleClickZoom)return!1;let t=this.getCenter(e);if(!this.isPointInBounds(t,e))return!1;let r=this.isFunctionKeyPressed(e),i=this.controllerState.zoom({pos:t,scale:r?.5:2});return this.updateViewport(i,this._getTransitionProps({around:t}),{isZooming:!0,isPanning:!0}),this.blockEvents(100),!0}_onKeyDown(e){let t;if(!this.keyboard)return!1;let r=this.isFunctionKeyPressed(e),{zoomSpeed:i,moveSpeed:s,rotateSpeedX:n,rotateSpeedY:o}=!0===this.keyboard?{}:this.keyboard,{controllerState:a}=this,l={};switch(e.srcEvent.code){case"Minus":t=r?a.zoomOut(i).zoomOut(i):a.zoomOut(i),l.isZooming=!0;break;case"Equal":t=r?a.zoomIn(i).zoomIn(i):a.zoomIn(i),l.isZooming=!0;break;case"ArrowLeft":r?(t=a.rotateLeft(n),l.isRotating=!0):(t=a.moveLeft(s),l.isPanning=!0);break;case"ArrowRight":r?(t=a.rotateRight(n),l.isRotating=!0):(t=a.moveRight(s),l.isPanning=!0);break;case"ArrowUp":r?(t=a.rotateUp(o),l.isRotating=!0):(t=a.moveUp(s),l.isPanning=!0);break;case"ArrowDown":r?(t=a.rotateDown(o),l.isRotating=!0):(t=a.moveDown(s),l.isPanning=!0);break;default:return!1}return this.updateViewport(t,this._getTransitionProps(),l),!0}_getTransitionProps(e){let{transition:t}=this;return t&&t.transitionInterpolator?e?{...t,transitionInterpolator:new k({...e,...t.transitionInterpolator.opts,makeViewport:this.controllerState.makeViewport})}:t:H}}class X{constructor(e,t){this._viewportProps=this.applyConstraints(e),this._state=t}getViewportProps(){return this._viewportProps}getState(){return this._state}}var K=r(81465);class J extends X{constructor(e){let{width:t,height:r,latitude:i,longitude:s,zoom:n,bearing:o=0,pitch:a=0,altitude:l=1.5,position:h=[0,0,0],maxZoom:u=20,minZoom:c=0,maxPitch:d=60,minPitch:f=0,startPanLngLat:p,startZoomLngLat:g,startRotatePos:m,startBearing:_,startPitch:A,startZoom:E,normalize:b=!0}=e;(0,F.A)(Number.isFinite(s)),(0,F.A)(Number.isFinite(i)),(0,F.A)(Number.isFinite(n)),super({width:t,height:r,latitude:i,longitude:s,zoom:n,bearing:o,pitch:a,altitude:l,maxZoom:u,minZoom:c,maxPitch:d,minPitch:f,normalize:b,position:h},{startPanLngLat:p,startZoomLngLat:g,startRotatePos:m,startBearing:_,startPitch:A,startZoom:E}),this.makeViewport=e.makeViewport}panStart({pos:e}){return this._getUpdatedState({startPanLngLat:this._unproject(e)})}pan({pos:e,startPos:t}){let r=this.getState().startPanLngLat||this._unproject(t);if(!r)return this;let i=this.makeViewport(this.getViewportProps()).panByPosition(r,e);return this._getUpdatedState(i)}panEnd(){return this._getUpdatedState({startPanLngLat:null})}rotateStart({pos:e}){return this._getUpdatedState({startRotatePos:e,startBearing:this.getViewportProps().bearing,startPitch:this.getViewportProps().pitch})}rotate({pos:e,deltaAngleX:t=0,deltaAngleY:r=0}){let i;let{startRotatePos:s,startBearing:n,startPitch:o}=this.getState();return s&&void 0!==n&&void 0!==o?(i=e?this._getNewRotation(e,s,o,n):{bearing:n+t,pitch:o+r},this._getUpdatedState(i)):this}rotateEnd(){return this._getUpdatedState({startBearing:null,startPitch:null})}zoomStart({pos:e}){return this._getUpdatedState({startZoomLngLat:this._unproject(e),startZoom:this.getViewportProps().zoom})}zoom({pos:e,startPos:t,scale:r}){let{startZoom:i,startZoomLngLat:s}=this.getState();if(s||(i=this.getViewportProps().zoom,s=this._unproject(t)||this._unproject(e)),!s)return this;let{maxZoom:n,minZoom:o}=this.getViewportProps(),a=i+Math.log2(r);a=(0,M.qE)(a,o,n);let l=this.makeViewport({...this.getViewportProps(),zoom:a});return this._getUpdatedState({zoom:a,...l.panByPosition(s,e)})}zoomEnd(){return this._getUpdatedState({startZoomLngLat:null,startZoom:null})}zoomIn(e=2){return this._zoomFromCenter(e)}zoomOut(e=2){return this._zoomFromCenter(1/e)}moveLeft(e=100){return this._panFromCenter([e,0])}moveRight(e=100){return this._panFromCenter([-e,0])}moveUp(e=100){return this._panFromCenter([0,e])}moveDown(e=100){return this._panFromCenter([0,-e])}rotateLeft(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing-e})}rotateRight(e=15){return this._getUpdatedState({bearing:this.getViewportProps().bearing+e})}rotateUp(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch+e})}rotateDown(e=10){return this._getUpdatedState({pitch:this.getViewportProps().pitch-e})}shortestPathFrom(e){let t=e.getViewportProps(),r={...this.getViewportProps()},{bearing:i,longitude:s}=r;return Math.abs(i-t.bearing)>180&&(r.bearing=i<0?i+360:i-360),Math.abs(s-t.longitude)>180&&(r.longitude=s<0?s+360:s-360),r}applyConstraints(e){let{maxZoom:t,minZoom:r,zoom:i}=e;e.zoom=(0,M.qE)(i,r,t);let{maxPitch:s,minPitch:n,pitch:o}=e;e.pitch=(0,M.qE)(o,n,s);let{normalize:a=!0}=e;return a&&Object.assign(e,(0,K.CK)(e)),e}_zoomFromCenter(e){let{width:t,height:r}=this.getViewportProps();return this.zoom({pos:[t/2,r/2],scale:e})}_panFromCenter(e){let{width:t,height:r}=this.getViewportProps();return this.pan({startPos:[t/2,r/2],pos:[t/2+e[0],r/2+e[1]]})}_getUpdatedState(e){return new this.constructor({makeViewport:this.makeViewport,...this.getViewportProps(),...this.getState(),...e})}_unproject(e){let t=this.makeViewport(this.getViewportProps());return e&&t.unproject(e)}_getNewRotation(e,t,r,i){let s=e[0]-t[0],n=e[1]-t[1],o=e[1],a=t[1],{width:l,height:h}=this.getViewportProps(),u=0;n>0?Math.abs(h-a)>5&&(u=n/(a-h)*1.2):n<0&&a>5&&(u=1-o/a),u=(0,M.qE)(u,-1,1);let{minPitch:c,maxPitch:d}=this.getViewportProps(),f=r;return u>0?f=r+u*(d-r):u<0&&(f=r-u*(c-r)),{pitch:f,bearing:i+s/l*180}}}class $ extends z{constructor(){super(...arguments),this.ControllerState=J,this.transition={transitionDuration:300,transitionInterpolator:new k({transitionProps:{compare:["longitude","latitude","zoom","bearing","pitch","position"],required:["longitude","latitude","zoom"]}})},this.dragMode="pan"}setProps(e){e.position=e.position||[0,0,0];let t=this.props;super.setProps(e),t&&t.height===e.height||this.updateViewport(new this.ControllerState({makeViewport:this.makeViewport,...e,...this.state}))}}class Y extends B{constructor(e={}){super(e)}getViewportType(){return w.A}get ControllerType(){return $}}Y.displayName="MapView";let q=[255,255,255],Q=0;class Z{constructor(e={}){this.type="ambient";let{color:t=q}=e,{intensity:r=1}=e;this.id=e.id||`ambient-${Q++}`,this.color=t,this.intensity=r}}var ee=r(1673);let et=[255,255,255],er=[0,0,-1],ei=0;class es{constructor(e={}){this.type="directional";let{color:t=et}=e,{intensity:r=1}=e,{direction:i=er}=e,{_shadow:s=!1}=e;this.id=e.id||`directional-${ei++}`,this.color=t,this.intensity=r,this.type="directional",this.direction=new ee.P(i).normalize().toArray(),this.shadow=s}getProjectedLight(e){return this}}var en=r(74502);class eo{constructor(e,t={id:"pass"}){let{id:r}=t;this.id=r,this.device=e,this.props={...t}}setProps(e){Object.assign(this.props,e)}render(e){}cleanup(){}}class ea extends eo{constructor(){super(...arguments),this._lastRenderIndex=-1}render(e){let[t,r]=this.device.canvasContext.getDrawingBufferSize(),i=e.clearCanvas??!0,s=e.clearColor??(!!i&&[0,0,0,0]),n=e.colorMask??15,o={viewport:[0,0,t,r]};e.colorMask&&(o.colorMask=n),e.scissorRect&&(o.scissorRect=e.scissorRect);let a=this.device.beginRenderPass({framebuffer:e.target,parameters:o,clearColor:s,clearDepth:!!i&&1,clearStencil:!!i&&0});try{return this._drawLayers(a,e)}finally{a.end(),this.device.submit()}}_drawLayers(e,t){let{target:r,shaderModuleProps:i,viewports:s,views:n,onViewportActive:o,clearStack:a=!0}=t;t.pass=t.pass||"unknown",a&&(this._lastRenderIndex=-1);let l=[];for(let a of s){let s=n&&n[a.id];o?.(a);let h=this._getDrawLayerParams(a,t);for(let n of a.subViewports||[a]){let o=this._drawLayersInViewport(e,{target:r,shaderModuleProps:i,viewport:n,view:s,pass:t.pass,layers:t.layers},h);l.push(o)}}return l}_getDrawLayerParams(e,{layers:t,pass:r,isPicking:i=!1,layerFilter:s,cullRect:n,effects:o,shaderModuleProps:a},l=!1){let h=[],u=function e(t=0,r={}){let i={},s=(n,o)=>{let a;let l=n.props._offset,h=n.id,u=n.parent&&n.parent.id;if(!u||u in r||s(n.parent,!1),u in i){let t=i[u]=i[u]||e(r[u],r);a=t(n,o),i[h]=t}else Number.isFinite(l)?(a=l+(r[u]||0),i[h]=null):a=t;return o&&a>=t&&(t=a+1),r[h]=a,a};return s}(this._lastRenderIndex+1),c={layer:t[0],viewport:e,isPicking:i,renderPass:r,cullRect:n},d={};for(let i=0;i<t.length;i++){let n=t[i],f=this._shouldDrawLayer(n,c,s,d),p={shouldDrawLayer:f};f&&!l&&(p.shouldDrawLayer=!0,p.layerRenderIndex=u(n,f),p.shaderModuleProps=this._getShaderModuleProps(n,o,r,a),p.layerParameters={...n.context.deck?.props.parameters,...this.getLayerParameters(n,i,e)}),h[i]=p}return h}_drawLayersInViewport(e,{layers:t,shaderModuleProps:r,pass:i,target:s,viewport:n,view:o},a){let l=function(e,{shaderModuleProps:t,target:r,viewport:i}){let s=t?.project?.devicePixelRatio??e.canvasContext.cssToDeviceRatio(),[,n]=e.canvasContext.getDrawingBufferSize(),o=r?r.height:n;return[i.x*s,o-(i.y+i.height)*s,i.width*s,i.height*s,0,1]}(this.device,{shaderModuleProps:r,target:s,viewport:n});if(o&&o.props.clear){let e=!0===o.props.clear?{color:!0,depth:!0}:o.props.clear;this.device.beginRenderPass({framebuffer:s,parameters:{viewport:l,scissorRect:l},clearColor:!!e.color&&[0,0,0,0],clearDepth:!!e.depth&&1}).end()}let h={totalCount:t.length,visibleCount:0,compositeCount:0,pickableCount:0};e.setParameters({viewport:l});for(let r=0;r<t.length;r++){let s=t[r],o=a[r],{shouldDrawLayer:l}=o;if(l&&s.props.pickable&&h.pickableCount++,s.isComposite&&h.compositeCount++,s.isDrawable&&o.shouldDrawLayer){let{layerRenderIndex:t,shaderModuleProps:r,layerParameters:a}=o;h.visibleCount++,this._lastRenderIndex=Math.max(this._lastRenderIndex,t),r.project&&(r.project.viewport=n),s.context.renderPass=e;try{s._drawLayer({renderPass:e,shaderModuleProps:r,uniforms:{layerIndex:t},parameters:a})}catch(e){s.raiseError(e,`drawing ${s} to ${i}`)}}}return h}shouldDrawLayer(e){return!0}getShaderModuleProps(e,t,r){return null}getLayerParameters(e,t,r){return e.props.parameters}_shouldDrawLayer(e,t,r,i){if(!(e.props.visible&&this.shouldDrawLayer(e)))return!1;t.layer=e;let s=e.parent;for(;s;){if(!s.props.visible||!s.filterSubLayer(t))return!1;t.layer=s,s=s.parent}if(r){let e=t.layer.id;if(e in i||(i[e]=r(t)),!i[e])return!1}return e.activateViewport(t.viewport),!0}_getShaderModuleProps(e,t,r,i){let s=this.device.canvasContext.cssToDeviceRatio(),n=e.internalState?.propsInTransition||e.props,o={layer:n,picking:{isActive:!1},project:{viewport:e.context.viewport,devicePixelRatio:s,modelMatrix:n.modelMatrix,coordinateSystem:n.coordinateSystem,coordinateOrigin:n.coordinateOrigin,autoWrapLongitude:e.wrapLongitude}};if(t)for(let r of t)el(o,r.getShaderModuleProps?.(e,o));return el(o,this.getShaderModuleProps(e,t,o),i)}}function el(e,...t){for(let r of t)if(r)for(let t in r)e[t]?Object.assign(e[t],r[t]):e[t]=r[t];return e}class eh extends ea{constructor(e,t){super(e,t);let r=e.createTexture({format:"rgba8unorm",width:1,height:1,sampler:{minFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},mipmaps:!0}),i=e.createTexture({format:"depth16unorm",width:1,height:1,mipmaps:!1});this.fbo=e.createFramebuffer({id:"shadowmap",width:1,height:1,colorAttachments:[r],depthStencilAttachment:i})}delete(){this.fbo&&(this.fbo.destroy(),this.fbo=null)}getShadowMap(){return this.fbo.colorAttachments[0].texture}render(e){let t=this.fbo,r=this.device.canvasContext.cssToDeviceRatio(),i=e.viewports[0],s=i.width*r,n=i.height*r;(s!==t.width||n!==t.height)&&t.resize({width:s,height:n}),super.render({...e,clearColor:[1,1,1,1],target:t,pass:"shadow"})}getLayerParameters(e,t,r){return{...e.props.parameters,blend:!1,depthWriteEnabled:!0,depthCompare:"less-equal"}}shouldDrawLayer(e){return!1!==e.props.shadowEnabled}getShaderModuleProps(e,t,r){return{shadow:{project:r.project,drawToShadowMap:!0}}}}var eu=r(43210),ec=r(61059),ed=r(193);let ef=`
uniform shadowUniforms {
  bool drawShadowMap;
  bool useShadowMap;
  vec4 color;
  highp int lightId;
  float lightCount;
  mat4 viewProjectionMatrix0;
  mat4 viewProjectionMatrix1;
  vec4 projectCenter0;
  vec4 projectCenter1;
} shadow;
`,ep=`
const int max_lights = 2;

out vec3 shadow_vPosition[max_lights];

vec4 shadow_setVertexPosition(vec4 position_commonspace) {
  mat4 viewProjectionMatrices[max_lights];
  viewProjectionMatrices[0] = shadow.viewProjectionMatrix0;
  viewProjectionMatrices[1] = shadow.viewProjectionMatrix1;
  vec4 projectCenters[max_lights];
  projectCenters[0] = shadow.projectCenter0;
  projectCenters[1] = shadow.projectCenter1;

  if (shadow.drawShadowMap) {
    return project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[shadow.lightId], projectCenters[shadow.lightId]);
  }
  if (shadow.useShadowMap) {
    for (int i = 0; i < max_lights; i++) {
      if(i < int(shadow.lightCount)) {
        vec4 shadowMap_position = project_common_position_to_clipspace(position_commonspace, viewProjectionMatrices[i], projectCenters[i]);
        shadow_vPosition[i] = (shadowMap_position.xyz / shadowMap_position.w + 1.0) / 2.0;
      }
    }
  }
  return gl_Position;
}
`,eg=`
${ef}
${ep}
`,em=`
const int max_lights = 2;
uniform sampler2D shadow_uShadowMap0;
uniform sampler2D shadow_uShadowMap1;

in vec3 shadow_vPosition[max_lights];

const vec4 bitPackShift = vec4(1.0, 255.0, 65025.0, 16581375.0);
const vec4 bitUnpackShift = 1.0 / bitPackShift;
const vec4 bitMask = vec4(1.0 / 255.0, 1.0 / 255.0, 1.0 / 255.0,  0.0);

float shadow_getShadowWeight(vec3 position, sampler2D shadowMap) {
  vec4 rgbaDepth = texture(shadowMap, position.xy);

  float z = dot(rgbaDepth, bitUnpackShift);
  return smoothstep(0.001, 0.01, position.z - z);
}

vec4 shadow_filterShadowColor(vec4 color) {
  if (shadow.drawShadowMap) {
    vec4 rgbaDepth = fract(gl_FragCoord.z * bitPackShift);
    rgbaDepth -= rgbaDepth.gbaa * bitMask;
    return rgbaDepth;
  }
  if (shadow.useShadowMap) {
    float shadowAlpha = 0.0;
    shadowAlpha += shadow_getShadowWeight(shadow_vPosition[0], shadow_uShadowMap0);
    if(shadow.lightCount > 1.0) {
      shadowAlpha += shadow_getShadowWeight(shadow_vPosition[1], shadow_uShadowMap1);
    }
    shadowAlpha *= shadow.color.a / shadow.lightCount;
    float blendedAlpha = shadowAlpha + color.a * (1.0 - shadowAlpha);

    return vec4(
      mix(color.rgb, shadow.color.rgb, shadowAlpha / blendedAlpha),
      blendedAlpha
    );
  }
  return color;
}
`,e_=`
${ef}
${em}
`,eA=(0,ed.A)(function({viewport:e,center:t}){return new en.k(e.viewProjectionMatrix).invert().transform(t)}),eE=(0,ed.A)(function({viewport:e,shadowMatrices:t}){let r=[],i=e.pixelUnprojectionMatrix,s=e.isGeospatial?void 0:1,n=[[0,0,s],[e.width,0,s],[0,e.height,s],[e.width,e.height,s],[0,0,-1],[e.width,0,-1],[0,e.height,-1],[e.width,e.height,-1]].map(e=>(function(e,t){let[r,i,s]=e,n=(0,K.xJ)([r,i,s],t);return Number.isFinite(s)?n:[n[0],n[1],0]})(e,i));for(let i of t){let t=i.clone().translate(new ee.P(e.center).negate()),s=n.map(e=>t.transform(e)),o=new en.k().ortho({left:Math.min(...s.map(e=>e[0])),right:Math.max(...s.map(e=>e[0])),bottom:Math.min(...s.map(e=>e[1])),top:Math.max(...s.map(e=>e[1])),near:Math.min(...s.map(e=>-e[2])),far:Math.max(...s.map(e=>-e[2]))});r.push(o.multiplyRight(i))}return r}),eb=[0,0,0,1],ey=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],eT={name:"shadow",dependencies:[ec.A],vs:eg,fs:e_,inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    position = shadow_setVertexPosition(geometry.position);
    `,"fs:DECKGL_FILTER_COLOR":`
    color = shadow_filterShadowColor(color);
    `},getUniforms:function(e){let{shadowEnabled:t=!0,project:r}=e;if(!t||!r||!e.shadowMatrices||!e.shadowMatrices.length)return{drawShadowMap:!1,useShadowMap:!1,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};let i=ec.A.getUniforms(r),s=eA({viewport:r.viewport,center:i.center}),n=[],o=eE({shadowMatrices:e.shadowMatrices,viewport:r.viewport}).slice();for(let t=0;t<e.shadowMatrices.length;t++){let e=o[t],a=e.clone().translate(new ee.P(r.viewport.center).negate());i.coordinateSystem===eu.rf.LNGLAT&&i.projectionMode===eu.Kx.WEB_MERCATOR?(o[t]=a,n[t]=s):(o[t]=e.clone().multiplyRight(ey),n[t]=a.transform(s))}let a={drawShadowMap:!!e.drawToShadowMap,useShadowMap:!!e.shadowMaps&&e.shadowMaps.length>0,color:e.shadowColor||eb,lightId:e.shadowLightId||0,lightCount:e.shadowMatrices.length,shadow_uShadowMap0:e.dummyShadowMap,shadow_uShadowMap1:e.dummyShadowMap};for(let e=0;e<o.length;e++)a[`viewProjectionMatrix${e}`]=o[e],a[`projectCenter${e}`]=n[e];for(let t=0;t<2;t++)a[`shadow_uShadowMap${t}`]=e.shadowMaps&&e.shadowMaps[t]||e.dummyShadowMap;return a},uniformTypes:{drawShadowMap:"f32",useShadowMap:"f32",color:"vec4<f32>",lightId:"i32",lightCount:"f32",viewProjectionMatrix0:"mat4x4<f32>",viewProjectionMatrix1:"mat4x4<f32>",projectCenter0:"vec4<f32>",projectCenter1:"vec4<f32>"}},eC={color:[255,255,255],intensity:1},ev=[{color:[255,255,255],intensity:1,direction:[-1,3,-1]},{color:[255,255,255],intensity:.9,direction:[1,-8,-2.5]}],eR=[0,0,0,200/255];class eS{constructor(e={}){this.id="lighting-effect",this.shadowColor=eR,this.shadow=!1,this.directionalLights=[],this.pointLights=[],this.shadowPasses=[],this.dummyShadowMap=null,this.setProps(e)}setup(e){this.context=e;let{device:t,deck:r}=e;this.shadow&&!this.dummyShadowMap&&(this._createShadowPasses(t),r._addDefaultShaderModule(eT),this.dummyShadowMap=t.createTexture({width:1,height:1}))}setProps(e){for(let t in this.ambientLight=void 0,this.directionalLights=[],this.pointLights=[],e){let r=e[t];switch(r.type){case"ambient":this.ambientLight=r;break;case"directional":this.directionalLights.push(r);break;case"point":this.pointLights.push(r)}}this._applyDefaultLights(),this.shadow=this.directionalLights.some(e=>e.shadow),this.context&&this.setup(this.context),this.props=e}preRender({layers:e,layerFilter:t,viewports:r,onViewportActive:i,views:s}){if(this.shadow){this.shadowMatrices=this._calculateMatrices();for(let n=0;n<this.shadowPasses.length;n++)this.shadowPasses[n].render({layers:e,layerFilter:t,viewports:r,onViewportActive:i,views:s,shaderModuleProps:{shadow:{shadowLightId:n,dummyShadowMap:this.dummyShadowMap,shadowMatrices:this.shadowMatrices}}})}}getShaderModuleProps(e,t){let r=this.shadow?{project:t.project,shadowMaps:this.shadowPasses.map(e=>e.getShadowMap()),dummyShadowMap:this.dummyShadowMap,shadowColor:this.shadowColor,shadowMatrices:this.shadowMatrices}:{},i={enabled:!0,ambientLight:this.ambientLight,directionalLights:this.directionalLights.map(t=>t.getProjectedLight({layer:e})),pointLights:this.pointLights.map(t=>t.getProjectedLight({layer:e}))},s=e.props.material;return{shadow:r,lighting:i,phongMaterial:s,gouraudMaterial:s}}cleanup(e){for(let e of this.shadowPasses)e.delete();this.shadowPasses.length=0,this.dummyShadowMap&&(this.dummyShadowMap.destroy(),this.dummyShadowMap=null,e.deck._removeDefaultShaderModule(eT))}_calculateMatrices(){let e=[];for(let t of this.directionalLights){let r=new en.k().lookAt({eye:new ee.P(t.direction).negate()});e.push(r)}return e}_createShadowPasses(e){for(let t=0;t<this.directionalLights.length;t++){let r=new eh(e);this.shadowPasses[t]=r}}_applyDefaultLights(){let{ambientLight:e,pointLights:t,directionalLights:r}=this;e||0!==t.length||0!==r.length||(this.ambientLight=new Z(eC),this.directionalLights.push(new es(ev[0]),new es(ev[1])))}}let eB=new eS;class ew{constructor(e){this._resolvedEffects=[],this._defaultEffects=[],this.effects=[],this._context=e,this._needsRedraw="Initial render",this._setEffects([])}addDefaultEffect(e){let t=this._defaultEffects;if(!t.find(t=>t.id===e.id)){let r=t.findIndex(t=>{var r,i;return r=t,i=e,(r.order??1/0)-(i.order??1/0)>0});r<0?t.push(e):t.splice(r,0,e),e.setup(this._context),this._setEffects(this.effects)}}setProps(e){"effects"in e&&!(0,T.b)(e.effects,this.effects,1)&&this._setEffects(e.effects)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}getEffects(){return this._resolvedEffects}_setEffects(e){let t={};for(let e of this.effects)t[e.id]=e;let r=[];for(let i of e){let e=t[i.id],s=i;e&&e!==i?e.setProps?(e.setProps(i.props),s=e):e.cleanup(this._context):e||i.setup(this._context),r.push(s),delete t[i.id]}for(let e in t)t[e].cleanup(this._context);this.effects=r,this._resolvedEffects=r.concat(this._defaultEffects),e.some(e=>e instanceof eS)||this._resolvedEffects.push(eB),this._needsRedraw="effects changed"}finalize(){for(let e of this._resolvedEffects)e.cleanup(this._context);this.effects.length=0,this._resolvedEffects.length=0,this._defaultEffects.length=0}}class eM extends ea{shouldDrawLayer(e){let{operation:t}=e.props;return t.includes("draw")||t.includes("terrain")}}let eI={blendColorOperation:"add",blendColorSrcFactor:"one",blendColorDstFactor:"zero",blendAlphaOperation:"add",blendAlphaSrcFactor:"constant-alpha",blendAlphaDstFactor:"zero"};class eP extends ea{constructor(){super(...arguments),this._colorEncoderState=null}render(e){return"pickingFBO"in e?this._drawPickingBuffer(e):super.render(e)}_drawPickingBuffer({layers:e,layerFilter:t,views:r,viewports:i,onViewportActive:s,pickingFBO:n,deviceRect:{x:o,y:a,width:l,height:h},cullRect:u,effects:c,pass:d="picking",pickZ:f,shaderModuleProps:p}){this.pickZ=f;let g=this._resetColorEncoder(f),m=super.render({target:n,layers:e,layerFilter:t,views:r,viewports:i,onViewportActive:s,cullRect:u,effects:c?.filter(e=>e.useInPicking),pass:d,isPicking:!0,shaderModuleProps:p,clearColor:[0,0,0,0],colorMask:15,scissorRect:[o,a,l,h]});return this._colorEncoderState=null,{decodePickingColor:g&&eL.bind(null,g),stats:m}}shouldDrawLayer(e){let{pickable:t,operation:r}=e.props;return t&&r.includes("draw")||r.includes("terrain")||r.includes("mask")}getShaderModuleProps(e,t,r){return{picking:{isActive:1,isAttribute:this.pickZ},lighting:{enabled:!1}}}getLayerParameters(e,t,r){let i={...e.props.parameters},{pickable:s,operation:n}=e.props;return!this._colorEncoderState||n.includes("terrain")?i.blend=!1:s&&n.includes("draw")&&(Object.assign(i,eI),i.blend=!0,i.blendColor=function(e,t,r){let i;let{byLayer:s,byAlpha:n}=e,o=s.get(t);return o?(o.viewports.push(r),i=o.a):(i=s.size+1)<=255?(o={a:i,layer:t,viewports:[r]},s.set(t,o),n[i]=o):(f.A.warn("Too many pickable layers, only picking the first 255")(),i=0),[0,0,0,i/255]}(this._colorEncoderState,e,r)),i}_resetColorEncoder(e){return this._colorEncoderState=e?null:{byLayer:new Map,byAlpha:[]},this._colorEncoderState}}function eL(e,t){let r=e.byAlpha[t[3]];return r&&{pickedLayer:r.layer,pickedViewports:r.viewports,pickedObjectIndex:r.layer.decodePickingColor(t)}}class eO{constructor(e){this.device=e,this.layerFilter=null,this.drawPickingColors=!1,this.drawLayersPass=new eM(e),this.pickLayersPass=new eP(e),this.renderCount=0,this._needsRedraw="Initial render",this.renderBuffers=[],this.lastPostProcessEffect=null}setProps(e){this.layerFilter!==e.layerFilter&&(this.layerFilter=e.layerFilter,this._needsRedraw="layerFilter changed"),this.drawPickingColors!==e.drawPickingColors&&(this.drawPickingColors=e.drawPickingColors,this._needsRedraw="drawPickingColors changed")}renderLayers(e){if(!e.viewports.length)return;let t=this.drawPickingColors?this.pickLayersPass:this.drawLayersPass,r={layerFilter:this.layerFilter,isPicking:this.drawPickingColors,...e};r.effects&&this._preRender(r.effects,r);let i=this.lastPostProcessEffect?this.renderBuffers[0]:r.target;this.lastPostProcessEffect&&(r.clearColor=[0,0,0,0],r.clearCanvas=!0);let s=t.render({...r,target:i});r.effects&&this._postRender(r.effects,r),this.renderCount++,(0,p.A)("deckRenderer.renderLayers",this,s,e)}needsRedraw(e={clearRedrawFlags:!1}){let t=this._needsRedraw;return e.clearRedrawFlags&&(this._needsRedraw=!1),t}finalize(){let{renderBuffers:e}=this;for(let t of e)t.delete();e.length=0}_preRender(e,t){for(let r of(this.lastPostProcessEffect=null,t.preRenderStats=t.preRenderStats||{},e))t.preRenderStats[r.id]=r.preRender(t),r.postRender&&(this.lastPostProcessEffect=r.id);this.lastPostProcessEffect&&this._resizeRenderBuffers()}_resizeRenderBuffers(){let{renderBuffers:e}=this,t=this.device.canvasContext.getDrawingBufferSize();for(let r of(0===e.length&&[0,1].map(t=>{let r=this.device.createTexture({sampler:{minFilter:"linear",magFilter:"linear"}});e.push(this.device.createFramebuffer({id:`deck-renderbuffer-${t}`,colorAttachments:[r]}))}),e))r.resize(t)}_postRender(e,t){let{renderBuffers:r}=this,i={...t,inputBuffer:r[0],swapBuffer:r[1]};for(let s of e)if(s.postRender){i.target=s.id===this.lastPostProcessEffect?t.target:void 0;let e=s.postRender(i);i.inputBuffer=e,i.swapBuffer=e===r[0]?r[1]:r[0]}}}let ex={pickedColor:null,pickedObjectIndex:-1};function eN({pickInfo:e,viewports:t,pixelRatio:r,x:i,y:s,z:n}){let o,a=t[0];if(t.length>1&&(a=function(e,t){for(let r=e.length-1;r>=0;r--){let i=e[r];if(i.containsPixel(t))return i}return e[0]}(e?.pickedViewports||t,{x:i,y:s})),a){let e=[i-a.x,s-a.y];void 0!==n&&(e[2]=n),o=a.unproject(e)}return{color:null,layer:null,viewport:a,index:-1,picked:!1,x:i,y:s,pixel:[i,s],coordinate:o,devicePixel:e&&"pickedX"in e?[e.pickedX,e.pickedY]:void 0,pixelRatio:r}}function eF({layer:e,info:t,mode:r}){for(;e&&t;){let i=t.layer||null;t.sourceLayer=i,t.layer=e,t=e.getPickingInfo({info:t,mode:r,sourceLayer:i}),e=e.parent}return t}class eD{constructor(e){this._pickable=!0,this.device=e,this.pickLayersPass=new eP(e),this.lastPickedInfo={index:-1,layerId:null,info:null}}setProps(e){"layerFilter"in e&&(this.layerFilter=e.layerFilter),"_pickable"in e&&(this._pickable=e._pickable)}finalize(){this.pickingFBO&&this.pickingFBO.destroy(),this.depthFBO&&this.depthFBO.destroy()}pickObject(e){return this._pickClosestObject(e)}pickObjects(e){return this._pickVisibleObjects(e)}getLastPickedObject({x:e,y:t,layers:r,viewports:i},s=this.lastPickedInfo.info){let n=s&&s.layer&&s.layer.id,o=s&&s.viewport&&s.viewport.id,a=n?r.find(e=>e.id===n):null,l=o&&i.find(e=>e.id===o)||i[0],h=l&&l.unproject([e-l.x,t-l.y]);return{...s,x:e,y:t,viewport:l,coordinate:h,layer:a}}_resizeBuffer(){if(!this.pickingFBO&&(this.pickingFBO=this.device.createFramebuffer({colorAttachments:["rgba8unorm"],depthStencilAttachment:"depth16unorm"}),this.device.isTextureFormatRenderable("rgba32float"))){let e=this.device.createFramebuffer({colorAttachments:["rgba32float"],depthStencilAttachment:"depth16unorm"});this.depthFBO=e}let{canvas:e}=this.device.getDefaultCanvasContext();this.pickingFBO?.resize({width:e.width,height:e.height}),this.depthFBO?.resize({width:e.width,height:e.height})}_getPickable(e){if(!1===this._pickable)return null;let t=e.filter(e=>this.pickLayersPass.shouldDrawLayer(e)&&!e.isComposite);return t.length?t:null}_pickClosestObject({layers:e,views:t,viewports:r,x:i,y:s,radius:n=0,depth:o=1,mode:a="query",unproject3D:l,onViewportActive:h,effects:u}){let c;let d=this.device.canvasContext.cssToDeviceRatio(),p=this._getPickable(e);if(!p||0===r.length)return{result:[],emptyInfo:eN({viewports:r,x:i,y:s,pixelRatio:d})};this._resizeBuffer();let g=this.device.canvasContext.cssToDevicePixels([i,s],!0),m=[g.x+Math.floor(g.width/2),g.y+Math.floor(g.height/2)],_=Math.round(n*d),{width:A,height:E}=this.pickingFBO,b=this._getPickingRect({deviceX:m[0],deviceY:m[1],deviceRadius:_,deviceWidth:A,deviceHeight:E}),y={x:i-n,y:s-n,width:2*n+1,height:2*n+1},T=[],C=new Set;for(let e=0;e<o;e++){let n,g;if((n=b?function({pickedColors:e,decodePickingColor:t,deviceX:r,deviceY:i,deviceRadius:s,deviceRect:n}){let{x:o,y:a,width:l,height:h}=n,u=s*s,c=-1,d=0;for(let t=0;t<h;t++){let s=t+a-i,n=s*s;if(n>u)d+=4*l;else for(let t=0;t<l;t++){if(e[d+3]-1>=0){let e=t+o-r,i=e*e+n;i<=u&&(u=i,c=d)}d+=4}}if(c>=0){let r=e.slice(c,c+4),i=t(r);if(i){let e=Math.floor(c/4/l),t=c/4-e*l;return{...i,pickedColor:r,pickedX:o+t,pickedY:a+e}}f.A.error("Picked non-existent layer. Is picking buffer corrupt?")()}return ex}({...this._drawAndSample({layers:p,views:t,viewports:r,onViewportActive:h,deviceRect:b,cullRect:y,effects:u,pass:`picking:${a}`}),deviceX:m[0],deviceY:m[1],deviceRadius:_,deviceRect:b}):{pickedColor:null,pickedObjectIndex:-1}).pickedLayer&&l&&this.depthFBO){let{pickedColors:e}=this._drawAndSample({layers:[n.pickedLayer],views:t,viewports:r,onViewportActive:h,deviceRect:{x:n.pickedX,y:n.pickedY,width:1,height:1},cullRect:y,effects:u,pass:`picking:${a}:z`},!0);e[3]&&(g=e[0])}for(let t of(n.pickedLayer&&e+1<o&&(C.add(n.pickedLayer),n.pickedLayer.disablePickingIndex(n.pickedObjectIndex)),(c=function(e){let{pickInfo:t,lastPickedInfo:r,mode:i,layers:s}=e,{pickedColor:n,pickedLayer:o,pickedObjectIndex:a}=t,l=o?[o]:[];if("hover"===i){let e=r.index,t=r.layerId,i=o?o.props.id:null;if(i!==t||a!==e){if(i!==t){let e=s.find(e=>e.props.id===t);e&&l.unshift(e)}r.layerId=i,r.index=a,r.info=null}}let h=eN(e),u=new Map;return u.set(null,h),l.forEach(e=>{let t={...h};e===o&&(t.color=n,t.index=a,t.picked=!0);let s=(t=eF({layer:e,info:t,mode:i})).layer;e===o&&"hover"===i&&(r.info=t),u.set(s.id,t),"hover"===i&&s.updateAutoHighlight(t)}),u}({pickInfo:n,lastPickedInfo:this.lastPickedInfo,mode:a,layers:p,viewports:r,x:i,y:s,z:g,pixelRatio:d})).values()))t.layer&&T.push(t);if(!n.pickedColor)break}for(let e of C)e.restorePickingColors();return{result:T,emptyInfo:c.get(null)}}_pickVisibleObjects({layers:e,views:t,viewports:r,x:i,y:s,width:n=1,height:o=1,mode:a="query",maxObjects:l=null,onViewportActive:h,effects:u}){let c=this._getPickable(e);if(!c||0===r.length)return[];this._resizeBuffer();let d=this.device.canvasContext.cssToDeviceRatio(),p=this.device.canvasContext.cssToDevicePixels([i,s],!0),g=p.x,m=p.y+p.height,_=this.device.canvasContext.cssToDevicePixels([i+n,s+o],!0),A=_.x+_.width,E=_.y,b=function({pickedColors:e,decodePickingColor:t}){let r=new Map;if(e){for(let i=0;i<e.length;i+=4)if(e[i+3]-1>=0){let s=e.slice(i,i+4),n=s.join(",");if(!r.has(n)){let e=t(s);e?r.set(n,{...e,color:s}):f.A.error("Picked non-existent layer. Is picking buffer corrupt?")()}}}return Array.from(r.values())}(this._drawAndSample({layers:c,views:t,viewports:r,onViewportActive:h,deviceRect:{x:g,y:E,width:A-g,height:m-E},cullRect:{x:i,y:s,width:n,height:o},effects:u,pass:`picking:${a}`})),y=new Map,T=[],C=Number.isFinite(l);for(let e=0;e<b.length&&(!C||!(T.length>=l));e++){let t=b[e],r={color:t.pickedColor,layer:null,index:t.pickedObjectIndex,picked:!0,x:i,y:s,pixelRatio:d},n=(r=eF({layer:t.pickedLayer,info:r,mode:a})).layer.id;y.has(n)||y.set(n,new Set);let o=y.get(n),l=r.object??r.index;o.has(l)||(o.add(l),T.push(r))}return T}_drawAndSample({layers:e,views:t,viewports:r,onViewportActive:i,deviceRect:s,cullRect:n,effects:o,pass:a},l=!1){let h=l?this.depthFBO:this.pickingFBO,u={layers:e,layerFilter:this.layerFilter,views:t,viewports:r,onViewportActive:i,pickingFBO:h,deviceRect:s,cullRect:n,effects:o,pass:a,pickZ:l,preRenderStats:{},isPicking:!0};for(let e of o)e.useInPicking&&(u.preRenderStats[e.id]=e.preRender(u));let{decodePickingColor:c}=this.pickLayersPass.render(u),{x:d,y:f,width:p,height:g}=s,m=new(l?Float32Array:Uint8Array)(p*g*4);return this.device.readPixelsToArrayWebGL(h,{sourceX:d,sourceY:f,sourceWidth:p,sourceHeight:g,target:m}),{pickedColors:m,decodePickingColor:c}}_getPickingRect({deviceX:e,deviceY:t,deviceRadius:r,deviceWidth:i,deviceHeight:s}){let n=Math.max(0,e-r),o=Math.max(0,t-r),a=Math.min(i,e+r+1)-n,l=Math.min(s,t+r+1)-o;return a<=0||l<=0?null:{x:n,y:o,width:a,height:l}}}let eU={"top-left":{top:0,left:0},"top-right":{top:0,right:0},"bottom-left":{bottom:0,left:0},"bottom-right":{bottom:0,right:0},fill:{top:0,left:0,bottom:0,right:0}},eG="__root";class ek{constructor({deck:e,parentElement:t}){this.defaultWidgets=[],this.widgets=[],this.resolvedWidgets=[],this.containers={},this.lastViewports={},this.deck=e,this.parentElement=t}getWidgets(){return this.resolvedWidgets}setProps(e){e.widgets&&!(0,T.b)(e.widgets,this.widgets,1)&&this._setWidgets(e.widgets)}finalize(){for(let e of this.getWidgets())this._remove(e);for(let e in this.defaultWidgets.length=0,this.resolvedWidgets.length=0,this.containers)this.containers[e].remove()}addDefault(e){this.defaultWidgets.find(t=>t.id===e.id)||(this._add(e),this.defaultWidgets.push(e),this._setWidgets(this.widgets))}_setWidgets(e){let t={};for(let e of this.resolvedWidgets)t[e.id]=e;for(let e of(this.resolvedWidgets.length=0,this.defaultWidgets))t[e.id]=null,this.resolvedWidgets.push(e);for(let r of e){let e=t[r.id];e?e.viewId!==r.viewId||e.placement!==r.placement?(this._remove(e),this._add(r)):r!==e&&(e.setProps(r.props),r=e):this._add(r),t[r.id]=null,this.resolvedWidgets.push(r)}for(let e in t){let r=t[e];r&&this._remove(r)}this.widgets=e}_add(e){let{viewId:t=null,placement:r="top-left"}=e,i=e.onAdd({deck:this.deck,viewId:t});i&&this._getContainer(t,r).append(i),e._element=i}_remove(e){e.onRemove?.(),e._element&&e._element.remove(),e._element=void 0}_getContainer(e,t){let r=e||eG,i=this.containers[r];i||((i=document.createElement("div")).style.pointerEvents="none",i.style.position="absolute",i.style.overflow="hidden",this.parentElement?.append(i),this.containers[r]=i);let s=i.querySelector(`.${t}`);return s||((s=document.createElement("div")).className=t,s.style.position="absolute",s.style.zIndex="2",Object.assign(s.style,eU[t]),i.append(s)),s}_updateContainers(){let e=this.deck.width,t=this.deck.height;for(let r in this.containers){let i=this.lastViewports[r]||null,s=r===eG||i,n=this.containers[r];s?(n.style.display="block",n.style.left=`${i?i.x:0}px`,n.style.top=`${i?i.y:0}px`,n.style.width=`${i?i.width:e}px`,n.style.height=`${i?i.height:t}px`):n.style.display="none"}}onRedraw({viewports:e,layers:t}){let r=e.reduce((e,t)=>(e[t.id]=t,e),{});for(let i of this.getWidgets()){let{viewId:s}=i;if(s){let e=r[s];e&&(i.onViewportChange&&i.onViewportChange(e),i.onRedraw?.({viewports:[e],layers:t}))}else{if(i.onViewportChange)for(let t of e)i.onViewportChange(t);i.onRedraw?.({viewports:e,layers:t})}}this.lastViewports=r,this._updateContainers()}onHover(e,t){for(let r of this.getWidgets()){let{viewId:i}=r;i&&i!==e.viewport?.id||r.onHover?.(e,t)}}onEvent(e,t){let r=eu.tg[t.type];if(r)for(let i of this.getWidgets()){let{viewId:s}=i;s&&s!==e.viewport?.id||i[r]?.(e,t)}}}let eH={zIndex:"1",position:"absolute",pointerEvents:"none",color:"#a0a7b4",backgroundColor:"#29323c",padding:"10px",top:"0",left:"0",display:"none"};class eV{constructor(){this.id="default-tooltip",this.placement="fill",this.props={},this.isVisible=!1}onAdd({deck:e}){let t=document.createElement("div");return t.className="deck-tooltip",Object.assign(t.style,eH),this.deck=e,this.element=t,t}onRemove(){this.deck=void 0,this.element=void 0}setProps(){}onViewportChange(e){this.isVisible&&e.id===this.lastViewport?.id&&e!==this.lastViewport&&this.setTooltip(null)}onHover(e){let{deck:t}=this,r=t&&t.props.getTooltip;if(!r)return;let i=r(e);this.lastViewport=e.viewport,this.setTooltip(i,e.x,e.y)}setTooltip(e,t,r){let i=this.element;if(i){if("string"==typeof e)i.innerText=e;else if(e)e.text&&(i.innerText=e.text),e.html&&(i.innerHTML=e.html),e.className&&(i.className=e.className);else{this.isVisible=!1,i.style.display="none";return}this.isVisible=!0,i.style.display="block",i.style.transform=`translate(${t}px, ${r}px)`,e&&"object"==typeof e&&"style"in e&&Object.assign(i.style,e.style)}}}var ej=r(11867),eW=r(73271),ez=r(20761);let eX={dataType:null,batchType:null,id:"JSON",name:"JSON",module:"",version:"",options:{},extensions:["json","geojson"],mimeTypes:["application/json","application/geo+json"],testText:function(e){let t=e[0],r=e[e.length-1];return"{"===t&&"}"===r||"["===t&&"]"===r},parseTextSync:JSON.parse},eK=function(){let e="9.1.5",t=globalThis.deck&&globalThis.deck.VERSION;if(t&&t!==e)throw Error(`deck.gl - multiple versions detected: ${t} vs ${e}`);return t||(f.A.log(1,`deck.gl ${e}`)(),globalThis.deck={...globalThis.deck,VERSION:e,version:e,log:f.A,_registerLoggers:p.k},(0,eW.mk)([eX,[ez.$,{imagebitmap:{premultiplyAlpha:"none"}}]])),e}();var eJ=r(83003),e$=r(54169),eY=r(90288),eq=r(60263);let eQ=(0,eJ.B)()&&"undefined"!=typeof document,eZ=()=>eQ&&"complete"===document.readyState,e0="No matching device found. Ensure `@luma.gl/webgl` and/or `@luma.gl/webgpu` modules are imported.";class e1{static defaultProps={...e$.pF.defaultProps,type:"best-available",adapters:void 0,waitForPageLoad:!0};static pageLoaded=(eZ()||"undefined"==typeof window?Promise.resolve():new Promise(e=>{window.addEventListener("load",()=>e())})).then(()=>{eq.R.probe(2,"DOM is loaded")()});stats=eY.d;log=eq.R;VERSION="9.1.5";spector;preregisteredAdapters=new Map;constructor(){if(globalThis.luma){if(globalThis.luma.VERSION!==this.VERSION)throw eq.R.error(`Found luma.gl ${globalThis.luma.VERSION} while initialzing ${this.VERSION}`)(),eq.R.error("'yarn why @luma.gl/core' can help identify the source of the conflict")(),Error("luma.gl - multiple versions detected: see console log");eq.R.error("This version of luma.gl has already been initialized")()}eq.R.log(1,`${this.VERSION} - set luma.log.level=1 (or higher) to trace rendering`)(),globalThis.luma=this}registerAdapters(e){for(let t of e)this.preregisteredAdapters.set(t.type,t)}getSupportedAdapters(e=[]){return Array.from(this.getAdapterMap(e)).map(([,e])=>e).filter(e=>e.isSupported?.()).map(e=>e.type)}getBestAvailableAdapter(e=[]){let t=this.getAdapterMap(e);return t.get("webgpu")?.isSupported?.()?"webgpu":t.get("webgl")?.isSupported?.()?"webgl":null}setDefaultDeviceProps(e){Object.assign(e1.defaultProps,e)}async createDevice(e={}){(e={...e1.defaultProps,...e}).waitForPageLoad&&await e1.pageLoaded;let t=this.getAdapterMap(e.adapters),r=e.type||"";"best-available"===r&&(r=this.getBestAvailableAdapter(e.adapters)||r);let i=(this.getAdapterMap(e.adapters)||t).get(r),s=await i?.create?.(e);if(s)return s;throw Error(e0)}async attachDevice(e){let t=this.getAdapterMap(e.adapters),r="";e.handle instanceof WebGL2RenderingContext&&(r="webgl"),e.createCanvasContext&&await e1.pageLoaded,null===e.handle&&(r="unknown");let i=t.get(r),s=await i?.attach?.(null);if(s)return s;throw Error(e0)}enforceWebGL2(e=!0,t=[]){let r=this.getAdapterMap(t).get("webgl");r||eq.R.warn("enforceWebGL2: webgl adapter not found")(),r?.enforceWebGL2?.(e)}getAdapterMap(e=[]){let t=new Map(this.preregisteredAdapters);for(let r of e)t.set(r.type,r);return t}registerDevices(e){for(let t of(eq.R.warn("luma.registerDevices() is deprecated, use luma.registerAdapters() instead"),e)){let e=t.adapter;e&&this.preregisteredAdapters.set(e.type,e)}}}let e3=new e1;class e2{}var e6=r(46123);let e4={WEBGL_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},OES_element_index_uint:{},OES_texture_float:{},OES_texture_half_float:{HALF_FLOAT_OES:5131},EXT_color_buffer_float:{},OES_standard_derivatives:{FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723},EXT_frag_depth:{},EXT_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},EXT_shader_texture_lod:{}},e8=e=>({drawBuffersWEBGL:t=>e.drawBuffers(t),COLOR_ATTACHMENT0_WEBGL:36064,COLOR_ATTACHMENT1_WEBGL:36065,COLOR_ATTACHMENT2_WEBGL:36066,COLOR_ATTACHMENT3_WEBGL:36067}),e9=e=>({VERTEX_ARRAY_BINDING_OES:34229,createVertexArrayOES:()=>e.createVertexArray(),deleteVertexArrayOES:t=>e.deleteVertexArray(t),isVertexArrayOES:t=>e.isVertexArray(t),bindVertexArrayOES:t=>e.bindVertexArray(t)}),e5=e=>({VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,drawArraysInstancedANGLE:(...t)=>e.drawArraysInstanced(...t),drawElementsInstancedANGLE:(...t)=>e.drawElementsInstanced(...t),vertexAttribDivisorANGLE:(...t)=>e.vertexAttribDivisor(...t)});var e7=r(22217),te=r(32692);class tt extends e2{type="webgl";constructor(){super(),e$.pF.defaultProps={...e$.pF.defaultProps,...e7.ic},e6.e.adapter=this}isSupported(){return"undefined"!=typeof WebGL2RenderingContext}enforceWebGL2(e){!function(e=!0){let t=HTMLCanvasElement.prototype;if(!e&&t.originalGetContext){t.getContext=t.originalGetContext,t.originalGetContext=void 0;return}t.originalGetContext=t.getContext,t.getContext=function(e,t){if("webgl"===e||"experimental-webgl"===e){let e=this.originalGetContext("webgl2",t);return e instanceof HTMLElement&&function(e){e.getExtension("EXT_color_buffer_float");let t={...e4,WEBGL_disjoint_timer_query:e.getExtension("EXT_disjoint_timer_query_webgl2"),WEBGL_draw_buffers:e8(e),OES_vertex_array_object:e9(e),ANGLE_instanced_arrays:e5(e)},r=e.getExtension;e.getExtension=function(i){let s=r.call(e,i);return s||(i in t?t[i]:null)};let i=e.getSupportedExtensions;e.getSupportedExtensions=function(){let r=i.apply(e)||[];return r?.concat(Object.keys(t))}}(e),e}return this.originalGetContext(e,t)}}(e)}async attach(e){var t;if(e instanceof e6.e)return e;if(e?.device instanceof e$.pF)return e.device;if(t=e,!("undefined"!=typeof WebGL2RenderingContext&&t instanceof WebGL2RenderingContext||t&&Number.isFinite(t._version)))throw Error("Invalid WebGL2RenderingContext");return new e6.e({_handle:e,createCanvasContext:{canvas:e.canvas,autoResize:!1}})}async create(e={}){eq.R.groupCollapsed(1,"WebGLDevice created")();let t=[];for(let r of((e.debugWebGL||e.debug)&&t.push((0,te.$)()),e.debugSpectorJS&&t.push((0,e7._G)(e)),await Promise.allSettled(t)))"rejected"===r.status&&eq.R.error(`Failed to initialize debug libraries ${r.reason}`)();let r=new e6.e(e),i=`\
${r._reused?"Reusing":"Created"} device with WebGL2 ${r.debug?"debug ":""}context: \
${r.info.vendor}, ${r.info.renderer} for canvas: ${r.canvasContext.id}`;return eq.R.probe(1,i)(),eq.R.table(1,r.info)(),eq.R.groupEnd(1)(),r}}let tr=new tt,ti=0,ts={device:null,onAddHTML:()=>"",onInitialize:async()=>null,onRender:()=>{},onFinalize:()=>{},onError:e=>console.error(e),stats:e3.stats.get(`animation-loop-${ti++}`),useDevicePixels:!0,autoResizeViewport:!1,autoResizeDrawingBuffer:!1};class tn{device=null;canvas=null;props;animationProps=null;timeline=null;stats;cpuTime;gpuTime;frameRate;display;needsRedraw="initialized";_initialized=!1;_running=!1;_animationFrameId=null;_nextFramePromise=null;_resolveNextFrame=null;_cpuStartTime=0;_error=null;constructor(e){if(this.props={...ts,...e},!(e=this.props).device)throw Error("No device provided");let{useDevicePixels:t=!0}=this.props;this.stats=e.stats||new m.Uz({id:"animation-loop-stats"}),this.cpuTime=this.stats.get("CPU Time"),this.gpuTime=this.stats.get("GPU Time"),this.frameRate=this.stats.get("Frame Rate"),this.setProps({autoResizeViewport:e.autoResizeViewport,autoResizeDrawingBuffer:e.autoResizeDrawingBuffer,useDevicePixels:t}),this.start=this.start.bind(this),this.stop=this.stop.bind(this),this._onMousemove=this._onMousemove.bind(this),this._onMouseleave=this._onMouseleave.bind(this)}destroy(){this.stop(),this._setDisplay(null)}delete(){this.destroy()}setError(e){if(this.props.onError(e),this._error=Error(),this.device?.canvasContext?.canvas instanceof HTMLCanvasElement){let t=document.createElement("h1");t.innerHTML=e.message,t.style.position="absolute",t.style.top="20%",t.style.left="10px",t.style.color="black",t.style.backgroundColor="red",document.body.appendChild(t)}}setNeedsRedraw(e){return this.needsRedraw=this.needsRedraw||e,this}setProps(e){return"autoResizeViewport"in e&&(this.props.autoResizeViewport=e.autoResizeViewport||!1),"autoResizeDrawingBuffer"in e&&(this.props.autoResizeDrawingBuffer=e.autoResizeDrawingBuffer||!1),"useDevicePixels"in e&&(this.props.useDevicePixels=e.useDevicePixels||!1),this}async start(){if(this._running)return this;this._running=!0;try{let e;if(this._initialized||(this._initialized=!0,await this._initDevice(),this._initialize(),await this.props.onInitialize(this._getAnimationProps())),!this._running)return null;return!1!==e&&(this._cancelAnimationFrame(),this._requestAnimationFrame()),this}catch(t){let e=t instanceof Error?t:Error("Unknown error");throw this.props.onError(e),e}}stop(){return this._running&&(this.animationProps&&!this._error&&this.props.onFinalize(this.animationProps),this._cancelAnimationFrame(),this._nextFramePromise=null,this._resolveNextFrame=null,this._running=!1),this}redraw(){return this.device?.isLost||this._error||(this._beginFrameTimers(),this._setupFrame(),this._updateAnimationProps(),this._renderFrame(this._getAnimationProps()),this._clearNeedsRedraw(),this._resolveNextFrame&&(this._resolveNextFrame(this),this._nextFramePromise=null,this._resolveNextFrame=null),this._endFrameTimers()),this}attachTimeline(e){return this.timeline=e,this.timeline}detachTimeline(){this.timeline=null}waitForRender(){return this.setNeedsRedraw("waitForRender"),this._nextFramePromise||(this._nextFramePromise=new Promise(e=>{this._resolveNextFrame=e})),this._nextFramePromise}async toDataURL(){if(this.setNeedsRedraw("toDataURL"),await this.waitForRender(),this.canvas instanceof HTMLCanvasElement)return this.canvas.toDataURL();throw Error("OffscreenCanvas")}_initialize(){this._startEventHandling(),this._initializeAnimationProps(),this._updateAnimationProps(),this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_setDisplay(e){this.display&&(this.display.destroy(),this.display.animationLoop=null),e&&(e.animationLoop=this),this.display=e}_requestAnimationFrame(){var e;this._running&&(this._animationFrameId=(e=this._animationFrame.bind(this),"undefined"!=typeof window&&window.requestAnimationFrame?window.requestAnimationFrame(e):setTimeout(e,1e3/60)))}_cancelAnimationFrame(){var e;null!==this._animationFrameId&&(e=this._animationFrameId,"undefined"!=typeof window&&window.cancelAnimationFrame?window.cancelAnimationFrame(e):clearTimeout(e),this._animationFrameId=null)}_animationFrame(){this._running&&(this.redraw(),this._requestAnimationFrame())}_renderFrame(e){if(this.display){this.display._renderFrame(e);return}this.props.onRender(this._getAnimationProps()),this.device?.submit()}_clearNeedsRedraw(){this.needsRedraw=!1}_setupFrame(){this._resizeCanvasDrawingBuffer(),this._resizeViewport()}_initializeAnimationProps(){let e=this.device?.canvasContext?.canvas;if(!this.device||!e)throw Error("loop");this.animationProps={animationLoop:this,device:this.device,canvas:e,timeline:this.timeline,useDevicePixels:this.props.useDevicePixels,needsRedraw:!1,width:1,height:1,aspect:1,time:0,startTime:Date.now(),engineTime:0,tick:0,tock:0,_mousePosition:null}}_getAnimationProps(){if(!this.animationProps)throw Error("animationProps");return this.animationProps}_updateAnimationProps(){if(!this.animationProps)return;let{width:e,height:t,aspect:r}=this._getSizeAndAspect();(e!==this.animationProps.width||t!==this.animationProps.height)&&this.setNeedsRedraw("drawing buffer resized"),r!==this.animationProps.aspect&&this.setNeedsRedraw("drawing buffer aspect changed"),this.animationProps.width=e,this.animationProps.height=t,this.animationProps.aspect=r,this.animationProps.needsRedraw=this.needsRedraw,this.animationProps.engineTime=Date.now()-this.animationProps.startTime,this.timeline&&this.timeline.update(this.animationProps.engineTime),this.animationProps.tick=Math.floor(this.animationProps.time/1e3*60),this.animationProps.tock++,this.animationProps.time=this.timeline?this.timeline.getTime():this.animationProps.engineTime}async _initDevice(){if(this.device=await this.props.device,!this.device)throw Error("No device provided");this.canvas=this.device.canvasContext?.canvas||null}_createInfoDiv(){if(this.canvas&&this.props.onAddHTML){let e=document.createElement("div");document.body.appendChild(e),e.style.position="relative";let t=document.createElement("div");t.style.position="absolute",t.style.left="10px",t.style.bottom="10px",t.style.width="300px",t.style.background="white",this.canvas instanceof HTMLCanvasElement&&e.appendChild(this.canvas),e.appendChild(t);let r=this.props.onAddHTML(t);r&&(t.innerHTML=r)}}_getSizeAndAspect(){if(!this.device)return{width:1,height:1,aspect:1};let[e,t]=this.device?.canvasContext?.getPixelSize()||[1,1],r=1,i=this.device?.canvasContext?.canvas;return i&&i.clientHeight?r=i.clientWidth/i.clientHeight:e>0&&t>0&&(r=e/t),{width:e,height:t,aspect:r}}_resizeViewport(){this.props.autoResizeViewport&&this.device.gl&&this.device.gl.viewport(0,0,this.device.gl.drawingBufferWidth,this.device.gl.drawingBufferHeight)}_resizeCanvasDrawingBuffer(){this.props.autoResizeDrawingBuffer&&this.device?.canvasContext?.resize({useDevicePixels:this.props.useDevicePixels})}_beginFrameTimers(){this.frameRate.timeEnd(),this.frameRate.timeStart(),this.cpuTime.timeStart()}_endFrameTimers(){this.cpuTime.timeEnd()}_startEventHandling(){this.canvas&&(this.canvas.addEventListener("mousemove",this._onMousemove.bind(this)),this.canvas.addEventListener("mouseleave",this._onMouseleave.bind(this)))}_onMousemove(e){e instanceof MouseEvent&&(this._getAnimationProps()._mousePosition=[e.offsetX,e.offsetY])}_onMouseleave(e){this._getAnimationProps()._mousePosition=null}}var to=r(81810);function ta(){}let tl={id:"",width:"100%",height:"100%",style:null,viewState:null,initialViewState:null,pickingRadius:0,layerFilter:null,parameters:{},parent:null,device:null,deviceProps:{},gl:null,canvas:null,layers:[],effects:[],views:null,controller:null,useDevicePixels:!0,touchAction:"none",eventRecognizerOptions:{},_framebuffer:null,_animate:!1,_pickable:!0,_typedArrayManagerProps:{},_customRender:null,widgets:[],onDeviceInitialized:ta,onWebGLInitialized:ta,onResize:ta,onViewStateChange:ta,onInteractionStateChange:ta,onBeforeRender:ta,onAfterRender:ta,onLoad:ta,onError:e=>f.A.error(e.message,e.cause)(),onHover:null,onClick:null,onDragStart:null,onDrag:null,onDragEnd:null,_onMetrics:null,getCursor:({isDragging:e})=>e?"grabbing":"grab",getTooltip:null,debug:!1,drawPickingColors:!1};class th{constructor(e){this.width=0,this.height=0,this.userData={},this.device=null,this.canvas=null,this.viewManager=null,this.layerManager=null,this.effectManager=null,this.deckRenderer=null,this.deckPicker=null,this.eventManager=null,this.widgetManager=null,this.tooltip=null,this.animationLoop=null,this.cursorState={isHovering:!1,isDragging:!1},this.stats=new m.Uz({id:"deck.gl"}),this.metrics={fps:0,setPropsTime:0,updateAttributesTime:0,framesRedrawn:0,pickTime:0,pickCount:0,gpuTime:0,gpuTimePerFrame:0,cpuTime:0,cpuTimePerFrame:0,bufferMemory:0,textureMemory:0,renderbufferMemory:0,gpuMemory:0},this._metricsCounter=0,this._needsRedraw="Initial render",this._pickRequest={mode:"hover",x:-1,y:-1,radius:0,event:null},this._lastPointerDownInfo=null,this._onPointerMove=e=>{let{_pickRequest:t}=this;if("pointerleave"===e.type)t.x=-1,t.y=-1,t.radius=0;else{if(e.leftButton||e.rightButton)return;let r=e.offsetCenter;if(!r)return;t.x=r.x,t.y=r.y,t.radius=this.props.pickingRadius}this.layerManager&&(this.layerManager.context.mousePosition={x:t.x,y:t.y}),t.event=e},this._onEvent=e=>{let t=eu.tg[e.type],r=e.offsetCenter;if(!t||!r||!this.layerManager)return;let i=this.layerManager.getLayers(),s=this.deckPicker.getLastPickedObject({x:r.x,y:r.y,layers:i,viewports:this.getViewports(r)},this._lastPointerDownInfo),{layer:n}=s,o=n&&(n[t]||n.props[t]),a=this.props[t],l=!1;o&&(l=o.call(n,s,e)),l||(a?.(s,e),this.widgetManager.onEvent(s,e))},this._onPointerDown=e=>{if(this.device?.type==="webgpu")return;let t=e.offsetCenter,r=this._pick("pickObject","pickObject Time",{x:t.x,y:t.y,radius:this.props.pickingRadius});this._lastPointerDownInfo=r.result[0]||r.emptyInfo},this.props={...tl,...e},(e=this.props).viewState&&e.initialViewState&&f.A.warn("View state tracking is disabled. Use either `initialViewState` for auto update or `viewState` for manual update.")(),this.viewState=this.props.initialViewState,e.device&&(this.device=e.device);let t=this.device;!t&&e.gl&&(e.gl instanceof WebGLRenderingContext&&f.A.error("WebGL1 context not supported.")(),t=tr.attach(e.gl)),t||(t=e3.createDevice({type:"best-available",_reuseDevices:!0,adapters:[tr],...e.deviceProps,createCanvasContext:{canvas:this._createCanvas(e),useDevicePixels:this.props.useDevicePixels,autoResize:!1}})),this.animationLoop=this._createAnimationLoop(t,e),this.setProps(e),e._typedArrayManagerProps&&ej.A.setOptions(e._typedArrayManagerProps),this.animationLoop.start()}finalize(){this.animationLoop?.stop(),this.animationLoop?.destroy(),this.animationLoop=null,this._lastPointerDownInfo=null,this.layerManager?.finalize(),this.layerManager=null,this.viewManager?.finalize(),this.viewManager=null,this.effectManager?.finalize(),this.effectManager=null,this.deckRenderer?.finalize(),this.deckRenderer=null,this.deckPicker?.finalize(),this.deckPicker=null,this.eventManager?.destroy(),this.eventManager=null,this.widgetManager?.finalize(),this.widgetManager=null,this.props.canvas||this.props.device||this.props.gl||!this.canvas||(this.canvas.parentElement?.removeChild(this.canvas),this.canvas=null)}setProps(e){this.stats.get("setProps Time").timeStart(),"onLayerHover"in e&&f.A.removed("onLayerHover","onHover")(),"onLayerClick"in e&&f.A.removed("onLayerClick","onClick")(),e.initialViewState&&!(0,T.b)(this.props.initialViewState,e.initialViewState,3)&&(this.viewState=e.initialViewState),Object.assign(this.props,e),this._setCanvasSize(this.props);let t=Object.create(this.props);Object.assign(t,{views:this._getViews(),width:this.width,height:this.height,viewState:this._getViewState()}),this.animationLoop?.setProps(t),this.layerManager&&(this.viewManager.setProps(t),this.layerManager.activateViewport(this.getViewports()[0]),this.layerManager.setProps(t),this.effectManager.setProps(t),this.deckRenderer.setProps(t),this.deckPicker.setProps(t),this.widgetManager.setProps(t)),this.stats.get("setProps Time").timeEnd()}needsRedraw(e={clearRedrawFlags:!1}){if(!this.layerManager)return!1;if(this.props._animate)return"Deck._animate";let t=this._needsRedraw;e.clearRedrawFlags&&(this._needsRedraw=!1);let r=this.viewManager.needsRedraw(e),i=this.layerManager.needsRedraw(e),s=this.effectManager.needsRedraw(e),n=this.deckRenderer.needsRedraw(e);return t||r||i||s||n}redraw(e){if(!this.layerManager)return;let t=this.needsRedraw({clearRedrawFlags:!0});(t=e||t)&&(this.stats.get("Redraw Count").incrementCount(),this.props._customRender?this.props._customRender(t):this._drawLayers(t))}get isInitialized(){return null!==this.viewManager}getViews(){return(0,F.A)(this.viewManager),this.viewManager.views}getViewports(e){return(0,F.A)(this.viewManager),this.viewManager.getViewports(e)}getCanvas(){return this.canvas}pickObject(e){let t=this._pick("pickObject","pickObject Time",e).result;return t.length?t[0]:null}pickMultipleObjects(e){return e.depth=e.depth||10,this._pick("pickObject","pickMultipleObjects Time",e).result}pickObjects(e){return this._pick("pickObjects","pickObjects Time",e)}_addResources(e,t=!1){for(let r in e)this.layerManager.resourceManager.add({resourceId:r,data:e[r],forceUpdate:t})}_removeResources(e){for(let t of e)this.layerManager.resourceManager.remove(t)}_addDefaultEffect(e){this.effectManager.addDefaultEffect(e)}_addDefaultShaderModule(e){this.layerManager.addDefaultShaderModule(e)}_removeDefaultShaderModule(e){this.layerManager?.removeDefaultShaderModule(e)}_pick(e,t,r){(0,F.A)(this.deckPicker);let{stats:i}=this;i.get("Pick Count").incrementCount(),i.get(t).timeStart();let s=this.deckPicker[e]({layers:this.layerManager.getLayers(r),views:this.viewManager.getViews(),viewports:this.getViewports(r),onViewportActive:this.layerManager.activateViewport,effects:this.effectManager.getEffects(),...r});return i.get(t).timeEnd(),s}_createCanvas(e){let t=e.canvas;return"string"==typeof t&&(t=document.getElementById(t),(0,F.A)(t)),t||((t=document.createElement("canvas")).id=e.id||"deckgl-overlay",(e.parent||document.body).appendChild(t)),Object.assign(t.style,e.style),t}_setCanvasSize(e){if(!this.canvas)return;let{width:t,height:r}=e;if(t||0===t){let e=Number.isFinite(t)?`${t}px`:t;this.canvas.style.width=e}if(r||0===r){let t=Number.isFinite(r)?`${r}px`:r;this.canvas.style.position=e.style?.position||"absolute",this.canvas.style.height=t}}_updateCanvasSize(){let{canvas:e}=this;if(!e)return;let t=e.clientWidth??e.width,r=e.clientHeight??e.height;(t!==this.width||r!==this.height)&&(this.width=t,this.height=r,this.viewManager?.setProps({width:t,height:r}),this.layerManager?.activateViewport(this.getViewports()[0]),this.props.onResize({width:t,height:r}))}_createAnimationLoop(e,t){let{gl:r,onError:i,useDevicePixels:s}=t;return new tn({device:e,useDevicePixels:s,autoResizeDrawingBuffer:!r,autoResizeViewport:!1,onInitialize:e=>this._setDevice(e.device),onRender:this._onRenderFrame.bind(this),onError:i})}_getViewState(){return this.props.viewState||this.viewState}_getViews(){let{views:e}=this.props,t=Array.isArray(e)?e:e?[e]:[new Y({id:"default-view"})];return t.length&&this.props.controller&&(t[0].props.controller=this.props.controller),t}_onContextLost(){let{onError:e}=this.props;this.animationLoop&&e&&e(Error("WebGL context is lost"))}_pickAndCallback(){if(this.device?.type==="webgpu")return;let{_pickRequest:e}=this;if(e.event){let{result:t,emptyInfo:r}=this._pick("pickObject","pickObject Time",e);this.cursorState.isHovering=t.length>0;let i=r,s=!1;for(let r of t)i=r,s=r.layer?.onHover(r,e.event)||s;s||(this.props.onHover?.(i,e.event),this.widgetManager.onHover(i,e.event)),e.event=null}}_updateCursor(){let e=this.props.parent||this.canvas;e&&(e.style.cursor=this.props.getCursor(this.cursorState))}_setDevice(e){if(this.device=e,!this.animationLoop)return;this.canvas||(this.canvas=this.device.canvasContext?.canvas),"webgl"===this.device.type&&this.device.setParametersWebGL({blend:!0,blendFunc:[770,771,1,771],polygonOffsetFill:!0,depthTest:!0,depthFunc:515}),this.props.onDeviceInitialized(this.device),"webgl"===this.device.type&&this.props.onWebGLInitialized(this.device.gl);let t=new n;for(let e in t.play(),this.animationLoop.attachTimeline(t),this.eventManager=new to.EU(this.props.parent||this.canvas,{touchAction:this.props.touchAction,recognizers:Object.keys(eu.We).map(e=>{let[t,r,i,s]=eu.We[e],n=this.props.eventRecognizerOptions?.[e];return{recognizer:new t({...r,...n,event:e}),recognizeWith:i,requestFailure:s}}),events:{pointerdown:this._onPointerDown,pointermove:this._onPointerMove,pointerleave:this._onPointerMove}}),eu.tg)this.eventManager.on(e,this._onEvent);this.viewManager=new C({timeline:t,eventManager:this.eventManager,onViewStateChange:this._onViewStateChange.bind(this),onInteractionStateChange:this._onInteractionStateChange.bind(this),views:this._getViews(),viewState:this._getViewState(),width:this.width,height:this.height});let r=this.viewManager.getViewports()[0];this.layerManager=new y(this.device,{deck:this,stats:this.stats,viewport:r,timeline:t}),this.effectManager=new ew({deck:this,device:this.device}),this.deckRenderer=new eO(this.device),this.deckPicker=new eD(this.device),this.widgetManager=new ek({deck:this,parentElement:this.canvas?.parentElement}),this.widgetManager.addDefault(new eV),this.setProps(this.props),this._updateCanvasSize(),this.props.onLoad()}_drawLayers(e,t){let{device:r,gl:i}=this.layerManager.context;this.props.onBeforeRender({device:r,gl:i});let s={target:this.props._framebuffer,layers:this.layerManager.getLayers(),viewports:this.viewManager.getViewports(),onViewportActive:this.layerManager.activateViewport,views:this.viewManager.getViews(),pass:"screen",effects:this.effectManager.getEffects(),...t};this.deckRenderer?.renderLayers(s),"screen"===s.pass&&this.widgetManager.onRedraw({viewports:s.viewports,layers:s.layers}),this.props.onAfterRender({device:r,gl:i})}_onRenderFrame(){this._getFrameStats(),this._metricsCounter++%60==0&&(this._getMetrics(),this.stats.reset(),f.A.table(4,this.metrics)(),this.props._onMetrics&&this.props._onMetrics(this.metrics)),this._updateCanvasSize(),this._updateCursor(),this.layerManager.updateLayers(),this.device?.type!=="webgpu"&&this._pickAndCallback(),this.redraw(),this.viewManager&&this.viewManager.updateViewStates()}_onViewStateChange(e){let t=this.props.onViewStateChange(e)||e.viewState;this.viewState&&(this.viewState={...this.viewState,[e.viewId]:t},!this.props.viewState&&this.viewManager&&this.viewManager.setProps({viewState:this.viewState}))}_onInteractionStateChange(e){this.cursorState.isDragging=e.isDragging||!1,this.props.onInteractionStateChange(e)}_getFrameStats(){let{stats:e}=this;e.get("frameRate").timeEnd(),e.get("frameRate").timeStart();let t=this.animationLoop.stats;e.get("GPU Time").addTime(t.get("GPU Time").lastTiming),e.get("CPU Time").addTime(t.get("CPU Time").lastTiming)}_getMetrics(){let{metrics:e,stats:t}=this;e.fps=t.get("frameRate").getHz(),e.setPropsTime=t.get("setProps Time").time,e.updateAttributesTime=t.get("Update Attributes").time,e.framesRedrawn=t.get("Redraw Count").count,e.pickTime=t.get("pickObject Time").time+t.get("pickMultipleObjects Time").time+t.get("pickObjects Time").time,e.pickCount=t.get("Pick Count").count,e.gpuTime=t.get("GPU Time").time,e.cpuTime=t.get("CPU Time").time,e.gpuTimePerFrame=t.get("GPU Time").getAverageTime(),e.cpuTimePerFrame=t.get("CPU Time").getAverageTime();let r=e3.stats.get("Memory Usage");e.bufferMemory=r.get("Buffer Memory").count,e.textureMemory=r.get("Texture Memory").count,e.renderbufferMemory=r.get("Renderbuffer Memory").count,e.gpuMemory=r.get("GPU Memory").count}}th.defaultProps=tl,th.VERSION=eK;var tu=r(36389),tc=r(33176);let td=Math.PI/180,tf=180/Math.PI;class tp extends b.A{constructor(e={}){let{longitude:t=0,zoom:r=0,nearZMultiplier:i=.5,farZMultiplier:s=1,resolution:n=10}=e,{latitude:o=0,height:a,altitude:l=1.5,fovy:h}=e;o=Math.max(Math.min(o,K.aH),-K.aH),a=a||1,h?l=(0,K.wZ)(h):h=(0,K.Os)(l);let u=1/Math.PI/Math.cos(o*Math.PI/180)*Math.pow(2,r),c=e.nearZ??i,d=e.farZ??(l+512*u/a)*s,f=new en.k().lookAt({eye:[0,-l,0],up:[0,0,1]});f.rotateX(o*td),f.rotateZ(-t*td),f.scale(u/a),super({...e,height:a,viewMatrix:f,longitude:t,latitude:o,zoom:r,distanceScales:function(){let e=Math.PI/180*256;return{unitsPerMeter:[4018225162502676e-20,4018225162502676e-20,4018225162502676e-20],unitsPerMeter2:[0,0,0],metersPerUnit:[24886.609375,24886.609375,24886.609375],unitsPerDegree:[e,e,4018225162502676e-20],unitsPerDegree2:[0,0,0],degreesPerUnit:[1/e,1/e,24886.609375]}}(),fovy:h,focalDistance:l,near:c,far:d}),this.scale=u,this.latitude=o,this.longitude=t,this.resolution=n}get projectionMode(){return eu.Kx.GLOBE}getDistanceScales(){return this.distanceScales}getBounds(e={}){let t={targetZ:e.z||0},r=this.unproject([0,this.height/2],t),i=this.unproject([this.width/2,0],t),s=this.unproject([this.width,this.height/2],t),n=this.unproject([this.width/2,this.height],t);return s[0]<this.longitude&&(s[0]+=360),r[0]>this.longitude&&(r[0]-=360),[Math.min(r[0],s[0],i[0],n[0]),Math.min(r[1],s[1],i[1],n[1]),Math.max(r[0],s[0],i[0],n[0]),Math.max(r[1],s[1],i[1],n[1])]}unproject(e,{topLeft:t=!0,targetZ:r}={}){let i;let[s,n,o]=e,a=t?n:this.height-n,{pixelUnprojectionMatrix:l}=this;if(Number.isFinite(o))i=tg(l,[s,a,o,1]);else{let e=tg(l,[s,a,-1,1]),t=tg(l,[s,a,1,1]),n=((r||0)/6370972+1)*256,o=tu.uE(tu.jb([],e,t)),h=tu.uE(e),u=tu.uE(t),c=(4*h*u-(o-h-u)**2)/16*4/o,d=(Math.sqrt(h-c)-Math.sqrt(Math.max(0,n*n-c)))/Math.sqrt(o);i=tu.Cc([],e,t,d)}let[h,u,c]=this.unprojectPosition(i);return Number.isFinite(o)?[h,u,c]:Number.isFinite(r)?[h,u,r]:[h,u]}projectPosition(e){let[t,r,i=0]=e,s=t*td,n=r*td,o=Math.cos(n),a=(i/6370972+1)*256;return[Math.sin(s)*o*a,-Math.cos(s)*o*a,Math.sin(n)*a]}unprojectPosition(e){let[t,r,i]=e,s=tu.Il(e);return[Math.atan2(t,-r)*tf,Math.asin(i/s)*tf,(s/256-1)*6370972]}projectFlat(e){return e}unprojectFlat(e){return e}panByPosition(e,t){let r=this.unproject(t);return{longitude:e[0]-r[0]+this.longitude,latitude:e[1]-r[1]+this.latitude}}}function tg(e,t){let r=tc.Z0([],t,e);return tc.hs(r,r,1/r[3]),r}var tm=r(15273);class t_ extends J{applyConstraints(e){let{maxZoom:t,minZoom:r,zoom:i}=e;e.zoom=(0,M.qE)(i,r,t);let{longitude:s,latitude:n}=e;return(s<-180||s>180)&&(e.longitude=(0,tm.zi)(s+180,360)-180),e.latitude=(0,M.qE)(n,-K.aH,K.aH),e}}class tA extends z{constructor(){super(...arguments),this.ControllerState=t_,this.transition={transitionDuration:300,transitionInterpolator:new k(["longitude","latitude","zoom"])},this.dragMode="pan"}setProps(e){super.setProps(e),this.dragRotate=!1,this.touchRotate=!1}}class tE extends B{constructor(e={}){super(e)}getViewportType(e){return e.zoom>12?w.A:tp}get ControllerType(){return tA}}tE.displayName="GlobeView";let tb=Math.PI/180;function ty({map:e,gl:t,deck:r}){let i;if(e.__deck)return e.__deck;let s=r?.props._customRender,n=r?.props.onLoad,o={...r?.props,_customRender:()=>{e.triggerRepaint(),s?.("")}};return o.parameters={...tv(e,!0),...o.parameters},o.views||(o.views=tS(e)),r&&r.props.gl!==t||(Object.assign(o,{gl:t,width:null,height:null,touchAction:"unset",viewState:tB(e)}),r?.isInitialized?tT(r,e):o.onLoad=()=>{n?.(),tT(i,e)}),r?(i=r,r.setProps(o),r.userData.isExternal=!0):(i=new th(o),e.on("remove",()=>{tC(e)})),i.userData.mapboxLayers=new Set,e.__deck=i,e.on("render",()=>{i.isInitialized&&function(e,t){let{mapboxLayers:r,isExternal:i}=e.userData;if(i){let i=Array.from(r,e=>e.id),s=(0,g.B)(e.props.layers,Boolean).some(e=>e&&!i.includes(e.id)),n=e.getViewports(),o=n.findIndex(e=>"mapbox"===e.id),a=n.length>1||o<0;(s||a)&&(o>=0&&((n=n.slice())[o]=tw(e,t)),e._drawLayers("mapbox-repaint",{viewports:n,layerFilter:t=>(!e.props.layerFilter||e.props.layerFilter(t))&&("mapbox"!==t.viewport.id||!i.includes(t.layer.id)),clearCanvas:!1}))}e.userData.currentViewport=null}(i,e)}),i}function tT(e,t){let r=()=>{var i,s;e.isInitialized?(i=e,s=t,i.setProps({viewState:tB(s)}),i.needsRedraw({clearRedrawFlags:!0})):t.off("move",r)};t.on("move",r)}function tC(e){e.__deck?.finalize(),e.__deck=null}function tv(e,t){let r=t?{depthWriteEnabled:!0,depthCompare:"less-equal",depthBias:0,blend:!0,blendColorSrcFactor:"src-alpha",blendColorDstFactor:"one-minus-src-alpha",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one-minus-src-alpha",blendColorOperation:"add",blendAlphaOperation:"add"}:{};return"globe"===tR(e)&&(r.cullMode="back"),r}function tR(e){let t=e.getProjection?.(),r=t?.type||t?.name;if("globe"===r)return"globe";if(r&&"mercator"!==r)throw Error("Unsupported projection");return"mercator"}function tS(e){return"globe"===tR(e)?new tE({id:"mapbox"}):new Y({id:"mapbox"})}function tB(e){let{lng:t,lat:r}=e.getCenter(),i={longitude:(t+540)%360-180,latitude:r,zoom:e.getZoom(),bearing:e.getBearing(),pitch:e.getPitch(),padding:e.getPadding(),repeat:e.getRenderWorldCopies()};return e.getTerrain?.()&&function(e,t){if(e.getFreeCameraOptions){let{position:r}=e.getFreeCameraOptions();if(!r||void 0===r.z)return;let i=e.transform.height,{longitude:s,latitude:n,pitch:o}=t,a=512*r.x,l=(1-r.y)*512,h=512*r.z,u=(0,K.Gw)([s,n]),c=a-u[0],d=l-u[1],f=Math.sqrt(c*c+d*d),p=o*tb,g=1.5*i,m=p<.001?g*Math.cos(p)/h:g*Math.sin(p)/f;t.zoom=Math.log2(m),t.position=[0,0,(h-g*Math.cos(p)/m)/(0,K.mY)(n)]}else"number"==typeof e.transform.elevation&&(t.position=[0,0,e.transform.elevation])}(e,i),i}function tw(e,t,r){let i=tB(t),s=tS(t);r&&(s.props.nearZMultiplier=.2);let n=r?.nearZ??t.transform._nearZ,o=r?.farZ??t.transform._farZ;return Number.isFinite(n)&&(i.nearZ=n/t.transform.height,i.farZ=o/t.transform.height),s.makeViewport({width:e.width,height:e.height,viewState:i})}function tM(e){if(e.userData.isExternal)return;let t=[];e.userData.mapboxLayers.forEach(e=>{let r=new e.props.type(e.props);t.push(r)}),e.setProps({layers:t})}class tI{constructor(e){if(!e.id)throw Error("Layer must have an unique id");this.id=e.id,this.type="custom",this.renderingMode=e.renderingMode||"3d",this.slot=e.slot,this.map=null,this.deck=null,this.props=e}onAdd(e,t){var r;this.map=e,this.deck=ty({map:e,gl:t,deck:this.props.deck}),(r=this.deck).userData.mapboxLayers.add(this),tM(r)}onRemove(){if(this.deck){var e;(e=this.deck).userData.mapboxLayers.delete(this),tM(e)}}setProps(e){if(Object.assign(this.props,e,{id:this.id}),this.deck)tM(this.deck)}render(e,t){!function(e,t,r,i){let{currentViewport:s}=e.userData,n=!1;s||(s=tw(e,t,i),e.userData.currentViewport=s,n=!0),e.isInitialized&&e._drawLayers("mapbox-repaint",{viewports:[s],layerFilter:({layer:e})=>r.id===e.id||e.props.operation.includes("terrain"),clearStack:n,clearCanvas:!1})}(this.deck,this.map,this,t)}}let tP="__UNDEFINED__";function tL(e,t,r,i){if(!e||!t||!e.style||!e.style._loaded)return;let s=(0,g.B)(i,Boolean);if(r!==i){let t=new Set((0,g.B)(r,Boolean).map(e=>e.id));for(let e of s)t.delete(e.id);for(let r of t)e.getLayer(r)&&e.removeLayer(r)}for(let r of s){let i=e.getLayer(r.id);i?(i.implementation||i).setProps(r.props):e.addLayer(new tI({id:r.id,deck:t,slot:r.props.slot}),r.props.beforeId)}let n=e.style._order,o={};for(let e of s){let{beforeId:t}=e.props;t&&n.includes(t)||(t=tP),o[t]=o[t]||[],o[t].push(e.id)}for(let t in o){let r=o[t],i=t===tP?n.length:n.indexOf(t),s=t===tP?void 0:t;for(let t=r.length-1;t>=0;t--){let o=r[t],a=n.indexOf(o);a!==i-1&&(e.moveLayer(o,s),a>i&&i++),i--,s=o}}}class tO{constructor(e){this._handleStyleChange=()=>{tL(this._map,this._deck,this._props.layers,this._props.layers)},this._updateContainerSize=()=>{if(this._map&&this._container){let{clientWidth:e,clientHeight:t}=this._map.getContainer();Object.assign(this._container.style,{width:`${e}px`,height:`${t}px`})}},this._updateViewState=()=>{let e=this._deck,t=this._map;e&&t&&(e.setProps({views:this._props.views||tS(t),viewState:tB(t)}),e.isInitialized&&e.redraw())},this._handleMouseEvent=e=>{let t=this._deck;if(!t||!t.isInitialized)return;let r={type:e.type,offsetCenter:e.point,srcEvent:e},i=this._lastMouseDownPoint;switch(!e.point&&i&&(r.deltaX=e.originalEvent.clientX-i.clientX,r.deltaY=e.originalEvent.clientY-i.clientY,r.offsetCenter={x:i.x+r.deltaX,y:i.y+r.deltaY}),r.type){case"mousedown":t._onPointerDown(r),this._lastMouseDownPoint={...e.point,clientX:e.originalEvent.clientX,clientY:e.originalEvent.clientY};break;case"dragstart":r.type="panstart",t._onEvent(r);break;case"drag":r.type="panmove",t._onEvent(r);break;case"dragend":r.type="panend",t._onEvent(r);break;case"click":r.tapCount=1,t._onEvent(r);break;case"dblclick":r.type="click",r.tapCount=2,t._onEvent(r);break;case"mousemove":r.type="pointermove",t._onPointerMove(r);break;case"mouseout":r.type="pointerleave",t._onPointerMove(r);break;default:return}};let{interleaved:t=!1,...r}=e;this._interleaved=t,this._props=r}setProps(e){this._interleaved&&e.layers&&tL(this._map,this._deck,this._props.layers,e.layers),Object.assign(this._props,e),this._deck&&this._map&&this._deck.setProps({...this._props,parameters:{...tv(this._map,this._interleaved),...this._props.parameters}})}onAdd(e){return this._map=e,this._interleaved?this._onAddInterleaved(e):this._onAddOverlaid(e)}_onAddOverlaid(e){let t=document.createElement("div");return Object.assign(t.style,{position:"absolute",left:0,top:0,textAlign:"initial",pointerEvents:"none"}),this._container=t,this._deck=new th({...this._props,parent:t,parameters:{...tv(e,!1),...this._props.parameters},views:this._props.views||tS(e),viewState:tB(e)}),e.on("resize",this._updateContainerSize),e.on("render",this._updateViewState),e.on("mousedown",this._handleMouseEvent),e.on("dragstart",this._handleMouseEvent),e.on("drag",this._handleMouseEvent),e.on("dragend",this._handleMouseEvent),e.on("mousemove",this._handleMouseEvent),e.on("mouseout",this._handleMouseEvent),e.on("click",this._handleMouseEvent),e.on("dblclick",this._handleMouseEvent),this._updateContainerSize(),t}_onAddInterleaved(e){let t=e.painter.context.gl;return t instanceof WebGLRenderingContext&&f.A.warn("Incompatible basemap library. See: https://deck.gl/docs/api-reference/mapbox/overview#compatibility")(),this._deck=ty({map:e,gl:t,deck:new th({...this._props,gl:t})}),e.on("styledata",this._handleStyleChange),tL(e,this._deck,[],this._props.layers),document.createElement("div")}onRemove(){let e=this._map;e&&(this._interleaved?this._onRemoveInterleaved(e):this._onRemoveOverlaid(e)),this._deck=void 0,this._map=void 0,this._container=void 0}_onRemoveOverlaid(e){e.off("resize",this._updateContainerSize),e.off("render",this._updateViewState),e.off("mousedown",this._handleMouseEvent),e.off("dragstart",this._handleMouseEvent),e.off("drag",this._handleMouseEvent),e.off("dragend",this._handleMouseEvent),e.off("mousemove",this._handleMouseEvent),e.off("mouseout",this._handleMouseEvent),e.off("click",this._handleMouseEvent),e.off("dblclick",this._handleMouseEvent),this._deck?.finalize()}_onRemoveInterleaved(e){e.off("styledata",this._handleStyleChange),tL(e,this._deck,this._props.layers,[]),tC(e)}getDefaultPosition(){return"top-left"}pickObject(e){return(0,F.A)(this._deck),this._deck.pickObject(e)}pickMultipleObjects(e){return(0,F.A)(this._deck),this._deck.pickMultipleObjects(e)}pickObjects(e){return(0,F.A)(this._deck),this._deck.pickObjects(e)}finalize(){this._map&&this._map.removeControl(this)}getCanvas(){return this._map?this._interleaved?this._map.getCanvas():this._deck.getCanvas():null}}},57048:(e,t,r)=>{let i,s,n,o,a,l;r.d(t,{A:()=>l7});var h,u,c,d,f,p,g,m,_={};r.r(_),r.d(_,{createExtMeshFeatures:()=>iD,decode:()=>iN,encode:()=>iF,name:()=>ix});var A={};r.r(A),r.d(A,{createExtStructuralMetadata:()=>ij,decode:()=>ik,encode:()=>iH,name:()=>iG});var E={};r.r(E),r.d(E,{decode:()=>i1,name:()=>i0});var b={};r.r(b),r.d(b,{name:()=>i5,preprocess:()=>i7});var y={};r.r(y),r.d(y,{name:()=>st,preprocess:()=>sr});var T={};r.r(T),r.d(T,{decode:()=>sy,encode:()=>sT,name:()=>sE,preprocess:()=>sb});var C={};r.r(C),r.d(C,{decode:()=>sN,name:()=>sP});var v={};r.r(v),r.d(v,{decode:()=>sU,encode:()=>sG,name:()=>sD});var R={};r.r(R),r.d(R,{decode:()=>sV,encode:()=>sj,name:()=>sH});var S={};r.r(S),r.d(S,{decode:()=>sX,encode:()=>sK,name:()=>sz});var B={};r.r(B),r.d(B,{decode:()=>sY,name:()=>s$});let w={};function M(e="id"){w[e]=w[e]||1;let t=w[e]++;return`${e}-${t}`}class I{id;topology;vertexCount;indices;attributes;userData={};constructor(e){let{attributes:t={},indices:r=null,vertexCount:i=null}=e;for(let[i,s]of(this.id=e.id||M("geometry"),this.topology=e.topology,r&&(this.indices=ArrayBuffer.isView(r)?{value:r,size:1}:r),this.attributes={},Object.entries(t))){let e=ArrayBuffer.isView(s)?{value:s}:s;if(!ArrayBuffer.isView(e.value))throw Error(`${this._print(i)}: must be typed array or object with value as typed array`);if("POSITION"!==i&&"positions"!==i||e.size||(e.size=3),"indices"===i){if(this.indices)throw Error("Multiple indices detected");this.indices=e}else this.attributes[i]=e}this.indices&&void 0!==this.indices.isIndexed&&(this.indices=Object.assign({},this.indices),delete this.indices.isIndexed),this.vertexCount=i||this._calculateVertexCount(this.attributes,this.indices)}getVertexCount(){return this.vertexCount}getAttributes(){return this.indices?{indices:this.indices,...this.attributes}:this.attributes}_print(e){return`Geometry ${this.id} attribute ${e}`}_setAttributes(e,t){return this}_calculateVertexCount(e,t){if(t)return t.value.length;let r=1/0;for(let t of Object.values(e)){let{value:e,size:i,constant:s}=t;!s&&e&&void 0!==i&&i>=1&&(r=Math.min(r,e.length/i))}return r}}var P=r(609),L=r(46123),O=r(43210);function x(e){let t=ArrayBuffer.isView(e)?e.constructor:e;switch(t){case Float32Array:return"float32";case Uint16Array:return"uint16";case Uint32Array:return"uint32";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int8Array:return"sint8";case Int16Array:return"sint16";case Int32Array:return"sint32";default:throw Error(t.constructor.name)}}function N(e){switch(e){case"float32":return Float32Array;case"uint32":return Uint32Array;case"sint32":return Int32Array;case"uint16":case"unorm16":return Uint16Array;case"sint16":case"snorm16":return Int16Array;case"uint8":case"unorm8":return Uint8Array;case"sint8":case"snorm8":return Int8Array;default:throw Error(e)}}function F(e,t){return{attribute:e,format:t.size>1?`${t.type}x${t.size}`:t.type,byteOffset:t.offset||0}}function D(e){return e.stride||e.size*e.bytesPerElement}var U=r(11867),G=r(15273),k=r(20907);function H(e,t){t.offset&&k.A.removed("shaderAttribute.offset","vertexOffset, elementOffset")();let r=D(e),i=(void 0!==t.vertexOffset?t.vertexOffset:e.vertexOffset||0)*r+(t.elementOffset||0)*e.bytesPerElement+(e.offset||0);return{...t,offset:i,stride:r}}class V{constructor(e,t,r){let i;this._buffer=null,this.device=e,this.id=t.id||"",this.size=t.size||1;let s=t.logicalType||t.type,n="float64"===s,{defaultValue:o}=t;o=Number.isFinite(o)?[o]:o||Array(this.size).fill(0),i=n?"float32":!s&&t.isIndexed?"uint32":s||"float32";let a=function(e){switch(e){case"float64":return Float64Array;case"uint8":case"unorm8":return Uint8ClampedArray;default:return N(e)}}(s||i);this.doublePrecision=n,n&&!1===t.fp64&&(a=Float32Array),this.value=null,this.settings={...t,defaultType:a,defaultValue:o,logicalType:s,type:i,normalized:i.includes("norm"),size:this.size,bytesPerElement:a.BYTES_PER_ELEMENT},this.state={...r,externalBuffer:null,bufferAccessor:this.settings,allocatedValue:null,numInstances:0,bounds:null,constant:!1}}get isConstant(){return this.state.constant}get buffer(){return this._buffer}get byteOffset(){let e=this.getAccessor();return e.vertexOffset?e.vertexOffset*D(e):0}get numInstances(){return this.state.numInstances}set numInstances(e){this.state.numInstances=e}delete(){this._buffer&&(this._buffer.delete(),this._buffer=null),U.A.release(this.state.allocatedValue)}getBuffer(){return this.state.constant?null:this.state.externalBuffer||this._buffer}getValue(e=this.id,t=null){let r={};if(this.state.constant){let i=this.value;if(t){let s=H(this.getAccessor(),t),n=s.offset/i.BYTES_PER_ELEMENT,o=s.size||this.size;r[e]=i.subarray(n,n+o)}else r[e]=i}else r[e]=this.getBuffer();return this.doublePrecision&&(this.value instanceof Float64Array?r[`${e}64Low`]=r[e]:r[`${e}64Low`]=new Float32Array(this.size)),r}_getBufferLayout(e=this.id,t=null){let r=this.getAccessor(),i=[],s={name:this.id,byteStride:D(r),attributes:i};if(this.doublePrecision){let s=function(e,t){let r=H(e,t);return{high:r,low:{...r,offset:r.offset+4*e.size}}}(r,t||{});i.push(F(e,{...r,...s.high}),F(`${e}64Low`,{...r,...s.low}))}else if(t){let s=H(r,t);i.push(F(e,{...r,...s}))}else i.push(F(e,r));return s}setAccessor(e){this.state.bufferAccessor=e}getAccessor(){return this.state.bufferAccessor}getBounds(){if(this.state.bounds)return this.state.bounds;let e=null;if(this.state.constant&&this.value){let t=Array.from(this.value);e=[t,t]}else{let{value:t,numInstances:r,size:i}=this,s=r*i;if(t&&s&&t.length>=s){let r=Array(i).fill(1/0),n=Array(i).fill(-1/0);for(let e=0;e<s;)for(let s=0;s<i;s++){let i=t[e++];i<r[s]&&(r[s]=i),i>n[s]&&(n[s]=i)}e=[r,n]}}return this.state.bounds=e,e}setData(e){let t;let{state:r}=this;t=ArrayBuffer.isView(e)?{value:e}:e instanceof P.h?{buffer:e}:e;let i={...this.settings,...t};if(ArrayBuffer.isView(t.value)){if(!t.type){if(this.doublePrecision&&t.value instanceof Float64Array)i.type="float32";else{let e=x(t.value);i.type=i.normalized?e.replace("int","norm"):e}}i.bytesPerElement=t.value.BYTES_PER_ELEMENT,i.stride=D(i)}if(r.bounds=null,t.constant){let e=t.value;if(e=this._normalizeValue(e,[],0),this.settings.normalized&&(e=this.normalizeConstant(e)),!(!r.constant||!this._areValuesEqual(e,this.value)))return!1;r.externalBuffer=null,r.constant=!0,this.value=ArrayBuffer.isView(e)?e:new Float32Array(e)}else if(t.buffer)r.externalBuffer=t.buffer,r.constant=!1,this.value=t.value||null;else if(t.value){this._checkExternalBuffer(t);let e=t.value;r.externalBuffer=null,r.constant=!1,this.value=e;let{buffer:s}=this,n=D(i),o=(i.vertexOffset||0)*n;if(this.doublePrecision&&e instanceof Float64Array&&(e=(0,G.cT)(e,i)),this.settings.isIndexed){let t=this.settings.defaultType;e.constructor!==t&&(e=new t(e))}let a=e.byteLength+o+2*n;(!s||s.byteLength<a)&&(s=this._createBuffer(a)),s.write(e,o)}return this.setAccessor(i),!0}updateSubBuffer(e={}){this.state.bounds=null;let t=this.value,{startOffset:r=0,endOffset:i}=e;this.buffer.write(this.doublePrecision&&t instanceof Float64Array?(0,G.cT)(t,{size:this.size,startIndex:r,endIndex:i}):t.subarray(r,i),r*t.BYTES_PER_ELEMENT+this.byteOffset)}allocate(e,t=!1){let{state:r}=this,i=r.allocatedValue,s=U.A.allocate(i,e+1,{size:this.size,type:this.settings.defaultType,copy:t});this.value=s;let{byteOffset:n}=this,{buffer:o}=this;return(!o||o.byteLength<s.byteLength+n)&&(o=this._createBuffer(s.byteLength+n),t&&i&&o.write(i instanceof Float64Array?(0,G.cT)(i,this):i,n)),r.allocatedValue=s,r.constant=!1,r.externalBuffer=null,this.setAccessor(this.settings),!0}_checkExternalBuffer(e){let{value:t}=e;if(!ArrayBuffer.isView(t))throw Error(`Attribute ${this.id} value is not TypedArray`);let r=this.settings.defaultType,i=!1;if(this.doublePrecision&&(i=t.BYTES_PER_ELEMENT<4),i)throw Error(`Attribute ${this.id} does not support ${t.constructor.name}`);t instanceof r||!this.settings.normalized||"normalized"in e||k.A.warn(`Attribute ${this.id} is normalized`)()}normalizeConstant(e){switch(this.settings.type){case"snorm8":return new Float32Array(e).map(e=>(e+128)/255*2-1);case"snorm16":return new Float32Array(e).map(e=>(e+32768)/65535*2-1);case"unorm8":return new Float32Array(e).map(e=>e/255);case"unorm16":return new Float32Array(e).map(e=>e/65535);default:return e}}_normalizeValue(e,t,r){let{defaultValue:i,size:s}=this.settings;if(Number.isFinite(e))return t[r]=e,t;if(!e){let e=s;for(;--e>=0;)t[r+e]=i[e];return t}switch(s){case 4:t[r+3]=Number.isFinite(e[3])?e[3]:i[3];case 3:t[r+2]=Number.isFinite(e[2])?e[2]:i[2];case 2:t[r+1]=Number.isFinite(e[1])?e[1]:i[1];case 1:t[r+0]=Number.isFinite(e[0])?e[0]:i[0];break;default:let n=s;for(;--n>=0;)t[r+n]=Number.isFinite(e[n])?e[n]:i[n]}return t}_areValuesEqual(e,t){if(!e||!t)return!1;let{size:r}=this;for(let i=0;i<r;i++)if(e[i]!==t[i])return!1;return!0}_createBuffer(e){this._buffer&&this._buffer.destroy();let{isIndexed:t,type:r}=this.settings;return this._buffer=this.device.createBuffer({...this._buffer?.props,id:this.id,usage:(t?P.h.INDEX:P.h.VERTEX)|P.h.COPY_DST,indexType:t?r:void 0,byteLength:e}),this._buffer}}var j=r(72593);let W=[],z=[];function X(e,t=0,r=1/0){let i=W,s={index:-1,data:e,target:[]};return e?"function"==typeof e[Symbol.iterator]?i=e:e.length>0&&(z.length=e.length,i=z):i=W,(t>0||Number.isFinite(r))&&(i=(Array.isArray(i)?i:Array.from(i)).slice(t,r),s.index=t-1),{iterable:i,objectInfo:s}}function K(e){return e&&e[Symbol.asyncIterator]}var J=r(68323);let $=[],Y=[[0,1/0]],q={interpolation:{duration:0,easing:e=>e},spring:{stiffness:.05,damping:.5}};function Q(e,t){if(!e)return null;Number.isFinite(e)&&(e={type:"interpolation",duration:e});let r=e.type||"interpolation";return{...q[r],...t,...e,type:r}}class Z extends V{constructor(e,t){super(e,t,{startIndices:null,lastExternalBuffer:null,binaryValue:null,binaryAccessor:null,needsUpdate:!0,needsRedraw:!1,layoutChanged:!1,updateRanges:Y}),this.constant=!1,this.settings.update=t.update||(t.accessor?this._autoUpdater:void 0),Object.seal(this.settings),Object.seal(this.state),this._validateAttributeUpdaters()}get startIndices(){return this.state.startIndices}set startIndices(e){this.state.startIndices=e}needsUpdate(){return this.state.needsUpdate}needsRedraw({clearChangedFlags:e=!1}={}){let t=this.state.needsRedraw;return this.state.needsRedraw=t&&!e,t}layoutChanged(){return this.state.layoutChanged}setAccessor(e){var t,r;(t=this.state).layoutChanged||(r=this.getAccessor(),t.layoutChanged=e.type!==r.type||e.size!==r.size||D(e)!==D(r)||(e.offset||0)!==(r.offset||0)),super.setAccessor(e)}getUpdateTriggers(){let{accessor:e}=this.settings;return[this.id].concat("function"!=typeof e&&e||[])}supportsTransition(){return!!this.settings.transition}getTransitionSetting(e){if(!e||!this.supportsTransition())return null;let{accessor:t}=this.settings,r=this.settings.transition;return Q(Array.isArray(t)?e[t.find(t=>e[t])]:e[t],r)}setNeedsUpdate(e=this.id,t){if(this.state.needsUpdate=this.state.needsUpdate||e,this.setNeedsRedraw(e),t){let{startRow:e=0,endRow:r=1/0}=t;this.state.updateRanges=function(e,t){if(e===Y||(t[0]<0&&(t[0]=0),t[0]>=t[1]))return e;let r=[],i=e.length,s=0;for(let n=0;n<i;n++){let i=e[n];i[1]<t[0]?(r.push(i),s=n+1):i[0]>t[1]?r.push(i):t=[Math.min(i[0],t[0]),Math.max(i[1],t[1])]}return r.splice(s,0,t),r}(this.state.updateRanges,[e,r])}else this.state.updateRanges=Y}clearNeedsUpdate(){this.state.needsUpdate=!1,this.state.updateRanges=$}setNeedsRedraw(e=this.id){this.state.needsRedraw=this.state.needsRedraw||e}allocate(e){let{state:t,settings:r}=this;return!r.noAlloc&&!!r.update&&(super.allocate(e,t.updateRanges!==Y),!0)}updateBuffer({numInstances:e,data:t,props:r,context:i}){if(!this.needsUpdate())return!1;let{state:{updateRanges:s},settings:{update:n,noAlloc:o}}=this,a=!0;if(n){for(let[o,a]of s)n.call(i,this,{data:t,startRow:o,endRow:a,props:r,numInstances:e});if(this.value){if(this.constant||!this.buffer||this.buffer.byteLength<this.value.byteLength+this.byteOffset)this.setData({value:this.value,constant:this.constant}),this.constant=!1;else for(let[t,r]of s){let i=Number.isFinite(t)?this.getVertexOffset(t):0,s=Number.isFinite(r)?this.getVertexOffset(r):o||!Number.isFinite(e)?this.value.length:e*this.size;super.updateSubBuffer({startOffset:i,endOffset:s})}}this._checkAttributeArray()}else a=!1;return this.clearNeedsUpdate(),this.setNeedsRedraw(),a}setConstantValue(e){return void 0!==e&&"function"!=typeof e&&(this.setData({constant:!0,value:e})&&this.setNeedsRedraw(),this.clearNeedsUpdate(),!0)}setExternalBuffer(e){let{state:t}=this;return e?(this.clearNeedsUpdate(),t.lastExternalBuffer===e||(t.lastExternalBuffer=e,this.setNeedsRedraw(),this.setData(e),!0)):(t.lastExternalBuffer=null,!1)}setBinaryValue(e,t=null){let{state:r,settings:i}=this;if(!e)return r.binaryValue=null,r.binaryAccessor=null,!1;if(i.noAlloc)return!1;if(r.binaryValue===e)return this.clearNeedsUpdate(),!0;if(r.binaryValue=e,this.setNeedsRedraw(),i.transform||t!==this.startIndices){ArrayBuffer.isView(e)&&(e={value:e});let s=e;(0,j.A)(ArrayBuffer.isView(s.value),`invalid ${i.accessor}`);let n=!!s.size&&s.size!==this.size;return r.binaryAccessor=function(e,t){let{size:r,stride:i,offset:s,startIndices:n,nested:o}=t,a=e.BYTES_PER_ELEMENT,l=i?i/a:r,h=s?s/a:0,u=Math.floor((e.length-h)/l);return(t,{index:i,target:s})=>{let a;if(!n){let t=i*l+h;for(let i=0;i<r;i++)s[i]=e[t+i];return s}let c=n[i],d=n[i+1]||u;if(o){a=Array(d-c);for(let t=c;t<d;t++){let i=t*l+h;s=Array(r);for(let t=0;t<r;t++)s[t]=e[i+t];a[t-c]=s}}else if(l===r)a=e.subarray(c*r+h,d*r+h);else{a=new e.constructor((d-c)*r);let t=0;for(let i=c;i<d;i++){let s=i*l+h;for(let i=0;i<r;i++)a[t++]=e[s+i]}}return a}}(s.value,{size:s.size||this.size,stride:s.stride,offset:s.offset,startIndices:t,nested:n}),!1}return this.clearNeedsUpdate(),this.setData(e),!0}getVertexOffset(e){let{startIndices:t}=this;return(t?e<t.length?t[e]:this.numInstances:e)*this.size}getValue(){let e=this.settings.shaderAttributes,t=super.getValue();if(!e)return t;for(let r in e)Object.assign(t,super.getValue(r,e[r]));return t}getBufferLayout(e){this.state.layoutChanged=!1;let t=this.settings.shaderAttributes,r=super._getBufferLayout(),{stepMode:i}=this.settings;if("dynamic"===i?r.stepMode=e?e.isInstanced?"instance":"vertex":"instance":r.stepMode=i??"vertex",!t)return r;for(let e in t){let i=super._getBufferLayout(e,t[e]);r.attributes.push(...i.attributes)}return r}_autoUpdater(e,{data:t,startRow:r,endRow:i,props:s,numInstances:n}){if(e.constant)return;let{settings:o,state:a,value:l,size:h,startIndices:u}=e,{accessor:c,transform:d}=o,f=a.binaryAccessor||("function"==typeof c?c:s[c]);(0,j.A)("function"==typeof f,`accessor "${c}" is not a function`);let p=e.getVertexOffset(r),{iterable:g,objectInfo:m}=X(t,r,i);for(let t of g){m.index++;let r=f(t,m);if(d&&(r=d.call(this,r)),u){let t=(m.index<u.length-1?u[m.index+1]:n)-u[m.index];if(r&&Array.isArray(r[0])){let t=p;for(let i of r)e._normalizeValue(i,l,t),t+=h}else r&&r.length>h?l.set(r,p):(e._normalizeValue(r,m.target,0),(0,J.R)({target:l,source:m.target,start:p,count:t}));p+=t*h}else e._normalizeValue(r,l,p),p+=h}}_validateAttributeUpdaters(){let{settings:e}=this;if(!(e.noAlloc||"function"==typeof e.update))throw Error(`Attribute ${this.id} missing update or accessor`)}_checkAttributeArray(){let{value:e}=this,t=Math.min(4,this.size);if(e&&e.length>=t){let r=!0;switch(t){case 4:r=r&&Number.isFinite(e[3]);case 3:r=r&&Number.isFinite(e[2]);case 2:r=r&&Number.isFinite(e[1]);case 1:r=r&&Number.isFinite(e[0]);break;default:r=!1}if(!r)throw Error(`Illegal attribute generated for ${this.id}`)}}}var ee=r(193),et=r(28131);let er=`\
out vec4 transform_output;
void main() {
  transform_output = vec4(0);
}`,ei=`#version 300 es
${er}`;var es=r(64920),en=r(60263);class eo{bufferLayouts;constructor(e){this.bufferLayouts=e}getBufferLayout(e){return this.bufferLayouts.find(t=>t.name===e)||null}getAttributeNamesForBuffer(e){return e.attributes?e.attributes?.map(e=>e.attribute):[e.name]}mergeBufferLayouts(e,t){let r=[...e];for(let e of t){let t=r.findIndex(t=>t.name===e.name);t<0?r.push(e):r[t]=e}return r}}function ea(e){return Array.isArray(e)?0===e.length||"number"==typeof e[0]:ArrayBuffer.isView(e)&&!(e instanceof DataView)}class el{name;uniforms={};modifiedUniforms={};modified=!0;bindingLayout={};needsRedraw="initialized";constructor(e){if(this.name=e?.name||"unnamed",e?.name&&e?.shaderLayout){let t=e?.shaderLayout.bindings?.find(t=>"uniform"===t.type&&t.name===e?.name);if(!t)throw Error(e?.name);for(let e of t.uniforms||[])this.bindingLayout[e.name]=e}}setUniforms(e){for(let[t,r]of Object.entries(e))this._setUniform(t,r),this.needsRedraw||this.setNeedsRedraw(`${this.name}.${t}=${r}`)}setNeedsRedraw(e){this.needsRedraw=this.needsRedraw||e}getAllUniforms(){return this.modifiedUniforms={},this.needsRedraw=!1,this.uniforms||{}}_setUniform(e,t){!function(e,t,r=16){if(e!==t||!ea(e))return!1;if(ea(t)&&e.length===t.length){for(let r=0;r<e.length;++r)if(t[r]!==e[r])return!1}return!0}(this.uniforms[e],t)&&(this.uniforms[e]=ea(t)?t.slice():t,this.modifiedUniforms[e]=!0,this.modified=!0)}}let eh={f32:{type:"f32",components:1},i32:{type:"i32",components:1},u32:{type:"u32",components:1},"vec2<f32>":{type:"f32",components:2},"vec3<f32>":{type:"f32",components:3},"vec4<f32>":{type:"f32",components:4},"vec2<i32>":{type:"i32",components:2},"vec3<i32>":{type:"i32",components:3},"vec4<i32>":{type:"i32",components:4},"vec2<u32>":{type:"u32",components:2},"vec3<u32>":{type:"u32",components:3},"vec4<u32>":{type:"u32",components:4},"mat2x2<f32>":{type:"f32",components:4},"mat2x3<f32>":{type:"f32",components:6},"mat2x4<f32>":{type:"f32",components:8},"mat3x2<f32>":{type:"f32",components:6},"mat3x3<f32>":{type:"f32",components:9},"mat3x4<f32>":{type:"f32",components:12},"mat4x2<f32>":{type:"f32",components:8},"mat4x3<f32>":{type:"f32",components:12},"mat4x4<f32>":{type:"f32",components:16}};var eu=r(11304);class ec{layout={};byteLength;constructor(e){let t=0;for(let[r,i]of Object.entries(e)){let{type:e,components:s}=eh[i],n=t=function(e,t){switch(t){case 1:return e;case 2:return e+e%2;default:return e+(4-e%4)%4}}(t,s);t+=s,this.layout[r]={type:e,size:s,offset:n}}let r=4*(t+=(4-t%4)%4);this.byteLength=Math.max(r,1024)}getData(e){let t=Math.max(this.byteLength,1024),r=(0,eu.o)(t),i={i32:new Int32Array(r),u32:new Uint32Array(r),f32:new Float32Array(r),f16:new Uint16Array(r)};for(let[t,r]of Object.entries(e)){let e=this.layout[t];if(!e){en.R.warn(`Supplied uniform value ${t} not present in uniform block layout`)();continue}let{type:s,size:n,offset:o}=e,a=i[s];if(1===n){if("number"!=typeof r&&"boolean"!=typeof r){en.R.warn(`Supplied value for single component uniform ${t} is not a number: ${r}`)();continue}a[o]=Number(r)}else{if(!ea(r)){en.R.warn(`Supplied value for multi component / array uniform ${t} is not a numeric array: ${r}`)();continue}a.set(r,o)}}return new Uint8Array(r)}has(e){return!!this.layout[e]}get(e){return this.layout[e]}}class ed{uniformBlocks=new Map;uniformBufferLayouts=new Map;uniformBuffers=new Map;constructor(e){for(let[t,r]of Object.entries(e)){let e=new ec(r.uniformTypes||{});this.uniformBufferLayouts.set(t,e);let i=new el({name:t});i.setUniforms(r.defaultUniforms||{}),this.uniformBlocks.set(t,i)}}destroy(){for(let e of this.uniformBuffers.values())e.destroy()}setUniforms(e){for(let[t,r]of Object.entries(e))this.uniformBlocks.get(t)?.setUniforms(r);this.updateUniformBuffers()}getUniformBufferByteLength(e){return this.uniformBufferLayouts.get(e)?.byteLength||0}getUniformBufferData(e){let t=this.uniformBlocks.get(e)?.getAllUniforms()||{};return this.uniformBufferLayouts.get(e)?.getData(t)}createUniformBuffer(e,t,r){r&&this.setUniforms(r);let i=this.getUniformBufferByteLength(t),s=e.createBuffer({usage:P.h.UNIFORM|P.h.COPY_DST,byteLength:i}),n=this.getUniformBufferData(t);return s.write(n),s}getManagedUniformBuffer(e,t){if(!this.uniformBuffers.get(t)){let r=this.getUniformBufferByteLength(t),i=e.createBuffer({usage:P.h.UNIFORM|P.h.COPY_DST,byteLength:r});this.uniformBuffers.set(t,i)}return this.uniformBuffers.get(t)}updateUniformBuffers(){let e=!1;for(let t of this.uniformBlocks.keys()){let r=this.updateUniformBuffer(t);e||=r}return e&&en.R.log(3,`UniformStore.updateUniformBuffers(): ${e}`)(),e}updateUniformBuffer(e){let t=this.uniformBlocks.get(e),r=this.uniformBuffers.get(e),i=!1;if(r&&t?.needsRedraw){i||=t.needsRedraw;let s=this.getUniformBufferData(e);r=this.uniformBuffers.get(e),r?.write(s);let n=this.uniformBlocks.get(e)?.getAllUniforms();en.R.log(4,`Writing to uniform buffer ${String(e)}`,s,n)()}return i}}var ef=r(10184),ep=r(26106),eg=r(15101),em=r(51465),e_=r(35510),eA=r(15288);function eE(e){return e.format?`${e.name}<${e.format.name}>`:e.name}class eb{id;userData={};topology;bufferLayout=[];vertexCount;indices;attributes;constructor(e){if(this.id=e.id||M("geometry"),this.topology=e.topology,this.indices=e.indices||null,this.attributes=e.attributes,this.vertexCount=e.vertexCount,this.bufferLayout=e.bufferLayout||[],this.indices&&!(this.indices.usage&P.h.INDEX))throw Error("Index buffer must have INDEX usage")}destroy(){for(let e of(this.indices?.destroy(),Object.values(this.attributes)))e.destroy()}getVertexCount(){return this.vertexCount}getAttributes(){return this.attributes}getIndexes(){return this.indices||null}_calculateVertexCount(e){return e.byteLength/12}}var ey=r(32167);class eT extends ey.F{static defaultProps={...ey.F.defaultProps,shader:void 0,entryPoint:void 0,constants:{},shaderLayout:void 0};get[Symbol.toStringTag](){return"ComputePipeline"}hash="";shaderLayout;constructor(e,t){super(e,t,eT.defaultProps),this.shaderLayout=t.shaderLayout}}class eC{static defaultProps={...es.r.defaultProps};static getDefaultPipelineFactory(e){return e._lumaData.defaultPipelineFactory=e._lumaData.defaultPipelineFactory||new eC(e),e._lumaData.defaultPipelineFactory}device;destroyPolicy;_hashCounter=0;_hashes={};_renderPipelineCache={};_computePipelineCache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createRenderPipeline(e){let t={...es.r.defaultProps,...e},r=this._hashRenderPipeline(t);if(!this._renderPipelineCache[r]){let e=this.device.createRenderPipeline({...t,id:t.id?`${t.id}-cached`:void 0});e.hash=r,this._renderPipelineCache[r]={pipeline:e,useCount:0}}return this._renderPipelineCache[r].useCount++,this._renderPipelineCache[r].pipeline}createComputePipeline(e){let t={...eT.defaultProps,...e},r=this._hashComputePipeline(t);if(!this._computePipelineCache[r]){let e=this.device.createComputePipeline({...t,id:t.id?`${t.id}-cached`:void 0});e.hash=r,this._computePipelineCache[r]={pipeline:e,useCount:0}}return this._computePipelineCache[r].useCount++,this._computePipelineCache[r].pipeline}release(e){let t=e.hash,r=e instanceof eT?this._computePipelineCache:this._renderPipelineCache;r[t].useCount--,0===r[t].useCount&&"unused"===this.destroyPolicy&&(r[t].pipeline.destroy(),delete r[t])}_hashComputePipeline(e){let t=this._getHash(e.shader.source);return`${t}`}_hashRenderPipeline(e){let t=e.vs?this._getHash(e.vs.source):0,r=e.fs?this._getHash(e.fs.source):0,i=this._getHash(JSON.stringify(e.bufferLayout));if("webgl"===this.device.type)return`${t}/${r}V-BL${i}`;{let s=this._getHash(JSON.stringify(e.parameters));return`${t}/${r}V-T${e.topology}P${s}BL${i}`}}_getHash(e){return void 0===this._hashes[e]&&(this._hashes[e]=this._hashCounter++),this._hashes[e]}}var ev=r(53422);class eR{static defaultProps={...ev.M.defaultProps};static getDefaultShaderFactory(e){return e._lumaData.defaultShaderFactory||=new eR(e),e._lumaData.defaultShaderFactory}device;destroyPolicy;_cache={};constructor(e){this.device=e,this.destroyPolicy=e.props._factoryDestroyPolicy}createShader(e){let t=this._hashShader(e),r=this._cache[t];if(!r){let i=this.device.createShader({...e,id:e.id?`${e.id}-cached`:void 0});this._cache[t]=r={shader:i,useCount:0}}return r.useCount++,r.shader}release(e){let t=this._hashShader(e),r=this._cache[t];r&&(r.useCount--,0===r.useCount&&"unused"===this.destroyPolicy&&(delete this._cache[t],r.shader.destroy()))}_hashShader(e){return`${e.stage}:${e.source}`}}let eS=null,eB=null;var ew=r(33021),eM=r(15026);function eI(e){let t={bindings:{},uniforms:{}};return Object.keys(e).forEach(r=>{let i=e[r];(0,eM.H9)(i)||"number"==typeof i||"boolean"==typeof i?t.uniforms[r]=i:t.bindings[r]=i}),t}class eP{options={disableWarnings:!1};modules;moduleUniforms;moduleBindings;constructor(e,t){for(let r of(Object.assign(this.options,t),(0,ew.$Q)(Object.values(e).filter(e=>e.dependencies))))e[r.name]=r;for(let[t,r]of(en.R.log(1,"Creating ShaderInputs with modules",Object.keys(e))(),this.modules=e,this.moduleUniforms={},this.moduleBindings={},Object.entries(e)))this._addModule(r),r.name&&t!==r.name&&!this.options.disableWarnings&&en.R.warn(`Module name: ${t} vs ${r.name}`)()}destroy(){}setProps(e){for(let t of Object.keys(e)){let r=e[t]||{},i=this.modules[t];if(!i){this.options.disableWarnings||en.R.warn(`Module ${t} not found`)();continue}let s=this.moduleUniforms[t],n=this.moduleBindings[t],{uniforms:o,bindings:a}=eI(i.getUniforms?.(r,s)||r);this.moduleUniforms[t]={...s,...o},this.moduleBindings[t]={...n,...a}}}getModules(){return Object.values(this.modules)}getUniformValues(){return this.moduleUniforms}getBindingValues(){let e={};for(let t of Object.values(this.moduleBindings))Object.assign(e,t);return e}getDebugTable(){let e={};for(let[t,r]of Object.entries(this.moduleUniforms))for(let[i,s]of Object.entries(r))e[`${t}.${i}`]={type:this.modules[t].uniformTypes?.[i],value:String(s)};return e}_addModule(e){let t=e.name;this.moduleUniforms[t]=e.defaultUniforms||{},this.moduleBindings[t]={}}}async function eL(e,t){let r=new Image;return r.crossOrigin=t?.crossOrigin||"anonymous",r.src=e.startsWith("http")?e:""+e,await r.decode(),t?await createImageBitmap(r,t):await createImageBitmap(r)}class eO{device;id;texture;sampler;view;ready;isReady=!1;destroyed=!1;resolveReady=()=>{};rejectReady=()=>{};get[Symbol.toStringTag](){return"AsyncTexture"}toString(){return`AsyncTexture:"${this.id}"(${this.isReady?"ready":"loading"})`}constructor(e,t){this.device=e,this.id=t.id||M("async-texture"),"string"==typeof t?.data&&"2d"===t.dimension&&(t={...t,data:eL(t.data)}),this.ready=new Promise((e,t)=>{this.resolveReady=()=>{this.isReady=!0,e()},this.rejectReady=t}),this.initAsync(t)}async initAsync(e){let t,r;let i=e.data,s=await ex(i).then(t,r);if(this.destroyed)return;let n={...e,data:s};this.texture=this.device.createTexture(n),this.sampler=this.texture.sampler,this.view=this.texture.view,this.isReady=!0}destroy(){this.texture&&(this.texture.destroy(),this.texture=null),this.destroyed=!0}resize(e){if(!this.isReady)throw Error("Cannot resize texture before it is ready");if(e.width===this.texture.width&&e.height===this.texture.height)return!1;if(this.texture){let t=this.texture;this.texture=t.clone(e),t.destroy()}return!0}}async function ex(e){if(Array.isArray(e=await e))return await Promise.all(e.map(ex));if(e&&"object"==typeof e&&e.constructor===Object){let t=e,r=await Promise.all(Object.values(t)),i=Object.keys(t),s={};for(let e=0;e<i.length;e++)s[i[e]]=r[e];return s}return e}class eN{static defaultProps={...es.r.defaultProps,source:void 0,vs:null,fs:null,id:"unnamed",handle:void 0,userData:{},defines:{},modules:[],moduleSettings:void 0,geometry:null,indexBuffer:null,attributes:{},constantAttributes:{},varyings:[],isInstanced:void 0,instanceCount:0,vertexCount:0,shaderInputs:void 0,pipelineFactory:void 0,shaderFactory:void 0,transformFeedback:void 0,shaderAssembler:e_._.getDefaultShaderAssembler(),debugShaders:void 0,disableWarnings:void 0};device;id;source;vs;fs;pipelineFactory;shaderFactory;userData={};parameters;topology;bufferLayout;isInstanced=void 0;instanceCount=0;vertexCount;indexBuffer=null;bufferAttributes={};constantAttributes={};bindings={};uniforms={};vertexArray;transformFeedback=null;pipeline;shaderInputs;_uniformStore;_attributeInfos={};_gpuGeometry=null;_getModuleUniforms;props;_pipelineNeedsUpdate="newly created";_needsRedraw="initializing";_destroyed=!1;_lastDrawTimestamp=-1;get[Symbol.toStringTag](){return"Model"}toString(){return`Model(${this.id})`}constructor(e,t){this.props={...eN.defaultProps,...t},t=this.props,this.id=t.id||M("model"),this.device=e,Object.assign(this.userData,t.userData);let r=Object.fromEntries(this.props.modules?.map(e=>[e.name,e])||[]),i=t.shaderInputs||new eP(r,{disableWarnings:this.props.disableWarnings});this.setShaderInputs(i);let s=function(e){return{type:e.type,shaderLanguage:e.info.shadingLanguage,shaderLanguageVersion:e.info.shadingLanguageVersion,gpu:e.info.gpu,features:e.features}}(e),n=(this.props.modules?.length>0?this.props.modules:this.shaderInputs?.getModules())||[];if("webgpu"===this.device.type&&this.props.source){let{source:e,getUniforms:t}=this.props.shaderAssembler.assembleWGSLShader({platformInfo:s,...this.props,modules:n});this.source=e,this._getModuleUniforms=t,this.props.shaderLayout||=function(e){let t;let r={attributes:[],bindings:[]};try{t=function(e){try{return new eA.$X(e)}catch(t){if(t instanceof Error)throw t;let e="WGSL parse error";throw"object"==typeof t&&t?.message&&(e+=`: ${t.message} `),"object"==typeof t&&t?.token&&(e+=t.token.line||""),Error(e,{cause:t})}}(e)}catch(e){return en.R.error(e.message)(),r}for(let e of t.uniforms){let t=[];for(let r of e.type?.members||[])t.push({name:r.name,type:eE(r.type)});r.bindings.push({type:"uniform",name:e.name,group:e.group,location:e.binding,members:t})}for(let e of t.textures)r.bindings.push({type:"texture",name:e.name,group:e.group,location:e.binding});for(let e of t.samplers)r.bindings.push({type:"sampler",name:e.name,group:e.group,location:e.binding});let i=t.entry.vertex[0],s=i?.inputs.length||0;for(let e=0;e<s;e++){let t=i.inputs[e];if("location"===t.locationType){let e=eE(t.type);r.attributes.push({name:t.name,location:Number(t.location),type:e})}}return r}(this.source)}else{let{vs:e,fs:t,getUniforms:r}=this.props.shaderAssembler.assembleGLSLShaderPair({platformInfo:s,...this.props,modules:n});this.vs=e,this.fs=t,this._getModuleUniforms=r}this.vertexCount=this.props.vertexCount,this.instanceCount=this.props.instanceCount,this.topology=this.props.topology,this.bufferLayout=this.props.bufferLayout,this.parameters=this.props.parameters,t.geometry&&this.setGeometry(t.geometry),this.pipelineFactory=t.pipelineFactory||eC.getDefaultPipelineFactory(this.device),this.shaderFactory=t.shaderFactory||eR.getDefaultShaderFactory(this.device),this.pipeline=this._updatePipeline(),this.vertexArray=e.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry),"isInstanced"in t&&(this.isInstanced=t.isInstanced),t.instanceCount&&this.setInstanceCount(t.instanceCount),t.vertexCount&&this.setVertexCount(t.vertexCount),t.indexBuffer&&this.setIndexBuffer(t.indexBuffer),t.attributes&&this.setAttributes(t.attributes),t.constantAttributes&&this.setConstantAttributes(t.constantAttributes),t.bindings&&this.setBindings(t.bindings),t.uniforms&&this.setUniformsWebGL(t.uniforms),t.moduleSettings&&this.updateModuleSettingsWebGL(t.moduleSettings),t.transformFeedback&&(this.transformFeedback=t.transformFeedback),Object.seal(this)}destroy(){this._destroyed||(this.pipelineFactory.release(this.pipeline),this.shaderFactory.release(this.pipeline.vs),this.pipeline.fs&&this.shaderFactory.release(this.pipeline.fs),this._uniformStore.destroy(),this._gpuGeometry?.destroy(),this._destroyed=!0)}needsRedraw(){this._getBindingsUpdateTimestamp()>this._lastDrawTimestamp&&this.setNeedsRedraw("contents of bound textures or buffers updated");let e=this._needsRedraw;return this._needsRedraw=!1,e}setNeedsRedraw(e){this._needsRedraw||=e}predraw(){this.updateShaderInputs(),this.pipeline=this._updatePipeline()}draw(e){let t;let r=this._areBindingsLoading();if(r)return en.R.info(2,`>>> DRAWING ABORTED ${this.id}: ${r} not loaded`)(),!1;try{e.pushDebugGroup(`${this}.predraw(${e})`),this.predraw()}finally{e.popDebugGroup()}try{e.pushDebugGroup(`${this}.draw(${e})`),this._logDrawCallStart(),this.pipeline=this._updatePipeline();let r=this._getBindings();this.pipeline.setBindings(r,{disableWarnings:this.props.disableWarnings}),eF(this.uniforms)||this.pipeline.setUniformsWebGL(this.uniforms);let{indexBuffer:i}=this.vertexArray,s=i?i.byteLength/("uint32"===i.indexType?4:2):void 0;t=this.pipeline.draw({renderPass:e,vertexArray:this.vertexArray,isInstanced:this.isInstanced,vertexCount:this.vertexCount,instanceCount:this.instanceCount,indexCount:s,transformFeedback:this.transformFeedback||void 0,parameters:this.parameters,topology:this.topology})}finally{e.popDebugGroup(),this._logDrawCallEnd()}return this._logFramebuffer(e),t?(this._lastDrawTimestamp=this.device.timestamp,this._needsRedraw=!1):this._needsRedraw="waiting for resource initialization",t}setGeometry(e){this._gpuGeometry?.destroy();let t=e&&function(e,t){if(t instanceof eb)return t;let r=function(e,t){if(!t.indices)return;let r=t.indices.value;return e.createBuffer({usage:P.h.INDEX,data:r})}(e,t),{attributes:i,bufferLayout:s}=function(e,t){let r=[],i={};for(let[s,n]of Object.entries(t.attributes)){let t=s;switch(s){case"POSITION":t="positions";break;case"NORMAL":t="normals";break;case"TEXCOORD_0":t="texCoords";break;case"COLOR_0":t="colors"}if(n){i[t]=e.createBuffer({data:n.value,id:`${s}-buffer`});let{value:o,size:a,normalized:l}=n;r.push({name:t,format:function(e,t,r){if(!t||t>4)throw Error(`size ${t}`);let i=x(e);if("uint8"===i&&r&&1===t)return"unorm8-webgl";if("uint8"===i&&r&&3===t)return"unorm8x3-webgl";if("uint8"===i||"sint8"===i||"uint16"===i||"sint16"===i){if(1===t||3===t)throw Error(`size: ${t}`);return r&&(i=i.replace("int","norm")),`${i}x${t}`}return 1===t?i:`${i}x${t}`}(o,a,l)})}}return{attributes:i,bufferLayout:r,vertexCount:t._calculateVertexCount(t.attributes,t.indices)}}(e,t);return new eb({topology:t.topology||"triangle-list",bufferLayout:s,vertexCount:t.vertexCount,indices:r,attributes:i})}(this.device,e);if(t){this.setTopology(t.topology||"triangle-list");let e=new eo(this.bufferLayout);this.bufferLayout=e.mergeBufferLayouts(t.bufferLayout,this.bufferLayout),this.vertexArray&&this._setGeometryAttributes(t)}this._gpuGeometry=t}setTopology(e){e!==this.topology&&(this.topology=e,this._setPipelineNeedsUpdate("topology"))}setBufferLayout(e){let t=new eo(this.bufferLayout);this.bufferLayout=this._gpuGeometry?t.mergeBufferLayouts(e,this._gpuGeometry.bufferLayout):e,this._setPipelineNeedsUpdate("bufferLayout"),this.pipeline=this._updatePipeline(),this.vertexArray=this.device.createVertexArray({renderPipeline:this.pipeline}),this._gpuGeometry&&this._setGeometryAttributes(this._gpuGeometry)}setParameters(e){!function e(t,r,i){if(t===r)return!0;if(!i||!t||!r)return!1;if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(!e(t[s],r[s],i-1))return!1;return!0}if(Array.isArray(r))return!1;if("object"==typeof t&&"object"==typeof r){let s=Object.keys(t),n=Object.keys(r);if(s.length!==n.length)return!1;for(let n of s)if(!r.hasOwnProperty(n)||!e(t[n],r[n],i-1))return!1;return!0}return!1}(e,this.parameters,2)&&(this.parameters=e,this._setPipelineNeedsUpdate("parameters"))}setInstanceCount(e){this.instanceCount=e,void 0===this.isInstanced&&e>0&&(this.isInstanced=!0),this.setNeedsRedraw("instanceCount")}setVertexCount(e){this.vertexCount=e,this.setNeedsRedraw("vertexCount")}setShaderInputs(e){for(let[r,i]of(this.shaderInputs=e,this._uniformStore=new ed(this.shaderInputs.modules),Object.entries(this.shaderInputs.modules))){var t;if((t=i).uniformTypes&&!eF(t.uniformTypes)){let e=this._uniformStore.getManagedUniformBuffer(this.device,r);this.bindings[`${r}Uniforms`]=e}}this.setNeedsRedraw("shaderInputs")}updateShaderInputs(){this._uniformStore.setUniforms(this.shaderInputs.getUniformValues()),this.setBindings(this.shaderInputs.getBindingValues()),this.setNeedsRedraw("shaderInputs")}setBindings(e){Object.assign(this.bindings,e),this.setNeedsRedraw("bindings")}setTransformFeedback(e){this.transformFeedback=e,this.setNeedsRedraw("transformFeedback")}setIndexBuffer(e){this.vertexArray.setIndexBuffer(e),this.setNeedsRedraw("indexBuffer")}setAttributes(e,t){let r=t?.disableWarnings??this.props.disableWarnings;e.indices&&en.R.warn(`Model:${this.id} setAttributes() - indexBuffer should be set using setIndexBuffer()`)();let i=new eo(this.bufferLayout);for(let[t,s]of Object.entries(e)){let e=i.getBufferLayout(t);if(!e){r||en.R.warn(`Model(${this.id}): Missing layout for buffer "${t}".`)();continue}let n=i.getAttributeNamesForBuffer(e),o=!1;for(let e of n){let t=this._attributeInfos[e];t&&(this.vertexArray.setBuffer(t.location,s),o=!0)}o||r||en.R.warn(`Model(${this.id}): Ignoring buffer "${s.id}" for unknown attribute "${t}"`)()}this.setNeedsRedraw("attributes")}setConstantAttributes(e,t){for(let[r,i]of Object.entries(e)){let e=this._attributeInfos[r];e?this.vertexArray.setConstantWebGL(e.location,i):(t?.disableWarnings??this.props.disableWarnings)||en.R.warn(`Model "${this.id}: Ignoring constant supplied for unknown attribute "${r}"`)()}this.setNeedsRedraw("constants")}setUniforms(e){this.setUniformsWebGL(e)}setUniformsWebGL(e){eF(e)||(this.pipeline.setUniformsWebGL(e),Object.assign(this.uniforms,e)),this.setNeedsRedraw("uniforms")}updateModuleSettingsWebGL(e){let{bindings:t,uniforms:r}=eI(this._getModuleUniforms(e));Object.assign(this.bindings,t),Object.assign(this.uniforms,r),this.setNeedsRedraw("moduleSettings")}_areBindingsLoading(){for(let e of Object.values(this.bindings))if(e instanceof eO&&!e.isReady)return e.id;return!1}_getBindings(){let e={};for(let[t,r]of Object.entries(this.bindings))r instanceof eO?r.isReady&&(e[t]=r.texture):e[t]=r;return e}_getBindingsUpdateTimestamp(){let e=0;for(let t of Object.values(this.bindings))t instanceof ef.X?e=Math.max(e,t.texture.updateTimestamp):t instanceof P.h||t instanceof ep.g?e=Math.max(e,t.updateTimestamp):t instanceof eO?e=t.texture?Math.max(e,t.texture.updateTimestamp):1/0:t instanceof eg.L||(e=Math.max(e,t.buffer.updateTimestamp));return e}_setGeometryAttributes(e){let t={...e.attributes};for(let[e]of Object.entries(t))this.pipeline.shaderLayout.attributes.find(t=>t.name===e)||"positions"===e||delete t[e];this.vertexCount=e.vertexCount,this.setIndexBuffer(e.indices||null),this.setAttributes(e.attributes,{disableWarnings:!0}),this.setAttributes(t,{disableWarnings:this.props.disableWarnings}),this.setNeedsRedraw("geometry attributes")}_setPipelineNeedsUpdate(e){this._pipelineNeedsUpdate||=e,this.setNeedsRedraw(e)}_updatePipeline(){if(this._pipelineNeedsUpdate){let e=null,t=null;this.pipeline&&(en.R.log(1,`Model ${this.id}: Recreating pipeline because "${this._pipelineNeedsUpdate}".`)(),e=this.pipeline.vs,t=this.pipeline.fs),this._pipelineNeedsUpdate=!1;let r=this.shaderFactory.createShader({id:`${this.id}-vertex`,stage:"vertex",source:this.source||this.vs,debugShaders:this.props.debugShaders}),i=null;this.source?i=r:this.fs&&(i=this.shaderFactory.createShader({id:`${this.id}-fragment`,stage:"fragment",source:this.source||this.fs,debugShaders:this.props.debugShaders})),this.pipeline=this.pipelineFactory.createRenderPipeline({...this.props,bufferLayout:this.bufferLayout,topology:this.topology,parameters:this.parameters,bindings:this._getBindings(),vs:r,fs:i}),this._attributeInfos=(0,em.P)(this.pipeline.shaderLayout,this.bufferLayout),e&&this.shaderFactory.release(e),t&&this.shaderFactory.release(t)}return this.pipeline}_lastLogTime=0;_logOpen=!1;_logDrawCallStart(){let e=en.R.level>3?0:1e4;!(en.R.level<2||Date.now()-this._lastLogTime<e)&&(this._lastLogTime=Date.now(),this._logOpen=!0,en.R.group(2,`>>> DRAWING MODEL ${this.id}`,{collapsed:en.R.level<=2})())}_logDrawCallEnd(){if(this._logOpen){let e=function(e,t){let r={},i="Values";if(0===e.attributes.length&&!e.varyings?.length)return{"No attributes or varyings":{[i]:"N/A"}};for(let t of e.attributes)if(t){let e=`${t.location} ${t.name}: ${t.type}`;r[`in ${e}`]={[i]:t.stepMode||"vertex"}}for(let t of e.varyings||[]){let e=`${t.location} ${t.name}`;r[`out ${e}`]={[i]:JSON.stringify(t)}}return r}(this.pipeline.shaderLayout,this.id);en.R.table(2,e)();let t=this.shaderInputs.getDebugTable();for(let[e,r]of Object.entries(this.uniforms))t[e]={value:r};en.R.table(2,t)();let r=this._getAttributeDebugTable();en.R.table(2,this._attributeInfos)(),en.R.table(2,r)(),en.R.groupEnd(2)(),this._logOpen=!1}}_drawCount=0;_logFramebuffer(e){let t=this.device.props.debugFramebuffers;if(this._drawCount++,!t)return;let r=e.props.framebuffer;r&&function(e,{id:t,minimap:r,opaque:i,top:s="0",left:n="0",rgbaScale:o=1}){eS||((eS=document.createElement("canvas")).id=t,eS.title=t,eS.style.zIndex="100",eS.style.position="absolute",eS.style.top=s,eS.style.left=n,eS.style.border="blue 5px solid",eS.style.transform="scaleY(-1)",document.body.appendChild(eS),eB=eS.getContext("2d")),(eS.width!==e.width||eS.height!==e.height)&&(eS.width=e.width/2,eS.height=e.height/2,eS.style.width="400px",eS.style.height="400px");let a=e.device.readPixelsToArrayWebGL(e),l=eB?.createImageData(e.width,e.height);if(l){for(let e=0;e<a.length;e+=4)l.data[0+e+0]=a[e+0]*o,l.data[0+e+1]=a[e+1]*o,l.data[0+e+2]=a[e+2]*o,l.data[0+e+3]=i?255:a[e+3]*o;eB?.putImageData(l,0,0)}}(r,{id:r.id,minimap:!0})}_getAttributeDebugTable(){let e={};for(let[t,r]of Object.entries(this._attributeInfos)){let i=this.vertexArray.attributes[r.location];e[r.location]={name:t,type:r.shaderType,values:i?this._getBufferOrConstantValues(i,r.bufferDataType):"null"}}if(this.vertexArray.indexBuffer){let{indexBuffer:t}=this.vertexArray,r="uint32"===t.indexType?new Uint32Array(t.debugData):new Uint16Array(t.debugData);e.indices={name:"indices",type:t.indexType,values:r.toString()}}return e}_getBufferOrConstantValues(e,t){let r=N(t);return(e instanceof P.h?new r(e.debugData):e).toString()}}function eF(e){for(let t in e)return!1;return!0}class eD{device;model;transformFeedback;static defaultProps={...eN.defaultProps,outputs:void 0,feedbackBuffers:void 0};static isSupported(e){return e?.info?.type==="webgl"}constructor(e,t=eD.defaultProps){if(!eD.isSupported(e))throw Error("BufferTransform not yet implemented on WebGPU");this.device=e,this.model=new eN(this.device,{id:t.id||"buffer-transform-model",fs:t.fs||function(e){let{input:t,inputChannels:r,output:i}={};if(!t)return ei;if(!r)throw Error("inputChannels");let s=function(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw Error(`invalid channels: ${e}`)}}(r),n=function(e,t){switch(t){case 1:return`vec4(${e}, 0.0, 0.0, 1.0)`;case 2:return`vec4(${e}, 0.0, 1.0)`;case 3:return`vec4(${e}, 1.0)`;case 4:return e;default:throw Error(`invalid channels: ${t}`)}}(t,r);return`\
#version 300 es
in ${s} ${t};
out vec4 ${i};
void main() {
  ${i} = ${n};
}`}(),topology:t.topology||"point-list",varyings:t.outputs||t.varyings,...t}),this.transformFeedback=this.device.createTransformFeedback({layout:this.model.pipeline.shaderLayout,buffers:t.feedbackBuffers}),this.model.setTransformFeedback(this.transformFeedback),Object.seal(this)}destroy(){this.model&&this.model.destroy()}delete(){this.destroy()}run(e){e?.inputBuffers&&this.model.setAttributes(e.inputBuffers),e?.outputBuffers&&this.transformFeedback.setBuffers(e.outputBuffers);let t=this.device.beginRenderPass(e);this.model.draw(t),t.end()}getBuffer(e){return this.transformFeedback.getBuffer(e)}readAsync(e){let t=this.getBuffer(e);if(!t)throw Error("BufferTransform#getBuffer");if(t instanceof P.h)return t.readAsync();let{buffer:r,byteOffset:i=0,byteLength:s=r.byteLength}=t;return r.readAsync(i,s)}}function eU(e,t=[],r=0){let i=Math.fround(e),s=e-i;return t[r]=i,t[r+1]=s,t}let eG={name:"fp64arithmetic",vs:`\

uniform fp64arithmeticUniforms {
  uniform float ONE;
} fp64;

/*
About LUMA_FP64_CODE_ELIMINATION_WORKAROUND

The purpose of this workaround is to prevent shader compilers from
optimizing away necessary arithmetic operations by swapping their sequences
or transform the equation to some 'equivalent' form.

The method is to multiply an artifical variable, ONE, which will be known to
the compiler to be 1 only at runtime. The whole expression is then represented
as a polynomial with respective to ONE. In the coefficients of all terms, only one a
and one b should appear

err = (a + b) * ONE^6 - a * ONE^5 - (a + b) * ONE^4 + a * ONE^3 - b - (a + b) * ONE^2 + a * ONE
*/

// Divide float number to high and low floats to extend fraction bits
vec2 split(float a) {
  const float SPLIT = 4097.0;
  float t = a * SPLIT;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float a_hi = t * fp64.ONE - (t - a);
  float a_lo = a * fp64.ONE - a_hi;
#else
  float a_hi = t - (t - a);
  float a_lo = a - a_hi;
#endif
  return vec2(a_hi, a_lo);
}

// Divide float number again when high float uses too many fraction bits
vec2 split2(vec2 a) {
  vec2 b = split(a.x);
  b.y += a.y;
  return b;
}

// Special sum operation when a > b
vec2 quickTwoSum(float a, float b) {
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float sum = (a + b) * fp64.ONE;
  float err = b - (sum - a) * fp64.ONE;
#else
  float sum = a + b;
  float err = b - (sum - a);
#endif
  return vec2(sum, err);
}

// General sum operation
vec2 twoSum(float a, float b) {
  float s = (a + b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE + (b - v);
#else
  float v = s - a;
  float err = (a - (s - v)) + (b - v);
#endif
  return vec2(s, err);
}

vec2 twoSub(float a, float b) {
  float s = (a - b);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float v = (s * fp64.ONE - a) * fp64.ONE;
  float err = (a - (s - v) * fp64.ONE) * fp64.ONE * fp64.ONE * fp64.ONE - (b + v);
#else
  float v = s - a;
  float err = (a - (s - v)) - (b + v);
#endif
  return vec2(s, err);
}

vec2 twoSqr(float a) {
  float prod = a * a;
  vec2 a_fp64 = split(a);
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  float err = ((a_fp64.x * a_fp64.x - prod) * fp64.ONE + 2.0 * a_fp64.x *
    a_fp64.y * fp64.ONE * fp64.ONE) + a_fp64.y * a_fp64.y * fp64.ONE * fp64.ONE * fp64.ONE;
#else
  float err = ((a_fp64.x * a_fp64.x - prod) + 2.0 * a_fp64.x * a_fp64.y) + a_fp64.y * a_fp64.y;
#endif
  return vec2(prod, err);
}

vec2 twoProd(float a, float b) {
  float prod = a * b;
  vec2 a_fp64 = split(a);
  vec2 b_fp64 = split(b);
  float err = ((a_fp64.x * b_fp64.x - prod) + a_fp64.x * b_fp64.y +
    a_fp64.y * b_fp64.x) + a_fp64.y * b_fp64.y;
  return vec2(prod, err);
}

vec2 sum_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSum(a.x, b.x);
  t = twoSum(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 sub_fp64(vec2 a, vec2 b) {
  vec2 s, t;
  s = twoSub(a.x, b.x);
  t = twoSub(a.y, b.y);
  s.y += t.x;
  s = quickTwoSum(s.x, s.y);
  s.y += t.y;
  s = quickTwoSum(s.x, s.y);
  return s;
}

vec2 mul_fp64(vec2 a, vec2 b) {
  vec2 prod = twoProd(a.x, b.x);
  // y component is for the error
  prod.y += a.x * b.y;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  prod.y += a.y * b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  prod = split2(prod);
#endif
  prod = quickTwoSum(prod.x, prod.y);
  return prod;
}

vec2 div_fp64(vec2 a, vec2 b) {
  float xn = 1.0 / b.x;
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  vec2 yn = mul_fp64(a, vec2(xn, 0));
#else
  vec2 yn = a * xn;
#endif
  float diff = (sub_fp64(a, mul_fp64(b, yn))).x;
  vec2 prod = twoProd(xn, diff);
  return sum_fp64(yn, prod);
}

vec2 sqrt_fp64(vec2 a) {
  if (a.x == 0.0 && a.y == 0.0) return vec2(0.0, 0.0);
  if (a.x < 0.0) return vec2(0.0 / 0.0, 0.0 / 0.0);

  float x = 1.0 / sqrt(a.x);
  float yn = a.x * x;
#if defined(LUMA_FP64_CODE_ELIMINATION_WORKAROUND)
  vec2 yn_sqr = twoSqr(yn) * fp64.ONE;
#else
  vec2 yn_sqr = twoSqr(yn);
#endif
  float diff = sub_fp64(a, yn_sqr).x;
  vec2 prod = twoProd(x * 0.5, diff);
#if defined(LUMA_FP64_HIGH_BITS_OVERFLOW_WORKAROUND)
  return sum_fp64(split(yn), prod);
#else
  return sum_fp64(vec2(yn, 0.0), prod);
#endif
}
`,defaultUniforms:{ONE:1},uniformTypes:{ONE:"f32"},fp64ify:eU,fp64LowPart:function(e){return e-Math.fround(e)},fp64ifyMatrix4:function(e){let t=new Float32Array(32);for(let r=0;r<4;++r)for(let i=0;i<4;++i){let s=4*r+i;eU(e[4*i+r],t,2*s)}return t}};function ek(e){let{source:t,target:r,start:i=0,size:s,getData:n}=e,o=e.end||r.length,a=t.length,l=o-i;if(a>l){r.set(t.subarray(0,l),i);return}if(r.set(t,i),!n)return;let h=a;for(;h<l;){let e=n(h,t);for(let t=0;t<s;t++)r[i+h]=e[t]||0,h++}}function eH(e){switch(e){case 1:return"float";case 2:return"vec2";case 3:return"vec3";case 4:return"vec4";default:throw Error(`No defined attribute type for size "${e}"`)}}function eV(e){switch(e){case 1:return"float32";case 2:return"float32x2";case 3:return"float32x3";case 4:return"float32x4";default:throw Error("invalid type size")}}function ej(e){e.push(e.shift())}function eW({device:e,source:t,target:r}){return(!r||r.byteLength<t.byteLength)&&(r?.destroy(),r=e.createBuffer({byteLength:t.byteLength,usage:t.usage})),r}function ez({device:e,buffer:t,attribute:r,fromLength:i,toLength:s,fromStartIndices:n,getData:o=e=>e}){let a=r.doublePrecision&&r.value instanceof Float64Array?2:1,l=r.size*a,h=r.byteOffset,u=r.settings.bytesPerElement<4?h/r.settings.bytesPerElement*4:h,c=r.startIndices,d=n&&c,f=r.isConstant;if(!d&&t&&i>=s)return t;let p=r.value instanceof Float64Array?Float32Array:r.value.constructor,g=f?r.value:new p(r.getBuffer().readSyncWebGL(h,s*p.BYTES_PER_ELEMENT).buffer);if(r.settings.normalized&&!f){let e=o;o=(t,i)=>r.normalizeConstant(e(t,i))}let m=f?(e,t)=>o(g,t):(e,t)=>o(g.subarray(e+h,e+h+l),t),_=new Float32Array(t?t.readSyncWebGL(u,4*i).buffer:0),A=new Float32Array(s);return!function({source:e,target:t,size:r,getData:i,sourceStartIndices:s,targetStartIndices:n}){if(!s||!n)return ek({source:e,target:t,size:r,getData:i});let o=0,a=0,l=i&&((e,t)=>i(e+a,t)),h=Math.min(s.length,n.length);for(let i=1;i<h;i++){let h=s[i]*r,u=n[i]*r;ek({source:e.subarray(o,h),target:t,start:a,end:u,size:r,getData:l}),o=h,a=u}a<t.length&&ek({source:[],target:t,start:a,size:r,getData:l})}({source:_,target:A,sourceStartIndices:n,targetStartIndices:c,size:l,getData:m}),(!t||t.byteLength<A.byteLength+u)&&(t?.destroy(),t=e.createBuffer({byteLength:A.byteLength+u,usage:35050})),t.write(A,u),t}var eX=r(86043);class eK{constructor({device:e,attribute:t,timeline:r}){this.buffers=[],this.currentLength=0,this.device=e,this.transition=new eX.A(r),this.attribute=t,this.attributeInTransition=function(e){let{device:t,settings:r,value:i}=e,s=new Z(t,r);return s.setData({value:i instanceof Float64Array?new Float64Array(0):new Float32Array(0),normalized:r.normalized}),s}(t),this.currentStartIndices=t.startIndices}get inProgress(){return this.transition.inProgress}start(e,t,r=1/0){this.settings=e,this.currentStartIndices=this.attribute.startIndices,this.currentLength=function(e,t){let{doublePrecision:r,settings:i,value:s,size:n}=e,o=r&&s instanceof Float64Array?2:1,a=0,{shaderAttributes:l}=e.settings;if(l)for(let e of Object.values(l))a=Math.max(a,e.vertexOffset??0);return(i.noAlloc?s.length:(t+a)*n)*o}(this.attribute,t),this.transition.start({...e,duration:r})}update(){let e=this.transition.update();return e&&this.onUpdate(),e}setBuffer(e){this.attributeInTransition.setData({buffer:e,normalized:this.attribute.settings.normalized,value:this.attributeInTransition.value})}cancel(){this.transition.cancel()}delete(){for(let e of(this.cancel(),this.buffers))e.destroy();this.buffers.length=0}}class eJ extends eK{constructor({device:e,attribute:t,timeline:r}){super({device:e,attribute:t,timeline:r}),this.type="interpolation",this.transform=function(e,t){let r=t.size,i=eH(r),s=eV(r),n=t.getBufferLayout();return eQ(t)?new eD(e,{vs:eq,bufferLayout:[{name:"aFrom",byteStride:8*r,attributes:[{attribute:"aFrom",format:s,byteOffset:0},{attribute:"aFrom64Low",format:s,byteOffset:4*r}]},{name:"aTo",byteStride:8*r,attributes:[{attribute:"aTo",format:s,byteOffset:0},{attribute:"aTo64Low",format:s,byteOffset:4*r}]}],modules:[eG,e$],defines:{ATTRIBUTE_TYPE:i,ATTRIBUTE_SIZE:r},moduleSettings:{},varyings:["vCurrent","vCurrent64Low"],bufferMode:35980,disableWarnings:!0}):new eD(e,{vs:eY,bufferLayout:[{name:"aFrom",format:s},{name:"aTo",format:n.attributes[0].format}],modules:[e$],defines:{ATTRIBUTE_TYPE:i},varyings:["vCurrent"],disableWarnings:!0})}(e,t)}start(e,t){let r=this.currentLength,i=this.currentStartIndices;if(super.start(e,t,e.duration),e.duration<=0){this.transition.cancel();return}let{buffers:s,attribute:n}=this;ej(s),s[0]=ez({device:this.device,buffer:s[0],attribute:n,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter}),s[1]=eW({device:this.device,source:s[0],target:s[1]}),this.setBuffer(s[1]);let{transform:o}=this,a=o.model,l=Math.floor(this.currentLength/n.size);eQ(n)&&(l/=2),a.setVertexCount(l),n.isConstant?(a.setAttributes({aFrom:s[0]}),a.setConstantAttributes({aTo:n.value})):a.setAttributes({aFrom:s[0],aTo:n.getBuffer()}),o.transformFeedback.setBuffers({vCurrent:s[1]})}onUpdate(){let{duration:e,easing:t}=this.settings,{time:r}=this.transition,i=r/e;t&&(i=t(i));let{model:s}=this.transform,n={time:i};s.shaderInputs.setProps({interpolation:n}),this.transform.run({discard:!0})}delete(){super.delete(),this.transform.destroy()}}let e$={name:"interpolation",vs:`\
uniform interpolationUniforms {
  float time;
} interpolation;
`,uniformTypes:{time:"f32"}},eY=`\
#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vCurrent;

void main(void) {
  vCurrent = mix(aFrom, aTo, interpolation.time);
  gl_Position = vec4(0.0);
}
`,eq=`\
#version 300 es
#define SHADER_NAME interpolation-transition-vertex-shader

in ATTRIBUTE_TYPE aFrom;
in ATTRIBUTE_TYPE aFrom64Low;
in ATTRIBUTE_TYPE aTo;
in ATTRIBUTE_TYPE aTo64Low;
out ATTRIBUTE_TYPE vCurrent;
out ATTRIBUTE_TYPE vCurrent64Low;

vec2 mix_fp64(vec2 a, vec2 b, float x) {
  vec2 range = sub_fp64(b, a);
  return sum_fp64(a, mul_fp64(range, vec2(x, 0.0)));
}

void main(void) {
  for (int i=0; i<ATTRIBUTE_SIZE; i++) {
    vec2 value = mix_fp64(vec2(aFrom[i], aFrom64Low[i]), vec2(aTo[i], aTo64Low[i]), interpolation.time);
    vCurrent[i] = value.x;
    vCurrent64Low[i] = value.y;
  }
  gl_Position = vec4(0.0);
}
`;function eQ(e){return e.doublePrecision&&e.value instanceof Float64Array}class eZ extends eK{constructor({device:e,attribute:t,timeline:r}){var i,s;super({device:e,attribute:t,timeline:r}),this.type="spring",this.texture=e.createTexture({data:new Uint8Array(4),format:"rgba8unorm",mipmaps:!1,width:1,height:1}),this.framebuffer=(i=e,s=this.texture,i.createFramebuffer({id:"spring-transition-is-transitioning-framebuffer",width:1,height:1,colorAttachments:[s]})),this.transform=function(e,t){let r=eH(t.size),i=eV(t.size);return new eD(e,{vs:e1,fs:e3,bufferLayout:[{name:"aPrev",format:i},{name:"aCur",format:i},{name:"aTo",format:t.getBufferLayout().attributes[0].format}],varyings:["vNext"],modules:[e0],defines:{ATTRIBUTE_TYPE:r},parameters:{depthCompare:"always",blendColorOperation:"max",blendColorSrcFactor:"one",blendColorDstFactor:"one",blendAlphaOperation:"max",blendAlphaSrcFactor:"one",blendAlphaDstFactor:"one"}})}(e,t)}start(e,t){let r=this.currentLength,i=this.currentStartIndices;super.start(e,t);let{buffers:s,attribute:n}=this;for(let t=0;t<2;t++)s[t]=ez({device:this.device,buffer:s[t],attribute:n,fromLength:r,toLength:this.currentLength,fromStartIndices:i,getData:e.enter});s[2]=eW({device:this.device,source:s[0],target:s[2]}),this.setBuffer(s[1]);let{model:o}=this.transform;o.setVertexCount(Math.floor(this.currentLength/n.size)),n.isConstant?o.setConstantAttributes({aTo:n.value}):o.setAttributes({aTo:n.getBuffer()})}onUpdate(){let{buffers:e,transform:t,framebuffer:r,transition:i}=this,s=this.settings;t.model.setAttributes({aPrev:e[0],aCur:e[1]}),t.transformFeedback.setBuffers({vNext:e[2]});let n={stiffness:s.stiffness,damping:s.damping};t.model.shaderInputs.setProps({spring:n}),t.run({framebuffer:r,discard:!1,parameters:{viewport:[0,0,1,1]},clearColor:[0,0,0,0]}),ej(e),this.setBuffer(e[1]),this.device.readPixelsToArrayWebGL(r)[0]>0||i.end()}delete(){super.delete(),this.transform.destroy(),this.texture.destroy(),this.framebuffer.destroy()}}let e0={name:"spring",vs:`\
uniform springUniforms {
  float damping;
  float stiffness;
} spring;
`,uniformTypes:{damping:"f32",stiffness:"f32"}},e1=`\
#version 300 es
#define SHADER_NAME spring-transition-vertex-shader

#define EPSILON 0.00001

in ATTRIBUTE_TYPE aPrev;
in ATTRIBUTE_TYPE aCur;
in ATTRIBUTE_TYPE aTo;
out ATTRIBUTE_TYPE vNext;
out float vIsTransitioningFlag;

ATTRIBUTE_TYPE getNextValue(ATTRIBUTE_TYPE cur, ATTRIBUTE_TYPE prev, ATTRIBUTE_TYPE dest) {
  ATTRIBUTE_TYPE velocity = cur - prev;
  ATTRIBUTE_TYPE delta = dest - cur;
  ATTRIBUTE_TYPE force = delta * spring.stiffness;
  ATTRIBUTE_TYPE resistance = velocity * spring.damping;
  return force - resistance + velocity + cur;
}

void main(void) {
  bool isTransitioning = length(aCur - aPrev) > EPSILON || length(aTo - aCur) > EPSILON;
  vIsTransitioningFlag = isTransitioning ? 1.0 : 0.0;

  vNext = getNextValue(aCur, aPrev, aTo);
  gl_Position = vec4(0, 0, 0, 1);
  gl_PointSize = 100.0;
}
`,e3=`\
#version 300 es
#define SHADER_NAME spring-transition-is-transitioning-fragment-shader

in float vIsTransitioningFlag;

out vec4 fragColor;

void main(void) {
  if (vIsTransitioningFlag == 0.0) {
    discard;
  }
  fragColor = vec4(1.0);
}`,e2={interpolation:eJ,spring:eZ};class e6{constructor(e,{id:t,timeline:r}){if(!e)throw Error("AttributeTransitionManager is constructed without device");this.id=t,this.device=e,this.timeline=r,this.transitions={},this.needsRedraw=!1,this.numInstances=1}finalize(){for(let e in this.transitions)this._removeTransition(e)}update({attributes:e,transitions:t,numInstances:r}){for(let i in this.numInstances=r||1,e){let r=e[i],s=r.getTransitionSetting(t);s&&this._updateAttribute(i,r,s)}for(let r in this.transitions){let i=e[r];i&&i.getTransitionSetting(t)||this._removeTransition(r)}}hasAttribute(e){let t=this.transitions[e];return t&&t.inProgress}getAttributes(){let e={};for(let t in this.transitions){let r=this.transitions[t];r.inProgress&&(e[t]=r.attributeInTransition)}return e}run(){if(0===this.numInstances)return!1;for(let e in this.transitions)this.transitions[e].update()&&(this.needsRedraw=!0);let e=this.needsRedraw;return this.needsRedraw=!1,e}_removeTransition(e){this.transitions[e].delete(),delete this.transitions[e]}_updateAttribute(e,t,r){let i=this.transitions[e],s=!i||i.type!==r.type;if(s){i&&this._removeTransition(e);let n=e2[r.type];n?this.transitions[e]=new n({attribute:t,timeline:this.timeline,device:this.device}):(k.A.error(`unsupported transition type '${r.type}'`)(),s=!1)}(s||t.needsRedraw())&&(this.needsRedraw=!0,this.transitions[e].start(r,this.numInstances))}}let e4="attributeManager.invalidate";class e8{constructor(e,{id:t="attribute-manager",stats:r,timeline:i}={}){this.mergeBoundsMemoized=(0,ee.A)(G._Z),this.id=t,this.device=e,this.attributes={},this.updateTriggers={},this.needsRedraw=!0,this.userData={},this.stats=r,this.attributeTransitionManager=new e6(e,{id:`${t}-transitions`,timeline:i}),Object.seal(this)}finalize(){for(let e in this.attributes)this.attributes[e].delete();this.attributeTransitionManager.finalize()}getNeedsRedraw(e={clearRedrawFlags:!1}){let t=this.needsRedraw;return this.needsRedraw=this.needsRedraw&&!e.clearRedrawFlags,t&&this.id}setNeedsRedraw(){this.needsRedraw=!0}add(e){this._add(e)}addInstanced(e){this._add(e,{stepMode:"instance"})}remove(e){for(let t of e)void 0!==this.attributes[t]&&(this.attributes[t].delete(),delete this.attributes[t])}invalidate(e,t){let r=this._invalidateTrigger(e,t);(0,et.A)(e4,this,e,r)}invalidateAll(e){for(let t in this.attributes)this.attributes[t].setNeedsUpdate(t,e);(0,et.A)(e4,this,"all")}update({data:e,numInstances:t,startIndices:r=null,transitions:i,props:s={},buffers:n={},context:o={}}){let a=!1;for(let i in(0,et.A)("attributeManager.updateStart",this),this.stats&&this.stats.get("Update Attributes").timeStart(),this.attributes){let l=this.attributes[i],h=l.settings.accessor;l.startIndices=r,l.numInstances=t,s[i]&&k.A.removed(`props.${i}`,`data.attributes.${i}`)(),l.setExternalBuffer(n[i])||l.setBinaryValue("string"==typeof h?n[h]:void 0,e.startIndices)||"string"==typeof h&&!n[h]&&l.setConstantValue(s[h])||l.needsUpdate()&&(a=!0,this._updateAttribute({attribute:l,numInstances:t,data:e,props:s,context:o})),this.needsRedraw=this.needsRedraw||l.needsRedraw()}a&&(0,et.A)("attributeManager.updateEnd",this,t),this.stats&&this.stats.get("Update Attributes").timeEnd(),this.attributeTransitionManager.update({attributes:this.attributes,numInstances:t,transitions:i})}updateTransition(){let{attributeTransitionManager:e}=this,t=e.run();return this.needsRedraw=this.needsRedraw||t,t}getAttributes(){return{...this.attributes,...this.attributeTransitionManager.getAttributes()}}getBounds(e){let t=e.map(e=>this.attributes[e]?.getBounds());return this.mergeBoundsMemoized(t)}getChangedAttributes(e={clearChangedFlags:!1}){let{attributes:t,attributeTransitionManager:r}=this,i={...r.getAttributes()};for(let s in t){let n=t[s];n.needsRedraw(e)&&!r.hasAttribute(s)&&(i[s]=n)}return i}getBufferLayouts(e){return Object.values(this.getAttributes()).map(t=>t.getBufferLayout(e))}_add(e,t){for(let r in e){let i=e[r],s={...i,id:r,size:i.isIndexed&&1||i.size||1,...t};this.attributes[r]=new Z(this.device,s)}this._mapUpdateTriggersToAttributes()}_mapUpdateTriggersToAttributes(){let e={};for(let t in this.attributes)this.attributes[t].getUpdateTriggers().forEach(r=>{e[r]||(e[r]=[]),e[r].push(t)});this.updateTriggers=e}_invalidateTrigger(e,t){let{attributes:r,updateTriggers:i}=this,s=i[e];return s&&s.forEach(e=>{let i=r[e];i&&i.setNeedsUpdate(i.id,t)}),s}_updateAttribute(e){let{attribute:t,numInstances:r}=e;if((0,et.A)("attribute.updateStart",t),t.constant){t.setConstantValue(t.value);return}t.allocate(r)&&(0,et.A)("attribute.allocate",t,r),t.updateBuffer(e)&&(this.needsRedraw=!0,(0,et.A)("attribute.updateEnd",t,r))}}var e9=r(75031);class e5 extends eX.A{get value(){return this._value}_onUpdate(){let{time:e,settings:{fromValue:t,toValue:r,duration:i,easing:s}}=this,n=s(e/i);this._value=(0,e9.Cc)(t,r,n)}}function e7(e,t,r,i,s){let n=t-e;return(r-t)*s+-n*i+n+t}function te(e,t){if(Array.isArray(e)){let r=0;for(let i=0;i<e.length;i++){let s=e[i]-t[i];r+=s*s}return Math.sqrt(r)}return Math.abs(e-t)}class tt extends eX.A{get value(){return this._currValue}_onUpdate(){let{fromValue:e,toValue:t,damping:r,stiffness:i}=this.settings,{_prevValue:s=e,_currValue:n=e}=this,o=function(e,t,r,i,s){if(Array.isArray(r)){let n=[];for(let o=0;o<r.length;o++)n[o]=e7(e[o],t[o],r[o],i,s);return n}return e7(e,t,r,i,s)}(s,n,t,r,i),a=te(o,t),l=te(o,n);a<1e-5&&l<1e-5&&(o=t,this.end()),this._prevValue=n,this._currValue=o}}let tr={interpolation:e5,spring:tt};class ti{constructor(e){this.transitions=new Map,this.timeline=e}get active(){return this.transitions.size>0}add(e,t,r,i){let{transitions:s}=this;if(s.has(e)){let r=s.get(e),{value:i=r.settings.fromValue}=r;t=i,this.remove(e)}if(!(i=Q(i)))return;let n=tr[i.type];if(!n){k.A.error(`unsupported transition type '${i.type}'`)();return}let o=new n(this.timeline);o.start({...i,fromValue:t,toValue:r}),s.set(e,o)}remove(e){let{transitions:t}=this;t.has(e)&&(t.get(e).cancel(),t.delete(e))}update(){let e={};for(let[t,r]of this.transitions)r.update(),e[t]=r.value,r.inProgress||this.remove(t);return e}clear(){for(let e of this.transitions.keys())this.remove(e)}}var ts=r(35761);function tn({newProps:e,oldProps:t,ignoreProps:r={},propTypes:i={},triggerName:s="props"}){if(t===e)return!1;if("object"!=typeof e||null===e||"object"!=typeof t||null===t)return`${s} changed shallowly`;for(let n of Object.keys(e))if(!(n in r)){if(!(n in t))return`${s}.${n} added`;let r=to(e[n],t[n],i[n]);if(r)return`${s}.${n} ${r}`}for(let n of Object.keys(t))if(!(n in r)){if(!(n in e))return`${s}.${n} dropped`;if(!Object.hasOwnProperty.call(e,n)){let r=to(e[n],t[n],i[n]);if(r)return`${s}.${n} ${r}`}}return!1}function to(e,t,r){let i=r&&r.equal;return i&&!i(e,t,r)||!i&&(i=e&&t&&e.equals)&&!i.call(e,t)?"changed deeply":i||t===e?null:"changed shallowly"}function ta(e,t,r){let i=e.updateTriggers[r];i=null==i?{}:i;let s=t.updateTriggers[r];return tn({oldProps:s=null==s?{}:s,newProps:i,triggerName:r})}function tl(e,t){if(!t)return e;let r={...e,...t};if("defines"in t&&(r.defines={...e.defines,...t.defines}),"modules"in t&&(r.modules=(e.modules||[]).concat(t.modules),t.modules.some(e=>"project64"===e.name))){let e=r.modules.findIndex(e=>"project32"===e.name);e>=0&&r.modules.splice(e,1)}if("inject"in t){if(e.inject){let i={...e.inject};for(let e in t.inject)i[e]=(i[e]||"")+t.inject[e];r.inject=i}else r.inject=t.inject}return r}var th=r(70709),tu=r(16186),tc=r(33176),td=r(36389),tf=r(81465);let tp=[0,0,0];function tg(e,t,r=!1){let i=t.projectPosition(e);if(r&&t instanceof tu.A){let[r,s,n=0]=e,o=t.getDistanceScales([r,s]);i[2]=n*o.unitsPerMeter[2]}return i}function tm(e,{viewport:t,modelMatrix:r,coordinateSystem:i,coordinateOrigin:s,offsetMode:n}){let[o,a,l=0]=e;switch(r&&([o,a,l]=tc.Z0([],[o,a,l,1],r)),i){case O.rf.LNGLAT:return tg([o,a,l],t,n);case O.rf.LNGLAT_OFFSETS:return tg([o+s[0],a+s[1],l+(s[2]||0)],t,n);case O.rf.METER_OFFSETS:return tg((0,tf.dT)(s,[o,a,l]),t,n);case O.rf.CARTESIAN:default:return t.isGeospatial?[o+s[0],a+s[1],l+s[2]]:t.projectPosition([o,a,l])}}let t_={minFilter:"linear",mipmapFilter:"linear",magFilter:"linear",addressModeU:"clamp-to-edge",addressModeV:"clamp-to-edge"},tA={};var tE=r(91852);let tb={boolean:{validate:(e,t)=>!0,equal:(e,t,r)=>!!e==!!t},number:{validate:(e,t)=>Number.isFinite(e)&&(!("max"in t)||e<=t.max)&&(!("min"in t)||e>=t.min)},color:{validate:(e,t)=>t.optional&&!e||tT(e)&&(3===e.length||4===e.length),equal:(e,t,r)=>(0,tE.b)(e,t,1)},accessor:{validate(e,t){let r=tC(e);return"function"===r||r===tC(t.value)},equal:(e,t,r)=>"function"==typeof t||(0,tE.b)(e,t,1)},array:{validate:(e,t)=>t.optional&&!e||tT(e),equal(e,t,r){let{compare:i}=r,s=Number.isInteger(i)?i:+!!i;return i?(0,tE.b)(e,t,s):e===t}},object:{equal(e,t,r){if(r.ignore)return!0;let{compare:i}=r,s=Number.isInteger(i)?i:+!!i;return i?(0,tE.b)(e,t,s):e===t}},function:{validate:(e,t)=>t.optional&&!e||"function"==typeof e,equal:(e,t,r)=>!r.compare&&!1!==r.ignore||e===t},data:{transform:(e,t,r)=>{if(!e)return e;let{dataTransform:i}=r.props;return i?i(e):"string"==typeof e.shape&&e.shape.endsWith("-table")&&Array.isArray(e.data)?e.data:e}},image:{transform:(e,t,r)=>{let i=r.context;return i&&i.device?function(e,t,r,i){if(r instanceof ep.g)return r;r.constructor&&"Object"!==r.constructor.name&&(r={data:r});let s=null;r.compressed&&(s={minFilter:"linear",mipmapFilter:r.data.length>1?"nearest":"linear"});let n=t.createTexture({...r,sampler:{...t_,...s,...i},mipmaps:!0});return tA[n.id]=e,n}(r.id,i.device,e,{...t.parameters,...r.props.textureParameters}):null},release:(e,t,r)=>{!function(e,t){t&&t instanceof ep.g&&tA[t.id]===e&&(t.delete(),delete tA[t.id])}(r.id,e)}}};function ty(e,t){return"type"in t?{name:e,...tb[t.type],...t}:"value"in t?{name:e,type:tC(t.value),...t}:{name:e,type:"object",value:t}}function tT(e){return Array.isArray(e)||ArrayBuffer.isView(e)}function tC(e){return tT(e)?"array":null===e?"null":typeof e}function tv(e,t){return Object.prototype.hasOwnProperty.call(e,t)}let tR=0;class tS{constructor(...e){this.props=function(e,t){let r;for(let e=t.length-1;e>=0;e--){let i=t[e];"extensions"in i&&(r=i.extensions)}let i=Object.create(function e(t,r){var i,s;if(!(t instanceof tB.constructor))return{};let n="_mergedDefaultProps";if(r)for(let e of r){let t=e.constructor;t&&(n+=`:${t.extensionName||t.name}`)}let o=tv(i=t,s=n)&&i[s];return o||(t[n]=function(t,r){if(!t.prototype)return null;let i=e(Object.getPrototypeOf(t)),s=function(e){let t={},r={},i={};for(let[s,n]of Object.entries(e)){let e=n?.deprecatedFor;if(e)i[s]=Array.isArray(e)?e:[e];else{let e=function(e,t){switch(tC(t)){case"object":return ty(e,t);case"array":return ty(e,{type:"array",value:t,compare:!1});case"boolean":return ty(e,{type:"boolean",value:t});case"number":return ty(e,{type:"number",value:t});case"function":return ty(e,{type:"function",value:t,compare:!0});default:return{name:e,type:"unknown",value:t}}}(s,n);t[s]=e,r[s]=e.value}}return{propTypes:t,defaultProps:r,deprecatedProps:i}}(function(e,t){return tv(e,t)&&e[t]}(t,"defaultProps")||{}),n=Object.assign(Object.create(null),i,s.defaultProps),o=Object.assign(Object.create(null),i?.[ts.fW],s.propTypes),a=Object.assign(Object.create(null),i?.[ts.uH],s.deprecatedProps);for(let t of r){let r=e(t.constructor);r&&(Object.assign(n,r),Object.assign(o,r[ts.fW]),Object.assign(a,r[ts.uH]))}return Object.defineProperties(n,{id:{writable:!0,value:function(e){let t=e.componentName;return t||k.A.warn(`${e.name}.componentName not specified`)(),t||e.name}(t)}}),function(e,t){let r={},i={};for(let e in t){let s=t[e],{name:n,value:o}=s;s.async&&(r[n]=o,i[n]=function(e){return{enumerable:!0,set(t){"string"==typeof t||t instanceof Promise||K(t)?this[ts.YN][e]=t:this[ts.vf][e]=t},get(){if(this[ts.vf]){if(e in this[ts.vf])return this[ts.vf][e]||this[ts.jA][e];if(e in this[ts.YN]){let t=this[ts.r3]&&this[ts.r3].internalState;if(t&&t.hasAsyncProp(e))return t.getAsyncProp(e)||this[ts.jA][e]}}return this[ts.jA][e]}}}(n))}e[ts.jA]=r,e[ts.YN]={},Object.defineProperties(e,i)}(n,o),function(e,t){for(let r in t)Object.defineProperty(e,r,{enumerable:!1,set(e){let i=`${this.id}: ${r}`;for(let i of t[r])tv(this,i)||(this[i]=e);k.A.deprecated(i,t[r].join("/"))()}})}(n,a),n[ts.fW]=o,n[ts.uH]=a,0!==r.length||tv(t,"_propTypes")||(t._propTypes=o),n}(t,r||[]))}(e.constructor,r));i[ts.r3]=e,i[ts.YN]={},i[ts.vf]={};for(let e=0;e<t.length;++e){let r=t[e];for(let e in r)i[e]=r[e]}return Object.freeze(i),i}(this,e),this.id=this.props.id,this.count=tR++}clone(e){let{props:t}=this,r={};for(let e in t[ts.jA])e in t[ts.vf]?r[e]=t[ts.vf][e]:e in t[ts.YN]&&(r[e]=t[ts.YN][e]);return new this.constructor({...t,...r,...e})}}tS.componentName="Component",tS.defaultProps={};let tB=tS,tw=Object.freeze({});class tM{constructor(e){this.component=e,this.asyncProps={},this.onAsyncPropUpdated=()=>{},this.oldProps=null,this.oldAsyncProps=null}finalize(){for(let e in this.asyncProps){let t=this.asyncProps[e];t&&t.type&&t.type.release&&t.type.release(t.resolvedValue,t.type,this.component)}this.asyncProps={},this.component=null,this.resetOldProps()}getOldProps(){return this.oldAsyncProps||this.oldProps||tw}resetOldProps(){this.oldAsyncProps=null,this.oldProps=this.component?this.component.props:null}hasAsyncProp(e){return e in this.asyncProps}getAsyncProp(e){let t=this.asyncProps[e];return t&&t.resolvedValue}isAsyncPropLoading(e){if(e){let t=this.asyncProps[e];return!!(t&&t.pendingLoadCount>0&&t.pendingLoadCount!==t.resolvedLoadCount)}for(let e in this.asyncProps)if(this.isAsyncPropLoading(e))return!0;return!1}reloadAsyncProp(e,t){this._watchPromise(e,Promise.resolve(t))}setAsyncProps(e){this.component=e[ts.r3]||this.component;let t=e[ts.vf]||{},r=e[ts.YN]||e,i=e[ts.jA]||{};for(let e in t){let r=t[e];this._createAsyncPropData(e,i[e]),this._updateAsyncProp(e,r),t[e]=this.getAsyncProp(e)}for(let e in r){let t=r[e];this._createAsyncPropData(e,i[e]),this._updateAsyncProp(e,t)}}_fetch(e,t){return null}_onResolve(e,t){}_onError(e,t){}_updateAsyncProp(e,t){if(this._didAsyncInputValueChange(e,t)){if("string"==typeof t&&(t=this._fetch(e,t)),t instanceof Promise){this._watchPromise(e,t);return}if(K(t)){this._resolveAsyncIterable(e,t);return}this._setPropValue(e,t)}}_freezeAsyncOldProps(){if(!this.oldAsyncProps&&this.oldProps)for(let e in this.oldAsyncProps=Object.create(this.oldProps),this.asyncProps)Object.defineProperty(this.oldAsyncProps,e,{enumerable:!0,value:this.oldProps[e]})}_didAsyncInputValueChange(e,t){let r=this.asyncProps[e];return t!==r.resolvedValue&&t!==r.lastValue&&(r.lastValue=t,!0)}_setPropValue(e,t){this._freezeAsyncOldProps();let r=this.asyncProps[e];r&&(r.resolvedValue=t=this._postProcessValue(r,t),r.pendingLoadCount++,r.resolvedLoadCount=r.pendingLoadCount)}_setAsyncPropValue(e,t,r){let i=this.asyncProps[e];i&&r>=i.resolvedLoadCount&&void 0!==t&&(this._freezeAsyncOldProps(),i.resolvedValue=t,i.resolvedLoadCount=r,this.onAsyncPropUpdated(e,t))}_watchPromise(e,t){let r=this.asyncProps[e];if(r){r.pendingLoadCount++;let i=r.pendingLoadCount;t.then(t=>{this.component&&(t=this._postProcessValue(r,t),this._setAsyncPropValue(e,t,i),this._onResolve(e,t))}).catch(t=>{this._onError(e,t)})}}async _resolveAsyncIterable(e,t){if("data"!==e){this._setPropValue(e,t);return}let r=this.asyncProps[e];if(!r)return;r.pendingLoadCount++;let i=r.pendingLoadCount,s=[],n=0;for await(let r of t){if(!this.component)return;let{dataTransform:t}=this.component.props;Object.defineProperty(s=t?t(r,s):s.concat(r),"__diff",{enumerable:!1,value:[{startRow:n,endRow:s.length}]}),n=s.length,this._setAsyncPropValue(e,s,i)}this._onResolve(e,s)}_postProcessValue(e,t){let r=e.type;return r&&this.component&&(r.release&&r.release(e.resolvedValue,r,this.component),r.transform)?r.transform(t,r,this.component):t}_createAsyncPropData(e,t){if(!this.asyncProps[e]){let r=this.component&&this.component.props[ts.fW];this.asyncProps[e]={type:r&&r[e],lastValue:null,resolvedValue:t,pendingLoadCount:0,resolvedLoadCount:0}}}}class tI extends tM{constructor({attributeManager:e,layer:t}){super(t),this.attributeManager=e,this.needsRedraw=!0,this.needsUpdate=!0,this.subLayers=null,this.usesPickingColorCache=!1}get layer(){return this.component}_fetch(e,t){let r=this.layer,i=r?.props.fetch;return i?i(t,{propName:e,layer:r}):super._fetch(e,t)}_onResolve(e,t){let r=this.layer;if(r){let i=r.props.onDataLoad;"data"===e&&i&&i(t,{propName:e,layer:r})}}_onError(e,t){let r=this.layer;r&&r.raiseError(t,`loading ${e} of ${this.layer}`)}}var tP=r(22662);let tL=Object.freeze([]),tO=(0,ee.A)(({oldViewport:e,viewport:t})=>e.equals(t)),tx=new Uint8ClampedArray(0),tN={data:{type:"data",value:tL,async:!0},dataComparator:{type:"function",value:null,optional:!0},_dataDiff:{type:"function",value:e=>e&&e.__diff,optional:!0},dataTransform:{type:"function",value:null,optional:!0},onDataLoad:{type:"function",value:null,optional:!0},onError:{type:"function",value:null,optional:!0},fetch:{type:"function",value:(e,{propName:t,layer:r,loaders:i,loadOptions:s,signal:n})=>{let{resourceManager:o}=r.context;s=s||r.getLoadOptions(),i=i||r.props.loaders,n&&(s={...s,fetch:{...s?.fetch,signal:n}});let a=o.contains(e);return(a||s||(o.add({resourceId:e,data:(0,tP.H)(e,i),persistent:!1}),a=!0),a)?o.subscribe({resourceId:e,onChange:e=>r.internalState?.reloadAsyncProp(t,e),consumerId:r.id,requestId:t}):(0,tP.H)(e,i,s)}},updateTriggers:{},visible:!0,pickable:!1,opacity:{type:"number",min:0,max:1,value:1},operation:"draw",onHover:{type:"function",value:null,optional:!0},onClick:{type:"function",value:null,optional:!0},onDragStart:{type:"function",value:null,optional:!0},onDrag:{type:"function",value:null,optional:!0},onDragEnd:{type:"function",value:null,optional:!0},coordinateSystem:O.rf.DEFAULT,coordinateOrigin:{type:"array",value:[0,0,0],compare:!0},modelMatrix:{type:"array",value:null,compare:!0,optional:!0},wrapLongitude:!1,positionFormat:"XYZ",colorFormat:"RGBA",parameters:{type:"object",value:{},optional:!0,compare:2},loadOptions:{type:"object",value:null,optional:!0,ignore:!0},transitions:null,extensions:[],loaders:{type:"array",value:[],optional:!0,ignore:!0},getPolygonOffset:{type:"function",value:({layerIndex:e})=>[0,-(100*e)]},highlightedObjectIndex:null,autoHighlight:!1,highlightColor:{type:"accessor",value:[0,0,128,128]}};class tF extends tB{constructor(){super(...arguments),this.internalState=null,this.lifecycle=ts.VD.NO_STATE,this.parent=null}static get componentName(){return Object.prototype.hasOwnProperty.call(this,"layerName")?this.layerName:""}get root(){let e=this;for(;e.parent;)e=e.parent;return e}toString(){let e=this.constructor.layerName||this.constructor.name;return`${e}({id: '${this.props.id}'})`}project(e){(0,j.A)(this.internalState);let t=this.internalState.viewport||this.context.viewport,r=tm(e,{viewport:t,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem}),[i,s,n]=(0,tf.VJ)(r,t.pixelProjectionMatrix);return 2===e.length?[i,s]:[i,s,n]}unproject(e){return(0,j.A)(this.internalState),(this.internalState.viewport||this.context.viewport).unproject(e)}projectPosition(e,t){return(0,j.A)(this.internalState),function(e,t){let{viewport:r,coordinateSystem:i,coordinateOrigin:s,modelMatrix:n,fromCoordinateSystem:o,fromCoordinateOrigin:a}=function(e){let{viewport:t,modelMatrix:r,coordinateOrigin:i}=e,{coordinateSystem:s,fromCoordinateSystem:n,fromCoordinateOrigin:o}=e;return s===O.rf.DEFAULT&&(s=t.isGeospatial?O.rf.LNGLAT:O.rf.CARTESIAN),void 0===n&&(n=s),void 0===o&&(o=i),{viewport:t,coordinateSystem:s,coordinateOrigin:i,modelMatrix:r,fromCoordinateSystem:n,fromCoordinateOrigin:o}}(t),{autoOffset:l=!0}=t,{geospatialOrigin:h=tp,shaderCoordinateOrigin:u=tp,offsetMode:c=!1}=l?(0,th.o)(r,i,s):{},d=tm(e,{viewport:r,modelMatrix:n,coordinateSystem:o,coordinateOrigin:a,offsetMode:c});if(c){let e=r.projectPosition(h||u);td.jb(d,d,e)}return d}(e,{viewport:this.internalState.viewport||this.context.viewport,modelMatrix:this.props.modelMatrix,coordinateOrigin:this.props.coordinateOrigin,coordinateSystem:this.props.coordinateSystem,...t})}get isComposite(){return!1}get isDrawable(){return!0}setState(e){this.setChangeFlags({stateChanged:!0}),Object.assign(this.state,e),this.setNeedsRedraw()}setNeedsRedraw(){this.internalState&&(this.internalState.needsRedraw=!0)}setNeedsUpdate(){this.internalState&&(this.context.layerManager.setNeedsUpdate(String(this)),this.internalState.needsUpdate=!0)}get isLoaded(){return!!this.internalState&&!this.internalState.isAsyncPropLoading()}get wrapLongitude(){return this.props.wrapLongitude}isPickable(){return this.props.pickable&&this.props.visible}getModels(){let e=this.state;return e&&(e.models||e.model&&[e.model])||[]}setShaderModuleProps(...e){for(let t of this.getModels())t.shaderInputs.setProps(...e)}getAttributeManager(){return this.internalState&&this.internalState.attributeManager}getCurrentLayer(){return this.internalState&&this.internalState.layer}getLoadOptions(){return this.props.loadOptions}use64bitPositions(){let{coordinateSystem:e}=this.props;return e===O.rf.DEFAULT||e===O.rf.LNGLAT||e===O.rf.CARTESIAN}onHover(e,t){return!!this.props.onHover&&(this.props.onHover(e,t)||!1)}onClick(e,t){return!!this.props.onClick&&(this.props.onClick(e,t)||!1)}nullPickingColor(){return[0,0,0]}encodePickingColor(e,t=[]){return t[0]=e+1&255,t[1]=e+1>>8&255,t[2]=e+1>>8>>8&255,t}decodePickingColor(e){(0,j.A)(e instanceof Uint8Array);let[t,r,i]=e;return t+256*r+65536*i-1}getNumInstances(){return Number.isFinite(this.props.numInstances)?this.props.numInstances:this.state&&void 0!==this.state.numInstances?this.state.numInstances:function(e){var t,r;if(null===(t=e)||"object"!=typeof t)throw Error("count(): argument not an object");if("function"==typeof e.count)return e.count();if(Number.isFinite(e.size))return e.size;if(Number.isFinite(e.length))return e.length;if(null!==(r=e)&&"object"==typeof r&&r.constructor===Object)return Object.keys(e).length;throw Error("count(): argument not a container")}(this.props.data)}getStartIndices(){return this.props.startIndices?this.props.startIndices:this.state&&this.state.startIndices?this.state.startIndices:null}getBounds(){return this.getAttributeManager()?.getBounds(["positions","instancePositions"])}getShaders(e){for(let t of(e=tl(e,{disableWarnings:!0,modules:this.context.defaultShaderModules}),this.props.extensions))e=tl(e,t.getShaders.call(this,t));return e}shouldUpdateState(e){return e.changeFlags.propsOrDataChanged}updateState(e){let t=this.getAttributeManager(),{dataChanged:r}=e.changeFlags;if(r&&t){if(Array.isArray(r))for(let e of r)t.invalidateAll(e);else t.invalidateAll()}if(t){let{props:r}=e,i=this.internalState.hasPickingBuffer,s=Number.isInteger(r.highlightedObjectIndex)||r.pickable||r.extensions.some(e=>e.getNeedsPickingBuffer.call(this,e));if(i!==s){this.internalState.hasPickingBuffer=s;let{pickingColors:e,instancePickingColors:r}=t.attributes,i=e||r;!i||(s&&i.constant&&(i.constant=!1,t.invalidate(i.id)),i.value||s||(i.constant=!0,i.value=[0,0,0]))}}}finalizeState(e){for(let e of this.getModels())e.destroy();let t=this.getAttributeManager();t&&t.finalize(),this.context&&this.context.resourceManager.unsubscribe({consumerId:this.id}),this.internalState&&(this.internalState.uniformTransitions.clear(),this.internalState.finalize())}draw(e){for(let t of this.getModels())t.draw(e.renderPass)}getPickingInfo({info:e,mode:t,sourceLayer:r}){let{index:i}=e;return i>=0&&Array.isArray(this.props.data)&&(e.object=this.props.data[i]),e}raiseError(e,t){t&&(e=Error(`${t}: ${e.message}`,{cause:e})),this.props.onError?.(e)||this.context?.onError?.(e,this)}getNeedsRedraw(e={clearRedrawFlags:!1}){return this._getNeedsRedraw(e)}needsUpdate(){return!!this.internalState&&(this.internalState.needsUpdate||this.hasUniformTransition()||this.shouldUpdateState(this._getUpdateParams()))}hasUniformTransition(){return this.internalState?.uniformTransitions.active||!1}activateViewport(e){if(!this.internalState)return;let t=this.internalState.viewport;this.internalState.viewport=e,t&&tO({oldViewport:t,viewport:e})||(this.setChangeFlags({viewportChanged:!0}),this.isComposite?this.needsUpdate()&&this.setNeedsUpdate():this._update())}invalidateAttribute(e="all"){let t=this.getAttributeManager();t&&("all"===e?t.invalidateAll():t.invalidate(e))}updateAttributes(e){let t=!1;for(let r in e)e[r].layoutChanged()&&(t=!0);for(let r of this.getModels())this._setModelAttributes(r,e,t)}_updateAttributes(){let e=this.getAttributeManager();if(!e)return;let t=this.props,r=this.getNumInstances(),i=this.getStartIndices();e.update({data:t.data,numInstances:r,startIndices:i,props:t,transitions:t.transitions,buffers:t.data.attributes,context:this});let s=e.getChangedAttributes({clearChangedFlags:!0});this.updateAttributes(s)}_updateAttributeTransition(){let e=this.getAttributeManager();e&&e.updateTransition()}_updateUniformTransition(){let{uniformTransitions:e}=this.internalState;if(e.active){let t=e.update(),r=Object.create(this.props);for(let e in t)Object.defineProperty(r,e,{value:t[e]});return r}return this.props}calculateInstancePickingColors(e,{numInstances:t}){if(e.constant)return;let r=Math.floor(tx.length/4);if(this.internalState.usesPickingColorCache=!0,r<t){t>0xffffff&&k.A.warn("Layer has too many data objects. Picking might not be able to distinguish all objects.")();let e=Math.floor((tx=U.A.allocate(tx,t,{size:4,copy:!0,maxCount:Math.max(t,0xffffff)})).length/4),i=[0,0,0];for(let t=r;t<e;t++)this.encodePickingColor(t,i),tx[4*t+0]=i[0],tx[4*t+1]=i[1],tx[4*t+2]=i[2],tx[4*t+3]=0}e.value=tx.subarray(0,4*t)}_setModelAttributes(e,t,r=!1){if(!Object.keys(t).length)return;if(r){let r=this.getAttributeManager();e.setBufferLayout(r.getBufferLayouts(e)),t=r.getAttributes()}let i=e.userData?.excludeAttributes||{},s={},n={};for(let r in t){if(i[r])continue;let o=t[r].getValue();for(let i in o){let a=o[i];a instanceof P.h?t[r].settings.isIndexed?e.setIndexBuffer(a):s[i]=a:a&&(n[i]=a)}}e.setAttributes(s),e.setConstantAttributes(n)}disablePickingIndex(e){let t=this.props.data;if(!("attributes"in t)){this._disablePickingIndex(e);return}let{pickingColors:r,instancePickingColors:i}=this.getAttributeManager().attributes,s=r||i,n=s&&t.attributes&&t.attributes[s.id];if(n&&n.value){let r=n.value,i=this.encodePickingColor(e);for(let e=0;e<t.length;e++){let t=s.getVertexOffset(e);r[t]===i[0]&&r[t+1]===i[1]&&r[t+2]===i[2]&&this._disablePickingIndex(e)}}else this._disablePickingIndex(e)}_disablePickingIndex(e){let{pickingColors:t,instancePickingColors:r}=this.getAttributeManager().attributes,i=t||r;if(!i)return;let s=i.getVertexOffset(e),n=i.getVertexOffset(e+1);i.buffer.write(new Uint8Array(n-s),s)}restorePickingColors(){let{pickingColors:e,instancePickingColors:t}=this.getAttributeManager().attributes,r=e||t;r&&(this.internalState.usesPickingColorCache&&r.value.buffer!==tx.buffer&&(r.value=tx.subarray(0,r.value.length)),r.updateSubBuffer({startOffset:0}))}_initialize(){(0,j.A)(!this.internalState),(0,j.A)(Number.isFinite(this.props.coordinateSystem)),(0,et.A)("layer.initialize",this);let e=this._getAttributeManager();for(let t of(e&&e.addInstanced({instancePickingColors:{type:"uint8",size:4,noAlloc:!0,update:this.calculateInstancePickingColors}}),this.internalState=new tI({attributeManager:e,layer:this}),this._clearChangeFlags(),this.state={},Object.defineProperty(this.state,"attributeManager",{get:()=>(k.A.deprecated("layer.state.attributeManager","layer.getAttributeManager()")(),e)}),this.internalState.uniformTransitions=new ti(this.context.timeline),this.internalState.onAsyncPropUpdated=this._onAsyncPropUpdated.bind(this),this.internalState.setAsyncProps(this.props),this.initializeState(this.context),this.props.extensions))t.initializeState.call(this,this.context,t);this.setChangeFlags({dataChanged:"init",propsChanged:"init",viewportChanged:!0,extensionsChanged:!0}),this._update()}_transferState(e){(0,et.A)("layer.matched",this,this===e);let{state:t,internalState:r}=e;this!==e&&(this.internalState=r,this.state=t,this.internalState.setAsyncProps(this.props),this._diffProps(this.props,this.internalState.getOldProps()))}_update(){let e=this.needsUpdate();if((0,et.A)("layer.update",this,e),!e)return;let t=this.props,r=this.context,i=this.internalState,s=r.viewport,n=this._updateUniformTransition();i.propsInTransition=n,r.viewport=i.viewport||s,this.props=n;try{let e=this._getUpdateParams(),t=this.getModels();if(r.device)this.updateState(e);else try{this.updateState(e)}catch(e){}for(let t of this.props.extensions)t.updateState.call(this,e,t);this.setNeedsRedraw(),this._updateAttributes();let i=this.getModels()[0]!==t[0];this._postUpdate(e,i)}finally{r.viewport=s,this.props=t,this._clearChangeFlags(),i.needsUpdate=!1,i.resetOldProps()}}_finalize(){for(let e of((0,et.A)("layer.finalize",this),this.finalizeState(this.context),this.props.extensions))e.finalizeState.call(this,this.context,e)}_drawLayer({renderPass:e,shaderModuleProps:t=null,uniforms:r={},parameters:i={}}){this._updateAttributeTransition();let s=this.props,n=this.context;this.props=this.internalState.propsInTransition||s;try{t&&this.setShaderModuleProps(t);let{getPolygonOffset:s}=this.props,o=s&&s(r)||[0,0];for(let e of(n.device instanceof L.e&&n.device.setParametersWebGL({polygonOffset:o}),this.getModels()))"webgpu"===e.device.type?e.setParameters({...e.parameters,...i}):e.setParameters(i);if(n.device instanceof L.e)n.device.withParametersWebGL(i,()=>{let s={renderPass:e,shaderModuleProps:t,uniforms:r,parameters:i,context:n};for(let e of this.props.extensions)e.draw.call(this,s,e);this.draw(s)});else{let s={renderPass:e,shaderModuleProps:t,uniforms:r,parameters:i,context:n};for(let e of this.props.extensions)e.draw.call(this,s,e);this.draw(s)}}finally{this.props=s}}getChangeFlags(){return this.internalState?.changeFlags}setChangeFlags(e){if(!this.internalState)return;let{changeFlags:t}=this.internalState;for(let r in e)if(e[r]){let i=!1;if("dataChanged"===r){let s=e[r],n=t[r];s&&Array.isArray(n)&&(t.dataChanged=Array.isArray(s)?n.concat(s):s,i=!0)}t[r]||(t[r]=e[r],i=!0),i&&(0,et.A)("layer.changeFlag",this,r,e)}let r=!!(t.dataChanged||t.updateTriggersChanged||t.propsChanged||t.extensionsChanged);t.propsOrDataChanged=r,t.somethingChanged=r||t.viewportChanged||t.stateChanged}_clearChangeFlags(){this.internalState.changeFlags={dataChanged:!1,propsChanged:!1,updateTriggersChanged:!1,viewportChanged:!1,stateChanged:!1,extensionsChanged:!1,propsOrDataChanged:!1,somethingChanged:!1}}_diffProps(e,t){let r=function(e,t){let r=tn({newProps:e,oldProps:t,propTypes:e[ts.fW],ignoreProps:{data:null,updateTriggers:null,extensions:null,transitions:null}}),i=function(e,t){if(null===t)return"oldProps is null, initial diff";let r=!1,{dataComparator:i,_dataDiff:s}=e;return i?i(e.data,t.data)||(r="Data comparator detected a change"):e.data!==t.data&&(r="A new data container was supplied"),r&&s&&(r=s(e.data,t.data)||r),r}(e,t),s=!1;return i||(s=function(e,t){if(null===t||"all"in e.updateTriggers&&ta(e,t,"all"))return{all:!0};let r={},i=!1;for(let s in e.updateTriggers)"all"!==s&&ta(e,t,s)&&(r[s]=!0,i=!0);return!!i&&r}(e,t)),{dataChanged:i,propsChanged:r,updateTriggersChanged:s,extensionsChanged:function(e,t){if(null===t)return!0;let r=t.extensions,{extensions:i}=e;if(i===r)return!1;if(!r||!i||i.length!==r.length)return!0;for(let e=0;e<i.length;e++)if(!i[e].equals(r[e]))return!0;return!1}(e,t),transitionsChanged:function(e,t){if(!e.transitions)return!1;let r={},i=e[ts.fW],s=!1;for(let n in e.transitions){let o=i[n],a=o&&o.type;("number"===a||"color"===a||"array"===a)&&to(e[n],t[n],o)&&(r[n]=!0,s=!0)}return!!s&&r}(e,t)}}(e,t);if(r.updateTriggersChanged)for(let e in r.updateTriggersChanged)r.updateTriggersChanged[e]&&this.invalidateAttribute(e);if(r.transitionsChanged)for(let i in r.transitionsChanged)this.internalState.uniformTransitions.add(i,t[i],e[i],e.transitions?.[i]);return this.setChangeFlags(r)}validateProps(){!function(e){let t=e[ts.fW];for(let r in t){let i=t[r],{validate:s}=i;if(s&&!s(e[r],i))throw Error(`Invalid prop ${r}: ${e[r]}`)}}(this.props)}updateAutoHighlight(e){this.props.autoHighlight&&!Number.isInteger(this.props.highlightedObjectIndex)&&this._updateAutoHighlight(e)}_updateAutoHighlight(e){let t={highlightedObjectColor:e.picked?e.color:null},{highlightColor:r}=this.props;e.picked&&"function"==typeof r&&(t.highlightColor=r(e)),this.setShaderModuleProps({picking:t}),this.setNeedsRedraw()}_getAttributeManager(){let e=this.context;return new e8(e.device,{id:this.props.id,stats:e.stats,timeline:e.timeline})}_postUpdate(e,t){let{props:r,oldProps:i}=e,s=this.state.model;s?.isInstanced&&s.setInstanceCount(this.getNumInstances());let{autoHighlight:n,highlightedObjectIndex:o,highlightColor:a}=r;if(t||i.autoHighlight!==n||i.highlightedObjectIndex!==o||i.highlightColor!==a){let e={};Array.isArray(a)&&(e.highlightColor=a),(t||i.autoHighlight!==n||o!==i.highlightedObjectIndex)&&(e.highlightedObjectColor=Number.isFinite(o)&&o>=0?this.encodePickingColor(o):null),this.setShaderModuleProps({picking:e})}}_getUpdateParams(){return{props:this.props,oldProps:this.internalState.getOldProps(),context:this.context,changeFlags:this.internalState.changeFlags}}_getNeedsRedraw(e){if(!this.internalState)return!1;let t=!1;t=this.internalState.needsRedraw&&this.id;let r=this.getAttributeManager(),i=!!r&&r.getNeedsRedraw(e);if(t=t||i)for(let e of this.props.extensions)e.onNeedsRedraw.call(this,e);return this.internalState.needsRedraw=this.internalState.needsRedraw&&!e.clearRedrawFlags,t}_onAsyncPropUpdated(){this._diffProps(this.props,this.internalState.getOldProps()),this.setNeedsUpdate()}}tF.defaultProps=tN,tF.layerName="Layer";let tD=tF;class tU extends tD{get isComposite(){return!0}get isDrawable(){return!1}get isLoaded(){return super.isLoaded&&this.getSubLayers().every(e=>e.isLoaded)}getSubLayers(){return this.internalState&&this.internalState.subLayers||[]}initializeState(e){}setState(e){super.setState(e),this.setNeedsUpdate()}getPickingInfo({info:e}){let{object:t}=e;return t&&t.__source&&t.__source.parent&&t.__source.parent.id===this.id&&(e.object=t.__source.object,e.index=t.__source.index),e}filterSubLayer(e){return!0}shouldRenderSubLayer(e,t){return t&&t.length}getSubLayerClass(e,t){let{_subLayerProps:r}=this.props;return r&&r[e]&&r[e].type||t}getSubLayerRow(e,t,r){return e.__source={parent:this,object:t,index:r},e}getSubLayerAccessor(e){if("function"==typeof e){let t={index:-1,data:this.props.data,target:[]};return(r,i)=>r&&r.__source?(t.index=r.__source.index,e(r.__source.object,t)):e(r,i)}return e}getSubLayerProps(e={}){let{opacity:t,pickable:r,visible:i,parameters:s,getPolygonOffset:n,highlightedObjectIndex:o,autoHighlight:a,highlightColor:l,coordinateSystem:h,coordinateOrigin:u,wrapLongitude:c,positionFormat:d,modelMatrix:f,extensions:p,fetch:g,operation:m,_subLayerProps:_}=this.props,A={id:"",updateTriggers:{},opacity:t,pickable:r,visible:i,parameters:s,getPolygonOffset:n,highlightedObjectIndex:o,autoHighlight:a,highlightColor:l,coordinateSystem:h,coordinateOrigin:u,wrapLongitude:c,positionFormat:d,modelMatrix:f,extensions:p,fetch:g,operation:m},E=_&&e.id&&_[e.id],b=E&&E.updateTriggers,y=e.id||"sublayer";if(E){let t=this.props[ts.fW],r=e.type?e.type._propTypes:{};for(let e in E){let i=r[e]||t[e];i&&"accessor"===i.type&&(E[e]=this.getSubLayerAccessor(E[e]))}}for(let t of(Object.assign(A,e,E),A.id=`${this.props.id}-${y}`,A.updateTriggers={all:this.props.updateTriggers?.all,...e.updateTriggers,...b},p)){let e=t.getSubLayerProps.call(this,t);e&&Object.assign(A,e,{updateTriggers:Object.assign(A.updateTriggers,e.updateTriggers)})}return A}_updateAutoHighlight(e){for(let t of this.getSubLayers())t.updateAutoHighlight(e)}_getAttributeManager(){return null}_postUpdate(e,t){let r=this.internalState.subLayers,i=!r||this.needsUpdate();if(i){let e=this.renderLayers();r=(0,J.B)(e,Boolean),this.internalState.subLayers=r}for(let e of((0,et.A)("compositeLayer.renderLayers",this,i,r),r))e.parent=this}}tU.layerName="CompositeLayer";let tG=tU;var tk=r(61059);let tH=`
vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset, out vec4 commonPosition
) {
  vec3 projectedPosition = project_position(position, position64Low);
  mat3 rotation;
  if (project_needs_rotation(projectedPosition, rotation)) {
    // offset is specified as ENU
    // when in globe projection, rotate offset so that the ground alighs with the surface of the globe
    offset = rotation * offset;
  }
  commonPosition = vec4(projectedPosition + offset, 1.0);
  return project_common_position_to_clipspace(commonPosition);
}

vec4 project_position_to_clipspace(
  vec3 position, vec3 position64Low, vec3 offset
) {
  vec4 commonPosition;
  return project_position_to_clipspace(position, position64Low, offset, commonPosition);
}
`,tV={name:"project32",dependencies:[tk.A],vs:tH},tj={props:{},uniforms:{},name:"picking",uniformTypes:{isActive:"f32",isAttribute:"f32",isHighlightActive:"f32",useFloatColors:"f32",highlightedObjectColor:"vec3<f32>",highlightColor:"vec4<f32>"},defaultUniforms:{isActive:!1,isAttribute:!1,isHighlightActive:!1,useFloatColors:!0,highlightedObjectColor:[0,0,0],highlightColor:[0,1,1,1]},vs:`\
uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

out vec4 picking_vRGBcolor_Avalid;

// Normalize unsigned byte color to 0-1 range
vec3 picking_normalizeColor(vec3 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

// Normalize unsigned byte color to 0-1 range
vec4 picking_normalizeColor(vec4 color) {
  return picking.useFloatColors > 0.5 ? color : color / 255.0;
}

bool picking_isColorZero(vec3 color) {
  return dot(color, vec3(1.0)) < 0.00001;
}

bool picking_isColorValid(vec3 color) {
  return dot(color, vec3(1.0)) > 0.00001;
}

// Check if this vertex is highlighted 
bool isVertexHighlighted(vec3 vertexColor) {
  vec3 highlightedObjectColor = picking_normalizeColor(picking.highlightedObjectColor);
  return
    bool(picking.isHighlightActive) && picking_isColorZero(abs(vertexColor - highlightedObjectColor));
}

// Set the current picking color
void picking_setPickingColor(vec3 pickingColor) {
  pickingColor = picking_normalizeColor(pickingColor);

  if (bool(picking.isActive)) {
    // Use alpha as the validity flag. If pickingColor is [0, 0, 0] fragment is non-pickable
    picking_vRGBcolor_Avalid.a = float(picking_isColorValid(pickingColor));

    if (!bool(picking.isAttribute)) {
      // Stores the picking color so that the fragment shader can render it during picking
      picking_vRGBcolor_Avalid.rgb = pickingColor;
    }
  } else {
    // Do the comparison with selected item color in vertex shader as it should mean fewer compares
    picking_vRGBcolor_Avalid.a = float(isVertexHighlighted(pickingColor));
  }
}

void picking_setPickingAttribute(float value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.r = value;
  }
}

void picking_setPickingAttribute(vec2 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rg = value;
  }
}

void picking_setPickingAttribute(vec3 value) {
  if (bool(picking.isAttribute)) {
    picking_vRGBcolor_Avalid.rgb = value;
  }
}
`,fs:`\
uniform pickingUniforms {
  float isActive;
  float isAttribute;
  float isHighlightActive;
  float useFloatColors;
  vec3 highlightedObjectColor;
  vec4 highlightColor;
} picking;

in vec4 picking_vRGBcolor_Avalid;

/*
 * Returns highlight color if this item is selected.
 */
vec4 picking_filterHighlightColor(vec4 color) {
  // If we are still picking, we don't highlight
  if (picking.isActive > 0.5) {
    return color;
  }

  bool selected = bool(picking_vRGBcolor_Avalid.a);

  if (selected) {
    // Blend in highlight color based on its alpha value
    float highLightAlpha = picking.highlightColor.a;
    float blendedAlpha = highLightAlpha + color.a * (1.0 - highLightAlpha);
    float highLightRatio = highLightAlpha / blendedAlpha;

    vec3 blendedRGB = mix(color.rgb, picking.highlightColor.rgb, highLightRatio);
    return vec4(blendedRGB, blendedAlpha);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 picking_filterPickingColor(vec4 color) {
  if (bool(picking.isActive)) {
    if (picking_vRGBcolor_Avalid.a == 0.0) {
      discard;
    }
    return picking_vRGBcolor_Avalid;
  }
  return color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 picking_filterColor(vec4 color) {
  vec4 highlightColor = picking_filterHighlightColor(color);
  return picking_filterPickingColor(highlightColor);
}
`,getUniforms:function(e={},t){let r={};if(void 0===e.highlightedObjectColor||(null===e.highlightedObjectColor?r.isHighlightActive=!1:(r.isHighlightActive=!0,r.highlightedObjectColor=e.highlightedObjectColor.slice(0,3))),e.highlightColor){let t=Array.from(e.highlightColor,e=>e/255);Number.isFinite(t[3])||(t[3]=1),r.highlightColor=t}return void 0!==e.isActive&&(r.isActive=!!e.isActive,r.isAttribute=!!e.isAttribute),void 0!==e.useFloatColors&&(r.useFloatColors=!!e.useFloatColors),r}},tW={...tj,defaultUniforms:{...tj.defaultUniforms,useFloatColors:!1},inject:{"vs:DECKGL_FILTER_GL_POSITION":`
    // for picking depth values
    picking_setPickingAttribute(position.z / position.w);
  `,"vs:DECKGL_FILTER_COLOR":`
  picking_setPickingColor(geometry.pickingColor);
  `,"fs:DECKGL_FILTER_COLOR":{order:99,injection:`
  // use highlight color if this fragment belongs to the selected object.
  color = picking_filterHighlightColor(color);

  // use picking color if rendering to picking FBO.
  color = picking_filterPickingColor(color);
    `}}},tz=`\
precision highp int;

// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  vec3 color;
};

struct PointLight {
  vec3 color;
  vec3 position;
  vec3 attenuation; // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  vec3 color;
  vec3 direction;
};

uniform lightingUniforms {
  int enabled;
  int lightType;

  int directionalLightCount;
  int pointLightCount;

  vec3 ambientColor;

  vec3 lightColor0;
  vec3 lightPosition0;
  vec3 lightDirection0;
  vec3 lightAttenuation0;

  vec3 lightColor1;
  vec3 lightPosition1;
  vec3 lightDirection1;
  vec3 lightAttenuation1;

  vec3 lightColor2;
  vec3 lightPosition2;
  vec3 lightDirection2;
  vec3 lightAttenuation2;
} lighting;

PointLight lighting_getPointLight(int index) {
  switch (index) {
    case 0:
      return PointLight(lighting.lightColor0, lighting.lightPosition0, lighting.lightAttenuation0);
    case 1:
      return PointLight(lighting.lightColor1, lighting.lightPosition1, lighting.lightAttenuation1);
    case 2:
    default:  
      return PointLight(lighting.lightColor2, lighting.lightPosition2, lighting.lightAttenuation2);
  }
}

DirectionalLight lighting_getDirectionalLight(int index) {
  switch (index) {
    case 0:
      return DirectionalLight(lighting.lightColor0, lighting.lightDirection0);
    case 1:
      return DirectionalLight(lighting.lightColor1, lighting.lightDirection1);
    case 2:
    default:   
      return DirectionalLight(lighting.lightColor2, lighting.lightDirection2);
  }
} 

float getPointLightAttenuation(PointLight pointLight, float distance) {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}

// #endif
`,tX=`\
// #if (defined(SHADER_TYPE_FRAGMENT) && defined(LIGHTING_FRAGMENT)) || (defined(SHADER_TYPE_VERTEX) && defined(LIGHTING_VERTEX))
struct AmbientLight {
  color: vec3<f32>,
};

struct PointLight {
  color: vec3<f32>,
  position: vec3<f32>,
  attenuation: vec3<f32>, // 2nd order x:Constant-y:Linear-z:Exponential
};

struct DirectionalLight {
  color: vec3<f32>,
  direction: vec3<f32>,
};

struct lightingUniforms {
  enabled: i32,
  poightCount: i32,
  directionalLightCount: i32,

  ambientColor: vec3<f32>,

  // TODO - support multiple lights by uncommenting arrays below
  lightType: i32,
  lightColor: vec3<f32>,
  lightDirection: vec3<f32>,
  lightPosition: vec3<f32>,
  lightAttenuation: vec3<f32>,

  // AmbientLight ambientLight;
  // PointLight pointLight[MAX_LIGHTS];
  // DirectionalLight directionalLight[MAX_LIGHTS];
};

// Binding 0:1 is reserved for lighting (Note: could go into separate bind group as it is stable across draw calls)
@binding(1) @group(0) var<uniform> lighting : lightingUniforms;

fn lighting_getPointLight(index: i32) -> PointLight {
  return PointLight(lighting.lightColor, lighting.lightPosition, lighting.lightAttenuation);
}

fn lighting_getDirectionalLight(index: i32) -> DirectionalLight {
  return DirectionalLight(lighting.lightColor, lighting.lightDirection);
} 

fn getPointLightAttenuation(pointLight: PointLight, distance: f32) -> f32 {
  return pointLight.attenuation.x
       + pointLight.attenuation.y * distance
       + pointLight.attenuation.z * distance * distance;
}
`;!function(e){e[e.POINT=0]="POINT",e[e.DIRECTIONAL=1]="DIRECTIONAL"}(h||(h={}));let tK={props:{},uniforms:{},name:"lighting",defines:{MAX_LIGHTS:3},uniformTypes:{enabled:"i32",lightType:"i32",directionalLightCount:"i32",pointLightCount:"i32",ambientLightColor:"vec3<f32>",lightColor0:"vec3<f32>",lightPosition0:"vec3<f32>",lightDirection0:"vec3<f32>",lightAttenuation0:"vec3<f32>",lightColor1:"vec3<f32>",lightPosition1:"vec3<f32>",lightDirection1:"vec3<f32>",lightAttenuation1:"vec3<f32>",lightColor2:"vec3<f32>",lightPosition2:"vec3<f32>",lightDirection2:"vec3<f32>",lightAttenuation2:"vec3<f32>"},defaultUniforms:{enabled:1,lightType:h.POINT,directionalLightCount:0,pointLightCount:0,ambientLightColor:[.1,.1,.1],lightColor0:[1,1,1],lightPosition0:[1,1,2],lightDirection0:[1,1,1],lightAttenuation0:[1,0,0],lightColor1:[1,1,1],lightPosition1:[1,1,2],lightDirection1:[1,1,1],lightAttenuation1:[1,0,0],lightColor2:[1,1,1],lightPosition2:[1,1,2],lightDirection2:[1,1,1],lightAttenuation2:[1,0,0]},source:tX,vs:tz,fs:tz,getUniforms:function(e,t={}){if(!(e=e?{...e}:e))return{...tK.defaultUniforms};e.lights&&(e={...e,...function(e){let t={pointLights:[],directionalLights:[]};for(let r of e||[])switch(r.type){case"ambient":t.ambientLight=r;break;case"directional":t.directionalLights?.push(r);break;case"point":t.pointLights?.push(r)}return t}(e.lights),lights:void 0});let{ambientLight:r,pointLights:i,directionalLights:s}=e||{};if(!(r||i&&i.length>0||s&&s.length>0))return{...tK.defaultUniforms,enabled:0};let n={...tK.defaultUniforms,...t,...function({ambientLight:e,pointLights:t=[],directionalLights:r=[]}){let i={};i.ambientLightColor=tJ(e);let s=0;for(let e of t){i.lightType=h.POINT;let t=s;i[`lightColor${t}`]=tJ(e),i[`lightPosition${t}`]=e.position,i[`lightAttenuation${t}`]=e.attenuation||[1,0,0],s++}for(let e of r){i.lightType=h.DIRECTIONAL;let t=s;i[`lightColor${t}`]=tJ(e),i[`lightDirection${t}`]=e.direction,s++}return s>3&&en.R.warn("MAX_LIGHTS exceeded")(),i.directionalLightCount=r.length,i.pointLightCount=t.length,i}({ambientLight:r,pointLights:i,directionalLights:s})};return void 0!==e.enabled&&(n.enabled=+!!e.enabled),n}};function tJ(e={}){let{color:t=[0,0,0],intensity:r=1}=e;return t.map(e=>e*r/255)}let t$=`\
uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;
`,tY=`\
uniform phongMaterialUniforms {
  uniform float ambient;
  uniform float diffuse;
  uniform float shininess;
  uniform vec3  specularColor;
} material;

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 light_direction, vec3 view_direction, vec3 normal_worldspace, vec3 color) {
  vec3 halfway_direction = normalize(light_direction + view_direction);
  float lambertian = dot(light_direction, normal_worldspace);
  float specular = 0.0;
  if (lambertian > 0.0) {
    float specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

vec3 lighting_getLightColor(vec3 surfaceColor, vec3 cameraPosition, vec3 position_worldspace, vec3 normal_worldspace) {
  vec3 lightColor = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  vec3 view_direction = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  for (int i = 0; i < lighting.pointLightCount; i++) {
    PointLight pointLight = lighting_getPointLight(i);
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    float light_attenuation = getPointLightAttenuation(pointLight, distance(light_position_worldspace, position_worldspace));
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color / light_attenuation);
  }

  int totalLights = min(MAX_LIGHTS, lighting.pointLightCount + lighting.directionalLightCount);
  for (int i = lighting.pointLightCount; i < totalLights; i++) {
    DirectionalLight directionalLight = lighting_getDirectionalLight(i);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
}
`,tq={props:{},name:"gouraudMaterial",vs:tY.replace("phongMaterial","gouraudMaterial"),fs:t$.replace("phongMaterial","gouraudMaterial"),defines:{LIGHTING_VERTEX:1},dependencies:[tK],uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){let t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map(e=>e/255)),{...tq.defaultUniforms,...t}}},tQ=`\
uniform pointCloudUniforms {
  float radiusPixels;
  highp int sizeUnits;
} pointCloud;
`,tZ={name:"pointCloud",vs:tQ,fs:tQ,uniformTypes:{radiusPixels:"f32",sizeUnits:"i32"}},t0=`\
#version 300 es
#define SHADER_NAME point-cloud-layer-vertex-shader
in vec3 positions;
in vec3 instanceNormals;
in vec4 instanceColors;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec3 instancePickingColors;
out vec4 vColor;
out vec2 unitPosition;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.normal = project_normal(instanceNormals);
unitPosition = positions.xy;
geometry.uv = unitPosition;
geometry.pickingColor = instancePickingColors;
vec3 offset = vec3(positions.xy * project_size_to_pixel(pointCloud.radiusPixels, pointCloud.sizeUnits), 0.0);
DECKGL_FILTER_SIZE(offset, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.), geometry.position);
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);
vec3 lightColor = lighting_getLightColor(instanceColors.rgb, project.cameraPosition, geometry.position.xyz, geometry.normal);
vColor = vec4(lightColor, instanceColors.a * layer.opacity);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,t1=`\
#version 300 es
#define SHADER_NAME point-cloud-layer-fragment-shader
precision highp float;
in vec4 vColor;
in vec2 unitPosition;
out vec4 fragColor;
void main(void) {
geometry.uv = unitPosition.xy;
float distToCenter = length(unitPosition);
if (distToCenter > 1.0) {
discard;
}
fragColor = vColor;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,t3=[0,0,0,255],t2=[0,0,1];class t6 extends tD{getShaders(){return super.getShaders({vs:t0,fs:t1,modules:[tV,tq,tW,tZ]})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceNormals:{size:3,transition:!0,accessor:"getNormal",defaultValue:t2},instanceColors:{size:this.props.colorFormat.length,type:"unorm8",transition:!0,accessor:"getColor",defaultValue:t3}})}updateState(e){let{changeFlags:t,props:r}=e;super.updateState(e),t.extensionsChanged&&(this.state.model?.destroy(),this.state.model=this._getModel(),this.getAttributeManager().invalidateAll()),t.dataChanged&&function(e){let{header:t,attributes:r}=e;if(t&&r&&(e.length=t.vertexCount,r.POSITION&&(r.instancePositions=r.POSITION),r.NORMAL&&(r.instanceNormals=r.NORMAL),r.COLOR_0)){let{size:e,value:t}=r.COLOR_0;r.instanceColors={size:e,type:"unorm8",value:t}}}(r.data)}draw({uniforms:e}){let{pointSize:t,sizeUnits:r}=this.props,i=this.state.model,s={sizeUnits:O.p5[r],radiusPixels:t};i.shaderInputs.setProps({pointCloud:s}),i.draw(this.context.renderPass)}_getModel(){let e=[];for(let t=0;t<3;t++){let r=t/3*Math.PI*2;e.push(2*Math.cos(r),2*Math.sin(r),0)}return new eN(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:new I({topology:"triangle-list",attributes:{positions:new Float32Array(e)}}),isInstanced:!0})}}t6.layerName="PointCloudLayer",t6.defaultProps={sizeUnits:"pixels",pointSize:{type:"number",min:0,value:10},getPosition:{type:"accessor",value:e=>e.position},getNormal:{type:"accessor",value:t2},getColor:{type:"accessor",value:t3},material:!0,radiusPixels:{deprecatedFor:"pointSize"}};let t4=`\
uniform pbrProjectionUniforms {
  mat4 modelViewProjectionMatrix;
  mat4 modelMatrix;
  mat4 normalMatrix;
  vec3 camera;
} pbrProjection;
`,t8={props:{},uniforms:{},name:"pbrMaterial",dependencies:[tK,{name:"pbrProjection",vs:t4,fs:t4,getUniforms:e=>e,uniformTypes:{modelViewProjectionMatrix:"mat4x4<f32>",modelMatrix:"mat4x4<f32>",normalMatrix:"mat4x4<f32>",camera:"vec3<i32>"}}],vs:`\
out vec3 pbr_vPosition;
out vec2 pbr_vUV;

#ifdef HAS_NORMALS
# ifdef HAS_TANGENTS
out mat3 pbr_vTBN;
# else
out vec3 pbr_vNormal;
# endif
#endif

void pbr_setPositionNormalTangentUV(vec4 position, vec4 normal, vec4 tangent, vec2 uv)
{
  vec4 pos = pbrProjection.modelMatrix * position;
  pbr_vPosition = vec3(pos.xyz) / pos.w;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
  vec3 normalW = normalize(vec3(pbrProjection.normalMatrix * vec4(normal.xyz, 0.0)));
  vec3 tangentW = normalize(vec3(pbrProjection.modelMatrix * vec4(tangent.xyz, 0.0)));
  vec3 bitangentW = cross(normalW, tangentW) * tangent.w;
  pbr_vTBN = mat3(tangentW, bitangentW, normalW);
#else // HAS_TANGENTS != 1
  pbr_vNormal = normalize(vec3(pbrProjection.modelMatrix * vec4(normal.xyz, 0.0)));
#endif
#endif

#ifdef HAS_UV
  pbr_vUV = uv;
#else
  pbr_vUV = vec2(0.,0.);
#endif
}
`,fs:`\
precision highp float;

uniform pbrMaterialUniforms {
  // Material is unlit
  bool unlit;

  // Base color map
  bool baseColorMapEnabled;
  vec4 baseColorFactor;

  bool normalMapEnabled;  
  float normalScale; // #ifdef HAS_NORMALMAP

  bool emissiveMapEnabled;
  vec3 emissiveFactor; // #ifdef HAS_EMISSIVEMAP

  vec2 metallicRoughnessValues;
  bool metallicRoughnessMapEnabled;

  bool occlusionMapEnabled;
  float occlusionStrength; // #ifdef HAS_OCCLUSIONMAP
  
  bool alphaCutoffEnabled;
  float alphaCutoff; // #ifdef ALPHA_CUTOFF
  
  // IBL
  bool IBLenabled;
  vec2 scaleIBLAmbient; // #ifdef USE_IBL
  
  // debugging flags used for shader output of intermediate PBR variables
  // #ifdef PBR_DEBUG
  vec4 scaleDiffBaseMR;
  vec4 scaleFGDSpec;
  // #endif
} pbrMaterial;

// Samplers
#ifdef HAS_BASECOLORMAP
uniform sampler2D pbr_baseColorSampler;
#endif
#ifdef HAS_NORMALMAP
uniform sampler2D pbr_normalSampler;
#endif
#ifdef HAS_EMISSIVEMAP
uniform sampler2D pbr_emissiveSampler;
#endif
#ifdef HAS_METALROUGHNESSMAP
uniform sampler2D pbr_metallicRoughnessSampler;
#endif
#ifdef HAS_OCCLUSIONMAP
uniform sampler2D pbr_occlusionSampler;
#endif
#ifdef USE_IBL
uniform samplerCube pbr_diffuseEnvSampler;
uniform samplerCube pbr_specularEnvSampler;
uniform sampler2D pbr_brdfLUT;
#endif

// Inputs from vertex shader

in vec3 pbr_vPosition;
in vec2 pbr_vUV;

#ifdef HAS_NORMALS
#ifdef HAS_TANGENTS
in mat3 pbr_vTBN;
#else
in vec3 pbr_vNormal;
#endif
#endif

// Encapsulate the various inputs used by the various functions in the shading equation
// We store values in this struct to simplify the integration of alternative implementations
// of the shading terms, outlined in the Readme.MD Appendix.
struct PBRInfo {
  float NdotL;                  // cos angle between normal and light direction
  float NdotV;                  // cos angle between normal and view direction
  float NdotH;                  // cos angle between normal and half vector
  float LdotH;                  // cos angle between light direction and half vector
  float VdotH;                  // cos angle between view direction and half vector
  float perceptualRoughness;    // roughness value, as authored by the model creator (input to shader)
  float metalness;              // metallic value at the surface
  vec3 reflectance0;            // full reflectance color (normal incidence angle)
  vec3 reflectance90;           // reflectance color at grazing angle
  float alphaRoughness;         // roughness mapped to a more linear change in the roughness (proposed by [2])
  vec3 diffuseColor;            // color contribution from diffuse lighting
  vec3 specularColor;           // color contribution from specular lighting
  vec3 n;                       // normal at surface point
  vec3 v;                       // vector from surface point to camera
};

const float M_PI = 3.141592653589793;
const float c_MinRoughness = 0.04;

vec4 SRGBtoLINEAR(vec4 srgbIn)
{
#ifdef MANUAL_SRGB
#ifdef SRGB_FAST_APPROXIMATION
  vec3 linOut = pow(srgbIn.xyz,vec3(2.2));
#else // SRGB_FAST_APPROXIMATION
  vec3 bLess = step(vec3(0.04045),srgbIn.xyz);
  vec3 linOut = mix( srgbIn.xyz/vec3(12.92), pow((srgbIn.xyz+vec3(0.055))/vec3(1.055),vec3(2.4)), bLess );
#endif //SRGB_FAST_APPROXIMATION
  return vec4(linOut,srgbIn.w);;
#else //MANUAL_SRGB
  return srgbIn;
#endif //MANUAL_SRGB
}

// Find the normal for this fragment, pulling either from a predefined normal map
// or from the interpolated mesh normal and tangent attributes.
vec3 getNormal()
{
  // Retrieve the tangent space matrix
#ifndef HAS_TANGENTS
  vec3 pos_dx = dFdx(pbr_vPosition);
  vec3 pos_dy = dFdy(pbr_vPosition);
  vec3 tex_dx = dFdx(vec3(pbr_vUV, 0.0));
  vec3 tex_dy = dFdy(vec3(pbr_vUV, 0.0));
  vec3 t = (tex_dy.t * pos_dx - tex_dx.t * pos_dy) / (tex_dx.s * tex_dy.t - tex_dy.s * tex_dx.t);

#ifdef HAS_NORMALS
  vec3 ng = normalize(pbr_vNormal);
#else
  vec3 ng = cross(pos_dx, pos_dy);
#endif

  t = normalize(t - ng * dot(ng, t));
  vec3 b = normalize(cross(ng, t));
  mat3 tbn = mat3(t, b, ng);
#else // HAS_TANGENTS
  mat3 tbn = pbr_vTBN;
#endif

#ifdef HAS_NORMALMAP
  vec3 n = texture(pbr_normalSampler, pbr_vUV).rgb;
  n = normalize(tbn * ((2.0 * n - 1.0) * vec3(pbrMaterial.normalScale, pbrMaterial.normalScale, 1.0)));
#else
  // The tbn matrix is linearly interpolated, so we need to re-normalize
  vec3 n = normalize(tbn[2].xyz);
#endif

  return n;
}

// Calculation of the lighting contribution from an optional Image Based Light source.
// Precomputed Environment Maps are required uniform inputs and are computed as outlined in [1].
// See our README.md on Environment Maps [3] for additional discussion.
#ifdef USE_IBL
vec3 getIBLContribution(PBRInfo pbrInfo, vec3 n, vec3 reflection)
{
  float mipCount = 9.0; // resolution of 512x512
  float lod = (pbrInfo.perceptualRoughness * mipCount);
  // retrieve a scale and bias to F0. See [1], Figure 3
  vec3 brdf = SRGBtoLINEAR(texture(pbr_brdfLUT,
    vec2(pbrInfo.NdotV, 1.0 - pbrInfo.perceptualRoughness))).rgb;
  vec3 diffuseLight = SRGBtoLINEAR(texture(pbr_diffuseEnvSampler, n)).rgb;

#ifdef USE_TEX_LOD
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection, lod)).rgb;
#else
  vec3 specularLight = SRGBtoLINEAR(texture(pbr_specularEnvSampler, reflection)).rgb;
#endif

  vec3 diffuse = diffuseLight * pbrInfo.diffuseColor;
  vec3 specular = specularLight * (pbrInfo.specularColor * brdf.x + brdf.y);

  // For presentation, this allows us to disable IBL terms
  diffuse *= pbrMaterial.scaleIBLAmbient.x;
  specular *= pbrMaterial.scaleIBLAmbient.y;

  return diffuse + specular;
}
#endif

// Basic Lambertian diffuse
// Implementation from Lambert's Photometria https://archive.org/details/lambertsphotome00lambgoog
// See also [1], Equation 1
vec3 diffuse(PBRInfo pbrInfo)
{
  return pbrInfo.diffuseColor / M_PI;
}

// The following equation models the Fresnel reflectance term of the spec equation (aka F())
// Implementation of fresnel from [4], Equation 15
vec3 specularReflection(PBRInfo pbrInfo)
{
  return pbrInfo.reflectance0 +
    (pbrInfo.reflectance90 - pbrInfo.reflectance0) *
    pow(clamp(1.0 - pbrInfo.VdotH, 0.0, 1.0), 5.0);
}

// This calculates the specular geometric attenuation (aka G()),
// where rougher material will reflect less light back to the viewer.
// This implementation is based on [1] Equation 4, and we adopt their modifications to
// alphaRoughness as input as originally proposed in [2].
float geometricOcclusion(PBRInfo pbrInfo)
{
  float NdotL = pbrInfo.NdotL;
  float NdotV = pbrInfo.NdotV;
  float r = pbrInfo.alphaRoughness;

  float attenuationL = 2.0 * NdotL / (NdotL + sqrt(r * r + (1.0 - r * r) * (NdotL * NdotL)));
  float attenuationV = 2.0 * NdotV / (NdotV + sqrt(r * r + (1.0 - r * r) * (NdotV * NdotV)));
  return attenuationL * attenuationV;
}

// The following equation(s) model the distribution of microfacet normals across
// the area being drawn (aka D())
// Implementation from "Average Irregularity Representation of a Roughened Surface
// for Ray Reflection" by T. S. Trowbridge, and K. P. Reitz
// Follows the distribution function recommended in the SIGGRAPH 2013 course notes
// from EPIC Games [1], Equation 3.
float microfacetDistribution(PBRInfo pbrInfo)
{
  float roughnessSq = pbrInfo.alphaRoughness * pbrInfo.alphaRoughness;
  float f = (pbrInfo.NdotH * roughnessSq - pbrInfo.NdotH) * pbrInfo.NdotH + 1.0;
  return roughnessSq / (M_PI * f * f);
}

void PBRInfo_setAmbientLight(inout PBRInfo pbrInfo) {
  pbrInfo.NdotL = 1.0;
  pbrInfo.NdotH = 0.0;
  pbrInfo.LdotH = 0.0;
  pbrInfo.VdotH = 1.0;
}

void PBRInfo_setDirectionalLight(inout PBRInfo pbrInfo, vec3 lightDirection) {
  vec3 n = pbrInfo.n;
  vec3 v = pbrInfo.v;
  vec3 l = normalize(lightDirection);             // Vector from surface point to light
  vec3 h = normalize(l+v);                        // Half vector between both l and v

  pbrInfo.NdotL = clamp(dot(n, l), 0.001, 1.0);
  pbrInfo.NdotH = clamp(dot(n, h), 0.0, 1.0);
  pbrInfo.LdotH = clamp(dot(l, h), 0.0, 1.0);
  pbrInfo.VdotH = clamp(dot(v, h), 0.0, 1.0);
}

void PBRInfo_setPointLight(inout PBRInfo pbrInfo, PointLight pointLight) {
  vec3 light_direction = normalize(pointLight.position - pbr_vPosition);
  PBRInfo_setDirectionalLight(pbrInfo, light_direction);
}

vec3 calculateFinalColor(PBRInfo pbrInfo, vec3 lightColor) {
  // Calculate the shading terms for the microfacet specular shading model
  vec3 F = specularReflection(pbrInfo);
  float G = geometricOcclusion(pbrInfo);
  float D = microfacetDistribution(pbrInfo);

  // Calculation of analytical lighting contribution
  vec3 diffuseContrib = (1.0 - F) * diffuse(pbrInfo);
  vec3 specContrib = F * G * D / (4.0 * pbrInfo.NdotL * pbrInfo.NdotV);
  // Obtain final intensity as reflectance (BRDF) scaled by the energy of the light (cosine law)
  return pbrInfo.NdotL * lightColor * (diffuseContrib + specContrib);
}

vec4 pbr_filterColor(vec4 colorUnused)
{
  // The albedo may be defined from a base texture or a flat color
#ifdef HAS_BASECOLORMAP
  vec4 baseColor = SRGBtoLINEAR(texture(pbr_baseColorSampler, pbr_vUV)) * pbrMaterial.baseColorFactor;
#else
  vec4 baseColor = pbrMaterial.baseColorFactor;
#endif

#ifdef ALPHA_CUTOFF
  if (baseColor.a < pbrMaterial.alphaCutoff) {
    discard;
  }
#endif

  vec3 color = vec3(0, 0, 0);

  if(pbrMaterial.unlit){
    color.rgb = baseColor.rgb;
  }
  else{
    // Metallic and Roughness material properties are packed together
    // In glTF, these factors can be specified by fixed scalar values
    // or from a metallic-roughness map
    float perceptualRoughness = pbrMaterial.metallicRoughnessValues.y;
    float metallic = pbrMaterial.metallicRoughnessValues.x;
#ifdef HAS_METALROUGHNESSMAP
    // Roughness is stored in the 'g' channel, metallic is stored in the 'b' channel.
    // This layout intentionally reserves the 'r' channel for (optional) occlusion map data
    vec4 mrSample = texture(pbr_metallicRoughnessSampler, pbr_vUV);
    perceptualRoughness = mrSample.g * perceptualRoughness;
    metallic = mrSample.b * metallic;
#endif
    perceptualRoughness = clamp(perceptualRoughness, c_MinRoughness, 1.0);
    metallic = clamp(metallic, 0.0, 1.0);
    // Roughness is authored as perceptual roughness; as is convention,
    // convert to material roughness by squaring the perceptual roughness [2].
    float alphaRoughness = perceptualRoughness * perceptualRoughness;

    vec3 f0 = vec3(0.04);
    vec3 diffuseColor = baseColor.rgb * (vec3(1.0) - f0);
    diffuseColor *= 1.0 - metallic;
    vec3 specularColor = mix(f0, baseColor.rgb, metallic);

    // Compute reflectance.
    float reflectance = max(max(specularColor.r, specularColor.g), specularColor.b);

    // For typical incident reflectance range (between 4% to 100%) set the grazing
    // reflectance to 100% for typical fresnel effect.
    // For very low reflectance range on highly diffuse objects (below 4%),
    // incrementally reduce grazing reflecance to 0%.
    float reflectance90 = clamp(reflectance * 25.0, 0.0, 1.0);
    vec3 specularEnvironmentR0 = specularColor.rgb;
    vec3 specularEnvironmentR90 = vec3(1.0, 1.0, 1.0) * reflectance90;

    vec3 n = getNormal();                          // normal at surface point
    vec3 v = normalize(pbrProjection.camera - pbr_vPosition);  // Vector from surface point to camera

    float NdotV = clamp(abs(dot(n, v)), 0.001, 1.0);
    vec3 reflection = -normalize(reflect(v, n));

    PBRInfo pbrInfo = PBRInfo(
      0.0, // NdotL
      NdotV,
      0.0, // NdotH
      0.0, // LdotH
      0.0, // VdotH
      perceptualRoughness,
      metallic,
      specularEnvironmentR0,
      specularEnvironmentR90,
      alphaRoughness,
      diffuseColor,
      specularColor,
      n,
      v
    );


#ifdef USE_LIGHTS
    // Apply ambient light
    PBRInfo_setAmbientLight(pbrInfo);
    color += calculateFinalColor(pbrInfo, lighting.ambientColor);

    // Apply directional light
    for(int i = 0; i < lighting.directionalLightCount; i++) {
      if (i < lighting.directionalLightCount) {
        PBRInfo_setDirectionalLight(pbrInfo, lighting_getDirectionalLight(i).direction);
        color += calculateFinalColor(pbrInfo, lighting_getDirectionalLight(i).color);
      }
    }

    // Apply point light
    for(int i = 0; i < lighting.pointLightCount; i++) {
      if (i < lighting.pointLightCount) {
        PBRInfo_setPointLight(pbrInfo, lighting_getPointLight(i));
        float attenuation = getPointLightAttenuation(lighting_getPointLight(i), distance(lighting_getPointLight(i).position, pbr_vPosition));
        color += calculateFinalColor(pbrInfo, lighting_getPointLight(i).color / attenuation);
      }
    }
#endif

    // Calculate lighting contribution from image based lighting source (IBL)
#ifdef USE_IBL
    if (pbrMaterial.IBLenabled) {
      color += getIBLContribution(pbrInfo, n, reflection);
    }
#endif

 // Apply optional PBR terms for additional (optional) shading
#ifdef HAS_OCCLUSIONMAP
    if (pbrMaterial.occlusionMapEnabled) {
      float ao = texture(pbr_occlusionSampler, pbr_vUV).r;
      color = mix(color, color * ao, pbrMaterial.occlusionStrength);
    }
#endif

#ifdef HAS_EMISSIVEMAP
    if (pbrMaterial.emissiveMapEnabled) {
      vec3 emissive = SRGBtoLINEAR(texture(pbr_emissiveSampler, pbr_vUV)).rgb * pbrMaterial.emissiveFactor;
      color += emissive;
    }
#endif

    // This section uses mix to override final color for reference app visualization
    // of various parameters in the lighting equation.
#ifdef PBR_DEBUG
    // TODO: Figure out how to debug multiple lights

    // color = mix(color, F, pbr_scaleFGDSpec.x);
    // color = mix(color, vec3(G), pbr_scaleFGDSpec.y);
    // color = mix(color, vec3(D), pbr_scaleFGDSpec.z);
    // color = mix(color, specContrib, pbr_scaleFGDSpec.w);

    // color = mix(color, diffuseContrib, pbr_scaleDiffBaseMR.x);
    color = mix(color, baseColor.rgb, pbrMaterial.scaleDiffBaseMR.y);
    color = mix(color, vec3(metallic), pbrMaterial.scaleDiffBaseMR.z);
    color = mix(color, vec3(perceptualRoughness), pbrMaterial.scaleDiffBaseMR.w);
#endif

  }

  return vec4(pow(color,vec3(1.0/2.2)), baseColor.a);
}
`,defines:{LIGHTING_FRAGMENT:1},getUniforms:e=>e,uniformTypes:{unlit:"i32",baseColorMapEnabled:"i32",baseColorFactor:"vec4<f32>",normalMapEnabled:"i32",normalScale:"f32",emissiveMapEnabled:"i32",emissiveFactor:"vec3<f32>",metallicRoughnessValues:"vec2<f32>",metallicRoughnessMapEnabled:"i32",occlusionMapEnabled:"i32",occlusionStrength:"f32",alphaCutoffEnabled:"i32",alphaCutoff:"f32",IBLenabled:"i32",scaleIBLAmbient:"vec2<f32>",scaleDiffBaseMR:"vec4<f32>",scaleFGDSpec:"vec4<f32>"}};var t9=r(74502),t5=r(1673);class t7{id;matrix=new t9.k;display=!0;position=new t5.P;rotation=new t5.P;scale=new t5.P(1,1,1);userData={};props={};constructor(e={}){let{id:t}=e;this.id=t||M(this.constructor.name),this._setScenegraphNodeProps(e)}getBounds(){return null}destroy(){}delete(){this.destroy()}setProps(e){return this._setScenegraphNodeProps(e),this}toString(){return`{type: ScenegraphNode, id: ${this.id})}`}setPosition(e){return this.position=e,this}setRotation(e){return this.rotation=e,this}setScale(e){return this.scale=e,this}setMatrix(e,t=!0){t?this.matrix.copy(e):this.matrix=e}setMatrixComponents(e){let{position:t,rotation:r,scale:i,update:s=!0}=e;return t&&this.setPosition(t),r&&this.setRotation(r),i&&this.setScale(i),s&&this.updateMatrix(),this}updateMatrix(){let e=this.position,t=this.rotation,r=this.scale;return this.matrix.identity(),this.matrix.translate(e),this.matrix.rotateXYZ(t),this.matrix.scale(r),this}update(e={}){let{position:t,rotation:r,scale:i}=e;return t&&this.setPosition(t),r&&this.setRotation(r),i&&this.setScale(i),this.updateMatrix(),this}getCoordinateUniforms(e,t){t=t||this.matrix;let r=new t9.k(e).multiplyRight(t),i=r.invert(),s=i.transpose();return{viewMatrix:e,modelMatrix:t,objectMatrix:t,worldMatrix:r,worldInverseMatrix:i,worldInverseTransposeMatrix:s}}_setScenegraphNodeProps(e){"position"in e&&this.setPosition(e.position),"rotation"in e&&this.setRotation(e.rotation),"scale"in e&&this.setScale(e.scale),"matrix"in e&&this.setMatrix(e.matrix),Object.assign(this.props,e)}}class re extends t7{children;constructor(e={}){let{children:t=[]}=e=Array.isArray(e)?{children:e}:e;en.R.assert(t.every(e=>e instanceof t7),"every child must an instance of ScenegraphNode"),super(e),this.children=t}getBounds(){let e=[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]];return(this.traverse((t,{worldMatrix:r})=>{let i=t.getBounds();if(!i)return;let[s,n]=i,o=new t5.P(s).add(n).divide([2,2,2]);r.transformAsPoint(o,o);let a=new t5.P(n).subtract(s).divide([2,2,2]);r.transformAsVector(a,a);for(let t=0;t<8;t++){let r=new t5.P(1&t?-1:1,2&t?-1:1,4&t?-1:1).multiply(a).add(o);for(let t=0;t<3;t++)e[0][t]=Math.min(e[0][t],r[t]),e[1][t]=Math.max(e[1][t],r[t])}}),Number.isFinite(e[0][0]))?e:null}destroy(){this.children.forEach(e=>e.destroy()),this.removeAll(),super.destroy()}add(...e){for(let t of e)Array.isArray(t)?this.add(...t):this.children.push(t);return this}remove(e){let t=this.children,r=t.indexOf(e);return r>-1&&t.splice(r,1),this}removeAll(){return this.children=[],this}traverse(e,{worldMatrix:t=new t9.k}={}){let r=new t9.k(t).multiplyRight(this.matrix);for(let t of this.children)t instanceof re?t.traverse(e,{worldMatrix:r}):e(t,{worldMatrix:r})}}class rt extends t7{model;bounds=null;managedResources;constructor(e){super(e),this.model=e.model,this.managedResources=e.managedResources||[],this.bounds=e.bounds||null,this.setProps(e)}destroy(){this.model&&(this.model.destroy(),this.model=null),this.managedResources.forEach(e=>e.destroy()),this.managedResources=[]}getBounds(){return this.bounds}draw(e){return this.model.draw(e)}}var rr=r(5229),ri=r(73801),rs=r(70715),rn=r(53028);class ro extends rn.M{static get ZERO(){return i||Object.freeze(i=new ro(0,0,0,0)),i}constructor(e=0,t=0,r=0,i=0){super(-0,-0,-0,-0),(0,e9.cy)(e)&&1==arguments.length?this.copy(e):(e9.$W.debug&&((0,ri.ws)(e),(0,ri.ws)(t),(0,ri.ws)(r),(0,ri.ws)(i)),this[0]=e,this[1]=t,this[2]=r,this[3]=i)}set(e,t,r,i){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}fromObject(e){return e9.$W.debug&&((0,ri.ws)(e.x),(0,ri.ws)(e.y),(0,ri.ws)(e.z),(0,ri.ws)(e.w)),this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this}toObject(e){return e.x=this[0],e.y=this[1],e.z=this[2],e.w=this[3],e}get ELEMENTS(){return 4}get z(){return this[2]}set z(e){this[2]=(0,ri.ws)(e)}get w(){return this[3]}set w(e){this[3]=(0,ri.ws)(e)}transform(e){return(0,td.Z0)(this,this,e),this.check()}transformByMatrix3(e){return(0,rs.vE)(this,this,e),this.check()}transformByMatrix2(e){return(0,rs.Cg)(this,this,e),this.check()}transformByQuaternion(e){return(0,td.gL)(this,this,e),this.check()}applyMatrix4(e){return e.transform(this,this),this}}var ra=r(31303);function rl(e,t,r){let i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],h=t[6],u=t[7],c=t[8],d=r[0],f=r[1],p=r[2],g=r[3],m=r[4],_=r[5],A=r[6],E=r[7],b=r[8];return e[0]=d*i+f*o+p*h,e[1]=d*s+f*a+p*u,e[2]=d*n+f*l+p*c,e[3]=g*i+m*o+_*h,e[4]=g*s+m*a+_*u,e[5]=g*n+m*l+_*c,e[6]=A*i+E*o+b*h,e[7]=A*s+E*a+b*u,e[8]=A*n+E*l+b*c,e}function rh(e,t,r){let i=r[0],s=r[1];return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=s*t[3],e[4]=s*t[4],e[5]=s*t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e}function ru(){let e=new ra.tb(4);return ra.tb!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function rc(e,t,r){let i=Math.sin(r*=.5);return e[0]=i*t[0],e[1]=i*t[1],e[2]=i*t[2],e[3]=Math.cos(r),e}function rd(e,t,r){let i=t[0],s=t[1],n=t[2],o=t[3],a=r[0],l=r[1],h=r[2],u=r[3];return e[0]=i*u+o*a+s*h-n*l,e[1]=s*u+o*l+n*a-i*h,e[2]=n*u+o*h+i*l-s*a,e[3]=o*u-i*a-s*l-n*h,e}tc.o8,tc.fA,tc.C,tc.hZ;let rf=tc.WQ,rp=tc.hs,rg=tc.Om,rm=tc.Cc,r_=tc.Bw,rA=tc.m3,rE=tc.S8;tc.t2;let rb=function(){let e=td.vt(),t=td.fA(1,0,0),r=td.fA(0,1,0);return function(i,s,n){let o=td.Om(s,n);return o<-.999999?(td.$A(e,t,s),1e-6>td.Il(e)&&td.$A(e,r,s),td.S8(e,e),rc(i,e,Math.PI),i):o>.999999?(i[0]=0,i[1]=0,i[2]=0,i[3]=1,i):(td.$A(e,s,n),i[0]=e[0],i[1]=e[1],i[2]=e[2],i[3]=1+o,rE(i,i))}}();ru(),ru(),function(){let e=new ra.tb(9);ra.tb!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1}();let ry=[0,0,0,1];class rT extends rr.a{constructor(e=0,t=0,r=0,i=1){super(-0,-0,-0,-0),Array.isArray(e)&&1==arguments.length?this.copy(e):this.set(e,t,r,i)}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this.check()}set(e,t,r,i){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this.check()}fromObject(e){return this[0]=e.x,this[1]=e.y,this[2]=e.z,this[3]=e.w,this.check()}fromMatrix3(e){return!function(e,t){let r;let i=t[0]+t[4]+t[8];if(i>0)r=Math.sqrt(i+1),e[3]=.5*r,r=.5/r,e[0]=(t[5]-t[7])*r,e[1]=(t[6]-t[2])*r,e[2]=(t[1]-t[3])*r;else{let i=0;t[4]>t[0]&&(i=1),t[8]>t[3*i+i]&&(i=2);let s=(i+1)%3,n=(i+2)%3;r=Math.sqrt(t[3*i+i]-t[3*s+s]-t[3*n+n]+1),e[i]=.5*r,r=.5/r,e[3]=(t[3*s+n]-t[3*n+s])*r,e[s]=(t[3*s+i]+t[3*i+s])*r,e[n]=(t[3*n+i]+t[3*i+n])*r}}(this,e),this.check()}fromAxisRotation(e,t){return rc(this,e,t),this.check()}identity(){return this[0]=0,this[1]=0,this[2]=0,this[3]=1,this.check()}setAxisAngle(e,t){return this.fromAxisRotation(e,t)}get ELEMENTS(){return 4}get x(){return this[0]}set x(e){this[0]=(0,ri.ws)(e)}get y(){return this[1]}set y(e){this[1]=(0,ri.ws)(e)}get z(){return this[2]}set z(e){this[2]=(0,ri.ws)(e)}get w(){return this[3]}set w(e){this[3]=(0,ri.ws)(e)}len(){return r_(this)}lengthSquared(){return rA(this)}dot(e){return rg(this,e)}rotationTo(e,t){return rb(this,e,t),this.check()}add(e){return rf(this,this,e),this.check()}calculateW(){return!function(e,t){let r=t[0],i=t[1],s=t[2];e[0]=r,e[1]=i,e[2]=s,e[3]=Math.sqrt(Math.abs(1-r*r-i*i-s*s))}(this,this),this.check()}conjugate(){return this[0]=-this[0],this[1]=-this[1],this[2]=-this[2],this[3]=this[3],this.check()}invert(){return!function(e,t){let r=t[0],i=t[1],s=t[2],n=t[3],o=r*r+i*i+s*s+n*n,a=o?1/o:0;e[0]=-r*a,e[1]=-i*a,e[2]=-s*a,e[3]=n*a}(this,this),this.check()}lerp(e,t,r){return void 0===r?this.lerp(this,e,t):(rm(this,e,t,r),this.check())}multiplyRight(e){return rd(this,this,e),this.check()}multiplyLeft(e){return rd(this,e,this),this.check()}normalize(){let e=this.len(),t=e>0?1/e:0;return this[0]=this[0]*t,this[1]=this[1]*t,this[2]=this[2]*t,this[3]=this[3]*t,0===e&&(this[3]=1),this.check()}rotateX(e){return!function(e,t,r){r*=.5;let i=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);e[0]=i*l+o*a,e[1]=s*l+n*a,e[2]=n*l-s*a,e[3]=o*l-i*a}(this,this,e),this.check()}rotateY(e){return!function(e,t,r){r*=.5;let i=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);e[0]=i*l-n*a,e[1]=s*l+o*a,e[2]=n*l+i*a,e[3]=o*l-s*a}(this,this,e),this.check()}rotateZ(e){return!function(e,t,r){r*=.5;let i=t[0],s=t[1],n=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);e[0]=i*l+s*a,e[1]=s*l-i*a,e[2]=n*l+o*a,e[3]=o*l-n*a}(this,this,e),this.check()}scale(e){return rp(this,this,e),this.check()}slerp(e,t,r){let i,s,n;switch(arguments.length){case 1:({start:i=ry,target:s,ratio:n}=e);break;case 2:i=this,s=e,n=t;break;default:i=e,s=t,n=r}return!function(e,t,r,i){let s,n,o,a,l;let h=t[0],u=t[1],c=t[2],d=t[3],f=r[0],p=r[1],g=r[2],m=r[3];(s=h*f+u*p+c*g+d*m)<0&&(s=-s,f=-f,p=-p,g=-g,m=-m),1-s>ra.p8?(l=Math.sin(n=Math.acos(s)),o=Math.sin((1-i)*n)/l,a=Math.sin(i*n)/l):(o=1-i,a=i),e[0]=o*h+a*f,e[1]=o*u+a*p,e[2]=o*c+a*g,e[3]=o*d+a*m}(this,i,s,n),this.check()}transformVector4(e,t=new ro){return(0,tc.gL)(t,e,this),(0,ri.qk)(t,4)}lengthSq(){return this.lengthSquared()}setFromAxisAngle(e,t){return this.setAxisAngle(e,t)}premultiply(e){return this.multiplyLeft(e)}multiply(e){return this.multiplyRight(e)}}let rC={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},rv={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};class rR{name;startTime=0;playing=!0;speed=1;channels=[];constructor(e){Object.assign(this,e)}animate(e){if(!this.playing)return;let t=(e/1e3-this.startTime)*this.speed;this.channels.forEach(({sampler:e,target:r,path:i})=>{(function(e,{input:t,interpolation:r,output:i},s,n){let o=e%t[t.length-1],a=t.findIndex(e=>e>=o),l=Math.max(0,a-1);if(!Array.isArray(s[n]))switch(n){case"translation":s[n]=[0,0,0];break;case"rotation":s[n]=[0,0,0,1];break;case"scale":s[n]=[1,1,1];break;default:en.R.warn(`Bad animation path ${n}`)()}let h=t[l],u=t[a];switch(r){case"STEP":!function(e,t,r){for(let i=0;i<r.length;i++)e[t][i]=r[i]}(s,n,i[l]);break;case"LINEAR":u>h&&function(e,t,r,i,s){if("rotation"===t){rM.slerp({start:r,target:i,ratio:s});for(let r=0;r<rM.length;r++)e[t][r]=rM[r]}else for(let n=0;n<r.length;n++)e[t][n]=s*i[n]+(1-s)*r[n]}(s,n,i[l],i[a],(o-h)/(u-h));break;case"CUBICSPLINE":if(u>h){let e=i[3*l+1],t=i[3*l+2];!function(e,t,{p0:r,outTangent0:i,inTangent1:s,p1:n,tDiff:o,ratio:a}){for(let l=0;l<e[t].length;l++){let h=i[l]*o,u=s[l]*o;e[t][l]=(2*Math.pow(a,3)-3*Math.pow(a,2)+1)*r[l]+(Math.pow(a,3)-2*Math.pow(a,2)+a)*h+(-2*Math.pow(a,3)+3*Math.pow(a,2))*n[l]+(Math.pow(a,3)-Math.pow(a,2))*u}}(s,n,{p0:e,outTangent0:t,inTangent1:i[3*a+0],p1:i[3*a+1],tDiff:u-h,ratio:(o-h)/(u-h)})}break;default:en.R.warn(`Interpolation ${r} not supported`)()}})(t,e,r,i),function(e,t){if(t.matrix.identity(),e.translation&&t.matrix.translate(e.translation),e.rotation){let r=rw.fromQuaternion(e.rotation);t.matrix.multiplyRight(r)}e.scale&&t.matrix.scale(e.scale)}(r,r._node)})}}class rS{animations;constructor(e){this.animations=e.animations.map((t,r)=>{let i=t.name||`Animation-${r}`,s=t.samplers.map(({input:t,interpolation:r="LINEAR",output:i})=>({input:rB(e.accessors[t]),interpolation:r,output:rB(e.accessors[i])}));return new rR({name:i,channels:t.channels.map(({sampler:t,target:r})=>({sampler:s[t],target:e.nodes[r.node],path:r.path}))})})}animate(e){this.setTime(e)}setTime(e){this.animations.forEach(t=>t.animate(e))}getAnimations(){return this.animations}}function rB(e){if(!e._animation){let t=rv[e.componentType],r=rC[e.type],i=r*e.count,{buffer:s,byteOffset:n}=e.bufferView.data,o=new t(s,n+(e.byteOffset||0),i);if(1===r)e._animation=Array.from(o);else{let t=[];for(let e=0;e<o.length;e+=r)t.push(Array.from(o.slice(e,e+r)));e._animation=t}}return e._animation}let rw=new t9.k,rM=new rT;function rI(e,t,r,i){let s={defines:{MANUAL_SRGB:1,SRGB_FAST_APPROXIMATION:1},bindings:{},uniforms:{camera:[0,0,0],metallicRoughnessValues:[1,1]},parameters:{},glParameters:{},generatedTextures:[]};s.defines.USE_TEX_LOD=1;let{imageBasedLightingEnvironment:n}=i;return n&&(s.bindings.pbr_diffuseEnvSampler=n.diffuseEnvSampler.texture,s.bindings.pbr_specularEnvSampler=n.specularEnvSampler.texture,s.bindings.pbr_BrdfLUT=n.brdfLutTexture.texture,s.uniforms.scaleIBLAmbient=[1,1]),i?.pbrDebug&&(s.defines.PBR_DEBUG=1,s.uniforms.scaleDiffBaseMR=[0,0,0,0],s.uniforms.scaleFGDSpec=[0,0,0,0]),r.NORMAL&&(s.defines.HAS_NORMALS=1),r.TANGENT&&i?.useTangents&&(s.defines.HAS_TANGENTS=1),r.TEXCOORD_0&&(s.defines.HAS_UV=1),i?.imageBasedLightingEnvironment&&(s.defines.USE_IBL=1),i?.lights&&(s.defines.USE_LIGHTS=1),t&&function(e,t,r){if(r.uniforms.unlit=!!t.unlit,t.pbrMetallicRoughness&&function(e,t,r){t.baseColorTexture&&rP(e,t.baseColorTexture,"pbr_baseColorSampler","HAS_BASECOLORMAP",r),r.uniforms.baseColorFactor=t.baseColorFactor||[1,1,1,1],t.metallicRoughnessTexture&&rP(e,t.metallicRoughnessTexture,"pbr_metallicRoughnessSampler","HAS_METALROUGHNESSMAP",r);let{metallicFactor:i=1,roughnessFactor:s=1}=t;r.uniforms.metallicRoughnessValues=[i,s]}(e,t.pbrMetallicRoughness,r),t.normalTexture){rP(e,t.normalTexture,"pbr_normalSampler","HAS_NORMALMAP",r);let{scale:i=1}=t.normalTexture;r.uniforms.normalScale=i}if(t.occlusionTexture){rP(e,t.occlusionTexture,"pbr_occlusionSampler","HAS_OCCLUSIONMAP",r);let{strength:i=1}=t.occlusionTexture;r.uniforms.occlusionStrength=i}switch(t.emissiveTexture&&(rP(e,t.emissiveTexture,"pbr_emissiveSampler","HAS_EMISSIVEMAP",r),r.uniforms.emissiveFactor=t.emissiveFactor||[0,0,0]),t.alphaMode){case"MASK":let{alphaCutoff:i=.5}=t;r.defines.ALPHA_CUTOFF=1,r.uniforms.alphaCutoff=i;break;case"BLEND":en.R.warn("glTF BLEND alphaMode might not work well because it requires mesh sorting")(),r.parameters.blendColorOperation="add",r.parameters.blendColorSrcFactor="src-alpha",r.parameters.blendColorDstFactor="one-minus-src-alpha",r.parameters.blendAlphaOperation="add",r.parameters.blendAlphaSrcFactor="one",r.parameters.blendAlphaDstFactor="one-minus-src-alpha",r.glParameters.blend=!0,r.glParameters.blendEquation=u.FUNC_ADD,r.glParameters.blendFunc=[u.SRC_ALPHA,u.ONE_MINUS_SRC_ALPHA,u.ONE,u.ONE_MINUS_SRC_ALPHA]}}(e,t,s),s}function rP(e,t,r,i=null,s){let n;let o=t?.texture?.sampler?.parameters||{},a=t.texture.source.image,l={};a.compressed?(n=a,l={[u.TEXTURE_MIN_FILTER]:a.data.length>1?u.LINEAR_MIPMAP_NEAREST:u.LINEAR}):n={data:a};let h=e.createTexture({id:t.uniformName||t.id,parameters:{...o,...l},pixelStore:{[u.UNPACK_FLIP_Y_WEBGL]:!1},...n});s.bindings[r]=h,i&&(s.defines[i]=1),s.generatedTextures.push(h)}!function(e){e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.ONE=1]="ONE",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.LINEAR=9729]="LINEAR",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL"}(u||(u={}));let rL=`
layout(0) positions: vec4; // in vec4 POSITION;

  #ifdef HAS_NORMALS
    in vec4 normals; // in vec4 NORMAL;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

@vertex
  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = u_MVPMatrix * positions;
  }

@fragment
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`,rO=`\
#version 300 es

  // in vec4 POSITION;
  in vec4 positions;

  #ifdef HAS_NORMALS
    // in vec4 NORMAL;
    in vec4 normals;
  #endif

  #ifdef HAS_TANGENTS
    in vec4 TANGENT;
  #endif

  #ifdef HAS_UV
    // in vec2 TEXCOORD_0;
    in vec2 texCoords;
  #endif

  void main(void) {
    vec4 _NORMAL = vec4(0.);
    vec4 _TANGENT = vec4(0.);
    vec2 _TEXCOORD_0 = vec2(0.);

    #ifdef HAS_NORMALS
      _NORMAL = normals;
    #endif

    #ifdef HAS_TANGENTS
      _TANGENT = TANGENT;
    #endif

    #ifdef HAS_UV
      _TEXCOORD_0 = texCoords;
    #endif

    pbr_setPositionNormalTangentUV(positions, _NORMAL, _TANGENT, _TEXCOORD_0);
    gl_Position = pbrProjection.modelViewProjectionMatrix * positions;
  }
`,rx=`\
#version 300 es
  out vec4 fragmentColor;

  void main(void) {
    vec3 pos = pbr_vPosition;
    fragmentColor = pbr_filterColor(vec4(1.0));
  }
`;!function(e){e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN"}(c||(c={}));let rN={modelOptions:{},pbrDebug:!1,imageBasedLightingEnvironment:null,lights:!0,useTangents:!1};class rF{device;options;gltf;constructor(e,t={}){this.device=e,this.options={...rN,...t}}instantiate(e){return this.gltf=function e(t){if(ArrayBuffer.isView(t)||t instanceof ArrayBuffer||t instanceof ImageBitmap)return t;if(Array.isArray(t))return t.map(e);if(t&&"object"==typeof t){let r={};for(let i in t)r[i]=e(t[i]);return r}return t}(e),(this.gltf.scenes||[]).map(e=>this.createScene(e))}createAnimator(){return Array.isArray(this.gltf.animations)?new rS(this.gltf):null}createScene(e){let t=(e.nodes||[]).map(e=>this.createNode(e));return new re({id:e.name||e.id,children:t})}createNode(e){if(!e._node){let t=(e.children||[]).map(e=>this.createNode(e));e.mesh&&t.push(this.createMesh(e.mesh));let r=new re({id:e.name||e.id,children:t});if(e.matrix)r.setMatrix(e.matrix);else{if(r.matrix.identity(),e.translation&&r.matrix.translate(e.translation),e.rotation){let t=new t9.k().fromQuaternion(e.rotation);r.matrix.multiplyRight(t)}e.scale&&r.matrix.scale(e.scale)}e._node=r}return this.gltf.nodes.find(t=>t.id===e.id)._node=e._node,e._node}createMesh(e){if(!e._mesh){let t=(e.primitives||[]).map((t,r)=>this.createPrimitive(t,r,e));e._mesh=new re({id:e.name||e.id,children:t})}return e._mesh}createPrimitive(e,t,r){let i=e.name||`${r.name||r.id}-primitive-${t}`,s=function(e){switch(e){case c.POINTS:return"point-list";case c.LINES:return"line-list";case c.LINE_STRIP:return"line-strip";case c.TRIANGLES:return"triangle-list";case c.TRIANGLE_STRIP:return"triangle-strip";default:throw Error(String(e))}}(e.mode||4),n=e.indices?e.indices.count:this.getVertexCount(e.attributes),o=function(e,t){let{id:r,geometry:i,material:s,vertexCount:n,materialOptions:o,modelOptions:a}=t,l=rI(e,s,i.attributes,o);en.R.info(4,"createGLTFModel defines: ",l.defines)();let h=new eN(e,{id:r,source:rL,vs:rO,fs:rx,geometry:i,topology:i.topology,vertexCount:n,modules:[t8],...a,defines:{...l.defines,...a.defines},parameters:{depthWriteEnabled:!0,depthCompare:"less",depthFormat:"depth24plus",cullMode:"back",...l.parameters,...a.parameters}}),{camera:u,...c}={...l.uniforms,...a.uniforms,...l.bindings,...a.bindings};return h.shaderInputs.setProps({pbrMaterial:c,pbrProjection:{camera:u}}),new rt({managedResources:[],model:h})}(this.device,{id:i,geometry:this.createGeometry(i,e,s),material:e.material,materialOptions:this.options,modelOptions:this.options.modelOptions,vertexCount:n});return o.bounds=[e.attributes.POSITION.min,e.attributes.POSITION.max],o}getVertexCount(e){throw Error("getVertexCount not implemented")}createGeometry(e,t,r){let i={};for(let[e,r]of Object.entries(t.attributes)){let{components:t,size:s,value:n}=r;i[e]={size:s??t,value:n}}return new I({id:e,topology:r,indices:t.indices.value,attributes:i})}createBuffer(e,t){e.bufferView||(e.bufferView={});let{bufferView:r}=e;return r.lumaBuffers||(r.lumaBuffers={}),r.lumaBuffers[t]||(r.lumaBuffers[t]=this.device.createBuffer({id:`from-${r.id}`,data:r.data||e.value})),r.lumaBuffers[t]}createSampler(e){return e}needsPOT(){return!1}}function rD(e,t,r){if(e.byteLength<=t+r)return"";let i=new DataView(e),s="";for(let e=0;e<r;e++)s+=String.fromCharCode(i.getUint8(t+e));return s}var rU=r(75606);async function rG(e,t,r,i){return i._parse(e,t,r,i)}var rk=r(20761),rH=r(71253),rV=r(40769),rj=r(20613);let rW={};async function rz(e,t=null,r={},i=null){return t&&(e=function(e,t,r={},i=null){if(!r.useLocalLibraries&&e.startsWith("http"))return e;i=i||e;let s=r.modules||{};return s[i]?s[i]:rH.Bd?r.CDN?((0,rV.v)(r.CDN.startsWith("http")),`${r.CDN}/${t}@${rj.Q}/dist/libs/${i}`):rH.xD?`../src/libs/${i}`:`modules/${t}/src/libs/${i}`:`modules/${t}/dist/libs/${i}`}(e,t,r,i)),rW[e]=rW[e]||rX(e),await rW[e]}async function rX(e){if(e.endsWith("wasm"))return await rK(e);if(!rH.Bd)try{let{requireFromFile:t}=globalThis.loaders||{};return await t?.(e)}catch(e){return console.error(e),null}return rH.xD?importScripts(e):function(e,t){if(!rH.Bd){let{requireFromString:r}=globalThis.loaders||{};return r?.(e,t)}if(rH.xD)return eval.call(globalThis,e),null;let r=document.createElement("script");r.id=t;try{r.appendChild(document.createTextNode(e))}catch(t){r.text=e}return document.body.appendChild(r),null}(await rJ(e),e)}async function rK(e){let{readFileAsArrayBuffer:t}=globalThis.loaders||{};if(rH.Bd||!t||e.startsWith("http")){let t=await fetch(e);return await t.arrayBuffer()}return await t(e)}async function rJ(e){let{readFileAsText:t}=globalThis.loaders||{};if(rH.Bd||!t||e.startsWith("http")){let t=await fetch(e);return await t.text()}return await t(e)}let r$={TRANSCODER:"basis_transcoder.js",TRANSCODER_WASM:"basis_transcoder.wasm",ENCODER:"basis_encoder.js",ENCODER_WASM:"basis_encoder.wasm"};async function rY(e){var t;t=e.modules,globalThis.loaders||={},globalThis.loaders.modules||={},Object.assign(globalThis.loaders.modules,t);let r=globalThis.loaders?.modules?.basis||null;return r||(s||=rq(e),await s)}async function rq(e){let t=null,r=null;return[t,r]=await Promise.all([await rz(r$.TRANSCODER,"textures",e),await rz(r$.TRANSCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await function(e,t){let r={};return t&&(r.wasmBinary=t),new Promise(t=>{e(r).then(e=>{let{BasisFile:r,initializeBasis:i}=e;i(),t({BasisFile:r})})})}(t,r)}async function rQ(e){let t=e.modules||{};return t.basisEncoder?t.basisEncoder:(n=n||rZ(e),await n)}async function rZ(e){let t=null,r=null;return[t,r]=await Promise.all([await rz(r$.ENCODER,"textures",e),await rz(r$.ENCODER_WASM,"textures",e)]),t=t||globalThis.BASIS,await function(e,t){let r={};return t&&(r.wasmBinary=t),new Promise(t=>{e(r).then(e=>{let{BasisFile:r,KTX2File:i,initializeBasis:s,BasisEncoder:n}=e;s(),t({BasisFile:r,KTX2File:i,BasisEncoder:n})})})}(t,r)}let r0={COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_RGBA_S3TC_DXT5_EXT:33779,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGB_ETC1_WEBGL:36196,COMPRESSED_RGBA_ASTC_4X4_KHR:37808},r1=["","WEBKIT_","MOZ_"],r3={WEBGL_compressed_texture_s3tc:"dxt",WEBGL_compressed_texture_s3tc_srgb:"dxt-srgb",WEBGL_compressed_texture_etc1:"etc1",WEBGL_compressed_texture_etc:"etc2",WEBGL_compressed_texture_pvrtc:"pvrtc",WEBGL_compressed_texture_atc:"atc",WEBGL_compressed_texture_astc:"astc",EXT_texture_compression_rgtc:"rgtc"},r2=null,r6=[171,75,84,88,32,50,48,187,13,10,26,10],r4={etc1:{basisFormat:0,compressed:!0,format:r0.COMPRESSED_RGB_ETC1_WEBGL},etc2:{basisFormat:1,compressed:!0},bc1:{basisFormat:2,compressed:!0,format:r0.COMPRESSED_RGB_S3TC_DXT1_EXT},bc3:{basisFormat:3,compressed:!0,format:r0.COMPRESSED_RGBA_S3TC_DXT5_EXT},bc4:{basisFormat:4,compressed:!0},bc5:{basisFormat:5,compressed:!0},"bc7-m6-opaque-only":{basisFormat:6,compressed:!0},"bc7-m5":{basisFormat:7,compressed:!0},"pvrtc1-4-rgb":{basisFormat:8,compressed:!0,format:r0.COMPRESSED_RGB_PVRTC_4BPPV1_IMG},"pvrtc1-4-rgba":{basisFormat:9,compressed:!0,format:r0.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG},"astc-4x4":{basisFormat:10,compressed:!0,format:r0.COMPRESSED_RGBA_ASTC_4X4_KHR},"atc-rgb":{basisFormat:11,compressed:!0},"atc-rgba-interpolated-alpha":{basisFormat:12,compressed:!0},rgba32:{basisFormat:13,compressed:!1},rgb565:{basisFormat:14,compressed:!1},bgr565:{basisFormat:15,compressed:!1},rgba4444:{basisFormat:16,compressed:!1}};function r8(e,t,r){let i=new e(new Uint8Array(t));try{if(!i.startTranscoding())throw Error("Failed to start basis transcoding");let e=i.getNumImages(),t=[];for(let s=0;s<e;s++){let e=i.getNumLevels(s),n=[];for(let t=0;t<e;t++)n.push(function(e,t,r,i){let s=e.getImageWidth(t,r),n=e.getImageHeight(t,r),o=e.getHasAlpha(),{compressed:a,format:l,basisFormat:h}=r5(i,o),u=new Uint8Array(e.getImageTranscodedSizeInBytes(t,r,h));if(!e.transcodeImage(u,t,r,h,0,0))throw Error("failed to start Basis transcoding");return{width:s,height:n,data:u,compressed:a,format:l,hasAlpha:o}}(i,s,t,r));t.push(n)}return t}finally{i.close(),i.delete()}}function r9(e,t,r){let i=new e(new Uint8Array(t));try{if(!i.startTranscoding())throw Error("failed to start KTX2 transcoding");let e=i.getLevels(),t=[];for(let s=0;s<e;s++)t.push(function(e,t,r){let{alphaFlag:i,height:s,width:n}=e.getImageLevelInfo(t,0,0),{compressed:o,format:a,basisFormat:l}=r5(r,i),h=e.getImageTranscodedSizeInBytes(t,0,0,l),u=new Uint8Array(h);if(!e.transcodeImage(u,t,0,0,l,0,-1,-1))throw Error("Failed to transcode KTX2 image");return{width:n,height:s,data:u,compressed:o,levelSize:h,hasAlpha:i,format:a}}(i,s,r));return[t]}finally{i.close(),i.delete()}}function r5(e,t){let r=e&&e.basis&&e.basis.format;return"auto"===r&&(r=r7()),"object"==typeof r&&(r=t?r.alpha:r.noAlpha),r4[r=r.toLowerCase()]}function r7(){let e=function(e){if(!r2){for(let t of(e=e||function(){try{return document.createElement("canvas").getContext("webgl")}catch(e){return null}}()||void 0,r2=new Set,r1))for(let r in r3)if(e&&e.getExtension(`${t}${r}`)){let e=r3[r];r2.add(e)}}return r2}();if(e.has("astc"))return"astc-4x4";if(e.has("dxt"))return{alpha:"bc3",noAlpha:"bc1"};if(e.has("pvrtc"))return{alpha:"pvrtc1-4-rgba",noAlpha:"pvrtc1-4-rgb"};if(e.has("etc1"))return"etc1";if(e.has("etc2"))return"etc2";return"rgb565"}let ie={dataType:null,batchType:null,name:"Basis",id:"basis",module:"textures",version:"4.3.2",worker:!0,extensions:["basis","ktx2"],mimeTypes:["application/octet-stream","image/ktx2"],tests:["sB"],binary:!0,options:{basis:{format:"auto",libraryPath:"libs/",containerFormat:"auto",module:"transcoder"}},parse:async function e(e,t){if("auto"===t.basis.containerFormat){if(function(e){let t=new Uint8Array(e);return!(t.byteLength<r6.length||t[0]!==r6[0]||t[1]!==r6[1]||t[2]!==r6[2]||t[3]!==r6[3]||t[4]!==r6[4]||t[5]!==r6[5]||t[6]!==r6[6]||t[7]!==r6[7]||t[8]!==r6[8]||t[9]!==r6[9]||t[10]!==r6[10]||t[11]!==r6[11])}(e))return r9((await rQ(t)).KTX2File,e,t);let{BasisFile:r}=await rY(t);return r8(r,e,t)}if("encoder"===t.basis.module){let r=await rQ(t);return"ktx2"===t.basis.containerFormat?r9(r.KTX2File,e,t):r8(r.BasisFile,e,t)}{let{BasisFile:r}=await rY(t);return r8(r,e,t)}}};function it(e,t){if(!e)throw Error(t||"assert failed: gltf")}var ir=r(14080);function ii(e,t){return(0,ir.v)(e>=0),(0,ir.v)(t>0),e+(t-1)&~(t-1)}function is(e,t,r,i){let s=new Uint8Array(t.buffer,r,i);return e.json=JSON.parse(new TextDecoder("utf8").decode(s)),ii(i,4)}function io(e,t,r,i){return e.header.hasBinChunk=!0,e.binChunks.push({byteOffset:r,byteLength:i,arrayBuffer:t.buffer}),ii(i,4)}function ia(e,t){if(e.startsWith("data:")||e.startsWith("http:")||e.startsWith("https:"))return e;let r=t.baseUri||t.uri;if(!r)throw Error(`'baseUri' must be provided to resolve relative url ${e}`);return r.substr(0,r.lastIndexOf("/")+1)+e}let il={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ih={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},iu=["SCALAR","VEC2","VEC3","VEC4"],ic=new Map([[Int8Array,5120],[Uint8Array,5121],[Int16Array,5122],[Uint16Array,5123],[Uint32Array,5125],[Float32Array,5126],[Float64Array,5130]]),id={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ip={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},ig={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function im(e){return iu[e-1]||"SCALAR"}function i_(e){let t=ic.get(e.constructor);if(!t)throw Error("Illegal typed array");return t}function iA(e,t){let r=ig[e.componentType],i=id[e.type],s=ip[e.componentType],n=e.count*i,o=e.count*i*s;return it(o>=0&&o<=t.byteLength),{ArrayType:r,length:n,byteLength:o,componentByteSize:ih[e.componentType],numberOfComponentsInElement:il[e.type]}}function iE(e){let{images:t,bufferViews:r}=e;r=r||[];let i=(t=t||[]).map(e=>e.bufferView);return(r=r.filter(e=>!i.includes(e))).reduce((e,t)=>e+t.byteLength,0)+Math.ceil(4*t.reduce((e,t)=>{let{width:r,height:i}=t.image;return e+r*i},0)*1.33)}var ib=r(65744);class iy{gltf;sourceBuffers;byteLength;constructor(e){this.gltf={json:e?.json||{asset:{version:"2.0",generator:"loaders.gl"},buffers:[],extensions:{},extensionsRequired:[],extensionsUsed:[]},buffers:e?.buffers||[],images:e?.images||[]},this.sourceBuffers=[],this.byteLength=0,this.gltf.buffers&&this.gltf.buffers[0]&&(this.byteLength=this.gltf.buffers[0].byteLength,this.sourceBuffers=[this.gltf.buffers[0]])}get json(){return this.gltf.json}getApplicationData(e){return this.json[e]}getExtraData(e){return(this.json.extras||{})[e]}hasExtension(e){let t=this.getUsedExtensions().find(t=>t===e),r=this.getRequiredExtensions().find(t=>t===e);return"string"==typeof t||"string"==typeof r}getExtension(e){let t=this.getUsedExtensions().find(t=>t===e),r=this.json.extensions||{};return t?r[e]:null}getRequiredExtension(e){return this.getRequiredExtensions().find(t=>t===e)?this.getExtension(e):null}getRequiredExtensions(){return this.json.extensionsRequired||[]}getUsedExtensions(){return this.json.extensionsUsed||[]}getRemovedExtensions(){return this.json.extensionsRemoved||[]}getObjectExtension(e,t){return(e.extensions||{})[t]}getScene(e){return this.getObject("scenes",e)}getNode(e){return this.getObject("nodes",e)}getSkin(e){return this.getObject("skins",e)}getMesh(e){return this.getObject("meshes",e)}getMaterial(e){return this.getObject("materials",e)}getAccessor(e){return this.getObject("accessors",e)}getTexture(e){return this.getObject("textures",e)}getSampler(e){return this.getObject("samplers",e)}getImage(e){return this.getObject("images",e)}getBufferView(e){return this.getObject("bufferViews",e)}getBuffer(e){return this.getObject("buffers",e)}getObject(e,t){if("object"==typeof t)return t;let r=this.json[e]&&this.json[e][t];if(!r)throw Error(`glTF file error: Could not find ${e}[${t}]`);return r}getTypedArrayForBufferView(e){let t=(e=this.getBufferView(e)).buffer,r=this.gltf.buffers[t];it(r);let i=(e.byteOffset||0)+r.byteOffset;return new Uint8Array(r.arrayBuffer,i,e.byteLength)}getTypedArrayForAccessor(e){let t=this.getAccessor(e);return function(e,t,r){let i="number"==typeof r?e.accessors?.[r]:r;if(!i)throw Error(`No gltf accessor ${JSON.stringify(r)}`);let s=e.bufferViews?.[i.bufferView||0];if(!s)throw Error(`No gltf buffer view for accessor ${s}`);let{arrayBuffer:n,byteOffset:o}=t[s.buffer],a=(o||0)+(i.byteOffset||0)+(s.byteOffset||0),{ArrayType:l,length:h,componentByteSize:u,numberOfComponentsInElement:c}=iA(i,s),d=u*c,f=s.byteStride||d;if(void 0===s.byteStride||s.byteStride===d)return new l(n,a,h);let p=new l(h);for(let e=0;e<i.count;e++){let t=new l(n,a+e*f,c);p.set(t,e*c)}return p}(this.gltf.json,this.gltf.buffers,t)}getTypedArrayForImageData(e){e=this.getAccessor(e);let t=this.getBufferView(e.bufferView);return new Uint8Array(this.getBuffer(t.buffer).data,t.byteOffset||0,t.byteLength)}addApplicationData(e,t){return this.json[e]=t,this}addExtraData(e,t){return this.json.extras=this.json.extras||{},this.json.extras[e]=t,this}addObjectExtension(e,t,r){return e.extensions=e.extensions||{},e.extensions[t]=r,this.registerUsedExtension(t),this}setObjectExtension(e,t,r){(e.extensions||{})[t]=r}removeObjectExtension(e,t){let r=e?.extensions||{};if(r[t]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];let e=this.json.extensionsRemoved;e.includes(t)||e.push(t)}delete r[t]}addExtension(e,t={}){return it(t),this.json.extensions=this.json.extensions||{},this.json.extensions[e]=t,this.registerUsedExtension(e),t}addRequiredExtension(e,t={}){return it(t),this.addExtension(e,t),this.registerRequiredExtension(e),t}registerUsedExtension(e){this.json.extensionsUsed=this.json.extensionsUsed||[],this.json.extensionsUsed.find(t=>t===e)||this.json.extensionsUsed.push(e)}registerRequiredExtension(e){this.registerUsedExtension(e),this.json.extensionsRequired=this.json.extensionsRequired||[],this.json.extensionsRequired.find(t=>t===e)||this.json.extensionsRequired.push(e)}removeExtension(e){if(this.json.extensions?.[e]){this.json.extensionsRemoved=this.json.extensionsRemoved||[];let t=this.json.extensionsRemoved;t.includes(e)||t.push(e)}this.json.extensions&&delete this.json.extensions[e],this.json.extensionsRequired&&this._removeStringFromArray(this.json.extensionsRequired,e),this.json.extensionsUsed&&this._removeStringFromArray(this.json.extensionsUsed,e)}setDefaultScene(e){this.json.scene=e}addScene(e){let{nodeIndices:t}=e;return this.json.scenes=this.json.scenes||[],this.json.scenes.push({nodes:t}),this.json.scenes.length-1}addNode(e){let{meshIndex:t,matrix:r}=e;this.json.nodes=this.json.nodes||[];let i={mesh:t};return r&&(i.matrix=r),this.json.nodes.push(i),this.json.nodes.length-1}addMesh(e){let{attributes:t,indices:r,material:i,mode:s=4}=e,n={primitives:[{attributes:this._addAttributes(t),mode:s}]};if(r){let e=this._addIndices(r);n.primitives[0].indices=e}return Number.isFinite(i)&&(n.primitives[0].material=i),this.json.meshes=this.json.meshes||[],this.json.meshes.push(n),this.json.meshes.length-1}addPointCloud(e){let t=this._addAttributes(e);return this.json.meshes=this.json.meshes||[],this.json.meshes.push({primitives:[{attributes:t,mode:0}]}),this.json.meshes.length-1}addImage(e,t){let r=(0,ib.m)(e),i=t||r?.mimeType,s=this.addBufferView(e);return this.json.images=this.json.images||[],this.json.images.push({bufferView:s,mimeType:i}),this.json.images.length-1}addBufferView(e,t=0,r=this.byteLength){let i=e.byteLength;return it(Number.isFinite(i)),this.sourceBuffers=this.sourceBuffers||[],this.sourceBuffers.push(e),this.byteLength+=ii(i,4),this.json.bufferViews=this.json.bufferViews||[],this.json.bufferViews.push({buffer:t,byteOffset:r,byteLength:i}),this.json.bufferViews.length-1}addAccessor(e,t){let r={bufferView:e,type:im(t.size),componentType:t.componentType,count:t.count,max:t.max,min:t.min};return this.json.accessors=this.json.accessors||[],this.json.accessors.push(r),this.json.accessors.length-1}addBinaryBuffer(e,t={size:3}){let r=this.addBufferView(e),i={min:t.min,max:t.max};i.min&&i.max||(i=this._getAccessorMinMax(e,t.size));let s={size:t.size,componentType:i_(e),count:Math.round(e.length/t.size),min:i.min,max:i.max};return this.addAccessor(r,Object.assign(s,t))}addTexture(e){let{imageIndex:t}=e;return this.json.textures=this.json.textures||[],this.json.textures.push({source:t}),this.json.textures.length-1}addMaterial(e){return this.json.materials=this.json.materials||[],this.json.materials.push(e),this.json.materials.length-1}createBinaryChunk(){let e=this.byteLength,t=new ArrayBuffer(e),r=new Uint8Array(t),i=0;for(let e of this.sourceBuffers||[])i=function(e,t,r){let i;if(e instanceof ArrayBuffer)i=new Uint8Array(e);else{let t=e.byteOffset,r=e.byteLength;i=new Uint8Array(e.buffer||e.arrayBuffer,t,r)}return t.set(i,r),r+ii(i.byteLength,4)}(e,r,i);this.json?.buffers?.[0]?this.json.buffers[0].byteLength=e:this.json.buffers=[{byteLength:e}],this.gltf.binary=t,this.sourceBuffers=[t],this.gltf.buffers=[{arrayBuffer:t,byteOffset:0,byteLength:t.byteLength}]}_removeStringFromArray(e,t){let r=!0;for(;r;){let i=e.indexOf(t);i>-1?e.splice(i,1):r=!1}}_addAttributes(e={}){let t={};for(let r in e){let i=e[r],s=this._getGltfAttributeName(r),n=this.addBinaryBuffer(i.value,i);t[s]=n}return t}_addIndices(e){return this.addBinaryBuffer(e,{size:1})}_getGltfAttributeName(e){switch(e.toLowerCase()){case"position":case"positions":case"vertices":return"POSITION";case"normal":case"normals":return"NORMAL";case"color":case"colors":return"COLOR_0";case"texcoord":case"texcoords":return"TEXCOORD_0";default:return e}}_getAccessorMinMax(e,t){let r={min:null,max:null};if(e.length<t)return r;for(let i of(r.min=[],r.max=[],e.subarray(0,t)))r.min.push(i),r.max.push(i);for(let i=t;i<e.length;i+=t)for(let s=0;s<t;s++)r.min[0+s]=Math.min(r.min[0+s],e[i+s]),r.max[0+s]=Math.max(r.max[0+s],e[i+s]);return r}}var iT=r(75331);let iC={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16,BOOLEAN:1,STRING:1,ENUM:1},iv={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:BigInt64Array,UINT64:BigUint64Array,FLOAT32:Float32Array,FLOAT64:Float64Array},iR={INT8:1,UINT8:1,INT16:2,UINT16:2,INT32:4,UINT32:4,INT64:8,UINT64:8,FLOAT32:4,FLOAT64:8};function iS(e,t,r,i){if("UINT8"!==r&&"UINT16"!==r&&"UINT32"!==r&&"UINT64"!==r)return null;let s=iB(e.getTypedArrayForBufferView(t),"SCALAR",r,i+1);return s instanceof BigInt64Array||s instanceof BigUint64Array?null:s}function iB(e,t,r,i=1){let s=iC[t],n=iv[r],o=iR[r],a=i*s,l=a*o,h=e.buffer,u=e.byteOffset;return u%o!=0&&(h=new Uint8Array(h).slice(u,u+l).buffer,u=0),new n(h,u,a)}function iw(e,t,r){let i=`TEXCOORD_${t.texCoord||0}`,s=r.attributes[i],n=e.getTypedArrayForAccessor(s),o=e.gltf.json,a=t.index,l=o.textures?.[a]?.source;if(void 0!==l){let r=o.images?.[l]?.mimeType,i=e.gltf.images?.[l];if(i&&void 0!==i.width){let e=[];for(let s=0;s<n.length;s+=2){let o=function(e,t,r,i,s=[0]){let n={r:{offset:0,shift:0},g:{offset:1,shift:8},b:{offset:2,shift:16},a:{offset:3,shift:24}},o=r[i],a=r[i+1],l=1;t&&(-1!==t.indexOf("image/jpeg")||-1!==t.indexOf("image/png"))&&(l=4);let h=function(e,t,r,i=1){let s=r.width,n=Math.round((e%1+1)%1*(s-1)),o=Math.round((t%1+1)%1*(r.height-1));return(o*s+n)*(r.components?r.components:i)}(o,a,e,l),u=0;for(let t of s){let r="number"==typeof t?Object.values(n)[t]:n[t],i=h+r.offset,s=(0,iT.M5)(e);if(s.data.length<=i)throw Error(`${s.data.length} <= ${i}`);u|=s.data[i]<<r.shift}return u}(i,r,n,s,t.channels);e.push(o)}return e}}return[]}function iM(e,t,r,i,s){if(!r?.length)return;let n=[];for(let e of r){let t=i.findIndex(t=>t===e);-1===t&&(t=i.push(e)-1),n.push(t)}let o=new Uint32Array(n),a=e.gltf.buffers.push({arrayBuffer:o.buffer,byteOffset:o.byteOffset,byteLength:o.byteLength})-1,l=e.addBufferView(o,a,0),h=e.addAccessor(l,{size:1,componentType:i_(o),count:o.length});s.attributes[t]=h}function iI(e,t,r,i,s){let n=[];for(let o=0;o<t;o++){let t=r[o],a=r[o+1]-r[o];if(a+t>i)break;let l=t/s,h=a/s;n.push(e.slice(l,l+h))}return n}function iP(e,t,r){let i=[];for(let s=0;s<t;s++){let t=s*r;i.push(e.slice(t,t+r))}return i}function iL(e,t,r,i){if(r)throw Error("Not implemented - arrayOffsets for strings is specified");if(i){let r=[],s=new TextDecoder("utf8"),n=0;for(let o=0;o<e;o++){let e=i[o+1]-i[o];if(e+n<=t.length){let i=t.subarray(n,e+n),o=s.decode(i);r.push(o),n+=e}}return r}return[]}let iO="EXT_mesh_features",ix=iO;async function iN(e,t){!function(e,t){let r=e.gltf.json;if(r.meshes)for(let i of r.meshes)for(let r of i.primitives)!function(e,t,r){if(!r?.gltf?.loadBuffers)return;let i=t.extensions?.[iO],s=i?.featureIds;if(s)for(let i of s){let s;if(void 0!==i.attribute){let r=`_FEATURE_ID_${i.attribute}`,n=t.attributes[r];s=e.getTypedArrayForAccessor(n)}else s=void 0!==i.texture&&r?.gltf?.loadImages?iw(e,i.texture,t):[];i.data=s}}(e,r,t)}(new iy(e),t)}function iF(e,t){let r=new iy(e);return function(e,t){let r=e.gltf.json.meshes;if(r)for(let t of r)for(let r of t.primitives)(function(e,t){let r=t.extensions?.[iO];if(!r)return;let i=r.featureIds;i.forEach((r,s)=>{if(r.data){let{accessorKey:n,index:o}=function(e){let t="_FEATURE_ID_",r=Object.keys(e).filter(e=>0===e.indexOf(t)),i=-1;for(let e of r){let r=Number(e.substring(t.length));r>i&&(i=r)}return i++,{accessorKey:`${t}${i}`,index:i}}(t.attributes),a=new Uint32Array(r.data);i[s]={featureCount:a.length,propertyTable:r.propertyTable,attribute:o},e.gltf.buffers.push({arrayBuffer:a.buffer,byteOffset:a.byteOffset,byteLength:a.byteLength});let l=e.addBufferView(a),h=e.addAccessor(l,{size:1,componentType:i_(a),count:a.length});t.attributes[n]=h}})})(e,r)}(r,0),r.createBinaryChunk(),r.gltf}function iD(e,t,r,i){t.extensions||(t.extensions={});let s=t.extensions[iO];s||(s={featureIds:[]},t.extensions[iO]=s);let{featureIds:n}=s,o={featureCount:r.length,propertyTable:i,data:r};n.push(o),e.addObjectExtension(t,iO,s)}let iU="EXT_structural_metadata",iG=iU;async function ik(e,t){!function(e,t){if(!t.gltf?.loadBuffers)return;let r=e.getExtension(iU);r&&(t.gltf?.loadImages&&function(e,t){let r=t.propertyTextures,i=e.gltf.json;if(r&&i.meshes)for(let s of i.meshes)for(let i of s.primitives)(function(e,t,r,i){if(!t)return;let s=r.extensions?.[iU],n=s?.propertyTextures;if(n)for(let s of n)(function(e,t,r,i){if(!t.properties)return;i.dataAttributeNames||(i.dataAttributeNames=[]);let s=t.class;for(let n in t.properties){let o=`${s}_${n}`,a=t.properties?.[n];if(!a)continue;a.data||(a.data=[]);let l=a.data,h=iw(e,a,r);null!==h&&(iM(e,o,h,l,r),a.data=l,i.dataAttributeNames.push(o))}})(e,t[s],r,i)})(e,r,i,t)}(e,r),function(e,t){let r=t.schema;if(!r)return;let i=r.classes,s=t.propertyTables;if(i&&s)for(let t in i){let i=function(e,t){for(let r of e)if(r.class===t)return r;return null}(s,t);i&&function(e,t,r){let i=t.classes?.[r.class];if(!i)throw Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);let s=r.count;for(let n in i.properties){let o=i.properties[n],a=r.properties?.[n];a&&(a.data=function(e,t,r,i,s){var n,o,a,l,h,u,c;let d=[],f=s.values,p=e.getTypedArrayForBufferView(f),g=(n=e,o=r,a=s,l=i,o.array&&void 0===o.count&&void 0!==a.arrayOffsets?iS(n,a.arrayOffsets,a.arrayOffsetType||"UINT32",l):null),m=(h=e,u=s,c=i,void 0!==u.stringOffsets?iS(h,u.stringOffsets,u.stringOffsetType||"UINT32",c):null);switch(r.type){case"SCALAR":case"VEC2":case"VEC3":case"VEC4":case"MAT2":case"MAT3":case"MAT4":d=function(e,t,r,i){var s;let n;let o=e.array,a=e.count,l=(s=e.type,iR[e.componentType]*iC[s]),h=r.byteLength/l;return(n=e.componentType?iB(r,e.type,e.componentType,h):r,o)?i?iI(n,t,i,r.length,l):a?iP(n,t,a):[]:n}(r,i,p,g);break;case"BOOLEAN":throw Error(`Not implemented - classProperty.type=${r.type}`);case"STRING":d=iL(i,p,g,m);break;case"ENUM":d=function(e,t,r,i,s){var n;let o=t.enumType;if(!o)throw Error("Incorrect data in the EXT_structural_metadata extension: classProperty.enumType is not set for type ENUM");let a=e.enums?.[o];if(!a)throw Error(`Incorrect data in the EXT_structural_metadata extension: schema.enums does't contain ${o}`);let l=a.valueType||"UINT16",h=(n=t.type,iR[l]*iC[n]),u=i.byteLength/h,c=iB(i,t.type,l,u);if(c||(c=i),t.array){if(s)return function(e){let{valuesData:t,numberOfElements:r,arrayOffsets:i,valuesDataBytesLength:s,elementSize:n,enumEntry:o}=e,a=[];for(let e=0;e<r;e++){let r=i[e],l=i[e+1]-i[e];if(l+r>s)break;let h=iV(t,r/n,l/n,o);a.push(h)}return a}({valuesData:c,numberOfElements:r,arrayOffsets:s,valuesDataBytesLength:i.length,elementSize:h,enumEntry:a});let e=t.count;return e?function(e,t,r,i){let s=[];for(let n=0;n<t;n++){let t=iV(e,r*n,r,i);s.push(t)}return s}(c,r,e,a):[]}return iV(c,0,r,a)}(t,r,i,p,g);break;default:throw Error(`Unknown classProperty type ${r.type}`)}return d}(e,t,o,s,a))}}(e,r,i)}}(e,r))}(new iy(e),t)}function iH(e,t){let r=new iy(e);return function(e,t){let r=e.getExtension(iU);if(r&&r.propertyTables)for(let t of r.propertyTables){let i=t.class,s=r.schema?.classes?.[i];t.properties&&s&&function(e,t,r){for(let i in e.properties){let s=e.properties[i].data;if(s){let n=t.properties[i];if(n){let t=function(e,t,r){let i={values:0};if("STRING"===t.type){let{stringData:t,stringOffsets:s}=function(e){let t=new TextEncoder,r=[],i=0;for(let s of e){let e=t.encode(s);i+=e.length,r.push(e)}let s=new Uint8Array(i),n=[],o=0;for(let e of r)s.set(e,o),n.push(o),o+=e.length;return n.push(o),{stringData:s,stringOffsets:new Uint32Array(n)}}(e);i.stringOffsets=iz(s,r),i.values=iz(t,r)}else"SCALAR"===t.type&&t.componentType&&(i.values=iz(function(e,t){let r=[];for(let t of e)r.push(Number(t));let i=iW[t];if(!i)throw Error("Illegal component type");return new i(r)}(e,t.componentType),r));return i}(s,n,r);e.properties[i]=t}}}}(t,s,e)}}(r,0),r.createBinaryChunk(),r.gltf}function iV(e,t,r,i){let s=[];for(let n=0;n<r;n++)if(e instanceof BigInt64Array||e instanceof BigUint64Array)s.push("");else{let r=function(e,t){for(let r of e.values)if(r.value===t)return r;return null}(i,e[t+n]);r?s.push(r.name):s.push("")}return s}function ij(e,t,r="schemaClassId"){let i=e.getExtension(iU);i||(i=e.addExtension(iU)),i.schema=function(e,t,r){let i=r??{id:"schema_id"},s={properties:{}};for(let t of e){let e={type:t.elementType,componentType:t.componentType};s.properties[t.name]=e}return i.classes={},i.classes[t]=s,i}(t,r,i.schema);let s=function(e,t,r){let i={class:t,count:0},s=0,n=r.classes?.[t];for(let t of e){if(0===s&&(s=t.values.length),s!==t.values.length&&t.values.length)throw Error("Illegal values in attributes");n?.properties[t.name]&&(i.properties||(i.properties={}),i.properties[t.name]={values:0,data:t.values})}return i.count=s,i}(t,r,i.schema);return i.propertyTables||(i.propertyTables=[]),i.propertyTables.push(s)-1}let iW={INT8:Int8Array,UINT8:Uint8Array,INT16:Int16Array,UINT16:Uint16Array,INT32:Int32Array,UINT32:Uint32Array,INT64:Int32Array,UINT64:Uint32Array,FLOAT32:Float32Array,FLOAT64:Float64Array};function iz(e,t){return t.gltf.buffers.push({arrayBuffer:e.buffer,byteOffset:e.byteOffset,byteLength:e.byteLength}),t.addBufferView(e)}let iX=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]),iK=new Uint8Array([32,0,65,253,3,1,2,34,4,106,6,5,11,8,7,20,13,33,12,16,128,9,116,64,19,113,127,15,10,21,22,14,255,66,24,54,136,107,18,23,192,26,114,118,132,17,77,101,130,144,27,87,131,44,45,74,156,154,70,167]),iJ={0:"",1:"meshopt_decodeFilterOct",2:"meshopt_decodeFilterQuat",3:"meshopt_decodeFilterExp",NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},i$={0:"meshopt_decodeVertexBuffer",1:"meshopt_decodeIndexBuffer",2:"meshopt_decodeIndexSequence",ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};async function iY(e,t,r,i,s,n="NONE"){let o=await iq();(function(e,t,r,i,s,n,o){let a=e.exports.sbrk,l=i+3&-4,h=a(l*s),u=a(n.length),c=new Uint8Array(e.exports.memory.buffer);c.set(n,u);let d=t(h,i,s,u,n.length);if(0===d&&o&&o(h,l,s),r.set(c.subarray(h,h+i*s)),a(h-a(0)),0!==d)throw Error(`Malformed buffer data: ${d}`)})(o,o.exports[i$[s]],e,t,r,i,o.exports[iJ[n||"NONE"]])}async function iq(){return o||(o=iQ()),o}async function iQ(){let e="B9h9z9tFBBBF8fL9gBB9gLaaaaaFa9gEaaaB9gFaFa9gEaaaFaEMcBFFFGGGEIIILF9wFFFLEFBFKNFaFCx/IFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBF8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBGy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBEn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBIi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBKI9z9iqlBOc+x8ycGBM/qQFTa8jUUUUBCU/EBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAGTkUUUBRNCUoBAG9uC/wgBZHKCUGAKCUG9JyRVAECFJRICBRcGXEXAcAF9PQFAVAFAclAcAVJAF9JyRMGXGXAG9FQBAMCbJHKC9wZRSAKCIrCEJCGrRQANCUGJRfCBRbAIRTEXGXAOATlAQ9PQBCBRISEMATAQJRIGXAS9FQBCBRtCBREEXGXAOAIlCi9PQBCBRISLMANCU/CBJAEJRKGXGXGXGXGXATAECKrJ2BBAtCKZrCEZfIBFGEBMAKhB83EBAKCNJhB83EBSEMAKAI2BIAI2BBHmCKrHYAYCE6HYy86BBAKCFJAICIJAYJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCGJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCEJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCIJAYAmJHY2BBAI2BFHmCKrHPAPCE6HPy86BBAKCLJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCKJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCOJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCNJAYAmJHY2BBAI2BGHmCKrHPAPCE6HPy86BBAKCVJAYAPJHY2BBAmCIrCEZHPAPCE6HPy86BBAKCcJAYAPJHY2BBAmCGrCEZHPAPCE6HPy86BBAKCMJAYAPJHY2BBAmCEZHmAmCE6Hmy86BBAKCSJAYAmJHm2BBAI2BEHICKrHYAYCE6HYy86BBAKCQJAmAYJHm2BBAICIrCEZHYAYCE6HYy86BBAKCfJAmAYJHm2BBAICGrCEZHYAYCE6HYy86BBAKCbJAmAYJHK2BBAICEZHIAICE6HIy86BBAKAIJRISGMAKAI2BNAI2BBHmCIrHYAYCb6HYy86BBAKCFJAICNJAYJHY2BBAmCbZHmAmCb6Hmy86BBAKCGJAYAmJHm2BBAI2BFHYCIrHPAPCb6HPy86BBAKCEJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCIJAmAYJHm2BBAI2BGHYCIrHPAPCb6HPy86BBAKCLJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCKJAmAYJHm2BBAI2BEHYCIrHPAPCb6HPy86BBAKCOJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCNJAmAYJHm2BBAI2BIHYCIrHPAPCb6HPy86BBAKCVJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCcJAmAYJHm2BBAI2BLHYCIrHPAPCb6HPy86BBAKCMJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCSJAmAYJHm2BBAI2BKHYCIrHPAPCb6HPy86BBAKCQJAmAPJHm2BBAYCbZHYAYCb6HYy86BBAKCfJAmAYJHm2BBAI2BOHICIrHYAYCb6HYy86BBAKCbJAmAYJHK2BBAICbZHIAICb6HIy86BBAKAIJRISFMAKAI8pBB83BBAKCNJAICNJ8pBB83BBAICTJRIMAtCGJRtAECTJHEAS9JQBMMGXAIQBCBRISEMGXAM9FQBANAbJ2BBRtCBRKAfREEXAEANCU/CBJAKJ2BBHTCFrCBATCFZl9zAtJHt86BBAEAGJREAKCFJHKAM9HQBMMAfCFJRfAIRTAbCFJHbAG9HQBMMABAcAG9sJANCUGJAMAG9sTkUUUBpANANCUGJAMCaJAG9sJAGTkUUUBpMAMCBAIyAcJRcAIQBMC9+RKSFMCBC99AOAIlAGCAAGCA9Ly6yRKMALCU/EBJ8kUUUUBAKM+OmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUFT+JUUUBpALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM+lLKFaF99GaG99FaG99GXGXAGCI9HQBAF9FQFEXGXGX9DBBB8/9DBBB+/ABCGJHG1BB+yAB1BBHE+yHI+L+TABCFJHL1BBHK+yHO+L+THN9DBBBB9gHVyAN9DBB/+hANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE86BBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG86BBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG86BBABCIJRBAFCaJHFQBSGMMAF9FQBEXGXGX9DBBB8/9DBBB+/ABCIJHG8uFB+yAB8uFBHE+yHI+L+TABCGJHL8uFBHK+yHO+L+THN9DBBBB9gHVyAN9DB/+g6ANAN+U9DBBBBANAVyHcAc+MHMAECa3yAI+SHIAI+UAcAMAKCa3yAO+SHcAc+U+S+S+R+VHO+U+SHN+L9DBBB9P9d9FQBAN+oRESFMCUUUU94REMAGAE87FBGXGX9DBBB8/9DBBB+/Ac9DBBBB9gyAcAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMALAG87FBGXGX9DBBB8/9DBBB+/AI9DBBBB9gyAIAO+U+SHN+L9DBBB9P9d9FQBAN+oRGSFMCUUUU94RGMABAG87FBABCNJRBAFCaJHFQBMMM/SEIEaE99EaF99GXAF9FQBCBREABRIEXGXGX9D/zI818/AICKJ8uFBHLCEq+y+VHKAI8uFB+y+UHO9DB/+g6+U9DBBB8/9DBBB+/AO9DBBBB9gy+SHN+L9DBBB9P9d9FQBAN+oRVSFMCUUUU94RVMAICIJ8uFBRcAICGJ8uFBRMABALCFJCEZAEqCFWJAV87FBGXGXAKAM+y+UHN9DB/+g6+U9DBBB8/9DBBB+/AN9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRMSFMCUUUU94RMMABALCGJCEZAEqCFWJAM87FBGXGXAKAc+y+UHK9DB/+g6+U9DBBB8/9DBBB+/AK9DBBBB9gy+SHS+L9DBBB9P9d9FQBAS+oRcSFMCUUUU94RcMABALCaJCEZAEqCFWJAc87FBGXGX9DBBU8/AOAO+U+TANAN+U+TAKAK+U+THO9DBBBBAO9DBBBB9gy+R9DB/+g6+U9DBBB8/+SHO+L9DBBB9P9d9FQBAO+oRcSFMCUUUU94RcMABALCEZAEqCFWJAc87FBAICNJRIAECIJREAFCaJHFQBMMM9JBGXAGCGrAF9sHF9FQBEXABAB8oGBHGCNWCN91+yAGCi91CnWCUUU/8EJ+++U84GBABCIJRBAFCaJHFQBMMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEM/lFFFaGXGXAFABqCEZ9FQBABRESFMGXGXAGCT9PQBABRESFMABREEXAEAF8oGBjGBAECIJAFCIJ8oGBjGBAECNJAFCNJ8oGBjGBAECSJAFCSJ8oGBjGBAECTJREAFCTJRFAGC9wJHGCb9LQBMMAGCI9JQBEXAEAF8oGBjGBAFCIJRFAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF2BB86BBAECFJREAFCFJRFAGCaJHGQBMMABMoFFGaGXGXABCEZ9FQBABRESFMAFCgFZC+BwsN9sRIGXGXAGCT9PQBABRESFMABREEXAEAIjGBAECSJAIjGBAECNJAIjGBAECIJAIjGBAECTJREAGC9wJHGCb9LQBMMAGCI9JQBEXAEAIjGBAECIJREAGC98JHGCE9LQBMMGXAG9FQBEXAEAF86BBAECFJREAGCaJHGQBMMABMMMFBCUNMIT9kBB";WebAssembly.validate(iX)&&(e="B9h9z9tFBBBF8dL9gBB9gLaaaaaFa9gEaaaB9gGaaB9gFaFaEQSBBFBFFGEGEGIILF9wFFFLEFBFKNFaFCx/aFMO/LFVK9tv9t9vq95GBt9f9f939h9z9t9f9j9h9s9s9f9jW9vq9zBBp9tv9z9o9v9wW9f9kv9j9v9kv9WvqWv94h919m9mvqBG8Z9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv94h919m9mvqBIy9tv9z9o9v9wW9f9kv9j9v9kv9J9u9kv949TvZ91v9u9jvBLn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9P9jWBKi9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9R919hWBNn9tv9z9o9v9wW9f9kv9j9v9kv69p9sWvq9F949wBcI9z9iqlBMc/j9JSIBTEM9+FLa8jUUUUBCTlRBCBRFEXCBRGCBREEXABCNJAGJAECUaAFAGrCFZHIy86BBAEAIJREAGCFJHGCN9HQBMAFCx+YUUBJAE86BBAFCEWCxkUUBJAB8pEN83EBAFCFJHFCUG9HQBMMkRIbaG97FaK978jUUUUBCU/KBlHL8kUUUUBC9+RKGXAGCFJAI9LQBCaRKAE2BBC+gF9HQBALAEAIJHOAGlAG/8cBBCUoBAG9uC/wgBZHKCUGAKCUG9JyRNAECFJRKCBRVGXEXAVAF9PQFANAFAVlAVANJAF9JyRcGXGXAG9FQBAcCbJHIC9wZHMCE9sRSAMCFWRQAICIrCEJCGrRfCBRbEXAKRTCBRtGXEXGXAOATlAf9PQBCBRKSLMALCU/CBJAtAM9sJRmATAfJRKCBREGXAMCoB9JQBAOAKlC/gB9JQBCBRIEXAmAIJREGXGXGXGXGXATAICKrJ2BBHYCEZfIBFGEBMAECBDtDMIBSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIBAKCTJRKMGXGXGXGXGXAYCGrCEZfIBFGEBMAECBDtDMITSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMITAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMITAKCTJRKMGXGXGXGXGXAYCIrCEZfIBFGEBMAECBDtDMIASEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIAAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAEAKDBBBDMIAAKCTJRKMGXGXGXGXGXAYCKrfIBFGEBMAECBDtDMI8wSEMAEAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCIJAnDeBJAYCx+YUUBJ2BBJRKSGMAEAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBAYCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HYCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMI8wAKCNJAnDeBJAYCx+YUUBJ2BBJRKSFMAEAKDBBBDMI8wAKCTJRKMAICoBJREAICUFJAM9LQFAERIAOAKlC/fB9LQBMMGXAEAM9PQBAECErRIEXGXAOAKlCi9PQBCBRKSOMAmAEJRYGXGXGXGXGXATAECKrJ2BBAICKZrCEZfIBFGEBMAYCBDtDMIBSEMAYAKDBBIAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnHPCGD+MFAPDQBTFtGmEYIPLdKeOnC0+G+MiDtD9OHdCEDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCIJAnDeBJAeCx+YUUBJ2BBJRKSGMAYAKDBBNAKDBBBHPCID+MFAPDQBTFtGmEYIPLdKeOnC+P+e+8/4BDtD9OHdCbDbD8jHPD8dBhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBAeCx+YUUBJDBBBHnAnDQBBBBBBBBBBBBBBBBAPD8dFhUg/8/4/w/goB9+h84k7HeCEWCxkUUBJDBEBD9uDQBFGEILKOTtmYPdenDfAdAPD9SDMIBAKCNJAnDeBJAeCx+YUUBJ2BBJRKSFMAYAKDBBBDMIBAKCTJRKMAICGJRIAECTJHEAM9JQBMMGXAK9FQBAKRTAtCFJHtCI6QGSFMMCBRKSEMGXAM9FQBALCUGJAbJREALAbJDBGBRnCBRYEXAEALCU/CBJAYJHIDBIBHdCFD9tAdCFDbHPD9OD9hD9RHdAIAMJDBIBHiCFD9tAiAPD9OD9hD9RHiDQBTFtGmEYIPLdKeOnH8ZAIAQJDBIBHpCFD9tApAPD9OD9hD9RHpAIASJDBIBHyCFD9tAyAPD9OD9hD9RHyDQBTFtGmEYIPLdKeOnH8cDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGEAnD9uHnDyBjGBAEAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnA8ZA8cDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNiV8ZcpMyS8cQ8df8eb8fHdApAyDQNiV8ZcpMyS8cQ8df8eb8fHiDQBFTtGEmYILPdKOenHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJHIAnAdAiDQNVi8ZcMpySQ8c8dfb8e8fHPAPDQBFGEBFGEBFGEBFGED9uHnDyBjGBAIAGJHIAnAPAPDQILKOILKOILKOILKOD9uHnDyBjGBAIAGJHIAnAPAPDQNVcMNVcMNVcMNVcMD9uHnDyBjGBAIAGJHIAnAPAPDQSQfbSQfbSQfbSQfbD9uHnDyBjGBAIAGJREAYCTJHYAM9JQBMMAbCIJHbAG9JQBMMABAVAG9sJALCUGJAcAG9s/8cBBALALCUGJAcCaJAG9sJAG/8cBBMAcCBAKyAVJRVAKQBMC9+RKSFMCBC99AOAKlAGCAAGCA9Ly6yRKMALCU/KBJ8kUUUUBAKMNBT+BUUUBM+KmFTa8jUUUUBCoFlHL8kUUUUBC9+RKGXAFCE9uHOCtJAI9LQBCaRKAE2BBHNC/wFZC/gF9HQBANCbZHVCF9LQBALCoBJCgFCUF/8MBALC84Jha83EBALC8wJha83EBALC8oJha83EBALCAJha83EBALCiJha83EBALCTJha83EBALha83ENALha83EBAEAIJC9wJRcAECFJHNAOJRMGXAF9FQBCQCbAVCF6yRSABRECBRVCBRQCBRfCBRICBRKEXGXAMAcuQBC9+RKSEMGXGXAN2BBHOC/vF9LQBALCoBJAOCIrCa9zAKJCbZCEWJHb8oGIRTAb8oGBRtGXAOCbZHbAS9PQBALAOCa9zAIJCbZCGWJ8oGBAVAbyROAb9FRbGXGXAGCG9HQBABAt87FBABCIJAO87FBABCGJAT87FBSFMAEAtjGBAECNJAOjGBAECIJATjGBMAVAbJRVALCoBJAKCEWJHmAOjGBAmATjGIALAICGWJAOjGBALCoBJAKCFJCbZHKCEWJHTAtjGBATAOjGIAIAbJRIAKCFJRKSGMGXGXAbCb6QBAQAbJAbC989zJCFJRQSFMAM1BBHbCgFZROGXGXAbCa9MQBAMCFJRMSFMAM1BFHbCgBZCOWAOCgBZqROGXAbCa9MQBAMCGJRMSFMAM1BGHbCgBZCfWAOqROGXAbCa9MQBAMCEJRMSFMAM1BEHbCgBZCdWAOqROGXAbCa9MQBAMCIJRMSFMAM2BIC8cWAOqROAMCLJRMMAOCFrCBAOCFZl9zAQJRQMGXGXAGCG9HQBABAt87FBABCIJAQ87FBABCGJAT87FBSFMAEAtjGBAECNJAQjGBAECIJATjGBMALCoBJAKCEWJHOAQjGBAOATjGIALAICGWJAQjGBALCoBJAKCFJCbZHKCEWJHOAtjGBAOAQjGIAICFJRIAKCFJRKSFMGXAOCDF9LQBALAIAcAOCbZJ2BBHbCIrHTlCbZCGWJ8oGBAVCFJHtATyROALAIAblCbZCGWJ8oGBAtAT9FHmJHtAbCbZHTyRbAT9FRTGXGXAGCG9HQBABAV87FBABCIJAb87FBABCGJAO87FBSFMAEAVjGBAECNJAbjGBAECIJAOjGBMALAICGWJAVjGBALCoBJAKCEWJHYAOjGBAYAVjGIALAICFJHICbZCGWJAOjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAIAmJCbZHICGWJAbjGBALCoBJAKCGJCbZHKCEWJHOAVjGBAOAbjGIAKCFJRKAIATJRIAtATJRVSFMAVCBAM2BBHYyHTAOC/+F6HPJROAYCbZRtGXGXAYCIrHmQBAOCFJRbSFMAORbALAIAmlCbZCGWJ8oGBROMGXGXAtQBAbCFJRVSFMAbRVALAIAYlCbZCGWJ8oGBRbMGXGXAP9FQBAMCFJRYSFMAM1BFHYCgFZRTGXGXAYCa9MQBAMCGJRYSFMAM1BGHYCgBZCOWATCgBZqRTGXAYCa9MQBAMCEJRYSFMAM1BEHYCgBZCfWATqRTGXAYCa9MQBAMCIJRYSFMAM1BIHYCgBZCdWATqRTGXAYCa9MQBAMCLJRYSFMAMCKJRYAM2BLC8cWATqRTMATCFrCBATCFZl9zAQJHQRTMGXGXAmCb6QBAYRPSFMAY1BBHMCgFZROGXGXAMCa9MQBAYCFJRPSFMAY1BFHMCgBZCOWAOCgBZqROGXAMCa9MQBAYCGJRPSFMAY1BGHMCgBZCfWAOqROGXAMCa9MQBAYCEJRPSFMAY1BEHMCgBZCdWAOqROGXAMCa9MQBAYCIJRPSFMAYCLJRPAY2BIC8cWAOqROMAOCFrCBAOCFZl9zAQJHQROMGXGXAtCb6QBAPRMSFMAP1BBHMCgFZRbGXGXAMCa9MQBAPCFJRMSFMAP1BFHMCgBZCOWAbCgBZqRbGXAMCa9MQBAPCGJRMSFMAP1BGHMCgBZCfWAbqRbGXAMCa9MQBAPCEJRMSFMAP1BEHMCgBZCdWAbqRbGXAMCa9MQBAPCIJRMSFMAPCLJRMAP2BIC8cWAbqRbMAbCFrCBAbCFZl9zAQJHQRbMGXGXAGCG9HQBABAT87FBABCIJAb87FBABCGJAO87FBSFMAEATjGBAECNJAbjGBAECIJAOjGBMALCoBJAKCEWJHYAOjGBAYATjGIALAICGWJATjGBALCoBJAKCFJCbZCEWJHYAbjGBAYAOjGIALAICFJHICbZCGWJAOjGBALCoBJAKCGJCbZCEWJHOATjGBAOAbjGIALAIAm9FAmCb6qJHICbZCGWJAbjGBAIAt9FAtCb6qJRIAKCEJRKMANCFJRNABCKJRBAECSJREAKCbZRKAICbZRIAfCEJHfAF9JQBMMCBC99AMAc6yRKMALCoFJ8kUUUUBAKM/tIFGa8jUUUUBCTlRLC9+RKGXAFCLJAI9LQBCaRKAE2BBC/+FZC/QF9HQBALhB83ENAECFJRKAEAIJC98JREGXAF9FQBGXAGCG6QBEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMALCNJAICFZCGWqHGAICGrCBAICFrCFZl9zAG8oGBJHIjGBABAIjGBABCIJRBAFCaJHFQBSGMMEXGXAKAE9JQBC9+bMAK1BBHGCgFZRIGXGXAGCa9MQBAKCFJRKSFMAK1BFHGCgBZCOWAICgBZqRIGXAGCa9MQBAKCGJRKSFMAK1BGHGCgBZCfWAIqRIGXAGCa9MQBAKCEJRKSFMAK1BEHGCgBZCdWAIqRIGXAGCa9MQBAKCIJRKSFMAK2BIC8cWAIqRIAKCLJRKMABAICGrCBAICFrCFZl9zALCNJAICFZCGWqHI8oGBJHG87FBAIAGjGBABCGJRBAFCaJHFQBMMCBC99AKAE6yRKMAKM/xLGEaK978jUUUUBCAlHE8kUUUUBGXGXAGCI9HQBGXAFC98ZHI9FQBABRGCBRLEXAGAGDBBBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMBBAGCTJRGALCIJHLAI9JQBMMAIAF9PQFAEAFCEZHLCGWHGqCBCTAGl/8MBAEABAICGWJHIAG/8cBBGXAL9FQBAEAEDBIBHKCiD+rFCiD+sFD/6FHOAKCND+rFCiD+sFD/6FAOD/gFAKCTD+rFCiD+sFD/6FHND/gFD/kFD/lFHVCBDtD+2FHcAOCUUUU94DtHMD9OD9RD/kFHO9DBB/+hDYAOAOD/mFAVAVD/mFANAcANAMD9OD9RD/kFHOAOD/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHcD/kFCgFDtD9OAKCUUU94DtD9OD9QAOAND/mFAcD/kFCND+rFCU/+EDtD9OD9QAVAND/mFAcD/kFCTD+rFCUU/8ODtD9OD9QDMIBMAIAEAG/8cBBSFMABAFC98ZHGT+HUUUBAGAF9PQBAEAFCEZHICEWHLJCBCAALl/8MBAEABAGCEWJHGAL/8cBBAEAIT+HUUUBAGAEAL/8cBBMAECAJ8kUUUUBM+yEGGaO97GXAF9FQBCBRGEXABCTJHEAEDBBBHICBDtHLCUU98D8cFCUU98D8cEHKD9OABDBBBHOAIDQILKOSQfbPden8c8d8e8fCggFDtD9OD/6FAOAIDQBFGENVcMTtmYi8ZpyHICTD+sFD/6FHND/gFAICTD+rFCTD+sFD/6FHVD/gFD/kFD/lFHI9DB/+g6DYAVAIALD+2FHLAVCUUUU94DtHcD9OD9RD/kFHVAVD/mFAIAID/mFANALANAcD9OD9RD/kFHIAID/mFD/kFD/kFD/jFD/nFHND/mF9DBBX9LDYHLD/kFCTD+rFAVAND/mFALD/kFCggEDtD9OD9QHVAIAND/mFALD/kFCaDbCBDnGCBDnECBDnKCBDnOCBDncCBDnMCBDnfCBDnbD9OHIDQNVi8ZcMpySQ8c8dfb8e8fD9QDMBBABAOAKD9OAVAIDQBFTtGEmYILPdKOenD9QDMBBABCAJRBAGCIJHGAF9JQBMMM94FEa8jUUUUBCAlHE8kUUUUBABAFC98ZHIT+JUUUBGXAIAF9PQBAEAFCEZHLCEWHFJCBCAAFl/8MBAEABAICEWJHBAF/8cBBAEALT+JUUUBABAEAF/8cBBMAECAJ8kUUUUBM/hEIGaF97FaL978jUUUUBCTlRGGXAF9FQBCBREEXAGABDBBBHIABCTJHLDBBBHKDQILKOSQfbPden8c8d8e8fHOCTD+sFHNCID+rFDMIBAB9DBBU8/DY9D/zI818/DYANCEDtD9QD/6FD/nFHNAIAKDQBFGENVcMTtmYi8ZpyHICTD+rFCTD+sFD/6FD/mFHKAKD/mFANAICTD+sFD/6FD/mFHVAVD/mFANAOCTD+rFCTD+sFD/6FD/mFHOAOD/mFD/kFD/kFD/lFCBDtD+4FD/jF9DB/+g6DYHND/mF9DBBX9LDYHID/kFCggEDtHcD9OAVAND/mFAID/kFCTD+rFD9QHVAOAND/mFAID/kFCTD+rFAKAND/mFAID/kFAcD9OD9QHNDQBFTtGEmYILPdKOenHID8dBAGDBIBDyB+t+J83EBABCNJAID8dFAGDBIBDyF+t+J83EBALAVANDQNVi8ZcMpySQ8c8dfb8e8fHND8dBAGDBIBDyG+t+J83EBABCiJAND8dFAGDBIBDyE+t+J83EBABCAJRBAECIJHEAF9JQBMMM/3FGEaF978jUUUUBCoBlREGXAGCGrAF9sHIC98ZHL9FQBCBRGABRFEXAFAFDBBBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMBBAFCTJRFAGCIJHGAL9JQBMMGXALAI9PQBAEAICEZHGCGWHFqCBCoBAFl/8MBAEABALCGWJHLAF/8cBBGXAG9FQBAEAEDBIBHKCND+rFCND+sFD/6FAKCiD+sFCnD+rFCUUU/8EDtD+uFD/mFDMIBMALAEAF/8cBBMM9TFEaCBCB8oGUkUUBHFABCEJC98ZJHBjGUkUUBGXGXAB8/BCTWHGuQBCaREABAGlCggEJCTrXBCa6QFMAFREMAEMMMFBCUNMIT9tBB",console.log("Warning: meshopt_decoder is using experimental SIMD support"));let t=await WebAssembly.instantiate(function(e){let t=new Uint8Array(e.length);for(let r=0;r<e.length;++r){let i=e.charCodeAt(r);t[r]=i>96?i-71:i>64?i-65:i>47?i+4:i>46?63:62}let r=0;for(let i=0;i<e.length;++i)t[r++]=t[i]<60?iK[t[i]]:(t[i]-60)*64+t[++i];return t.buffer.slice(0,r)}(e),{});return await t.instance.exports.__wasm_call_ctors(),t.instance}let iZ="EXT_meshopt_compression",i0=iZ;async function i1(e,t){let r=new iy(e);if(!t?.gltf?.decompressMeshes||!t.gltf?.loadBuffers)return;let i=[];for(let t of e.json.bufferViews||[])i.push(i3(r,t));await Promise.all(i),r.removeExtension(iZ)}async function i3(e,t){let r=e.getObjectExtension(t,iZ);if(r){let{byteOffset:i=0,byteLength:s=0,byteStride:n,count:o,mode:a,filter:l="NONE",buffer:h}=r,u=e.gltf.buffers[h],c=new Uint8Array(u.arrayBuffer,u.byteOffset+i,s),d=new Uint8Array(e.gltf.buffers[t.buffer].arrayBuffer,t.byteOffset,t.byteLength);await iY(d,o,n,c,a,l),e.removeObjectExtension(t,iZ)}}var i2=r(30358);let i6={},i4={"image/avif":"data:image/avif;base64,AAAAIGZ0eXBhdmlmAAAAAGF2aWZtaWYxbWlhZk1BMUIAAADybWV0YQAAAAAAAAAoaGRscgAAAAAAAAAAcGljdAAAAAAAAAAAAAAAAGxpYmF2aWYAAAAADnBpdG0AAAAAAAEAAAAeaWxvYwAAAABEAAABAAEAAAABAAABGgAAAB0AAAAoaWluZgAAAAAAAQAAABppbmZlAgAAAAABAABhdjAxQ29sb3IAAAAAamlwcnAAAABLaXBjbwAAABRpc3BlAAAAAAAAAAIAAAACAAAAEHBpeGkAAAAAAwgICAAAAAxhdjFDgQ0MAAAAABNjb2xybmNseAACAAIAAYAAAAAXaXBtYQAAAAAAAAABAAEEAQKDBAAAACVtZGF0EgAKCBgANogQEAwgMg8f8D///8WfhwB8+ErK42A=","image/webp":"data:image/webp;base64,UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA"};async function i8(e){return new Promise(t=>{let r=new Image;r.src=e,r.onload=()=>t(r.height>0),r.onerror=()=>t(!1)})}let i9="EXT_texture_webp",i5=i9;function i7(e,t){let r=new iy(e);if(!function(e){if(void 0===i6[e]){let t=i2.Bd?function(e){switch(e){case"image/avif":case"image/webp":return function(e){try{let t=document.createElement("canvas").toDataURL(e);return 0===t.indexOf(`data:${e}`)}catch{return!1}}(e);default:return!0}}(e):function(e){let t=globalThis.loaders?.imageFormatsNode||["image/png","image/jpeg","image/gif"];return!!globalThis.loaders?.parseImageNode&&t.includes(e)}(e);i6[e]=t}return i6[e]}("image/webp")){if(r.getRequiredExtensions().includes(i9))throw Error(`gltf: Required extension ${i9} not supported by browser`);return}let{json:i}=r;for(let e of i.textures||[]){let t=r.getObjectExtension(e,i9);t&&(e.source=t.source),r.removeObjectExtension(e,i9)}r.removeExtension(i9)}let se="KHR_texture_basisu",st=se;function sr(e,t){let r=new iy(e),{json:i}=r;for(let e of i.textures||[]){let t=r.getObjectExtension(e,se);t&&(e.source=t.source,r.removeObjectExtension(e,se))}r.removeExtension(se)}let si={dataType:null,batchType:null,name:"Draco",id:"draco",module:"draco",version:"4.3.2",worker:!0,extensions:["drc"],mimeTypes:["application/octet-stream"],binary:!0,tests:["DRACO"],options:{draco:{decoderType:"object"==typeof WebAssembly?"wasm":"js",libraryPath:"libs/",extraAttributes:{},attributeNameEntry:void 0}}};function ss(e){let t=1/0,r=1/0,i=1/0,s=-1/0,n=-1/0,o=-1/0,a=e.POSITION?e.POSITION.value:[],l=a&&a.length;for(let e=0;e<l;e+=3){let l=a[e],h=a[e+1],u=a[e+2];t=l<t?l:t,r=h<r?h:r,i=u<i?u:i,s=l>s?l:s,n=h>n?h:n,o=u>o?u:o}return[[t,r,i],[s,n,o]]}function sn(e,t,r){return function(e,t,r){let i=function(e){switch(e.constructor){case Int8Array:return"int8";case Uint8Array:case Uint8ClampedArray:return"uint8";case Int16Array:return"int16";case Uint16Array:return"uint16";case Int32Array:return"int32";case Uint32Array:return"uint32";case Float32Array:return"float32";case Float64Array:return"float64";default:return"null"}}(t.value),s=r||function(e){let t={};return"byteOffset"in e&&(t.byteOffset=e.byteOffset.toString(10)),"byteStride"in e&&(t.byteStride=e.byteStride.toString(10)),"normalized"in e&&(t.normalized=e.normalized.toString()),t}(t);return{name:e,type:{type:"fixed-size-list",listSize:t.size,children:[{name:"value",type:i}]},nullable:!1,metadata:s}}(e,t,r?so(r.metadata):void 0)}function so(e){Object.entries(e);let t={};for(let r in e)t[`${r}.string`]=JSON.stringify(e[r]);return t}let sa={POSITION:"POSITION",NORMAL:"NORMAL",COLOR:"COLOR_0",TEX_COORD:"TEXCOORD_0"},sl={1:Int8Array,2:Uint8Array,3:Int16Array,4:Uint16Array,5:Int32Array,6:Uint32Array,9:Float32Array};class sh{draco;decoder;metadataQuerier;constructor(e){this.draco=e,this.decoder=new this.draco.Decoder,this.metadataQuerier=new this.draco.MetadataQuerier}destroy(){this.draco.destroy(this.decoder),this.draco.destroy(this.metadataQuerier)}parseSync(e,t={}){let r=new this.draco.DecoderBuffer;r.Init(new Int8Array(e),e.byteLength),this._disableAttributeTransforms(t);let i=this.decoder.GetEncodedGeometryType(r),s=i===this.draco.TRIANGULAR_MESH?new this.draco.Mesh:new this.draco.PointCloud;try{let e;switch(i){case this.draco.TRIANGULAR_MESH:e=this.decoder.DecodeBufferToMesh(r,s);break;case this.draco.POINT_CLOUD:e=this.decoder.DecodeBufferToPointCloud(r,s);break;default:throw Error("DRACO: Unknown geometry type.")}if(!e.ok()||!s.ptr){let t=`DRACO decompression failed: ${e.error_msg()}`;throw Error(t)}let n=this._getDracoLoaderData(s,i,t),o=this._getMeshData(s,n,t),a=ss(o.attributes),l=function(e,t,r){let i=so(t.metadata),s=[],n=function(e){let t={};for(let r in e){let i=e[r];t[i.name||"undefined"]=i}return t}(t.attributes);for(let t in e){let r=e[t],i=sn(t,r,n[t]);s.push(i)}if(r){let e=sn("indices",r);s.push(e)}return{fields:s,metadata:i}}(o.attributes,n,o.indices);return{loader:"draco",loaderData:n,header:{vertexCount:s.num_points(),boundingBox:a},...o,schema:l}}finally{this.draco.destroy(r),s&&this.draco.destroy(s)}}_getDracoLoaderData(e,t,r){let i=this._getTopLevelMetadata(e),s=this._getDracoAttributes(e,r);return{geometry_type:t,num_attributes:e.num_attributes(),num_points:e.num_points(),num_faces:e instanceof this.draco.Mesh?e.num_faces():0,metadata:i,attributes:s}}_getDracoAttributes(e,t){let r={};for(let i=0;i<e.num_attributes();i++){let s=this.decoder.GetAttribute(e,i),n=this._getAttributeMetadata(e,i);r[s.unique_id()]={unique_id:s.unique_id(),attribute_type:s.attribute_type(),data_type:s.data_type(),num_components:s.num_components(),byte_offset:s.byte_offset(),byte_stride:s.byte_stride(),normalized:s.normalized(),attribute_index:i,metadata:n};let o=this._getQuantizationTransform(s,t);o&&(r[s.unique_id()].quantization_transform=o);let a=this._getOctahedronTransform(s,t);a&&(r[s.unique_id()].octahedron_transform=a)}return r}_getMeshData(e,t,r){let i=this._getMeshAttributes(t,e,r);if(!i.POSITION)throw Error("DRACO: No position attribute found.");if(e instanceof this.draco.Mesh)return"triangle-strip"===r.topology?{topology:"triangle-strip",mode:4,attributes:i,indices:{value:this._getTriangleStripIndices(e),size:1}}:{topology:"triangle-list",mode:5,attributes:i,indices:{value:this._getTriangleListIndices(e),size:1}};return{topology:"point-list",mode:0,attributes:i}}_getMeshAttributes(e,t,r){let i={};for(let s of Object.values(e.attributes)){let e=this._deduceAttributeName(s,r);s.name=e;let n=this._getAttributeValues(t,s);if(n){let{value:t,size:r}=n;i[e]={value:t,size:r,byteOffset:s.byte_offset,byteStride:s.byte_stride,normalized:s.normalized}}}return i}_getTriangleListIndices(e){let t=3*e.num_faces(),r=4*t,i=this.draco._malloc(r);try{return this.decoder.GetTrianglesUInt32Array(e,r,i),new Uint32Array(this.draco.HEAPF32.buffer,i,t).slice()}finally{this.draco._free(i)}}_getTriangleStripIndices(e){let t=new this.draco.DracoInt32Array;try{return this.decoder.GetTriangleStripsFromMesh(e,t),function(e){let t=e.size(),r=new Int32Array(t);for(let i=0;i<t;i++)r[i]=e.GetValue(i);return r}(t)}finally{this.draco.destroy(t)}}_getAttributeValues(e,t){let r;let i=sl[t.data_type];if(!i)return console.warn(`DRACO: Unsupported attribute type ${t.data_type}`),null;let s=t.num_components,n=e.num_points()*s,o=n*i.BYTES_PER_ELEMENT,a=function(e,t){switch(t){case Float32Array:return e.DT_FLOAT32;case Int8Array:return e.DT_INT8;case Int16Array:return e.DT_INT16;case Int32Array:return e.DT_INT32;case Uint8Array:return e.DT_UINT8;case Uint16Array:return e.DT_UINT16;case Uint32Array:return e.DT_UINT32;default:return e.DT_INVALID}}(this.draco,i),l=this.draco._malloc(o);try{let s=this.decoder.GetAttribute(e,t.attribute_index);this.decoder.GetAttributeDataArrayForAllPoints(e,s,a,o,l),r=new i(this.draco.HEAPF32.buffer,l,n).slice()}finally{this.draco._free(l)}return{value:r,size:s}}_deduceAttributeName(e,t){let r=e.unique_id;for(let[e,i]of Object.entries(t.extraAttributes||{}))if(i===r)return e;let i=e.attribute_type;for(let e in sa)if(this.draco[e]===i)return sa[e];let s=t.attributeNameEntry||"name";return e.metadata[s]?e.metadata[s].string:`CUSTOM_ATTRIBUTE_${r}`}_getTopLevelMetadata(e){let t=this.decoder.GetMetadata(e);return this._getDracoMetadata(t)}_getAttributeMetadata(e,t){let r=this.decoder.GetAttributeMetadata(e,t);return this._getDracoMetadata(r)}_getDracoMetadata(e){if(!e||!e.ptr)return{};let t={},r=this.metadataQuerier.NumEntries(e);for(let i=0;i<r;i++){let r=this.metadataQuerier.GetEntryName(e,i);t[r]=this._getDracoMetadataField(e,r)}return t}_getDracoMetadataField(e,t){let r=new this.draco.DracoInt32Array;try{this.metadataQuerier.GetIntEntryArray(e,t,r);let i=function(e){let t=e.size(),r=new Int32Array(t);for(let i=0;i<t;i++)r[i]=e.GetValue(i);return r}(r);return{int:this.metadataQuerier.GetIntEntry(e,t),string:this.metadataQuerier.GetStringEntry(e,t),double:this.metadataQuerier.GetDoubleEntry(e,t),intArray:i}}finally{this.draco.destroy(r)}}_disableAttributeTransforms(e){let{quantizedAttributes:t=[],octahedronAttributes:r=[]}=e;for(let e of[...t,...r])this.decoder.SkipAttributeTransform(this.draco[e])}_getQuantizationTransform(e,t){let{quantizedAttributes:r=[]}=t,i=e.attribute_type();if(r.map(e=>this.decoder[e]).includes(i)){let t=new this.draco.AttributeQuantizationTransform;try{if(t.InitFromAttribute(e))return{quantization_bits:t.quantization_bits(),range:t.range(),min_values:new Float32Array([1,2,3]).map(e=>t.min_value(e))}}finally{this.draco.destroy(t)}}return null}_getOctahedronTransform(e,t){let{octahedronAttributes:r=[]}=t,i=e.attribute_type();if(r.map(e=>this.decoder[e]).includes(i)){let t=new this.draco.AttributeQuantizationTransform;try{if(t.InitFromAttribute(e))return{quantization_bits:t.quantization_bits()}}finally{this.draco.destroy(t)}}return null}}let su="https://www.gstatic.com/draco/versioned/decoders/1.5.6",sc={DECODER:"draco_wasm_wrapper.js",DECODER_WASM:"draco_decoder.wasm",FALLBACK_DECODER:"draco_decoder.js",ENCODER:"draco_encoder.js"},sd={[sc.DECODER]:`${su}/${sc.DECODER}`,[sc.DECODER_WASM]:`${su}/${sc.DECODER_WASM}`,[sc.FALLBACK_DECODER]:`${su}/${sc.FALLBACK_DECODER}`,[sc.ENCODER]:`https://raw.githubusercontent.com/google/draco/1.4.1/javascript/${sc.ENCODER}`};async function sf(e){let t=e.modules||{};return t.draco3d?a||=t.draco3d.createDecoderModule({}).then(e=>({draco:e})):a||=sp(e),await a}async function sp(e){let t,r;return"js"===(e.draco&&e.draco.decoderType)?t=await rz(sd[sc.FALLBACK_DECODER],"draco",e,sc.FALLBACK_DECODER):[t,r]=await Promise.all([await rz(sd[sc.DECODER],"draco",e,sc.DECODER),await rz(sd[sc.DECODER_WASM],"draco",e,sc.DECODER_WASM)]),t=t||globalThis.DracoDecoderModule,await function(e,t){let r={};return t&&(r.wasmBinary=t),new Promise(t=>{e({...r,onModuleLoaded:e=>t({draco:e})})})}(t,r)}let sg={...si,parse:sm};async function sm(e,t){let{draco:r}=await sf(t),i=new sh(r);try{return i.parseSync(e,t?.draco)}finally{i.destroy()}}function s_(e){var t;let r,i,s;let{buffer:n,size:o,count:a}=(r=t=e,i=1,s=0,t&&t.value&&(r=t.value,i=t.size||1),r&&(ArrayBuffer.isView(r)||(r=function(e,t,r=!1){return e?!Array.isArray(e)&&(!r||e instanceof t)?e:new t(e):null}(r,Float32Array)),s=r.length/i),{buffer:r,size:i,count:s});return{value:n,size:o,byteOffset:0,count:a,type:im(o),componentType:i_(n)}}let sA="KHR_draco_mesh_compression",sE=sA;function sb(e,t,r){let i=new iy(e);for(let e of sv(i))i.getObjectExtension(e,sA)}async function sy(e,t,r){if(!t?.gltf?.decompressMeshes)return;let i=new iy(e),s=[];for(let e of sv(i))i.getObjectExtension(e,sA)&&s.push(sC(i,e,t,r));await Promise.all(s),i.removeExtension(sA)}function sT(e,t={}){let r=new iy(e);for(let e of r.json.meshes||[])(function(e,t,r=4,i,s){if(!(void 0).DracoWriter)throw Error("options.gltf.DracoWriter not provided");let n=i.DracoWriter.encodeSync({attributes:e}),o=void 0;i._addFauxAttributes(o.attributes),i.addBufferView(n)})(e,0),r.addRequiredExtension(sA)}async function sC(e,t,r,i){let s=e.getObjectExtension(t,sA);if(!s)return;let n=e.getTypedArrayForBufferView(s.bufferView),o=(0,rU._m)(n.buffer,n.byteOffset),a={...r};delete a["3d-tiles"];let l=await rG(o,sg,a,i),h=function(e){let t={};for(let r in e){let i=e[r];if("indices"!==r){let e=s_(i);t[r]=e}}return t}(l.attributes);for(let[r,i]of Object.entries(h))if(r in t.attributes){let s=t.attributes[r],n=e.getAccessor(s);n?.min&&n?.max&&(i.min=n.min,i.max=n.max)}t.attributes=h,l.indices&&(t.indices=s_(l.indices)),e.removeObjectExtension(t,sA),function(e){if(!e.attributes&&Object.keys(e.attributes).length>0)throw Error("glTF: Empty primitive detected: Draco decompression failure?")}(t)}function*sv(e){for(let t of e.json.meshes||[])for(let e of t.primitives)yield e}var sR=r(39394),sS=r(42538);!function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL1ROW0=3]="COL1ROW0",e[e.COL1ROW1=4]="COL1ROW1",e[e.COL1ROW2=5]="COL1ROW2",e[e.COL2ROW0=6]="COL2ROW0",e[e.COL2ROW1=7]="COL2ROW1",e[e.COL2ROW2=8]="COL2ROW2"}(d||(d={}));let sB=Object.freeze([1,0,0,0,1,0,0,0,1]);class sw extends sR.u{static get IDENTITY(){return sM||Object.freeze(sM=new sw),sM}static get ZERO(){return l||Object.freeze(l=new sw([0,0,0,0,0,0,0,0,0])),l}get ELEMENTS(){return 9}get RANK(){return 3}get INDICES(){return d}constructor(e,...t){super(-0,-0,-0,-0,-0,-0,-0,-0,-0),1==arguments.length&&Array.isArray(e)?this.copy(e):t.length>0?this.copy([e,...t]):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this.check()}identity(){return this.copy(sB)}fromObject(e){return this.check()}fromQuaternion(e){return!function(e,t){let r=t[0],i=t[1],s=t[2],n=t[3],o=r+r,a=i+i,l=s+s,h=r*o,u=i*o,c=i*a,d=s*o,f=s*a,p=s*l,g=n*o,m=n*a,_=n*l;e[0]=1-c-p,e[3]=u-_,e[6]=d+m,e[1]=u+_,e[4]=1-h-p,e[7]=f-g,e[2]=d-m,e[5]=f+g,e[8]=1-h-c}(this,e),this.check()}set(e,t,r,i,s,n,o,a,l){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this[4]=s,this[5]=n,this[6]=o,this[7]=a,this[8]=l,this.check()}setRowMajor(e,t,r,i,s,n,o,a,l){return this[0]=e,this[1]=i,this[2]=o,this[3]=t,this[4]=s,this[5]=a,this[6]=r,this[7]=n,this[8]=l,this.check()}determinant(){return function(e){let t=e[0],r=e[1],i=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],h=e[8];return t*(h*n-o*l)+r*(-h*s+o*a)+i*(l*s-n*a)}(this)}transpose(){return!function(e,t){if(e===t){let r=t[1],i=t[2],s=t[5];e[1]=t[3],e[2]=t[6],e[3]=r,e[5]=t[7],e[6]=i,e[7]=s}else e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8]}(this,this),this.check()}invert(){return!function(e,t){let r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],h=t[7],u=t[8],c=u*o-a*h,d=-u*n+a*l,f=h*n-o*l,p=r*c+i*d+s*f;p&&(p=1/p,e[0]=c*p,e[1]=(-u*i+s*h)*p,e[2]=(a*i-s*o)*p,e[3]=d*p,e[4]=(u*r-s*l)*p,e[5]=(-a*r+s*n)*p,e[6]=f*p,e[7]=(-h*r+i*l)*p,e[8]=(o*r-i*n)*p)}(this,this),this.check()}multiplyLeft(e){return rl(this,e,this),this.check()}multiplyRight(e){return rl(this,this,e),this.check()}rotate(e){return!function(e,t,r){let i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],h=t[6],u=t[7],c=t[8],d=Math.sin(r),f=Math.cos(r);e[0]=f*i+d*o,e[1]=f*s+d*a,e[2]=f*n+d*l,e[3]=f*o-d*i,e[4]=f*a-d*s,e[5]=f*l-d*n,e[6]=h,e[7]=u,e[8]=c}(this,this,e),this.check()}scale(e){return Array.isArray(e)?rh(this,this,e):rh(this,this,[e,e]),this.check()}translate(e){return!function(e,t,r){let i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],h=t[6],u=t[7],c=t[8],d=r[0],f=r[1];e[0]=i,e[1]=s,e[2]=n,e[3]=o,e[4]=a,e[5]=l,e[6]=d*i+f*o+h,e[7]=d*s+f*a+u,e[8]=d*n+f*l+c}(this,this,e),this.check()}transform(e,t){let r;switch(e.length){case 2:r=(0,sS.ei)(t||[-0,-0],e,this);break;case 3:r=(0,td.ei)(t||[-0,-0,-0],e,this);break;case 4:r=(0,rs.vE)(t||[-0,-0,-0,-0],e,this);break;default:throw Error("Illegal vector")}return(0,ri.qk)(r,e.length),r}transformVector(e,t){return this.transform(e,t)}transformVector2(e,t){return this.transform(e,t)}transformVector3(e,t){return this.transform(e,t)}}let sM=null,sI="KHR_texture_transform",sP=sI,sL=new t5.P,sO=new sw,sx=new sw;async function sN(e,t){if(!new iy(e).hasExtension(sI)||!t.gltf?.loadBuffers)return;let r=e.json.materials||[];for(let t=0;t<r.length;t++)!function(e,t){let r=t.json.materials?.[e],i=[r?.pbrMetallicRoughness?.baseColorTexture,r?.emissiveTexture,r?.normalTexture,r?.occlusionTexture,r?.pbrMetallicRoughness?.metallicRoughnessTexture],s=[];for(let r of i)r&&r?.extensions?.[sI]&&function(e,t,r,i){let s=function(e,t){let r=e.extensions?.[sI],{texCoord:i=0}=e,{texCoord:s=i}=r;if(-1===t.findIndex(([e,t])=>e===i&&t===s)){let n=function(e){let{offset:t=[0,0],rotation:r=0,scale:i=[1,1]}=e,s=new sw().set(1,0,0,0,1,0,t[0],t[1],1),n=sO.set(Math.cos(r),Math.sin(r),0,-Math.sin(r),Math.cos(r),0,0,0,1),o=sx.set(i[0],0,0,0,i[1],0,0,0,1);return s.multiplyRight(n).multiplyRight(o)}(r);return i!==s&&(e.texCoord=s),t.push([i,s]),{originalTexCoord:i,texCoord:s,matrix:n}}return null}(r,i);if(s)for(let r of e.json.meshes||[])for(let i of r.primitives){let r=i.material;Number.isFinite(r)&&t===r&&function(e,t,r){let{originalTexCoord:i,texCoord:s,matrix:n}=r,o=t.attributes[`TEXCOORD_${i}`];if(Number.isFinite(o)){let r=e.json.accessors?.[o];if(r&&r.bufferView){let o=e.json.bufferViews?.[r.bufferView];if(o){var a,l,h,u;let{arrayBuffer:c,byteOffset:d}=e.buffers[o.buffer],f=(d||0)+(r.byteOffset||0)+(o.byteOffset||0),{ArrayType:p,length:g}=iA(r,o),m=ih[r.componentType],_=il[r.type],A=o.byteStride||m*_,E=new Float32Array(g);for(let e=0;e<r.count;e++){let t=new p(c,f+e*A,2);sL.set(t[0],t[1],1),sL.transformByMatrix3(n),E.set([sL[0],sL[1]],e*_)}i===s?(a=r,l=o,h=e.buffers,u=E,a.componentType=5126,h.push({arrayBuffer:u.buffer,byteOffset:0,byteLength:u.buffer.byteLength}),l.buffer=h.length-1,l.byteLength=u.buffer.byteLength,l.byteOffset=0,delete l.byteStride):function(e,t,r,i,s){i.buffers.push({arrayBuffer:s.buffer,byteOffset:0,byteLength:s.buffer.byteLength});let n=i.json.bufferViews;if(!n)return;n.push({buffer:i.buffers.length-1,byteLength:s.buffer.byteLength,byteOffset:0});let o=i.json.accessors;o&&(o.push({bufferView:n?.length-1,byteOffset:0,componentType:5126,count:t.count,type:"VEC2"}),r.attributes[`TEXCOORD_${e}`]=o.length-1)}(s,r,t,e,E)}}}}(e,i,s)}}(t,e,r,s)}(t,e)}let sF="KHR_lights_punctual",sD=sF;async function sU(e){let t=new iy(e),{json:r}=t,i=t.getExtension(sF);for(let e of(i&&(t.json.lights=i.lights,t.removeExtension(sF)),r.nodes||[])){let r=t.getObjectExtension(e,sF);r&&(e.light=r.light),t.removeObjectExtension(e,sF)}}async function sG(e){let t=new iy(e),{json:r}=t;if(r.lights){let e=t.addExtension(sF);it(!e.lights),e.lights=r.lights,delete r.lights}if(t.json.lights){for(let e of t.json.lights){let r=e.node;t.addObjectExtension(r,sF,e)}delete t.json.lights}}let sk="KHR_materials_unlit",sH=sk;async function sV(e){let t=new iy(e),{json:r}=t;for(let e of r.materials||[])e.extensions&&e.extensions.KHR_materials_unlit&&(e.unlit=!0),t.removeObjectExtension(e,sk);t.removeExtension(sk)}function sj(e){let t=new iy(e),{json:r}=t;if(t.materials)for(let e of r.materials||[])e.unlit&&(delete e.unlit,t.addObjectExtension(e,sk,{}),t.addExtension(sk))}let sW="KHR_techniques_webgl",sz=sW;async function sX(e){let t=new iy(e),{json:r}=t,i=t.getExtension(sW);if(i){let e=function(e,t){let{programs:r=[],shaders:i=[],techniques:s=[]}=e,n=new TextDecoder;return i.forEach(e=>{if(Number.isFinite(e.bufferView))e.code=n.decode(t.getTypedArrayForBufferView(e.bufferView));else throw Error("KHR_techniques_webgl: no shader code")}),r.forEach(e=>{e.fragmentShader=i[e.fragmentShader],e.vertexShader=i[e.vertexShader]}),s.forEach(e=>{e.program=r[e.program]}),s}(i,t);for(let i of r.materials||[]){let r=t.getObjectExtension(i,sW);r&&(i.technique=Object.assign({},r,e[r.technique]),i.technique.values=function(e,t){let r=Object.assign({},e.values);return Object.keys(e.uniforms||{}).forEach(t=>{!e.uniforms[t].value||t in r||(r[t]=e.uniforms[t].value)}),Object.keys(r).forEach(e=>{"object"==typeof r[e]&&void 0!==r[e].index&&(r[e].texture=t.getTexture(r[e].index))}),r}(i.technique,t)),t.removeObjectExtension(i,sW)}t.removeExtension(sW)}}async function sK(e,t){}let sJ="EXT_feature_metadata",s$=sJ;async function sY(e,t){!function(e,t){if(!t.gltf?.loadBuffers)return;let r=e.getExtension(sJ);r&&(t.gltf?.loadImages&&function(e,t){let r=t.schema;if(!r)return;let i=r.classes,{featureTextures:s}=t;if(i&&s)for(let t in i){let r=i[t],n=function(e,t){for(let r in e){let i=e[r];if(i.class===t)return i}return null}(s,t);n&&function(e,t,r){let i=t.class;for(let s in r.properties){let r=t?.properties?.[s];r&&(r.data=function(e,t,r){let i=e.gltf.json;if(!i.meshes)return[];let s=[];for(let n of i.meshes)for(let i of n.primitives)(function(e,t,r,i,s){let n=iw(e,{channels:r.channels,...r.texture},s);n&&iM(e,t,n,i,s)})(e,r,t,s,i);return s}(e,r,i))}}(e,n,r)}}(e,r),function(e,t){let r=t.schema;if(!r)return;let i=r.classes,s=t.featureTables;if(i&&s)for(let t in i){let i=function(e,t){for(let r in e){let i=e[r];if(i.class===t)return i}return null}(s,t);i&&function(e,t,r){if(!r.class)return;let i=t.classes?.[r.class];if(!i)throw Error(`Incorrect data in the EXT_structural_metadata extension: no schema class with name ${r.class}`);let s=r.count;for(let t in i.properties){let n=i.properties[t],o=r.properties?.[t];o&&(o.data=function(e,t,r,i,s){var n,o,a,l,h,u,c,d;let f=[],p=s.bufferView,g=e.getTypedArrayForBufferView(p),m=(n=e,o=r,a=s,l=i,"ARRAY"===o.type&&void 0===o.componentCount&&void 0!==a.arrayOffsetBufferView?iS(n,a.arrayOffsetBufferView,a.offsetType||"UINT32",l):null),_=(h=e,u=0,c=s,d=i,void 0!==c.stringOffsetBufferView?iS(h,c.stringOffsetBufferView,c.offsetType||"UINT32",d):null);return"STRING"===r.type||"STRING"===r.componentType?f=iL(i,g,m,_):function(e){let t=["UINT8","INT16","UINT16","INT32","UINT32","INT64","UINT64","FLOAT32","FLOAT64"];return t.includes(e.type)||void 0!==e.componentType&&t.includes(e.componentType)}(r)&&(f=function(e,t,r,i){let s="ARRAY"===e.type,n=e.componentCount,o="SCALAR",a=e.componentType||e.type,l=iR[a]*iC[o],h=r.byteLength/l,u=iB(r,o,a,h);return s?i?iI(u,t,i,r.length,l):n?iP(u,t,n):[]:u}(r,i,g,m)),f}(e,0,n,s,o))}}(e,r,i)}}(e,r))}(new iy(e),t)}let sq=[A,_,E,b,y,T,v,R,S,C,B];async function sQ(e,t={},r){for(let i of sq.filter(e=>sZ(e.name,t)))await i.decode?.(e,t,r)}function sZ(e,t){let r=t?.gltf?.excludeExtensions||{};return!(e in r&&!r[e])}let s0="KHR_binary_glTF",s1={accessors:"accessor",animations:"animation",buffers:"buffer",bufferViews:"bufferView",images:"image",materials:"material",meshes:"mesh",nodes:"node",samplers:"sampler",scenes:"scene",skins:"skin",textures:"texture"},s3={accessor:"accessors",animations:"animation",buffer:"buffers",bufferView:"bufferViews",image:"images",material:"materials",mesh:"meshes",node:"nodes",sampler:"samplers",scene:"scenes",skin:"skins",texture:"textures"};class s2{idToIndexMap={animations:{},accessors:{},buffers:{},bufferViews:{},images:{},materials:{},meshes:{},nodes:{},samplers:{},scenes:{},skins:{},textures:{}};json;normalize(e,t){this.json=e.json;let r=e.json;switch(r.asset&&r.asset.version){case"2.0":return;case void 0:case"1.0":break;default:console.warn(`glTF: Unknown version ${r.asset.version}`);return}if(!t.normalize)throw Error("glTF v1 is not supported.");console.warn("Converting glTF v1 to glTF v2 format. This is experimental and may fail."),this._addAsset(r),this._convertTopLevelObjectsToArrays(r),function(e){let t=new iy(e),{json:r}=t;for(let e of r.images||[]){let r=t.getObjectExtension(e,s0);r&&Object.assign(e,r),t.removeObjectExtension(e,s0)}r.buffers&&r.buffers[0]&&delete r.buffers[0].uri,t.removeExtension(s0)}(e),this._convertObjectIdsToArrayIndices(r),this._updateObjects(r),this._updateMaterial(r)}_addAsset(e){e.asset=e.asset||{},e.asset.version="2.0",e.asset.generator=e.asset.generator||"Normalized to glTF 2.0 by loaders.gl"}_convertTopLevelObjectsToArrays(e){for(let t in s1)this._convertTopLevelObjectToArray(e,t)}_convertTopLevelObjectToArray(e,t){let r=e[t];if(!(!r||Array.isArray(r)))for(let i in e[t]=[],r){let s=r[i];s.id=s.id||i;let n=e[t].length;e[t].push(s),this.idToIndexMap[t][i]=n}}_convertObjectIdsToArrayIndices(e){for(let t in s1)this._convertIdsToIndices(e,t);for(let t of("scene"in e&&(e.scene=this._convertIdToIndex(e.scene,"scene")),e.textures))this._convertTextureIds(t);for(let t of e.meshes)this._convertMeshIds(t);for(let t of e.nodes)this._convertNodeIds(t);for(let t of e.scenes)this._convertSceneIds(t)}_convertTextureIds(e){e.source&&(e.source=this._convertIdToIndex(e.source,"image"))}_convertMeshIds(e){for(let t of e.primitives){let{attributes:e,indices:r,material:i}=t;for(let t in e)e[t]=this._convertIdToIndex(e[t],"accessor");r&&(t.indices=this._convertIdToIndex(r,"accessor")),i&&(t.material=this._convertIdToIndex(i,"material"))}}_convertNodeIds(e){e.children&&(e.children=e.children.map(e=>this._convertIdToIndex(e,"node"))),e.meshes&&(e.meshes=e.meshes.map(e=>this._convertIdToIndex(e,"mesh")))}_convertSceneIds(e){e.nodes&&(e.nodes=e.nodes.map(e=>this._convertIdToIndex(e,"node")))}_convertIdsToIndices(e,t){for(let r of(e[t]||(console.warn(`gltf v1: json doesn't contain attribute ${t}`),e[t]=[]),e[t]))for(let e in r){let t=r[e],i=this._convertIdToIndex(t,e);r[e]=i}}_convertIdToIndex(e,t){let r=s3[t];if(r in this.idToIndexMap){let i=this.idToIndexMap[r][e];if(!Number.isFinite(i))throw Error(`gltf v1: failed to resolve ${t} with id ${e}`);return i}return e}_updateObjects(e){for(let e of this.json.buffers)delete e.type}_updateMaterial(e){for(let t of e.materials){t.pbrMetallicRoughness={baseColorFactor:[1,1,1,1],metallicFactor:1,roughnessFactor:1};let r=t.values?.tex||t.values?.texture2d_0||t.values?.diffuseTex,i=e.textures.findIndex(e=>e.id===r);-1!==i&&(t.pbrMetallicRoughness.baseColorTexture={index:i})}}}async function s6(e,t,r=0,i,s){return function(e,t,r,i){if(i.uri&&(e.baseUri=i.uri),t instanceof ArrayBuffer&&!function(e,t=0,r={}){let i=new DataView(e),{magic:s=0x676c5446}=r,n=i.getUint32(t,!1);return n===s||0x676c5446===n}(t,r,i)&&(t=new TextDecoder().decode(t)),"string"==typeof t)e.json=function(e){try{return JSON.parse(e)}catch(t){throw Error(`Failed to parse JSON from data starting with "${function(e,t=5){return"string"==typeof e?e.slice(0,t):ArrayBuffer.isView(e)?rD(e.buffer,e.byteOffset,t):e instanceof ArrayBuffer?rD(e,0,t):""}(e)}"`)}}(t);else if(t instanceof ArrayBuffer){let s={};r=function(e,t,r=0,i={}){let s=new DataView(t),n=function(e,t=0){return`\
${String.fromCharCode(e.getUint8(t+0))}\
${String.fromCharCode(e.getUint8(t+1))}\
${String.fromCharCode(e.getUint8(t+2))}\
${String.fromCharCode(e.getUint8(t+3))}`}(s,r+0),o=s.getUint32(r+4,!0),a=s.getUint32(r+8,!0);switch(Object.assign(e,{header:{byteOffset:r,byteLength:a,hasBinChunk:!1},type:n,version:o,json:{},binChunks:[]}),r+=12,e.version){case 1:return function(e,t,r){(0,ir.v)(e.header.byteLength>20);let i=t.getUint32(r+0,!0),s=t.getUint32(r+4,!0);return r+=8,(0,ir.v)(0===s),is(e,t,r,i),r+=i,r+=io(e,t,r,e.header.byteLength)}(e,s,r);case 2:var l,h,u,c;return l=e,h=s,u=r,c={},(0,ir.v)(l.header.byteLength>20),function(e,t,r,i){for(;r+8<=e.header.byteLength;){let s=t.getUint32(r+0,!0),n=t.getUint32(r+4,!0);switch(r+=8,n){case 0x4e4f534a:is(e,t,r,s);break;case 5130562:io(e,t,r,s);break;case 0:i.strict||is(e,t,r,s);break;case 1:i.strict||io(e,t,r,s)}r+=ii(s,4)}}(l,h,u,c),u+l.header.byteLength;default:throw Error(`Invalid GLB version ${e.version}. Only supports version 1 and 2.`)}}(s,t,r,i.glb),it("glTF"===s.type,`Invalid GLB magic string ${s.type}`),e._glb=s,e.json=s.json}else it(!1,"GLTF: must be ArrayBuffer or string");if(e.buffers=Array((e.json.buffers||[]).length).fill(null),e._glb&&e._glb.header.hasBinChunk){let{binChunks:t}=e._glb;e.buffers[0]={arrayBuffer:t[0].arrayBuffer,byteOffset:t[0].byteOffset,byteLength:t[0].byteLength}}e.images=Array((e.json.images||[]).length).fill({})}(e,t,r,i),!function(e,t={}){new s2().normalize(e,t)}(e,{normalize:i?.gltf?.normalize}),!function(e,t={},r){for(let i of sq.filter(e=>sZ(e.name,t)))i.preprocess?.(e,t,r)}(e,i,s),i?.gltf?.loadBuffers&&e.json.buffers&&await s4(e,i,s),i?.gltf?.loadImages&&await s8(e,i,s),await sQ(e,i,s),e}async function s4(e,t,r){let i=e.json.buffers||[];for(let s=0;s<i.length;++s){let n=i[s];if(n.uri){let{fetch:i}=r;it(i);let o=ia(n.uri,t),a=await r?.fetch?.(o),l=await a?.arrayBuffer?.();e.buffers[s]={arrayBuffer:l,byteOffset:0,byteLength:l.byteLength},delete n.uri}else null===e.buffers[s]&&(e.buffers[s]={arrayBuffer:new ArrayBuffer(n.byteLength),byteOffset:0,byteLength:n.byteLength})}}async function s8(e,t,r){let i=function(e){let t=new Set;for(let r of e.json.textures||[])void 0!==r.source&&t.add(r.source);return Array.from(t).sort()}(e),s=e.json.images||[],n=[];for(let o of i)n.push(s9(e,s[o],o,t,r));return await Promise.all(n)}async function s9(e,t,r,i,s){let n;if(t.uri&&!t.hasOwnProperty("bufferView")){let e=ia(t.uri,i),{fetch:r}=s,o=await r(e);t.bufferView={data:n=await o.arrayBuffer()}}if(Number.isFinite(t.bufferView)){let r=function(e,t,r){let i=e.bufferViews[r];it(i);let s=t[i.buffer];it(s);let n=(i.byteOffset||0)+s.byteOffset;return new Uint8Array(s.arrayBuffer,n,i.byteLength)}(e.json,e.buffers,t.bufferView);n=(0,rU._m)(r.buffer,r.byteOffset,r.byteLength)}it(n,"glTF image has no data");let o=await rG(n,[rk.$,ie],{...i,mimeType:t.mimeType,basis:i.basis||{format:r7()}},s);o&&o[0]&&(o={compressed:!0,mipmaps:!1,width:o[0].width,height:o[0].height,data:o[0]}),e.images=e.images||[],e.images[r]=o}let s5={dataType:null,batchType:null,name:"glTF",id:"gltf",module:"gltf",version:"4.3.2",extensions:["gltf","glb"],mimeTypes:["model/gltf+json","model/gltf-binary"],text:!0,binary:!0,tests:["glTF"],parse:s7,options:{gltf:{normalize:!0,loadBuffers:!0,loadImages:!0,decompressMeshes:!0},log:console}};async function s7(e,t={},r){(t={...s5.options,...t}).gltf={...s5.options.gltf,...t.gltf};let{byteOffset:i=0}=t;return await s6({},e,i,t,r)}let ne={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},nt={5120:1,5121:1,5122:2,5123:2,5125:4,5126:4},nr={TEXTURE_MAG_FILTER:10240,TEXTURE_MIN_FILTER:10241,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,REPEAT:10497,LINEAR:9729,NEAREST_MIPMAP_LINEAR:9986},ni={magFilter:nr.TEXTURE_MAG_FILTER,minFilter:nr.TEXTURE_MIN_FILTER,wrapS:nr.TEXTURE_WRAP_S,wrapT:nr.TEXTURE_WRAP_T},ns={[nr.TEXTURE_MAG_FILTER]:nr.LINEAR,[nr.TEXTURE_MIN_FILTER]:nr.NEAREST_MIPMAP_LINEAR,[nr.TEXTURE_WRAP_S]:nr.REPEAT,[nr.TEXTURE_WRAP_T]:nr.REPEAT};class nn{baseUri="";jsonUnprocessed;json;buffers=[];images=[];postProcess(e,t={}){let{json:r,buffers:i=[],images:s=[]}=e,{baseUri:n=""}=e;return it(r),this.baseUri=n,this.buffers=i,this.images=s,this.jsonUnprocessed=r,this.json=this._resolveTree(e.json,t),this.json}_resolveTree(e,t={}){let r={...e};return this.json=r,e.bufferViews&&(r.bufferViews=e.bufferViews.map((e,t)=>this._resolveBufferView(e,t))),e.images&&(r.images=e.images.map((e,t)=>this._resolveImage(e,t))),e.samplers&&(r.samplers=e.samplers.map((e,t)=>this._resolveSampler(e,t))),e.textures&&(r.textures=e.textures.map((e,t)=>this._resolveTexture(e,t))),e.accessors&&(r.accessors=e.accessors.map((e,t)=>this._resolveAccessor(e,t))),e.materials&&(r.materials=e.materials.map((e,t)=>this._resolveMaterial(e,t))),e.meshes&&(r.meshes=e.meshes.map((e,t)=>this._resolveMesh(e,t))),e.nodes&&(r.nodes=e.nodes.map((e,t)=>this._resolveNode(e,t)),r.nodes=r.nodes.map((e,t)=>this._resolveNodeChildren(e))),e.skins&&(r.skins=e.skins.map((e,t)=>this._resolveSkin(e,t))),e.scenes&&(r.scenes=e.scenes.map((e,t)=>this._resolveScene(e,t))),"number"==typeof this.json.scene&&r.scenes&&(r.scene=r.scenes[this.json.scene]),r}getScene(e){return this._get(this.json.scenes,e)}getNode(e){return this._get(this.json.nodes,e)}getSkin(e){return this._get(this.json.skins,e)}getMesh(e){return this._get(this.json.meshes,e)}getMaterial(e){return this._get(this.json.materials,e)}getAccessor(e){return this._get(this.json.accessors,e)}getCamera(e){return this._get(this.json.cameras,e)}getTexture(e){return this._get(this.json.textures,e)}getSampler(e){return this._get(this.json.samplers,e)}getImage(e){return this._get(this.json.images,e)}getBufferView(e){return this._get(this.json.bufferViews,e)}getBuffer(e){return this._get(this.json.buffers,e)}_get(e,t){if("object"==typeof t)return t;let r=e&&e[t];return r||console.warn(`glTF file error: Could not find ${e}[${t}]`),r}_resolveScene(e,t){return{...e,id:e.id||`scene-${t}`,nodes:(e.nodes||[]).map(e=>this.getNode(e))}}_resolveNode(e,t){let r={...e,id:e?.id||`node-${t}`};return void 0!==e.mesh&&(r.mesh=this.getMesh(e.mesh)),void 0!==e.camera&&(r.camera=this.getCamera(e.camera)),void 0!==e.skin&&(r.skin=this.getSkin(e.skin)),void 0!==e.meshes&&e.meshes.length&&(r.mesh=e.meshes.reduce((e,t)=>{let r=this.getMesh(t);return e.id=r.id,e.primitives=e.primitives.concat(r.primitives),e},{primitives:[]})),r}_resolveNodeChildren(e){return e.children&&(e.children=e.children.map(e=>this.getNode(e))),e}_resolveSkin(e,t){let r="number"==typeof e.inverseBindMatrices?this.getAccessor(e.inverseBindMatrices):void 0;return{...e,id:e.id||`skin-${t}`,inverseBindMatrices:r}}_resolveMesh(e,t){let r={...e,id:e.id||`mesh-${t}`,primitives:[]};return e.primitives&&(r.primitives=e.primitives.map(e=>{let t={...e,attributes:{},indices:void 0,material:void 0},r=e.attributes;for(let e in r)t.attributes[e]=this.getAccessor(r[e]);return void 0!==e.indices&&(t.indices=this.getAccessor(e.indices)),void 0!==e.material&&(t.material=this.getMaterial(e.material)),t})),r}_resolveMaterial(e,t){let r={...e,id:e.id||`material-${t}`};if(r.normalTexture&&(r.normalTexture={...r.normalTexture},r.normalTexture.texture=this.getTexture(r.normalTexture.index)),r.occlusionTexture&&(r.occlusionTexture={...r.occlusionTexture},r.occlusionTexture.texture=this.getTexture(r.occlusionTexture.index)),r.emissiveTexture&&(r.emissiveTexture={...r.emissiveTexture},r.emissiveTexture.texture=this.getTexture(r.emissiveTexture.index)),r.emissiveFactor||(r.emissiveFactor=r.emissiveTexture?[1,1,1]:[0,0,0]),r.pbrMetallicRoughness){r.pbrMetallicRoughness={...r.pbrMetallicRoughness};let e=r.pbrMetallicRoughness;e.baseColorTexture&&(e.baseColorTexture={...e.baseColorTexture},e.baseColorTexture.texture=this.getTexture(e.baseColorTexture.index)),e.metallicRoughnessTexture&&(e.metallicRoughnessTexture={...e.metallicRoughnessTexture},e.metallicRoughnessTexture.texture=this.getTexture(e.metallicRoughnessTexture.index))}return r}_resolveAccessor(e,t){let r=nt[e.componentType],i=ne[e.type],s={...e,id:e.id||`accessor-${t}`,bytesPerComponent:r,components:i,bytesPerElement:r*i,value:void 0,bufferView:void 0,sparse:void 0};if(void 0!==e.bufferView&&(s.bufferView=this.getBufferView(e.bufferView)),s.bufferView){let e=s.bufferView.buffer,{ArrayType:t,byteLength:r}=iA(s,s.bufferView),i=(s.bufferView.byteOffset||0)+(s.byteOffset||0)+e.byteOffset,n=e.arrayBuffer.slice(i,i+r);s.bufferView.byteStride&&(n=this._getValueFromInterleavedBuffer(e,i,s.bufferView.byteStride,s.bytesPerElement,s.count)),s.value=new t(n)}return s}_getValueFromInterleavedBuffer(e,t,r,i,s){let n=new Uint8Array(s*i);for(let o=0;o<s;o++){let s=t+o*r;n.set(new Uint8Array(e.arrayBuffer.slice(s,s+i)),o*i)}return n.buffer}_resolveTexture(e,t){return{...e,id:e.id||`texture-${t}`,sampler:"number"==typeof e.sampler?this.getSampler(e.sampler):{id:"default-sampler",parameters:ns},source:"number"==typeof e.source?this.getImage(e.source):void 0}}_resolveSampler(e,t){let r={id:e.id||`sampler-${t}`,...e,parameters:{}};for(let e in r){let t=this._enumSamplerParameter(e);void 0!==t&&(r.parameters[t]=r[e])}return r}_enumSamplerParameter(e){return ni[e]}_resolveImage(e,t){let r={...e,id:e.id||`image-${t}`,image:null,bufferView:void 0!==e.bufferView?this.getBufferView(e.bufferView):void 0},i=this.images[t];return i&&(r.image=i),r}_resolveBufferView(e,t){let r=e.buffer,i=this.buffers[r].arrayBuffer,s=this.buffers[r].byteOffset||0;return e.byteOffset&&(s+=e.byteOffset),{id:`bufferView-${t}`,...e,buffer:this.buffers[r],data:new Uint8Array(i,s,e.byteLength)}}_resolveCamera(e,t){let r={...e,id:e.id||`camera-${t}`};return r.perspective,r.orthographic,r}}function no(e,t){return new nn().postProcess(e,t)}async function na(e){let t=[];return e.scenes.forEach(e=>{e.traverse(e=>{Object.values(e.model.uniforms).forEach(e=>{!1===e.loaded&&t.push(e)})})}),await nl(()=>t.some(e=>!e.loaded))}async function nl(e){for(;e();)await new Promise(e=>requestAnimationFrame(e))}let nh=Math.PI/180,nu=new Float32Array(16),nc=new Float32Array(12);function nd(e,t,r){let i=t[0]*nh,s=t[1]*nh,n=t[2]*nh,o=Math.sin(n),a=Math.sin(i),l=Math.sin(s),h=Math.cos(n),u=Math.cos(i),c=Math.cos(s),d=r[0],f=r[1],p=r[2];e[0]=d*c*u,e[1]=d*l*u,e[2]=-(d*a),e[3]=f*(-l*h+c*a*o),e[4]=f*(c*h+l*a*o),e[5]=f*u*o,e[6]=p*(l*o+c*a*h),e[7]=p*(-c*o+l*a*h),e[8]=p*u*h}function nf(e){return e[0]=e[0],e[1]=e[1],e[2]=e[2],e[3]=e[4],e[4]=e[5],e[5]=e[6],e[6]=e[8],e[7]=e[9],e[8]=e[10],e[9]=e[12],e[10]=e[13],e[11]=e[14],e.subarray(0,12)}let np={size:12,accessor:["getOrientation","getScale","getTranslation","getTransformMatrix"],shaderAttributes:{instanceModelMatrixCol0:{size:3,elementOffset:0},instanceModelMatrixCol1:{size:3,elementOffset:3},instanceModelMatrixCol2:{size:3,elementOffset:6},instanceTranslation:{size:3,elementOffset:9}},update(e,{startRow:t,endRow:r}){let{data:i,getOrientation:s,getScale:n,getTranslation:o,getTransformMatrix:a}=this.props,l=Array.isArray(a),h=l&&16===a.length,u=Array.isArray(n),c=Array.isArray(s),d=Array.isArray(o),f=h||!l&&!!a(i[0]);f?e.constant=h:e.constant=c&&u&&d;let p=e.value;if(e.constant){let t;f?(nu.set(a),t=nf(nu)):(nd(t=nc,s,n),t.set(o,9)),e.value=new Float32Array(t)}else{let l=t*e.size,{iterable:g,objectInfo:m}=X(i,t,r);for(let e of g){let t;(m.index++,f)?(nu.set(h?a:a(e,m)),t=nf(nu)):(nd(t=nc,c?s:s(e,m),u?n:n(e,m)),t.set(d?o:o(e,m),9)),p[l++]=t[0],p[l++]=t[1],p[l++]=t[2],p[l++]=t[3],p[l++]=t[4],p[l++]=t[5],p[l++]=t[6],p[l++]=t[7],p[l++]=t[8],p[l++]=t[9],p[l++]=t[10],p[l++]=t[11]}}}};function ng(e,t){return t===O.rf.CARTESIAN||t===O.rf.METER_OFFSETS||t===O.rf.DEFAULT&&!e.isGeospatial}let nm=`\
uniform scenegraphUniforms {
  float sizeScale;
  float sizeMinPixels;
  float sizeMaxPixels;
  mat4 sceneModelMatrix;
  bool composeModelMatrix;
} scenegraph;
`,n_={name:"scenegraph",vs:nm,fs:nm,uniformTypes:{sizeScale:"f32",sizeMinPixels:"f32",sizeMaxPixels:"f32",sceneModelMatrix:"mat4x4<f32>",composeModelMatrix:"f32"}},nA=`\
#version 300 es
#define SHADER_NAME scenegraph-layer-vertex-shader
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
in vec3 positions;
#ifdef HAS_UV
in vec2 texCoords;
#endif
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
in vec3 normals;
#endif
#endif
out vec4 vColor;
#ifndef LIGHTING_PBR
#ifdef HAS_UV
out vec2 vTEXCOORD_0;
#endif
#endif
void main(void) {
#if defined(HAS_UV) && !defined(LIGHTING_PBR)
vTEXCOORD_0 = texCoords;
geometry.uv = texCoords;
#endif
geometry.worldPosition = instancePositions;
geometry.pickingColor = instancePickingColors;
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 normal = vec3(0.0, 0.0, 1.0);
#ifdef LIGHTING_PBR
#ifdef HAS_NORMALS
normal = instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(normals, 0.0)).xyz;
#endif
#endif
float originalSize = project_size_to_pixel(scenegraph.sizeScale);
float clampedSize = clamp(originalSize, scenegraph.sizeMinPixels, scenegraph.sizeMaxPixels);
vec3 pos = (instanceModelMatrix * (scenegraph.sceneModelMatrix * vec4(positions, 1.0)).xyz) * scenegraph.sizeScale * (clampedSize / originalSize) + instanceTranslation;
if(scenegraph.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
geometry.normal = project_normal(normal);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), geometry.position);
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, geometry.position);
geometry.normal = project_normal(normal);
}
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef LIGHTING_PBR
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = texCoords;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
vColor = instanceColors;
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,nE=`\
#version 300 es
#define SHADER_NAME scenegraph-layer-fragment-shader
in vec4 vColor;
out vec4 fragColor;
#ifndef LIGHTING_PBR
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
in vec2 vTEXCOORD_0;
uniform sampler2D pbr_baseColorSampler;
#endif
#endif
void main(void) {
#ifdef LIGHTING_PBR
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
#else
#if defined(HAS_UV) && defined(HAS_BASECOLORMAP)
fragColor = vColor * texture(pbr_baseColorSampler, vTEXCOORD_0);
geometry.uv = vTEXCOORD_0;
#else
fragColor = vColor;
#endif
#endif
fragColor.a *= layer.opacity;
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`,nb=[255,255,255,255],ny={scenegraph:{type:"object",value:null,async:!0},getScene:e=>e&&e.scenes?"object"==typeof e.scene?e.scene:e.scenes[e.scene||0]:e,getAnimator:e=>e&&e.animator,_animations:null,sizeScale:{type:"number",value:1,min:0},sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:nb},_lighting:"flat",_imageBasedLightingEnvironment:void 0,getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},loaders:[s5]};class nT extends tD{getShaders(){let e;let t={};"pbr"===this.props._lighting?(e=t8,t.LIGHTING_PBR=1):e={name:"pbrMaterial"};let r=[tV,tW,n_,e];return super.getShaders({defines:t,vs:nA,fs:nE,modules:r})}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{size:3,type:"float64",fp64:this.use64bitPositions(),accessor:"getPosition",transition:!0},instanceColors:{type:"unorm8",size:this.props.colorFormat.length,accessor:"getColor",defaultValue:nb,transition:!0},instanceModelMatrix:np})}updateState(e){super.updateState(e);let{props:t,oldProps:r}=e;t.scenegraph!==r.scenegraph?this._updateScenegraph():t._animations!==r._animations&&this._applyAnimationsProp(this.state.animator,t._animations)}finalizeState(e){super.finalizeState(e),this.state.scenegraph?.destroy()}get isLoaded(){return!!(this.state?.scenegraph&&super.isLoaded)}_updateScenegraph(){let e=this.props,{device:t}=this.context,r=null;if(e.scenegraph instanceof t7)r={scenes:[e.scenegraph]};else if(e.scenegraph&&"object"==typeof e.scenegraph){let i=e.scenegraph,s=i.json?no(i):i,n=function(e,t,r){let i=new rF(e,r);return{scenes:i.instantiate(t),animator:i.createAnimator()}}(t,s,this._getModelOptions());r={gltf:s,...n},na(n).then(()=>{this.setNeedsRedraw()}).catch(e=>{this.raiseError(e,"loading glTF")})}let i={layer:this,device:this.context.device},s=e.getScene(r,i),n=e.getAnimator(r,i);if(s instanceof re){this.state.scenegraph?.destroy(),this._applyAnimationsProp(n,e._animations);let t=[];s.traverse(e=>{e instanceof rt&&t.push(e.model)}),this.setState({scenegraph:s,animator:n,models:t}),this.getAttributeManager().invalidateAll()}else null!==s&&k.A.warn("invalid scenegraph:",s)()}_applyAnimationsProp(e,t){if(!e||!t)return;let r=e.getAnimations();Object.keys(t).sort().forEach(e=>{let i=t[e];if("*"===e)r.forEach(e=>{Object.assign(e,i)});else if(Number.isFinite(Number(e))){let t=Number(e);t>=0&&t<r.length?Object.assign(r[t],i):k.A.warn(`animation ${e} not found`)()}else{let t=r.find(({name:t})=>t===e);t?Object.assign(t,i):k.A.warn(`animation ${e} not found`)()}})}_getModelOptions(){let e;let{_imageBasedLightingEnvironment:t}=this.props;return t&&(e="function"==typeof t?t({gl:this.context.gl,layer:this}):t),{imageBasedLightingEnvironment:e,modelOptions:{id:this.props.id,isInstanced:!0,bufferLayout:this.getAttributeManager().getBufferLayouts(),...this.getShaders()},useTangents:!1}}draw({context:e}){if(!this.state.scenegraph)return;this.props._animations&&this.state.animator&&(this.state.animator.animate(e.timeline.getTime()),this.setNeedsRedraw());let{viewport:t,renderPass:r}=this.context,{sizeScale:i,sizeMinPixels:s,sizeMaxPixels:n,coordinateSystem:o}=this.props,a=this.getNumInstances();this.state.scenegraph.traverse((e,{worldMatrix:l})=>{if(e instanceof rt){let{model:h}=e;h.setInstanceCount(a);let u={camera:h.uniforms.cameraPosition},c={sizeScale:i,sizeMinPixels:s,sizeMaxPixels:n,composeModelMatrix:ng(t,o),sceneModelMatrix:l};h.shaderInputs.setProps({pbrProjection:u,scenegraph:c}),h.draw(r)}})}}nT.defaultProps=ny,nT.layerName="ScenegraphLayer";let nC={name:"phongMaterial",dependencies:[tK],source:`\
struct phongMaterialUniforms {
  ambient: f32,
  diffuse: f32,
  shininess: f32,
  specularColor: vec3<f32>,
};

@binding(2) @group(0) var<uniform> material : phongMaterialUniforms;

fn lighting_getLightColor(surfaceColor: vec3<f32>, light_direction: vec3<f32>, view_direction: vec3<f32>, normal_worldspace: vec3<f32>, color: vec3<f32>) -> vec3<f32> {
  let halfway_direction: vec3<f32> = normalize(light_direction + view_direction);
  var lambertian: f32 = dot(light_direction, normal_worldspace);
  var specular: f32 = 0.0;
  if (lambertian > 0.0) {
    let specular_angle = max(dot(normal_worldspace, halfway_direction), 0.0);
    specular = pow(specular_angle, material.shininess);
  }
  lambertian = max(lambertian, 0.0);
  return (lambertian * material.diffuse * surfaceColor + specular * material.specularColor) * color;
}

fn lighting_getLightColor2(surfaceColor: vec3<f32>, cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32> {
  var lightColor: vec3<f32> = surfaceColor;

  if (lighting.enabled == 0) {
    return lightColor;
  }

  let view_direction: vec3<f32> = normalize(cameraPosition - position_worldspace);
  lightColor = material.ambient * surfaceColor * lighting.ambientColor;

  if (lighting.lightType == 0) {
    let pointLight: PointLight  = lighting_getPointLight(0);
    let light_position_worldspace: vec3<f32> = pointLight.position;
    let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  } else if (lighting.lightType == 1) {
    var directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  
  return lightColor;
  /*
  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.pointLightCount) {
      break;
    }
    PointLight pointLight = lighting.pointLight[i];
    vec3 light_position_worldspace = pointLight.position;
    vec3 light_direction = normalize(light_position_worldspace - position_worldspace);
    lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
  }

  for (int i = 0; i < MAX_LIGHTS; i++) {
    if (i >= lighting.directionalLightCount) {
      break;
    }
    DirectionalLight directionalLight = lighting.directionalLight[i];
    lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
  }
  */
}

fn lighting_getSpecularLightColor(cameraPosition: vec3<f32>, position_worldspace: vec3<f32>, normal_worldspace: vec3<f32>) -> vec3<f32>{
  var lightColor = vec3<f32>(0, 0, 0);
  let surfaceColor = vec3<f32>(0, 0, 0);

  if (lighting.enabled == 0) {
    let view_direction = normalize(cameraPosition - position_worldspace);

    switch (lighting.lightType) {
      case 0, default: {
        let pointLight: PointLight = lighting_getPointLight(0);
        let light_position_worldspace: vec3<f32> = pointLight.position;
        let light_direction: vec3<f32> = normalize(light_position_worldspace - position_worldspace);
        lightColor += lighting_getLightColor(surfaceColor, light_direction, view_direction, normal_worldspace, pointLight.color);
      }
      case 1: {
        let directionalLight: DirectionalLight = lighting_getDirectionalLight(0);
        lightColor += lighting_getLightColor(surfaceColor, -directionalLight.direction, view_direction, normal_worldspace, directionalLight.color);
      }
    }
  }
  return lightColor;
}
`,vs:t$,fs:tY,defines:{LIGHTING_FRAGMENT:1},uniformTypes:{ambient:"f32",diffuse:"f32",shininess:"f32",specularColor:"vec3<f32>"},defaultUniforms:{ambient:.35,diffuse:.6,shininess:32,specularColor:[.15,.15,.15]},getUniforms(e){let t={...e};return t.specularColor&&(t.specularColor=t.specularColor.map(e=>e/255)),{...nC.defaultUniforms,...t}}},nv=`\
uniform simpleMeshUniforms {
  float sizeScale;
  bool composeModelMatrix;
  bool hasTexture;
  bool flatShading;
} simpleMesh;
`,nR={name:"simpleMesh",vs:nv,fs:nv,uniformTypes:{sizeScale:"f32",composeModelMatrix:"f32",hasTexture:"f32",flatShading:"f32"}},nS=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec3 instancePositions;
in vec3 instancePositions64Low;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
in vec3 instanceTranslation;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
void main(void) {
geometry.worldPosition = instancePositions;
geometry.uv = texCoords;
geometry.pickingColor = instancePickingColors;
vTexCoord = texCoords;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale + instanceTranslation;
if (simpleMesh.composeModelMatrix) {
DECKGL_FILTER_SIZE(pos, geometry);
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.worldPosition += pos;
gl_Position = project_position_to_clipspace(pos + instancePositions, instancePositions64Low, vec3(0.0), position_commonspace);
geometry.position = position_commonspace;
}
else {
pos = project_size(pos);
DECKGL_FILTER_SIZE(pos, geometry);
gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, pos, position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
}
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,nB=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
DECKGL_FILTER_COLOR(color, geometry);
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
}
`;function nw(e){let t=e.positions||e.POSITION;k.A.assert(t,'no "postions" or "POSITION" attribute in mesh');let r=t.value.length/t.size,i=e.COLOR_0||e.colors;i||(i={size:3,value:new Float32Array(3*r).fill(1)});let s=e.NORMAL||e.normals;s||(s={size:3,value:new Float32Array(3*r).fill(0)});let n=e.TEXCOORD_0||e.texCoords;return n||(n={size:2,value:new Float32Array(2*r).fill(0)}),{positions:t,colors:i,normals:s,texCoords:n}}function nM(e){return e instanceof I?(e.attributes=nw(e.attributes),e):new I(e.attributes?{...e,topology:"triangle-list",attributes:nw(e.attributes)}:{topology:"triangle-list",attributes:nw(e)})}class nI extends tD{getShaders(){return super.getShaders({vs:nS,fs:nB,modules:[tV,nC,tW,nR]})}getBounds(){if(this.props._instanced)return super.getBounds();let e=this.state.positionBounds;if(e)return e;let{mesh:t}=this.props;if(!t)return null;if(!(e=t.header?.boundingBox)){let{attributes:r}=nM(t);r.POSITION=r.POSITION||r.positions,e=ss(r)}return this.state.positionBounds=e,e}initializeState(){this.getAttributeManager().addInstanced({instancePositions:{transition:!0,type:"float64",fp64:this.use64bitPositions(),size:3,accessor:"getPosition"},instanceColors:{type:"unorm8",transition:!0,size:this.props.colorFormat.length,accessor:"getColor",defaultValue:[0,0,0,255]},instanceModelMatrix:np}),this.setState({emptyTexture:this.context.device.createTexture({data:new Uint8Array(4),width:1,height:1})})}updateState(e){super.updateState(e);let{props:t,oldProps:r,changeFlags:i}=e;if(t.mesh!==r.mesh||i.extensionsChanged){if(this.state.positionBounds=null,this.state.model?.destroy(),t.mesh){this.state.model=this.getModel(t.mesh);let e=t.mesh.attributes||t.mesh;this.setState({hasNormals:!!(e.NORMAL||e.normals)})}this.getAttributeManager().invalidateAll()}t.texture!==r.texture&&t.texture instanceof ep.g&&this.setTexture(t.texture),this.state.model&&this.state.model.setTopology(this.props.wireframe?"line-strip":"triangle-list")}finalizeState(e){super.finalizeState(e),this.state.emptyTexture.delete()}draw({uniforms:e}){let{model:t}=this.state;if(!t)return;let{viewport:r,renderPass:i}=this.context,{sizeScale:s,coordinateSystem:n,_instanced:o}=this.props,a={sizeScale:s,composeModelMatrix:!o||ng(r,n),flatShading:!this.state.hasNormals};t.shaderInputs.setProps({simpleMesh:a}),t.draw(i)}get isLoaded(){return!!(this.state?.model&&super.isLoaded)}getModel(e){let t=new eN(this.context.device,{...this.getShaders(),id:this.props.id,bufferLayout:this.getAttributeManager().getBufferLayouts(),geometry:nM(e),isInstanced:!0}),{texture:r}=this.props,{emptyTexture:i}=this.state;return t.shaderInputs.setProps({simpleMesh:{sampler:r||i,hasTexture:!!r}}),t}setTexture(e){let{emptyTexture:t,model:r}=this.state;r&&r.shaderInputs.setProps({simpleMesh:{sampler:e||t,hasTexture:!!e}})}}nI.defaultProps={mesh:{type:"object",value:null,async:!0},texture:{type:"image",value:null,async:!0},sizeScale:{type:"number",value:1,min:0},_instanced:!0,wireframe:!1,material:!0,getPosition:{type:"accessor",value:e=>e.position},getColor:{type:"accessor",value:[0,0,0,255]},getOrientation:{type:"accessor",value:[0,0,0]},getScale:{type:"accessor",value:[1,1,1]},getTranslation:{type:"accessor",value:[0,0,0]},getTransformMatrix:{type:"accessor",value:[]},textureParameters:{type:"object",ignore:!0,value:null}},nI.layerName="SimpleMeshLayer";let nP=nI,nL=`\
uniform meshUniforms {
  bool pickFeatureIds;
} mesh;
`,nO={name:"mesh",vs:nL,fs:nL,uniformTypes:{pickFeatureIds:"f32"}},nx=`#version 300 es
#define SHADER_NAME simple-mesh-layer-vs
in vec3 positions;
in vec3 normals;
in vec3 colors;
in vec2 texCoords;
in vec4 uvRegions;
in vec3 featureIdsPickingColors;
in vec4 instanceColors;
in vec3 instancePickingColors;
in vec3 instanceModelMatrixCol0;
in vec3 instanceModelMatrixCol1;
in vec3 instanceModelMatrixCol2;
out vec2 vTexCoord;
out vec3 cameraPosition;
out vec3 normals_commonspace;
out vec4 position_commonspace;
out vec4 vColor;
vec2 applyUVRegion(vec2 uv) {
#ifdef HAS_UV_REGIONS
return fract(uv) * (uvRegions.zw - uvRegions.xy) + uvRegions.xy;
#else
return uv;
#endif
}
void main(void) {
vec2 uv = applyUVRegion(texCoords);
geometry.uv = uv;
if (mesh.pickFeatureIds) {
geometry.pickingColor = featureIdsPickingColors;
} else {
geometry.pickingColor = instancePickingColors;
}
mat3 instanceModelMatrix = mat3(instanceModelMatrixCol0, instanceModelMatrixCol1, instanceModelMatrixCol2);
vTexCoord = uv;
cameraPosition = project.cameraPosition;
vColor = vec4(colors * instanceColors.rgb, instanceColors.a);
vec3 pos = (instanceModelMatrix * positions) * simpleMesh.sizeScale;
vec3 projectedPosition = project_position(positions);
position_commonspace = vec4(projectedPosition, 1.0);
gl_Position = project_common_position_to_clipspace(position_commonspace);
geometry.position = position_commonspace;
normals_commonspace = project_normal(instanceModelMatrix * normals);
geometry.normal = normals_commonspace;
DECKGL_FILTER_GL_POSITION(gl_Position, geometry);
#ifdef MODULE_PBRMATERIAL
pbr_vPosition = geometry.position.xyz;
#ifdef HAS_NORMALS
pbr_vNormal = geometry.normal;
#endif
#ifdef HAS_UV
pbr_vUV = uv;
#else
pbr_vUV = vec2(0., 0.);
#endif
geometry.uv = pbr_vUV;
#endif
DECKGL_FILTER_COLOR(vColor, geometry);
}
`,nN=`#version 300 es
#define SHADER_NAME simple-mesh-layer-fs
precision highp float;
uniform sampler2D sampler;
in vec2 vTexCoord;
in vec3 cameraPosition;
in vec3 normals_commonspace;
in vec4 position_commonspace;
in vec4 vColor;
out vec4 fragColor;
void main(void) {
#ifdef MODULE_PBRMATERIAL
fragColor = vColor * pbr_filterColor(vec4(0));
geometry.uv = pbr_vUV;
fragColor.a *= layer.opacity;
#else
geometry.uv = vTexCoord;
vec3 normal;
if (simpleMesh.flatShading) {
normal = normalize(cross(dFdx(position_commonspace.xyz), dFdy(position_commonspace.xyz)));
} else {
normal = normals_commonspace;
}
vec4 color = simpleMesh.hasTexture ? texture(sampler, vTexCoord) : vColor;
vec3 lightColor = lighting_getLightColor(color.rgb, cameraPosition, position_commonspace.xyz, normal);
fragColor = vec4(lightColor, color.a * layer.opacity);
#endif
DECKGL_FILTER_COLOR(fragColor, geometry);
}
`;class nF extends nP{getShaders(){let e=super.getShaders();return e.modules.push(t8,nO),{...e,vs:nx,fs:nN}}initializeState(){let{featureIds:e}=this.props;super.initializeState();let t=this.getAttributeManager();e&&t.add({featureIdsPickingColors:{type:"uint8",size:3,noAlloc:!0,update:this.calculateFeatureIdsPickingColors}})}updateState(e){super.updateState(e);let{props:t,oldProps:r}=e;t.pbrMaterial!==r.pbrMaterial&&this.updatePbrMaterialUniforms(t.pbrMaterial)}draw(e){let{featureIds:t}=this.props,{model:r}=this.state;if(!r)return;let i={camera:r.uniforms.cameraPosition};r.shaderInputs.setProps({pbrProjection:i,mesh:{pickFeatureIds:!!t}}),super.draw(e)}getModel(e){let{id:t}=this.props,r=this.parseMaterial(this.props.pbrMaterial,e);this.setState({parsedPBRMaterial:r});let i=this.getShaders();return!function(e){let t=e.positions||e.POSITION,r=t.value.length/t.size;e.COLOR_0||e.colors||(e.colors={size:4,value:new Uint8Array(4*r).fill(255),normalized:!0})}(e.attributes),new eN(this.context.device,{...this.getShaders(),id:t,geometry:e,bufferLayout:this.getAttributeManager().getBufferLayouts(),defines:{...i.defines,...r?.defines,HAS_UV_REGIONS:+!!e.attributes.uvRegions},parameters:r?.parameters,isInstanced:!0})}updatePbrMaterialUniforms(e){let{model:t}=this.state;if(t){let{mesh:r}=this.props,i=this.parseMaterial(e,r);this.setState({parsedPBRMaterial:i});let{pbr_baseColorSampler:s}=i.bindings,{emptyTexture:n}=this.state,{camera:o,...a}={...i.bindings,...i.uniforms};t.shaderInputs.setProps({simpleMesh:{sampler:s||n,hasTexture:!!s},pbrMaterial:a})}}parseMaterial(e,t){let r=!!(e.pbrMetallicRoughness&&e.pbrMetallicRoughness.baseColorTexture);return rI(this.context.device,{unlit:r,...e},{NORMAL:t.attributes.normals,TEXCOORD_0:t.attributes.texCoords},{pbrDebug:!1,lights:!0,useTangents:!1})}calculateFeatureIdsPickingColors(e){let t=this.props.featureIds,r=new Uint8ClampedArray(t.length*e.size),i=[];for(let e=0;e<t.length;e++)this.encodePickingColor(t[e],i),r[3*e]=i[0],r[3*e+1]=i[1],r[3*e+2]=i[2];e.value=r}finalizeState(e){super.finalizeState(e),this.state.parsedPBRMaterial?.generatedTextures.forEach(e=>e.destroy()),this.setState({parsedPBRMaterial:null})}}nF.layerName="MeshLayer",nF.defaultProps={pbrMaterial:{type:"object",value:null},featureIds:{type:"array",value:null,optional:!0}};var nD=r(34752);function nU(e){return e}new t5.P;let nG=new t5.P,nk={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},nH={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},nV={east:new t5.P,north:new t5.P,up:new t5.P,west:new t5.P,south:new t5.P,down:new t5.P},nj=new t5.P,nW=new t5.P,nz=new t5.P;function nX(e,t,r,i,s,n){let o,a,l;let h=nk[t]&&nk[t][r];(0,nD.v)(h&&(!i||i===h));let u=nG.copy(s);if((0,e9.aI)(u.x,0,1e-14)&&(0,e9.aI)(u.y,0,1e-14)){let e=Math.sign(u.z);o=nj.fromArray(nH[t]),"east"!==t&&"west"!==t&&o.scale(e),a=nW.fromArray(nH[r]),"east"!==r&&"west"!==r&&a.scale(e),l=nz.fromArray(nH[i]),"east"!==i&&"west"!==i&&l.scale(e)}else{let{up:s,east:n,north:h}=nV;n.set(-u.y,u.x,0).normalize(),e.geodeticSurfaceNormal(u,s),h.copy(s).cross(n);let{down:c,west:d,south:f}=nV;c.copy(s).scale(-1),d.copy(n).scale(-1),f.copy(h).scale(-1),o=nV[t],a=nV[r],l=nV[i]}return n[0]=o.x,n[1]=o.y,n[2]=o.z,n[3]=0,n[4]=a.x,n[5]=a.y,n[6]=a.z,n[7]=0,n[8]=l.x,n[9]=l.y,n[10]=l.z,n[11]=0,n[12]=u.x,n[13]=u.y,n[14]=u.z,n[15]=1,n}let nK=new t5.P,nJ=new t5.P,n$=new t5.P,nY=new t5.P,nq=new t5.P,nQ=new t5.P,nZ=new t5.P,n0=new t5.P,n1=new t5.P;class n3{constructor(e=0,t=0,r=0){this.centerToleranceSquared=.1,(0,nD.v)(e>=0),(0,nD.v)(t>=0),(0,nD.v)(r>=0),this.radii=new t5.P(e,t,r),this.radiiSquared=new t5.P(e*e,t*t,r*r),this.radiiToTheFourth=new t5.P(e*e*e*e,t*t*t*t,r*r*r*r),this.oneOverRadii=new t5.P(0===e?0:1/e,0===t?0:1/t,0===r?0:1/r),this.oneOverRadiiSquared=new t5.P(0===e?0:1/(e*e),0===t?0:1/(t*t),0===r?0:1/(r*r)),this.minimumRadius=Math.min(e,t,r),this.maximumRadius=Math.max(e,t,r),0!==this.radiiSquared.z&&(this.squaredXOverSquaredZ=this.radiiSquared.x/this.radiiSquared.z),Object.freeze(this)}equals(e){return this===e||!!(e&&this.radii.equals(e.radii))}toString(){return this.radii.toString()}cartographicToCartesian(e,t=[0,0,0]){let[,,r]=e;this.geodeticSurfaceNormalCartographic(e,nq),nQ.copy(this.radiiSquared).scale(nq);let i=Math.sqrt(nq.dot(nQ));return nQ.scale(1/i),nq.scale(r),nQ.add(nq),nQ.to(t)}cartesianToCartographic(e,t=[0,0,0]){n1.from(e);let r=this.scaleToGeodeticSurface(n1,nZ);if(!r)return;let i=this.geodeticSurfaceNormal(r,nq);n0.copy(n1).subtract(r);let s=Math.atan2(i.y,i.x);return function(e,t,r=nU){return"longitude"in t?(t.longitude=r(e[0]),t.latitude=r(e[1]),t.height=e[2]):"x"in t?(t.x=r(e[0]),t.y=r(e[1]),t.z=e[2]):(t[0]=r(e[0]),t[1]=r(e[1]),t[2]=e[2]),t}([s,Math.asin(i.z),Math.sign(td.Om(n0,n1))*td.Bw(n0)],t,e9.$W._cartographicRadians?nU:e9.xW)}eastNorthUpToFixedFrame(e,t=new t9.k){return nX(this,"east","north","up",e,t)}localFrameToFixedFrame(e,t,r,i,s=new t9.k){return nX(this,e,t,r,i,s)}geocentricSurfaceNormal(e,t=[0,0,0]){return nY.from(e).normalize().to(t)}geodeticSurfaceNormalCartographic(e,t=[0,0,0]){let r=function(e,t=[]){return function(e,t=[],r=nU){return"longitude"in e?(t[0]=r(e.longitude),t[1]=r(e.latitude),t[2]=e.height):"x"in e?(t[0]=r(e.x),t[1]=r(e.y),t[2]=e.z):(t[0]=r(e[0]),t[1]=r(e[1]),t[2]=e[2]),t}(e,t,e9.$W._cartographicRadians?nU:e9.eh)}(e),i=r[0],s=r[1],n=Math.cos(s);return nY.set(n*Math.cos(i),n*Math.sin(i),Math.sin(s)).normalize(),nY.to(t)}geodeticSurfaceNormal(e,t=[0,0,0]){return nY.from(e).scale(this.oneOverRadiiSquared).normalize().to(t)}scaleToGeodeticSurface(e,t){return function(e,t,r=[]){let i,s,n,o;let{oneOverRadii:a,oneOverRadiiSquared:l,centerToleranceSquared:h}=t;nK.from(e);let u=nK.x,c=nK.y,d=nK.z,f=a.x,p=a.y,g=a.z,m=u*u*f*f,_=c*c*p*p,A=d*d*g*g,E=m+_+A,b=Math.sqrt(1/E);if(!Number.isFinite(b))return;if(nJ.copy(e).scale(b),E<h)return nJ.to(r);let y=l.x,T=l.y,C=l.z;n$.set(nJ.x*y*2,nJ.y*T*2,nJ.z*C*2);let v=(1-b)*nK.len()/(.5*n$.len()),R=0;do{v-=R;let e=(i=1/(1+v*y))*i,t=(s=1/(1+v*T))*s,r=(n=1/(1+v*C))*n,a=e*i,l=t*s,h=r*n;R=(o=m*e+_*t+A*r-1)/(-2*(m*a*y+_*l*T+A*h*C))}while(Math.abs(o)>1e-12);return nK.scale([i,s,n]).to(r)}(e,this,t)}scaleToGeocentricSurface(e,t=[0,0,0]){nZ.from(e);let r=nZ.x,i=nZ.y,s=nZ.z,n=this.oneOverRadiiSquared,o=1/Math.sqrt(r*r*n.x+i*i*n.y+s*s*n.z);return nZ.multiplyScalar(o).to(t)}transformPositionToScaledSpace(e,t=[0,0,0]){return nZ.from(e).scale(this.oneOverRadii).to(t)}transformPositionFromScaledSpace(e,t=[0,0,0]){return nZ.from(e).scale(this.radii).to(t)}getSurfaceNormalIntersectionWithZAxis(e,t=0,r=[0,0,0]){(0,nD.v)((0,e9.aI)(this.radii.x,this.radii.y,1e-15)),(0,nD.v)(this.radii.z>0),nZ.from(e);let i=nZ.z*(1-this.squaredXOverSquaredZ);if(!(Math.abs(i)>=this.radii.z-t))return nZ.set(0,0,i).to(r)}}n3.WGS84=new n3(6378137,6378137,6356752.314245179);var n2=r(7840),n6=r(89362);let n4={id:"request-scheduler",throttleRequests:!0,maxRequests:6,debounceTime:0};class n8{props;stats;activeRequestCount=0;requestQueue=[];requestMap=new Map;updateTimer=null;constructor(e={}){this.props={...n4,...e},this.stats=new n2.Uz({id:this.props.id}),this.stats.get("Queued Requests"),this.stats.get("Active Requests"),this.stats.get("Cancelled Requests"),this.stats.get("Queued Requests Ever"),this.stats.get("Active Requests Ever")}scheduleRequest(e,t=()=>0){if(!this.props.throttleRequests)return Promise.resolve({done:()=>{}});if(this.requestMap.has(e))return this.requestMap.get(e);let r={handle:e,priority:0,getPriority:t},i=new Promise(e=>(r.resolve=e,r));return this.requestQueue.push(r),this.requestMap.set(e,i),this._issueNewRequests(),i}_issueRequest(e){let{handle:t,resolve:r}=e,i=!1,s=()=>{i||(i=!0,this.requestMap.delete(t),this.activeRequestCount--,this._issueNewRequests())};return this.activeRequestCount++,r?r({done:s}):Promise.resolve({done:s})}_issueNewRequests(){null!==this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=setTimeout(()=>this._issueNewRequestsAsync(),this.props.debounceTime)}_issueNewRequestsAsync(){null!==this.updateTimer&&clearTimeout(this.updateTimer),this.updateTimer=null;let e=Math.max(this.props.maxRequests-this.activeRequestCount,0);if(0!==e){this._updateAllRequests();for(let t=0;t<e;++t){let e=this.requestQueue.shift();e&&this._issueRequest(e)}}}_updateAllRequests(){let e=this.requestQueue;for(let t=0;t<e.length;++t){let r=e[t];!this._updateRequest(r)&&(e.splice(t,1),this.requestMap.delete(r.handle),t--)}e.sort((e,t)=>e.priority-t.priority)}_updateRequest(e){return e.priority=e.getPriority(e.handle),!(e.priority<0)||(e.resolve(null),!1)}}class n9{item;previous;next;constructor(e,t,r){this.item=e,this.previous=t,this.next=r}}class n5{head=null;tail=null;_length=0;get length(){return this._length}add(e){let t=new n9(e,this.tail,null);return this.tail?this.tail.next=t:this.head=t,this.tail=t,++this._length,t}remove(e){e&&(e.previous&&e.next?(e.previous.next=e.next,e.next.previous=e.previous):e.previous?(e.previous.next=null,this.tail=e.previous):e.next?(e.next.previous=null,this.head=e.next):(this.head=null,this.tail=null),e.next=null,e.previous=null,--this._length)}splice(e,t){e!==t&&(this.remove(t),this._insert(e,t))}_insert(e,t){let r=e.next;e.next=t,this.tail===e?this.tail=t:r.previous=t,t.next=r,t.previous=e,++this._length}}class n7{_list;_sentinel;_trimTiles;constructor(){this._list=new n5,this._sentinel=this._list.add("sentinel"),this._trimTiles=!1}reset(){this._list.splice(this._list.tail,this._sentinel)}touch(e){let t=e._cacheNode;t&&this._list.splice(this._sentinel,t)}add(e,t,r){!t._cacheNode&&(t._cacheNode=this._list.add(t),r&&r(e,t))}unloadTile(e,t,r){let i=t._cacheNode;i&&(this._list.remove(i),t._cacheNode=null,r&&r(e,t))}unloadTiles(e,t){let r=this._trimTiles;this._trimTiles=!1;let i=this._list,s=1048576*e.maximumMemoryUsage,n=this._sentinel,o=i.head;for(;o!==n&&(e.gpuMemoryUsageInBytes>s||r);){let r=o.item;o=o.next,this.unloadTile(e,r,t)}}trim(){this._trimTiles=!0}}let oe={OUTSIDE:-1,INTERSECTING:0,INSIDE:1};new t5.P,new t5.P;var ot=r(74456);let or=new t5.P,oi=new t5.P;class os{constructor(e=[0,0,0],t=0){this.radius=-0,this.center=new t5.P,this.fromCenterRadius(e,t)}fromCenterRadius(e,t){return this.center.from(e),this.radius=t,this}fromCornerPoints(e,t){return t=or.from(t),this.center=new t5.P().from(e).add(t).scale(.5),this.radius=this.center.distance(t),this}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.radius===e.radius}clone(){return new os(this.center,this.radius)}union(e){let t=this.center,r=this.radius,i=e.center,s=e.radius,n=or.copy(i).subtract(t),o=n.magnitude();if(r>=o+s)return this.clone();if(s>=o+r)return e.clone();let a=(r+o+s)*.5;return oi.copy(n).scale((-r+a)/o).add(t),this.center.copy(oi),this.radius=a,this}expand(e){let t=or.from(e).subtract(this.center).magnitude();return t>this.radius&&(this.radius=t),this}transform(e){this.center.transform(e);let t=ot.IL(or,e);return this.radius=Math.max(t[0],Math.max(t[1],t[2]))*this.radius,this}distanceSquaredTo(e){let t=this.distanceTo(e);return t*t}distanceTo(e){return Math.max(0,or.from(e).subtract(this.center).len()-this.radius)}intersectPlane(e){let t=this.center,r=this.radius,i=e.normal.dot(t)+e.distance;return i<-r?oe.OUTSIDE:i<r?oe.INTERSECTING:oe.INSIDE}}let on=new t5.P,oo=new t5.P,oa=new t5.P,ol=new t5.P,oh=new t5.P,ou=new t5.P,oc=new t5.P,od={COLUMN0ROW0:0,COLUMN0ROW1:1,COLUMN0ROW2:2,COLUMN1ROW0:3,COLUMN1ROW1:4,COLUMN1ROW2:5,COLUMN2ROW0:6,COLUMN2ROW1:7,COLUMN2ROW2:8};class of{constructor(e=[0,0,0],t=[0,0,0,0,0,0,0,0,0]){this.center=new t5.P().from(e),this.halfAxes=new sw(t)}get halfSize(){let e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2);return[new t5.P(e).len(),new t5.P(t).len(),new t5.P(r).len()]}get quaternion(){let e=this.halfAxes.getColumn(0),t=this.halfAxes.getColumn(1),r=this.halfAxes.getColumn(2),i=new t5.P(e).normalize(),s=new t5.P(t).normalize(),n=new t5.P(r).normalize();return new rT().fromMatrix3(new sw([...i,...s,...n]))}fromCenterHalfSizeQuaternion(e,t,r){let i=new rT(r),s=new sw().fromQuaternion(i);return s[0]=s[0]*t[0],s[1]=s[1]*t[0],s[2]=s[2]*t[0],s[3]=s[3]*t[1],s[4]=s[4]*t[1],s[5]=s[5]*t[1],s[6]=s[6]*t[2],s[7]=s[7]*t[2],s[8]=s[8]*t[2],this.center=new t5.P().from(e),this.halfAxes=s,this}clone(){return new of(this.center,this.halfAxes)}equals(e){return this===e||!!e&&this.center.equals(e.center)&&this.halfAxes.equals(e.halfAxes)}getBoundingSphere(e=new os){let t=this.halfAxes,r=t.getColumn(0,oa),i=t.getColumn(1,ol),s=t.getColumn(2,oh),n=on.copy(r).add(i).add(s);return e.center.copy(this.center),e.radius=n.magnitude(),e}intersectPlane(e){let t=this.center,r=e.normal,i=this.halfAxes,s=r.x,n=r.y,o=r.z,a=Math.abs(s*i[od.COLUMN0ROW0]+n*i[od.COLUMN0ROW1]+o*i[od.COLUMN0ROW2])+Math.abs(s*i[od.COLUMN1ROW0]+n*i[od.COLUMN1ROW1]+o*i[od.COLUMN1ROW2])+Math.abs(s*i[od.COLUMN2ROW0]+n*i[od.COLUMN2ROW1]+o*i[od.COLUMN2ROW2]),l=r.dot(t)+e.distance;return l<=-a?oe.OUTSIDE:l>=a?oe.INSIDE:oe.INTERSECTING}distanceTo(e){return Math.sqrt(this.distanceSquaredTo(e))}distanceSquaredTo(e){let t;let r=oo.from(e).subtract(this.center),i=this.halfAxes,s=i.getColumn(0,oa),n=i.getColumn(1,ol),o=i.getColumn(2,oh),a=s.magnitude(),l=n.magnitude(),h=o.magnitude();s.normalize(),n.normalize(),o.normalize();let u=0;return(t=Math.abs(r.dot(s))-a)>0&&(u+=t*t),(t=Math.abs(r.dot(n))-l)>0&&(u+=t*t),(t=Math.abs(r.dot(o))-h)>0&&(u+=t*t),u}computePlaneDistances(e,t,r=[-0,-0]){let i=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,n=this.center,o=this.halfAxes,a=o.getColumn(0,oa),l=o.getColumn(1,ol),h=o.getColumn(2,oh),u=ou.copy(a).add(l).add(h).add(n),c=oc.copy(u).subtract(e),d=t.dot(c);return i=Math.min(d,i),s=Math.max(d,s),u.copy(n).add(a).add(l).subtract(h),c.copy(u).subtract(e),i=Math.min(d=t.dot(c),i),s=Math.max(d,s),u.copy(n).add(a).subtract(l).add(h),c.copy(u).subtract(e),i=Math.min(d=t.dot(c),i),s=Math.max(d,s),u.copy(n).add(a).subtract(l).subtract(h),c.copy(u).subtract(e),i=Math.min(d=t.dot(c),i),s=Math.max(d,s),n.copy(u).subtract(a).add(l).add(h),c.copy(u).subtract(e),i=Math.min(d=t.dot(c),i),s=Math.max(d,s),n.copy(u).subtract(a).add(l).subtract(h),c.copy(u).subtract(e),i=Math.min(d=t.dot(c),i),s=Math.max(d,s),n.copy(u).subtract(a).subtract(l).add(h),c.copy(u).subtract(e),i=Math.min(d=t.dot(c),i),s=Math.max(d,s),n.copy(u).subtract(a).subtract(l).subtract(h),c.copy(u).subtract(e),i=Math.min(d=t.dot(c),i),s=Math.max(d,s),r[0]=i,r[1]=s,r}transform(e){this.center.transformAsPoint(e);let t=this.halfAxes.getColumn(0,oa);t.transformAsPoint(e);let r=this.halfAxes.getColumn(1,ol);r.transformAsPoint(e);let i=this.halfAxes.getColumn(2,oh);return i.transformAsPoint(e),this.halfAxes=new sw([...t,...r,...i]),this}getTransform(){throw Error("not implemented")}}let op=new t5.P,og=new t5.P;class om{constructor(e=[0,0,1],t=0){this.normal=new t5.P,this.distance=-0,this.fromNormalDistance(e,t)}fromNormalDistance(e,t){return(0,nD.v)(Number.isFinite(t)),this.normal.from(e).normalize(),this.distance=t,this}fromPointNormal(e,t){e=op.from(e),this.normal.from(t).normalize();let r=-this.normal.dot(e);return this.distance=r,this}fromCoefficients(e,t,r,i){return this.normal.set(e,t,r),(0,nD.v)((0,e9.aI)(this.normal.len(),1)),this.distance=i,this}clone(){return new om(this.normal,this.distance)}equals(e){return(0,e9.aI)(this.distance,e.distance)&&(0,e9.aI)(this.normal,e.normal)}getPointDistance(e){return this.normal.dot(e)+this.distance}transform(e){let t=og.copy(this.normal).transformAsVector(e).normalize(),r=this.normal.scale(-this.distance).transform(e);return this.fromPointNormal(r,t)}projectPointOntoPlane(e,t=[0,0,0]){let r=op.from(e),i=this.getPointDistance(r),s=og.copy(this.normal).scale(i);return r.subtract(s).to(t)}}let o_=[new t5.P([1,0,0]),new t5.P([0,1,0]),new t5.P([0,0,1])],oA=new t5.P,oE=new t5.P;class ob{constructor(e=[]){this.planes=e}fromBoundingSphere(e){this.planes.length=2*o_.length;let t=e.center,r=e.radius,i=0;for(let e of o_){let s=this.planes[i],n=this.planes[i+1];s||(s=this.planes[i]=new om),n||(n=this.planes[i+1]=new om);let o=oA.copy(e).scale(-r).add(t);s.fromPointNormal(o,e);let a=oA.copy(e).scale(r).add(t),l=oE.copy(e).negate();n.fromPointNormal(a,l),i+=2}return this}computeVisibility(e){let t=oe.INSIDE;for(let r of this.planes)switch(e.intersectPlane(r)){case oe.OUTSIDE:return oe.OUTSIDE;case oe.INTERSECTING:t=oe.INTERSECTING}return t}computeVisibilityWithPlaneMask(e,t){if((0,nD.v)(Number.isFinite(t),"parentPlaneMask is required."),t===ob.MASK_OUTSIDE||t===ob.MASK_INSIDE)return t;let r=ob.MASK_INSIDE,i=this.planes;for(let s=0;s<this.planes.length;++s){let n=s<31?1<<s:0;if(s<31&&(t&n)==0)continue;let o=i[s],a=e.intersectPlane(o);if(a===oe.OUTSIDE)return ob.MASK_OUTSIDE;a===oe.INTERSECTING&&(r|=n)}return r}}ob.MASK_OUTSIDE=0xffffffff,ob.MASK_INSIDE=0,ob.MASK_INDETERMINATE=0x7fffffff,new t5.P,new t5.P,new t5.P,new t5.P,new t5.P,new t5.P,new t5.P,new t5.P,new t5.P,new t5.P,new t5.P,new t5.P,new t5.P,new t5.P,new t5.P,new t5.P,new t5.P;let oy=new sw,oT=new sw,oC=new sw,ov=new sw,oR=new sw,oS=[1,0,0],oB=[2,2,1],ow=new t5.P,oM=new t5.P,oI=new t5.P,oP=new t5.P,oL=new t5.P,oO=new sw,ox={diagonal:new sw,unitary:new sw},oN=new t5.P,oF=new t5.P,oD=new ob([new om,new om,new om,new om,new om,new om]);function oU(e,t,r=new t5.P){let i=e.normal.dot(t);return r.copy(e.normal).scale(e.distance-i).add(t),r}function oG(e,t,r=new t5.P){let i=e.unprojectPosition(t);return n3.WGS84.cartographicToCartesian(i,r)}let ok=new t5.P;function oH(e,t,r){return n3.WGS84.cartographicToCartesian([e.xmax,e.ymax,e.zmax],ok),Math.log2(6356752.314245179/(Math.sqrt(Math.pow(ok[0]-r[0],2)+Math.pow(ok[1]-r[1],2)+Math.pow(ok[2]-r[2],2))+t[2]))}let oV={UNLOADED:0,LOADING:1,READY:3,EXPIRED:4,FAILED:5};!function(e){e[e.ADD=1]="ADD",e[e.REPLACE=2]="REPLACE"}(f||(f={})),function(e){e.EMPTY="empty",e.SCENEGRAPH="scenegraph",e.POINTCLOUD="pointcloud",e.MESH="mesh"}(p||(p={})),function(e){e.I3S="I3S",e.TILES3D="TILES3D"}(g||(g={})),function(e){e.GEOMETRIC_ERROR="geometricError",e.MAX_SCREEN_THRESHOLD="maxScreenThreshold"}(m||(m={}));let oj={USE_OPTIMIZATION:1},oW=new t5.P,oz=new t5.P,oX=new t5.P,oK=new t5.P,oJ=new t5.P,o$=new t5.P,oY=new t5.P,oq=new t5.P;function oQ(e,t,r){if((0,ir.v)(e,"3D Tile: boundingVolume must be defined"),e.box)return oZ(e.box,t,r);if(e.region)return function(e){let[t,r,i,s,n,o]=e,a=n3.WGS84.cartographicToCartesian([(0,e9.uj)(t),(0,e9.uj)(s),n],oX),l=n3.WGS84.cartographicToCartesian([(0,e9.uj)(i),(0,e9.uj)(r),o],oK),h=new t5.P().addVectors(a,l).multiplyByScalar(.5);return n3.WGS84.cartesianToCartographic(h,oJ),n3.WGS84.cartographicToCartesian([(0,e9.uj)(i),oJ[1],oJ[2]],o$),n3.WGS84.cartographicToCartesian([oJ[0],(0,e9.uj)(s),oJ[2]],oY),n3.WGS84.cartographicToCartesian([oJ[0],oJ[1],o],oq),oZ([...h,...o$.subtract(h),...oY.subtract(h),...oq.subtract(h)],new t9.k)}(e.region);if(e.sphere)return function(e,t,r){let i=new t5.P(e[0],e[1],e[2]);t.transform(i,i);let s=t.getScale(oz),n=Math.max(Math.max(s[0],s[1]),s[2]),o=e[3]*n;return null!=r?(r.center=i,r.radius=o,r):new os(i,o)}(e.sphere,t,r);throw Error("3D Tile: boundingVolume must contain a sphere, region, or box")}function oZ(e,t,r){let i=new t5.P(e[0],e[1],e[2]);t.transform(i,i);let s=[];if(10===e.length){let t=e.slice(3,6),r=new rT;r.fromArray(e,6);let i=new t5.P([1,0,0]),n=new t5.P([0,1,0]),o=new t5.P([0,0,1]);i.transformByQuaternion(r),i.scale(t[0]),n.transformByQuaternion(r),n.scale(t[1]),o.transformByQuaternion(r),o.scale(t[2]),s=[...i.toArray(),...n.toArray(),...o.toArray()]}else s=[...e.slice(3,6),...e.slice(6,9),...e.slice(9,12)];let n=t.transformAsVector(s.slice(0,3)),o=t.transformAsVector(s.slice(3,6)),a=t.transformAsVector(s.slice(6,9)),l=new sw([n[0],n[1],n[2],o[0],o[1],o[2],a[0],a[1],a[2]]);return null!=r?(r.center=i,r.halfAxes=l,r):new of(i,l)}function o0(){return[[1/0,1/0,1/0],[-1/0,-1/0,-1/0]]}function o1(e,t){n3.WGS84.cartesianToCartographic(t,oW),e[0][0]=Math.min(e[0][0],oW[0]),e[0][1]=Math.min(e[0][1],oW[1]),e[0][2]=Math.min(e[0][2],oW[2]),e[1][0]=Math.max(e[1][0],oW[0]),e[1][1]=Math.max(e[1][1],oW[1]),e[1][2]=Math.max(e[1][2],oW[2])}new t5.P,new t5.P,new t9.k,new t5.P,new t5.P,new t5.P;let o3=new t5.P,o2=new t5.P,o6=new t5.P,o4=new t5.P,o8=new t5.P,o9=new t9.k,o5=new t9.k;function o7(e,t){let{topDownViewport:r}=t,i=e.header.mbs[1],s=e.header.mbs[0],n=e.header.mbs[2],o=e.header.mbs[3],a=[...e.boundingVolume.center],l=r.unprojectPosition(r.cameraPosition);n3.WGS84.cartographicToCartesian(l,o3),o2.copy(o3).subtract(a).normalize(),n3.WGS84.eastNorthUpToFixedFrame(a,o9),o5.copy(o9).invert(),o6.copy(o3).transform(o5);let h=Math.sqrt(o6[0]*o6[0]+o6[1]*o6[1]),u=h*h/o6[2];o4.copy([o6[0],o6[1],u]);let c=o4.transform(o9).subtract(a).normalize(),d=o2.cross(c).normalize().scale(o).add(a),f=n3.WGS84.cartesianToCartographic(d),p=r.project([s,i,n]),g=r.project(f);return o8.copy(p).subtract(g).magnitude()}class ae{_map=new Map;_array;_length;constructor(e=0){this._array=Array(e),this._length=e}get length(){return this._length}set length(e){this._length=e,e>this._array.length&&(this._array.length=e)}get values(){return this._array}get(e){return(0,ir.v)(e<this._array.length),this._array[e]}set(e,t){(0,ir.v)(e>=0),e>=this.length&&(this.length=e+1),this._map.has(this._array[e])&&this._map.delete(this._array[e]),this._array[e]=t,this._map.set(t,e)}delete(e){let t=this._map.get(e);t>=0&&(this._array.splice(t,1),this._map.delete(e),this.length--)}peek(){return this._array[this._length-1]}push(e){if(!this._map.has(e)){let t=this.length++;this._array[t]=e,this._map.set(e,t)}}pop(){let e=this._array[--this.length];return this._map.delete(e),e}reserve(e){(0,ir.v)(e>=0),e>this._array.length&&(this._array.length=e)}resize(e){(0,ir.v)(e>=0),this.length=e}trim(e){null==e&&(e=this.length),this._array.length=e}reset(){this._array=[],this._map=new Map,this._length=0}find(e){return this._map.has(e)}}let at={loadSiblings:!1,skipLevelOfDetail:!1,updateTransforms:!0,onTraversalEnd:()=>{},viewportTraversersMap:{},basePath:""};class ar{options;root=null;selectedTiles={};requestedTiles={};emptyTiles={};lastUpdate=new Date().getTime();updateDebounceTime=1e3;_traversalStack=new ae;_emptyTraversalStack=new ae;_frameNumber=null;traversalFinished(e){return!0}constructor(e){this.options={...at,...e}}traverse(e,t,r){this.root=e,this.options={...this.options,...r},this.reset(),this.updateTile(e,t),this._frameNumber=t.frameNumber,this.executeTraversal(e,t)}reset(){this.requestedTiles={},this.selectedTiles={},this.emptyTiles={},this._traversalStack.reset(),this._emptyTraversalStack.reset()}executeTraversal(e,t){let r=this._traversalStack;for(e._selectionDepth=1,r.push(e);r.length>0;){let e=r.pop(),i=!1;this.canTraverse(e,t)&&(this.updateChildTiles(e,t),i=this.updateAndPushChildren(e,t,r,e.hasRenderContent?e._selectionDepth+1:e._selectionDepth));let s=e.parent,n=!!(!s||s._shouldRefine),o=!i;e.hasRenderContent?e.refine===f.ADD?(this.loadTile(e,t),this.selectTile(e,t)):e.refine===f.REPLACE&&(this.loadTile(e,t),o&&this.selectTile(e,t)):(this.emptyTiles[e.id]=e,this.loadTile(e,t),o&&this.selectTile(e,t)),this.touchTile(e,t),e._shouldRefine=i&&n}let i=new Date().getTime();(this.traversalFinished(t)||i-this.lastUpdate>this.updateDebounceTime)&&(this.lastUpdate=i,this.options.onTraversalEnd(t))}updateChildTiles(e,t){for(let r of e.children)this.updateTile(r,t)}updateAndPushChildren(e,t,r,i){let{loadSiblings:s,skipLevelOfDetail:n}=this.options,o=e.children;o.sort(this.compareDistanceToCamera.bind(this));let a=e.refine===f.REPLACE&&e.hasRenderContent&&!n,l=!1,h=!0;for(let e of o)if(e._selectionDepth=i,e.isVisibleAndInRequestVolume?(r.find(e)&&r.delete(e),r.push(e),l=!0):(a||s)&&(this.loadTile(e,t),this.touchTile(e,t)),a){let r;if(r=!!e._inRequestVolume&&(e.hasRenderContent?e.contentAvailable:this.executeEmptyTraversal(e,t)),!(h=h&&r))return!1}return l||(h=!1),h}updateTile(e,t){this.updateTileVisibility(e,t)}selectTile(e,t){this.shouldSelectTile(e)&&(e._selectedFrame=t.frameNumber,this.selectedTiles[e.id]=e)}loadTile(e,t){this.shouldLoadTile(e)&&(e._requestedFrame=t.frameNumber,e._priority=e._getPriority(),this.requestedTiles[e.id]=e)}touchTile(e,t){e.tileset._cache.touch(e),e._touchedFrame=t.frameNumber}canTraverse(e,t){return!!e.hasChildren&&(e.hasTilesetContent?!e.contentExpired:this.shouldRefine(e,t))}shouldLoadTile(e){return e.hasUnloadedContent||e.contentExpired}shouldSelectTile(e){return e.contentAvailable&&!this.options.skipLevelOfDetail}shouldRefine(e,t,r=!1){let i=e._screenSpaceError;return r&&(i=e.getScreenSpaceError(t,!0)),i>e.tileset.memoryAdjustedScreenSpaceError}updateTileVisibility(e,t){let r=[];if(this.options.viewportTraversersMap)for(let e in this.options.viewportTraversersMap)this.options.viewportTraversersMap[e]===t.viewport.id&&r.push(e);else r.push(t.viewport.id);e.updateVisibility(t,r)}compareDistanceToCamera(e,t){return e._distanceToCamera-t._distanceToCamera}anyChildrenVisible(e,t){let r=!1;for(let i of e.children)i.updateVisibility(t),r=r||i.isVisibleAndInRequestVolume;return r}executeEmptyTraversal(e,t){let r=!0,i=this._emptyTraversalStack;for(i.push(e);i.length>0;){let e=i.pop(),s=!e.hasRenderContent&&this.canTraverse(e,t),n=!e.hasRenderContent&&0===e.children.length;if(s||e.contentAvailable||n||(r=!1),this.updateTile(e,t),e.isVisibleAndInRequestVolume||(this.loadTile(e,t),this.touchTile(e,t)),s)for(let t of e.children)i.push(t)}return r}}let ai=new t5.P;class as{tileset;header;id;url;parent;refine;type;contentUrl;lodMetricType="geometricError";lodMetricValue=0;boundingVolume=null;content=null;contentState=oV.UNLOADED;gpuMemoryUsageInBytes=0;children=[];depth=0;viewportIds=[];transform=new t9.k;extensions=null;implicitTiling=null;userData={};computedTransform;hasEmptyContent=!1;hasTilesetContent=!1;traverser=new ar({});_cacheNode=null;_frameNumber=null;_expireDate=null;_expiredContent=null;_boundingBox=void 0;_distanceToCamera=0;_screenSpaceError=0;_visibilityPlaneMask;_visible=void 0;_contentBoundingVolume;_viewerRequestVolume;_initialTransform=new t9.k;_priority=0;_selectedFrame=0;_requestedFrame=0;_selectionDepth=0;_touchedFrame=0;_centerZDepth=0;_shouldRefine=!1;_stackLength=0;_visitedFrame=0;_inRequestVolume=!1;_lodJudge=null;constructor(e,t,r,i=""){this.header=t,this.tileset=e,this.id=i||t.id,this.url=t.url,this.parent=r,this.refine=this._getRefine(t.refine),this.type=t.type,this.contentUrl=t.contentUrl,this._initializeLodMetric(t),this._initializeTransforms(t),this._initializeBoundingVolumes(t),this._initializeContent(t),this._initializeRenderingState(t),Object.seal(this)}destroy(){this.header=null}isDestroyed(){return null===this.header}get selected(){return this._selectedFrame===this.tileset._frameNumber}get isVisible(){return this._visible}get isVisibleAndInRequestVolume(){return this._visible&&this._inRequestVolume}get hasRenderContent(){return!this.hasEmptyContent&&!this.hasTilesetContent}get hasChildren(){return this.children.length>0||this.header.children&&this.header.children.length>0}get contentReady(){return this.contentState===oV.READY||this.hasEmptyContent}get contentAvailable(){return!!(this.contentReady&&this.hasRenderContent||this._expiredContent&&!this.contentFailed)}get hasUnloadedContent(){return this.hasRenderContent&&this.contentUnloaded}get contentUnloaded(){return this.contentState===oV.UNLOADED}get contentExpired(){return this.contentState===oV.EXPIRED}get contentFailed(){return this.contentState===oV.FAILED}get distanceToCamera(){return this._distanceToCamera}get screenSpaceError(){return this._screenSpaceError}get boundingBox(){return this._boundingBox||(this._boundingBox=function(e,t){if(e.box)return function(e){let t=o0(),{halfAxes:r}=e,i=new t5.P(r.getColumn(0)),s=new t5.P(r.getColumn(1)),n=new t5.P(r.getColumn(2));for(let r=0;r<2;r++){for(let r=0;r<2;r++){for(let r=0;r<2;r++)oW.copy(e.center),oW.add(i),oW.add(s),oW.add(n),o1(t,oW),n.negate();s.negate()}i.negate()}return t}(t);if(e.region){let[t,r,i,s,n,o]=e.region;return[[(0,e9.uj)(t),(0,e9.uj)(r),n],[(0,e9.uj)(i),(0,e9.uj)(s),o]]}if(e.sphere)return function(e){let t;let r=o0(),{center:i,radius:s}=e,n=n3.WGS84.scaleToGeodeticSurface(i,oW);t=n?n3.WGS84.geodeticSurfaceNormal(n):new t5.P(0,0,1);let o=new t5.P(t[2],-t[1],0);o.len()>0?o.normalize():o=new t5.P(0,1,0);let a=o.clone().cross(t);for(let e of[o,a,t]){oz.copy(e).scale(s);for(let e=0;e<2;e++)oW.copy(i),oW.add(oz),o1(r,oW),oz.negate()}return r}(t);throw Error("Unkown boundingVolume type")}(this.header.boundingVolume,this.boundingVolume)),this._boundingBox}getScreenSpaceError(e,t){switch(this.tileset.type){case g.I3S:return o7(this,e);case g.TILES3D:return function(e,t,r){let i=e.tileset,s=e.parent&&e.parent.lodMetricValue||e.lodMetricValue,n=r?s:e.lodMetricValue;if(0===n)return 0;let o=Math.max(e._distanceToCamera,1e-7),{height:a,sseDenominator:l}=t,{viewDistanceScale:h}=i.options,u=n*a*(h||1)/(o*l);return u-function(e,t){if(e.dynamicScreenSpaceError&&e.dynamicScreenSpaceErrorComputedDensity){let r=e.dynamicScreenSpaceErrorComputedDensity,i=e.dynamicScreenSpaceErrorFactor;return function(e,t){let r=e*t;return 1-Math.exp(-(r*r))}(t,r)*i}return 0}(i,o)}(this,e,t);default:throw Error("Unsupported tileset type")}}unselect(){this._selectedFrame=0}_getGpuMemoryUsageInBytes(){return this.content.gpuMemoryUsageInBytes||this.content.byteLength||0}_getPriority(){let e=this.tileset._traverser,{skipLevelOfDetail:t}=e.options,r=this.refine===f.ADD||t;if(r&&!this.isVisible&&void 0!==this._visible||this.tileset._frameNumber-this._touchedFrame>=1||this.contentState===oV.UNLOADED)return -1;let i=this.parent,s=i&&(!r||0===this._screenSpaceError||i.hasTilesetContent)?i._screenSpaceError:this._screenSpaceError;return Math.max((e.root?e.root._screenSpaceError:0)-s,0)}async loadContent(){if(this.hasEmptyContent)return!1;if(this.content)return!0;this.contentExpired&&(this._expireDate=null),this.contentState=oV.LOADING;let e=await this.tileset._requestScheduler.scheduleRequest(this.id,this._getPriority.bind(this));if(!e)return this.contentState=oV.UNLOADED,!1;try{let e=this.tileset.getTileUrl(this.contentUrl),t=this.tileset.loader,r={...this.tileset.loadOptions,[t.id]:{...this.tileset.loadOptions[t.id],isTileset:"json"===this.type,...this._getLoaderSpecificOptions(t.id)}};return this.content=await (0,tP.H)(e,t,r),this.tileset.options.contentLoader&&await this.tileset.options.contentLoader(this),this._isTileset()&&this.tileset._initializeTileHeaders(this.content,this),this.contentState=oV.READY,this._onContentLoaded(),!0}catch(e){throw this.contentState=oV.FAILED,e}finally{e.done()}}unloadContent(){return this.content&&this.content.destroy&&this.content.destroy(),this.content=null,this.header.content&&this.header.content.destroy&&this.header.content.destroy(),this.header.content=null,this.contentState=oV.UNLOADED,!0}updateVisibility(e,t){if(this._frameNumber===e.frameNumber)return;let r=this.parent,i=r?r._visibilityPlaneMask:ob.MASK_INDETERMINATE;if(this.tileset._traverser.options.updateTransforms){let e=r?r.computedTransform:this.tileset.modelMatrix;this._updateTransform(e)}this._distanceToCamera=this.distanceToTile(e),this._screenSpaceError=this.getScreenSpaceError(e,!1),this._visibilityPlaneMask=this.visibility(e,i),this._visible=this._visibilityPlaneMask!==ob.MASK_OUTSIDE,this._inRequestVolume=this.insideViewerRequestVolume(e),this._frameNumber=e.frameNumber,this.viewportIds=t}visibility(e,t){let{cullingVolume:r}=e,{boundingVolume:i}=this;return r.computeVisibilityWithPlaneMask(i,t)}contentVisibility(){return!0}distanceToTile(e){return Math.sqrt(Math.max(this.boundingVolume.distanceSquaredTo(e.camera.position),0))}cameraSpaceZDepth({camera:e}){let t=this.boundingVolume;return ai.subVectors(t.center,e.position),e.direction.dot(ai)}insideViewerRequestVolume(e){let t=this._viewerRequestVolume;return!t||0>=t.distanceSquaredTo(e.camera.position)}updateExpiration(){var e;if(null!=this._expireDate&&this.contentReady&&!this.hasEmptyContent){let e=Date.now();Date.lessThan(this._expireDate,e)&&(this.contentState=oV.EXPIRED,this._expiredContent=this.content)}}get extras(){return this.header.extras}_initializeLodMetric(e){"lodMetricType"in e?this.lodMetricType=e.lodMetricType:(this.lodMetricType=this.parent&&this.parent.lodMetricType||this.tileset.lodMetricType,console.warn("3D Tile: Required prop lodMetricType is undefined. Using parent lodMetricType")),"lodMetricValue"in e?this.lodMetricValue=e.lodMetricValue:(this.lodMetricValue=this.parent&&this.parent.lodMetricValue||this.tileset.lodMetricValue,console.warn("3D Tile: Required prop lodMetricValue is undefined. Using parent lodMetricValue"))}_initializeTransforms(e){this.transform=e.transform?new t9.k(e.transform):new t9.k;let t=this.parent,r=this.tileset,i=t&&t.computedTransform?t.computedTransform.clone():r.modelMatrix.clone();this.computedTransform=new t9.k(i).multiplyRight(this.transform);let s=t&&t._initialTransform?t._initialTransform.clone():new t9.k;this._initialTransform=new t9.k(s).multiplyRight(this.transform)}_initializeBoundingVolumes(e){this._contentBoundingVolume=null,this._viewerRequestVolume=null,this._updateBoundingVolume(e)}_initializeContent(e){this.content={_tileset:this.tileset,_tile:this},this.hasEmptyContent=!0,this.contentState=oV.UNLOADED,this.hasTilesetContent=!1,e.contentUrl&&(this.content=null,this.hasEmptyContent=!1)}_initializeRenderingState(e){this.depth=e.level||(this.parent?this.parent.depth+1:0),this._shouldRefine=!1,this._distanceToCamera=0,this._centerZDepth=0,this._screenSpaceError=0,this._visibilityPlaneMask=ob.MASK_INDETERMINATE,this._visible=void 0,this._inRequestVolume=!1,this._stackLength=0,this._selectionDepth=0,this._frameNumber=0,this._touchedFrame=0,this._visitedFrame=0,this._selectedFrame=0,this._requestedFrame=0,this._priority=0}_getRefine(e){return e||this.parent&&this.parent.refine||f.REPLACE}_isTileset(){return -1!==this.contentUrl.indexOf(".json")}_onContentLoaded(){switch(this.content&&this.content.type){case"vctr":case"geom":this.tileset._traverser.disableSkipLevelOfDetail=!0}this._isTileset()?this.hasTilesetContent=!0:this.gpuMemoryUsageInBytes=this._getGpuMemoryUsageInBytes()}_updateBoundingVolume(e){this.boundingVolume=oQ(e.boundingVolume,this.computedTransform,this.boundingVolume);let t=e.content;t&&(t.boundingVolume&&(this._contentBoundingVolume=oQ(t.boundingVolume,this.computedTransform,this._contentBoundingVolume)),e.viewerRequestVolume&&(this._viewerRequestVolume=oQ(e.viewerRequestVolume,this.computedTransform,this._viewerRequestVolume)))}_updateTransform(e=new t9.k){let t=e.clone().multiplyRight(this.transform);!t.equals(this.computedTransform)&&(this.computedTransform=t,this._updateBoundingVolume(this.header))}_getLoaderSpecificOptions(e){var t;return"i3s"===e?{...this.tileset.options.i3s,_tileOptions:{attributeUrls:this.header.attributeUrls,textureUrl:this.header.textureUrl,textureFormat:this.header.textureFormat,textureLoaderOptions:this.header.textureLoaderOptions,materialDefinition:this.header.materialDefinition,isDracoGeometry:this.header.isDracoGeometry,mbs:this.header.mbs},_tilesetOptions:{store:this.tileset.tileset.store,attributeStorageInfo:this.tileset.tileset.attributeStorageInfo,fields:this.tileset.tileset.fields},isTileHeader:!1}:{assetGltfUpAxis:(t=this.tileset.tileset).asset&&t.asset.gltfUpAxis||"Y"}}}class an extends ar{compareDistanceToCamera(e,t){return 0===t._distanceToCamera&&0===e._distanceToCamera?t._centerZDepth-e._centerZDepth:t._distanceToCamera-e._distanceToCamera}updateTileVisibility(e,t){if(super.updateTileVisibility(e,t),!e.isVisibleAndInRequestVolume)return;let r=e.children.length>0;if(e.hasTilesetContent&&r){let r=e.children[0];this.updateTileVisibility(r,t),e._visible=r._visible;return}if(this.meetsScreenSpaceErrorEarly(e,t)){e._visible=!1;return}let i=e.refine===f.REPLACE,s=e._optimChildrenWithinParent===oj.USE_OPTIMIZATION;if(i&&s&&r&&!this.anyChildrenVisible(e,t)){e._visible=!1;return}}meetsScreenSpaceErrorEarly(e,t){let{parent:r}=e;return!!r&&!r.hasTilesetContent&&r.refine===f.ADD&&!this.shouldRefine(e,t,!0)}}class ao{frameNumberMap=new Map;register(e,t){let r=this.frameNumberMap.get(e)||new Map,i=r.get(t)||0;r.set(t,i+1),this.frameNumberMap.set(e,r)}deregister(e,t){let r=this.frameNumberMap.get(e);if(!r)return;let i=r.get(t)||1;r.set(t,i-1)}isZero(e,t){return 0===(this.frameNumberMap.get(e)?.get(t)||0)}}let aa={REQUESTED:"REQUESTED",COMPLETED:"COMPLETED",ERROR:"ERROR"};class al{_statusMap;pendingTilesRegister=new ao;constructor(){this._statusMap={}}add(e,t,r,i){if(!this._statusMap[t]){let{frameNumber:s,viewport:{id:n}}=i;this._statusMap[t]={request:e,callback:r,key:t,frameState:i,status:aa.REQUESTED},this.pendingTilesRegister.register(n,s),e().then(e=>{this._statusMap[t].status=aa.COMPLETED;let{frameNumber:r,viewport:{id:s}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(s,r),this._statusMap[t].callback(e,i)}).catch(e=>{this._statusMap[t].status=aa.ERROR;let{frameNumber:i,viewport:{id:s}}=this._statusMap[t].frameState;this.pendingTilesRegister.deregister(s,i),r(e)})}}update(e,t){if(this._statusMap[e]){let{frameNumber:r,viewport:{id:i}}=this._statusMap[e].frameState;this.pendingTilesRegister.deregister(i,r);let{frameNumber:s,viewport:{id:n}}=t;this.pendingTilesRegister.register(n,s),this._statusMap[e].frameState=t}}find(e){return this._statusMap[e]}hasPendingTiles(e,t){return!this.pendingTilesRegister.isZero(e,t)}}class ah extends ar{_tileManager;constructor(e){super(e),this._tileManager=new al}traversalFinished(e){return!this._tileManager.hasPendingTiles(e.viewport.id,this._frameNumber||0)}shouldRefine(e,t){return e._lodJudge=function(e,t){if(0===e.lodMetricValue||isNaN(e.lodMetricValue))return"DIG";let r=2*o7(e,t);return r<2?"OUT":!e.header.children||r<=e.lodMetricValue?"DRAW":e.header.children?"DIG":"OUT"}(e,t),"DIG"===e._lodJudge}updateChildTiles(e,t){let r=e.header.children||[],i=e.children,s=e.tileset;for(let n of r){let r=`${n.id}-${t.viewport.id}`,o=i&&i.find(e=>e.id===r);if(o)o&&this.updateTile(o,t);else{let i=()=>this._loadTile(n.id,s);this._tileManager.find(r)?this._tileManager.update(r,t):(s.tileset.nodePages&&(i=()=>s.tileset.nodePagesTile.formTileFromNodePages(n.id)),this._tileManager.add(i,r,t=>this._onTileLoad(t,e,r),t))}}return!1}async _loadTile(e,t){let{loader:r}=t,i=t.getTileUrl(`${t.url}/nodes/${e}`),s={...t.loadOptions,i3s:{...t.loadOptions.i3s,isTileHeader:!0}};return await (0,tP.H)(i,r,s)}_onTileLoad(e,t,r){let i=new as(t.tileset,e,t,r);t.children.push(i);let s=this._tileManager.find(i.id).frameState;this.updateTile(i,s),this._frameNumber===s.frameNumber&&(this.traversalFinished(s)||new Date().getTime()-this.lastUpdate>this.updateDebounceTime)&&this.executeTraversal(i,s)}}let au={description:"",ellipsoid:n3.WGS84,modelMatrix:new t9.k,throttleRequests:!0,maxRequests:64,maximumMemoryUsage:32,memoryCacheOverflow:1,maximumTilesSelected:0,debounceTime:0,onTileLoad:()=>{},onTileUnload:()=>{},onTileError:()=>{},onTraversalComplete:e=>e,contentLoader:void 0,viewDistanceScale:1,maximumScreenSpaceError:8,memoryAdjustedScreenSpaceError:!1,loadTiles:!0,updateTransforms:!0,viewportTraversersMap:null,loadOptions:{fetch:{}},attributions:[],basePath:"",i3s:{}},ac="Tiles In Tileset(s)",ad="Tiles In Memory",af="Tiles In View",ap="Tiles To Render",ag="Tiles Loaded",am="Tiles Loading",a_="Tiles Unloaded",aA="Failed Tile Loads",aE="Points/Vertices",ab="Tile Memory Use",ay="Maximum Screen Space Error";class aT{options;loadOptions;type;tileset;loader;url;basePath;modelMatrix;ellipsoid;lodMetricType;lodMetricValue;refine;root=null;roots={};asset={};description="";properties;extras=null;attributions={};credits={};stats;contentFormats={draco:!1,meshopt:!1,dds:!1,ktx2:!1};cartographicCenter=null;cartesianCenter=null;zoom=1;boundingVolume=null;dynamicScreenSpaceErrorComputedDensity=0;maximumMemoryUsage=32;gpuMemoryUsageInBytes=0;memoryAdjustedScreenSpaceError=0;_cacheBytes=0;_cacheOverflowBytes=0;_frameNumber=0;_queryParams={};_extensionsUsed=[];_tiles={};_pendingCount=0;selectedTiles=[];traverseCounter=0;geometricError=0;lastUpdatedVieports=null;_requestedTiles=[];_emptyTiles=[];frameStateData={};_traverser;_cache=new n7;_requestScheduler;updatePromise=null;tilesetInitializationPromise;constructor(e,t){this.options={...au,...t},this.tileset=e,this.loader=e.loader,this.type=e.type,this.url=e.url,this.basePath=e.basePath||n6.pD(this.url),this.modelMatrix=this.options.modelMatrix,this.ellipsoid=this.options.ellipsoid,this.lodMetricType=e.lodMetricType,this.lodMetricValue=e.lodMetricValue,this.refine=e.root.refine,this.loadOptions=this.options.loadOptions||{},this._traverser=this._initializeTraverser(),this._requestScheduler=new n8({throttleRequests:this.options.throttleRequests,maxRequests:this.options.maxRequests}),this.memoryAdjustedScreenSpaceError=this.options.maximumScreenSpaceError,this._cacheBytes=1048576*this.options.maximumMemoryUsage,this._cacheOverflowBytes=1048576*this.options.memoryCacheOverflow,this.stats=new n2.Uz({id:this.url}),this._initializeStats(),this.tilesetInitializationPromise=this._initializeTileSet(e)}destroy(){this._destroy()}isLoaded(){return 0===this._pendingCount&&0!==this._frameNumber&&0===this._requestedTiles.length}get tiles(){return Object.values(this._tiles)}get frameNumber(){return this._frameNumber}get queryParams(){return new URLSearchParams(this._queryParams).toString()}setProps(e){this.options={...this.options,...e}}getTileUrl(e){if(e.startsWith("data:"))return e;let t=e;return this.queryParams.length&&(t=`${e}${e.includes("?")?"&":"?"}${this.queryParams}`),t}hasExtension(e){return this._extensionsUsed.indexOf(e)>-1}update(e=null){this.tilesetInitializationPromise.then(()=>{!e&&this.lastUpdatedVieports?e=this.lastUpdatedVieports:this.lastUpdatedVieports=e,e&&this.doUpdate(e)})}async selectTiles(e=null){return await this.tilesetInitializationPromise,e&&(this.lastUpdatedVieports=e),this.updatePromise||(this.updatePromise=new Promise(e=>{setTimeout(()=>{this.lastUpdatedVieports&&this.doUpdate(this.lastUpdatedVieports),e(this._frameNumber),this.updatePromise=null},this.options.debounceTime)})),this.updatePromise}adjustScreenSpaceError(){this.gpuMemoryUsageInBytes<this._cacheBytes?this.memoryAdjustedScreenSpaceError=Math.max(this.memoryAdjustedScreenSpaceError/1.02,this.options.maximumScreenSpaceError):this.gpuMemoryUsageInBytes>this._cacheBytes+this._cacheOverflowBytes&&(this.memoryAdjustedScreenSpaceError*=1.02)}doUpdate(e){if("loadTiles"in this.options&&!this.options.loadTiles||this.traverseCounter>0)return;let t=e instanceof Array?e:[e];this._cache.reset(),this._frameNumber++,this.traverseCounter=t.length;let r=[];for(let e of t){let t=e.id;this._needTraverse(t)?r.push(t):this.traverseCounter--}for(let e of t){let t=e.id;if(this.roots[t]||(this.roots[t]=this._initializeTileHeaders(this.tileset,null)),!r.includes(t))continue;let i=function(e,t){let{cameraDirection:r,cameraUp:i,height:s}=e,{metersPerUnit:n}=e.distanceScales,o=oG(e,e.center),a=n3.WGS84.eastNorthUpToFixedFrame(o),l=e.unprojectPosition(e.cameraPosition),h=n3.WGS84.cartographicToCartesian(l,new t5.P),u=new t5.P(a.transformAsVector(new t5.P(r).scale(n))).normalize(),c=new t5.P(a.transformAsVector(new t5.P(i).scale(n))).normalize();!function(e){let t=e.getFrustumPlanes(),r=oU(t.near,e.cameraPosition),i=oG(e,r),s=oG(e,e.cameraPosition,oF),n=0;for(let o in oD.planes[n++].fromPointNormal(i,oN.copy(i).subtract(s)),t){if("near"===o)continue;let s=oG(e,oU(t[o],r,oF),oF);oD.planes[n++].fromPointNormal(s,oN.copy(i).subtract(s))}}(e);let d=e.constructor,{longitude:f,latitude:p,width:g,bearing:m,zoom:_}=e;return{camera:{position:h,direction:u,up:c},viewport:e,topDownViewport:new d({longitude:f,latitude:p,height:s,width:g,bearing:m,zoom:_,pitch:0}),height:s,cullingVolume:oD,frameNumber:t,sseDenominator:1.15}}(e,this._frameNumber);this._traverser.traverse(this.roots[t],i,this.options)}}_needTraverse(e){let t=e;return this.options.viewportTraversersMap&&(t=this.options.viewportTraversersMap[e]),t===e}_onTraversalEnd(e){let t=e.viewport.id;this.frameStateData[t]||(this.frameStateData[t]={selectedTiles:[],_requestedTiles:[],_emptyTiles:[]});let r=this.frameStateData[t],[i,s]=function(e,t,r){if(0===r||e.length<=r)return[e,[]];let i=[],{longitude:s,latitude:n}=t.viewport;for(let[t,r]of e.entries()){let[e,o]=r.header.mbs,a=Math.abs(s-e),l=Math.abs(n-o),h=Math.sqrt(l*l+a*a);i.push([t,h])}let o=i.sort((e,t)=>e[1]-t[1]),a=[];for(let t=0;t<r;t++)a.push(e[o[t][0]]);let l=[];for(let t=r;t<o.length;t++)l.push(e[o[t][0]]);return[a,l]}(Object.values(this._traverser.selectedTiles),e,this.options.maximumTilesSelected);for(let e of(r.selectedTiles=i,s))e.unselect();r._requestedTiles=Object.values(this._traverser.requestedTiles),r._emptyTiles=Object.values(this._traverser.emptyTiles),this.traverseCounter--,!(this.traverseCounter>0)&&this._updateTiles()}_updateTiles(){for(let e in this.selectedTiles=[],this._requestedTiles=[],this._emptyTiles=[],this.frameStateData){let t=this.frameStateData[e];this.selectedTiles=this.selectedTiles.concat(t.selectedTiles),this._requestedTiles=this._requestedTiles.concat(t._requestedTiles),this._emptyTiles=this._emptyTiles.concat(t._emptyTiles)}for(let e of(this.selectedTiles=this.options.onTraversalComplete(this.selectedTiles),this.selectedTiles))this._tiles[e.id]=e;this._loadTiles(),this._unloadTiles(),this._updateStats()}_tilesChanged(e,t){if(e.length!==t.length)return!0;let r=new Set(e.map(e=>e.id)),i=new Set(t.map(e=>e.id)),s=e.filter(e=>!i.has(e.id)).length>0;return s||t.filter(e=>!r.has(e.id)).length>0}_loadTiles(){for(let e of this._requestedTiles)e.contentUnloaded&&this._loadTile(e)}_unloadTiles(){this._cache.unloadTiles(this,(e,t)=>e._unloadTile(t))}_updateStats(){let e=0,t=0;for(let r of this.selectedTiles)r.contentAvailable&&r.content&&(e++,r.content.pointCount?t+=r.content.pointCount:t+=r.content.vertexCount);this.stats.get(af).count=this.selectedTiles.length,this.stats.get(ap).count=e,this.stats.get(aE).count=t,this.stats.get(ay).count=this.memoryAdjustedScreenSpaceError}async _initializeTileSet(e){this.type===g.I3S&&(this.calculateViewPropsI3S(),e.root=await e.root),this.root=this._initializeTileHeaders(e,null),this.type===g.TILES3D&&(this._initializeTiles3DTileset(e),this.calculateViewPropsTiles3D()),this.type===g.I3S&&this._initializeI3STileset()}calculateViewPropsI3S(){let e=this.tileset.fullExtent;if(e){let{xmin:t,xmax:r,ymin:i,ymax:s,zmin:n,zmax:o}=e;this.cartographicCenter=new t5.P(t+(r-t)/2,i+(s-i)/2,n+(o-n)/2),this.cartesianCenter=new t5.P,n3.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=oH(e,this.cartographicCenter,this.cartesianCenter);return}let t=this.tileset.store?.extent;if(t){let[e,r,i,s]=t;this.cartographicCenter=new t5.P(e+(i-e)/2,r+(s-r)/2,0),this.cartesianCenter=new t5.P,n3.WGS84.cartographicToCartesian(this.cartographicCenter,this.cartesianCenter),this.zoom=function(e,t,r){let[i,s,n,o]=e;return oH({xmin:i,xmax:n,ymin:s,ymax:o,zmin:0,zmax:0},t,r)}(t,this.cartographicCenter,this.cartesianCenter);return}console.warn("Extent is not defined in the tileset header"),this.cartographicCenter=new t5.P,this.zoom=1}calculateViewPropsTiles3D(){let e=this.root,{center:t}=e.boundingVolume;if(!t){console.warn("center was not pre-calculated for the root tile"),this.cartographicCenter=new t5.P,this.zoom=1;return}0!==t[0]||0!==t[1]||0!==t[2]?(this.cartographicCenter=new t5.P,n3.WGS84.cartesianToCartographic(t,this.cartographicCenter)):this.cartographicCenter=new t5.P(0,0,-n3.WGS84.radii[0]),this.cartesianCenter=t,this.zoom=function(e,t){if(e instanceof of){let{halfAxes:r}=e;return Math.log2(6356752.314245179/(function(e){e.getColumn(0,ok);let t=e.getColumn(1),r=e.getColumn(2);return ok.add(t).add(r).len()}(r)+t[2]))}if(e instanceof os){let{radius:r}=e;return Math.log2(6356752.314245179/(r+t[2]))}if(e.width&&e.height){let{width:t,height:r}=e;return(Math.log2(6378137/t)+Math.log2(6378137/r))/2}return 1}(e.boundingVolume,this.cartographicCenter)}_initializeStats(){this.stats.get(ac),this.stats.get(am),this.stats.get(ad),this.stats.get(af),this.stats.get(ap),this.stats.get(ag),this.stats.get(a_),this.stats.get(aA),this.stats.get(aE),this.stats.get(ab,"memory"),this.stats.get(ay)}_initializeTileHeaders(e,t){let r=new as(this,e.root,t);if(t&&(t.children.push(r),r.depth=t.depth+1),this.type===g.TILES3D){let e=[];for(e.push(r);e.length>0;){let t=e.pop();for(let r of(this.stats.get(ac).incrementCount(),t.header.children||[])){let i=new as(this,r,t);if(i.contentUrl?.includes("?session=")){let e=new URL(i.contentUrl).searchParams.get("session");e&&(this._queryParams.session=e)}t.children.push(i),i.depth=t.depth+1,e.push(i)}}}return r}_initializeTraverser(){let e;switch(this.type){case g.TILES3D:e=an;break;case g.I3S:e=ah;break;default:e=ar}return new e({basePath:this.basePath,onTraversalEnd:this._onTraversalEnd.bind(this)})}_destroyTileHeaders(e){this._destroySubtree(e)}async _loadTile(e){let t;try{this._onStartTileLoading(),t=await e.loadContent()}catch(t){this._onTileLoadError(e,t instanceof Error?t:Error("load failed"))}finally{this._onEndTileLoading(),this._onTileLoad(e,t)}}_onTileLoadError(e,t){this.stats.get(aA).incrementCount();let r=t.message||t.toString(),i=e.url;console.error(`A 3D tile failed to load: ${e.url} ${r}`),this.options.onTileError(e,r,i)}_onTileLoad(e,t){if(t){if(this.type===g.I3S){let e=this.tileset?.nodePagesTile?.nodesInNodePages||0;this.stats.get(ac).reset(),this.stats.get(ac).addCount(e)}e&&e.content&&function(e,t){(0,ir.v)(e),(0,ir.v)(t);let{rtcCenter:r,gltfUpAxis:i}=t,{computedTransform:s,boundingVolume:{center:n}}=e,o=new t9.k(s);switch(r&&o.translate(r),i){case"Z":break;case"Y":let a=new t9.k().rotateX(Math.PI/2);o=o.multiplyRight(a);break;case"X":let l=new t9.k().rotateY(-Math.PI/2);o=o.multiplyRight(l)}t.isQuantized&&o.translate(t.quantizedVolumeOffset).scale(t.quantizedVolumeScale);let h=new t5.P(n);t.cartesianModelMatrix=o,t.cartesianOrigin=h;let u=n3.WGS84.cartesianToCartographic(h,new t5.P);t.cartographicModelMatrix=n3.WGS84.eastNorthUpToFixedFrame(h).invert().multiplyRight(o),t.cartographicOrigin=u,t.coordinateSystem||(t.modelMatrix=t.cartographicModelMatrix)}(e,e.content),this.updateContentTypes(e),this._addTileToCache(e),this.options.onTileLoad(e)}}updateContentTypes(e){if(this.type===g.I3S)switch(e.header.isDracoGeometry&&(this.contentFormats.draco=!0),e.header.textureFormat){case"dds":this.contentFormats.dds=!0;break;case"ktx2":this.contentFormats.ktx2=!0}else if(this.type===g.TILES3D){let{extensionsRemoved:t=[]}=e.content?.gltf||{};t.includes("KHR_draco_mesh_compression")&&(this.contentFormats.draco=!0),t.includes("EXT_meshopt_compression")&&(this.contentFormats.meshopt=!0),t.includes("KHR_texture_basisu")&&(this.contentFormats.ktx2=!0)}}_onStartTileLoading(){this._pendingCount++,this.stats.get(am).incrementCount()}_onEndTileLoading(){this._pendingCount--,this.stats.get(am).decrementCount()}_addTileToCache(e){this._cache.add(this,e,t=>t._updateCacheStats(e))}_updateCacheStats(e){this.stats.get(ag).incrementCount(),this.stats.get(ad).incrementCount(),this.gpuMemoryUsageInBytes+=e.gpuMemoryUsageInBytes||0,this.stats.get(ab).count=this.gpuMemoryUsageInBytes,this.options.memoryAdjustedScreenSpaceError&&this.adjustScreenSpaceError()}_unloadTile(e){this.gpuMemoryUsageInBytes-=e.gpuMemoryUsageInBytes||0,this.stats.get(ad).decrementCount(),this.stats.get(a_).incrementCount(),this.stats.get(ab).count=this.gpuMemoryUsageInBytes,this.options.onTileUnload(e),e.unloadContent()}_destroy(){let e=[];for(this.root&&e.push(this.root);e.length>0;){let t=e.pop();for(let r of t.children)e.push(r);this._destroyTile(t)}this.root=null}_destroySubtree(e){let t=e,r=[];for(r.push(t);r.length>0;){for(let t of(e=r.pop()).children)r.push(t);e!==t&&this._destroyTile(e)}t.children=[]}_destroyTile(e){this._cache.unloadTile(this,e),this._unloadTile(e),e.destroy()}_initializeTiles3DTileset(e){if(e.queryString){let t=Object.fromEntries(new URLSearchParams(e.queryString).entries());this._queryParams={...this._queryParams,...t}}if(this.asset=e.asset,!this.asset)throw Error("Tileset must have an asset property.");if("0.0"!==this.asset.version&&"1.0"!==this.asset.version&&"1.1"!==this.asset.version)throw Error("The tileset must be 3D Tiles version either 0.0 or 1.0 or 1.1.");"tilesetVersion"in this.asset&&(this._queryParams.v=this.asset.tilesetVersion),this.credits={attributions:this.options.attributions||[]},this.description=this.options.description||"",this.properties=e.properties,this.geometricError=e.geometricError,this._extensionsUsed=e.extensionsUsed||[],this.extras=e.extras}_initializeI3STileset(){this.loadOptions.i3s&&"token"in this.loadOptions.i3s&&(this._queryParams.token=this.loadOptions.i3s.token)}}let aC="4.3.2",av={COMPOSITE:"cmpt",POINT_CLOUD:"pnts",BATCHED_3D_MODEL:"b3dm",INSTANCED_3D_MODEL:"i3dm",GEOMETRY:"geom",VECTOR:"vect",GLTF:"glTF"};function aR(e,t,r){(0,ir.v)(e instanceof ArrayBuffer);let i=new TextDecoder("utf8"),s=new Uint8Array(e,t,r);return i.decode(s)}Object.keys(av);let aS={BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,DOUBLE:5130},aB={POINTS:0,LINES:1,LINE_LOOP:2,LINE_STRIP:3,TRIANGLES:4,TRIANGLE_STRIP:5,TRIANGLE_FAN:6,...aS},aw={[aS.DOUBLE]:Float64Array,[aS.FLOAT]:Float32Array,[aS.UNSIGNED_SHORT]:Uint16Array,[aS.UNSIGNED_INT]:Uint32Array,[aS.UNSIGNED_BYTE]:Uint8Array,[aS.BYTE]:Int8Array,[aS.SHORT]:Int16Array,[aS.INT]:Int32Array},aM={DOUBLE:aS.DOUBLE,FLOAT:aS.FLOAT,UNSIGNED_SHORT:aS.UNSIGNED_SHORT,UNSIGNED_INT:aS.UNSIGNED_INT,UNSIGNED_BYTE:aS.UNSIGNED_BYTE,BYTE:aS.BYTE,SHORT:aS.SHORT,INT:aS.INT},aI="Failed to convert GL type";class aP{static fromTypedArray(e){for(let t in e=ArrayBuffer.isView(e)?e.constructor:e,aw)if(aw[t]===e)return t;throw Error(aI)}static fromName(e){let t=aM[e];if(!t)throw Error(aI);return t}static getArrayType(e){switch(e){case aS.UNSIGNED_SHORT_5_6_5:case aS.UNSIGNED_SHORT_4_4_4_4:case aS.UNSIGNED_SHORT_5_5_5_1:return Uint16Array;default:let t=aw[e];if(!t)throw Error(aI);return t}}static getByteSize(e){return aP.getArrayType(e).BYTES_PER_ELEMENT}static validate(e){return!!aP.getArrayType(e)}static createTypedArray(e,t,r=0,i){return void 0===i&&(i=(t.byteLength-r)/aP.getByteSize(e)),new(aP.getArrayType(e))(t,r,i)}}class aL{json;buffer;featuresLength=0;_cachedTypedArrays={};constructor(e,t){this.json=e,this.buffer=t}getExtension(e){return this.json.extensions&&this.json.extensions[e]}hasProperty(e){return!!this.json[e]}getGlobalProperty(e,t=aB.UNSIGNED_INT,r=1){let i=this.json[e];return i&&Number.isFinite(i.byteOffset)?this._getTypedArrayFromBinary(e,t,r,1,i.byteOffset):i}getPropertyArray(e,t,r){let i=this.json[e];return i&&Number.isFinite(i.byteOffset)?("componentType"in i&&(t=aP.fromName(i.componentType)),this._getTypedArrayFromBinary(e,t,r,this.featuresLength,i.byteOffset)):this._getTypedArrayFromArray(e,t,i)}getProperty(e,t,r,i,s){let n=this.json[e];if(!n)return n;let o=this.getPropertyArray(e,t,r);if(1===r)return o[i];for(let e=0;e<r;++e)s[e]=o[r*i+e];return s}_getTypedArrayFromBinary(e,t,r,i,s){let n=this._cachedTypedArrays,o=n[e];return o||(o=aP.createTypedArray(t,this.buffer.buffer,this.buffer.byteOffset+s,i*r),n[e]=o),o}_getTypedArrayFromArray(e,t,r){let i=this._cachedTypedArrays,s=i[e];return s||(s=aP.createTypedArray(t,r),i[e]=s),s}}let aO={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16},ax={SCALAR:(e,t)=>e[t],VEC2:(e,t)=>[e[2*t+0],e[2*t+1]],VEC3:(e,t)=>[e[3*t+0],e[3*t+1],e[3*t+2]],VEC4:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT2:(e,t)=>[e[4*t+0],e[4*t+1],e[4*t+2],e[4*t+3]],MAT3:(e,t)=>[e[9*t+0],e[9*t+1],e[9*t+2],e[9*t+3],e[9*t+4],e[9*t+5],e[9*t+6],e[9*t+7],e[9*t+8]],MAT4:(e,t)=>[e[16*t+0],e[16*t+1],e[16*t+2],e[16*t+3],e[16*t+4],e[16*t+5],e[16*t+6],e[16*t+7],e[16*t+8],e[16*t+9],e[16*t+10],e[16*t+11],e[16*t+12],e[16*t+13],e[16*t+14],e[16*t+15]]},aN={SCALAR:(e,t,r)=>{t[r]=e},VEC2:(e,t,r)=>{t[2*r+0]=e[0],t[2*r+1]=e[1]},VEC3:(e,t,r)=>{t[3*r+0]=e[0],t[3*r+1]=e[1],t[3*r+2]=e[2]},VEC4:(e,t,r)=>{t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT2:(e,t,r)=>{t[4*r+0]=e[0],t[4*r+1]=e[1],t[4*r+2]=e[2],t[4*r+3]=e[3]},MAT3:(e,t,r)=>{t[9*r+0]=e[0],t[9*r+1]=e[1],t[9*r+2]=e[2],t[9*r+3]=e[3],t[9*r+4]=e[4],t[9*r+5]=e[5],t[9*r+6]=e[6],t[9*r+7]=e[7],t[9*r+8]=e[8],t[9*r+9]=e[9]},MAT4:(e,t,r)=>{t[16*r+0]=e[0],t[16*r+1]=e[1],t[16*r+2]=e[2],t[16*r+3]=e[3],t[16*r+4]=e[4],t[16*r+5]=e[5],t[16*r+6]=e[6],t[16*r+7]=e[7],t[16*r+8]=e[8],t[16*r+9]=e[9],t[16*r+10]=e[10],t[16*r+11]=e[11],t[16*r+12]=e[12],t[16*r+13]=e[13],t[16*r+14]=e[14],t[16*r+15]=e[15]}},aF=e=>void 0!==e;function aD(e,t,r){if(!e)return;let i=e.parentCounts;return e.parentIds?r(e,t):i>0?function(e,t,r){let i=e.classIds,s=e.parentCounts,n=e.parentIds,o=e.parentIndexes,a=i.length,l=scratchVisited;l.length=Math.max(l.length,a);let h=++marker,u=scratchStack;for(u.length=0,u.push(t);u.length>0;){if(l[t=u.pop()]===h)continue;l[t]=h;let i=r(e,t);if(aF(i))return i;let a=s[t],c=o[t];for(let e=0;e<a;++e){let r=n[c+e];r!==t&&u.push(r)}}return null}(e,t,r):function(e,t,r){let i=!0;for(;i;){let s=r(e,t);if(aF(s))return s;let n=e.parentIds[t];i=n!==t,t=n}throw Error("traverseHierarchySingleParent")}(e,t,r)}function aU(e){return null!=e}let aG=(e,t)=>e,ak={HIERARCHY:!0,extensions:!0,extras:!0};class aH{json;binary;featureCount;_extensions;_properties;_binaryProperties;_hierarchy;constructor(e,t,r,i={}){for(let i in(0,ir.v)(r>=0),this.json=e||{},this.binary=t,this.featureCount=r,this._extensions=this.json?.extensions||{},this._properties={},this.json)ak[i]||(this._properties[i]=this.json[i]);this._binaryProperties=this._initializeBinaryProperties(),i["3DTILES_batch_table_hierarchy"]&&(this._hierarchy=function(e,t,r){if(!t)return null;let i=e.getExtension("3DTILES_batch_table_hierarchy"),s=t.HIERARCHY;return(s&&(console.warn("3D Tile Parser: HIERARCHY is deprecated. Use 3DTILES_batch_table_hierarchy."),t.extensions=t.extensions||{},t.extensions["3DTILES_batch_table_hierarchy"]=s,i=s),i)?function(e,t){let r,i,s,n;let o=e.instancesLength,a=e.classes,l=e.classIds,h=e.parentCounts,u=e.parentIds,c=o;if(aF(l.byteOffset)&&(l.componentType=defaultValue(l.componentType,GL.UNSIGNED_SHORT),l.type=AttributeType.SCALAR,l=getBinaryAccessor(l).createArrayBufferView(t.buffer,t.byteOffset+l.byteOffset,o)),aF(h))for(aF(h.byteOffset)&&(h.componentType=defaultValue(h.componentType,GL.UNSIGNED_SHORT),h.type=AttributeType.SCALAR,h=getBinaryAccessor(h).createArrayBufferView(t.buffer,t.byteOffset+h.byteOffset,o)),n=new Uint16Array(o),c=0,r=0;r<o;++r)n[r]=c,c+=h[r];aF(u)&&aF(u.byteOffset)&&(u.componentType=defaultValue(u.componentType,GL.UNSIGNED_SHORT),u.type=AttributeType.SCALAR,u=getBinaryAccessor(u).createArrayBufferView(t.buffer,t.byteOffset+u.byteOffset,c));let d=a.length;for(r=0;r<d;++r){let e=a[r].length,i=a[r].instances,s=getBinaryProperties(e,i,t);a[r].instances=combine(s,i)}let f=Array(d).fill(0),p=new Uint16Array(o);for(r=0;r<o;++r)i=l[r],p[r]=f[i],++f[i];let g={classes:a,classIds:l,classIndexes:p,parentCounts:h,parentIndexes:n,parentIds:u};return function(e){let t=e.classIds.length;for(let r=0;r<t;++r)(function e(t,r,i){let s=t.parentCounts,n=t.parentIds,o=t.parentIndexes,a=t.classIds.length;if(!aF(n))return;assert(r<a,`Parent index ${r} exceeds the total number of instances: ${a}`),assert(-1===i.indexOf(r),"Circular dependency detected in the batch table hierarchy."),i.push(r);let l=aF(s)?s[r]:1,h=aF(s)?o[r]:r;for(let s=0;s<l;++s){let o=n[h+s];o!==r&&e(t,o,i)}i.pop(r)})(e,r,stack)}(g),g}(i,r):null}(this,this.json,this.binary))}getExtension(e){return this.json&&this.json.extensions&&this.json.extensions[e]}memorySizeInBytes(){return 0}isClass(e,t){return this._checkBatchId(e),(0,ir.v)("string"==typeof t,t),!!this._hierarchy&&aU(aD(this._hierarchy,e,(e,r)=>{let i=e.classIds[r];return e.classes[i].name===t}))}isExactClass(e,t){return(0,ir.v)("string"==typeof t,t),this.getExactClassName(e)===t}getExactClassName(e){if(this._checkBatchId(e),this._hierarchy){let t=this._hierarchy.classIds[e];return this._hierarchy.classes[t].name}}hasProperty(e,t){return this._checkBatchId(e),(0,ir.v)("string"==typeof t,t),aU(this._properties[t])||this._hasPropertyInHierarchy(e,t)}getPropertyNames(e,t){this._checkBatchId(e),(t=aU(t)?t:[]).length=0;let r=Object.keys(this._properties);return t.push(...r),this._hierarchy&&this._getPropertyNamesInHierarchy(e,t),t}getProperty(e,t){if(this._checkBatchId(e),(0,ir.v)("string"==typeof t,t),this._binaryProperties){let r=this._binaryProperties[t];if(aU(r))return this._getBinaryProperty(r,e)}let r=this._properties[t];if(aU(r))return aG(r[e],!0);if(this._hierarchy){let r=this._getHierarchyProperty(e,t);if(aU(r))return r}}setProperty(e,t,r){let i=this.featureCount;if(this._checkBatchId(e),(0,ir.v)("string"==typeof t,t),this._binaryProperties){let i=this._binaryProperties[t];if(i){this._setBinaryProperty(i,e,r);return}}if(this._hierarchy&&this._setHierarchyProperty(this,e,t,r))return;let s=this._properties[t];aU(s)||(this._properties[t]=Array(i),s=this._properties[t]),s[e]=aG(r,!0)}_checkBatchId(e){if(!(e>=0&&e<this.featureCount))throw Error("batchId not in range [0, featureCount - 1].")}_getBinaryProperty(e,t){return e.unpack(e.typedArray,t)}_setBinaryProperty(e,t,r){e.pack(r,e.typedArray,t)}_initializeBinaryProperties(){let e=null;for(let t in this._properties){let r=this._properties[t],i=this._initializeBinaryProperty(t,r);i&&((e=e||{})[t]=i)}return e}_initializeBinaryProperty(e,t){if("byteOffset"in t){(0,ir.v)(this.binary,`Property ${e} requires a batch table binary.`),(0,ir.v)(t.type,`Property ${e} requires a type.`);let r=function(e,t,r,i){let{componentType:s}=e;(0,ir.v)(e.componentType);let n="string"==typeof s?aP.fromName(s):s,o=aO[e.type],a=ax[e.type],l=aN[e.type];return r+=e.byteOffset,{values:aP.createTypedArray(n,t,r,o*i),type:n,size:o,unpacker:a,packer:l}}(t,this.binary.buffer,0|this.binary.byteOffset,this.featureCount);return{typedArray:r.values,componentCount:r.size,unpack:r.unpacker,pack:r.packer}}return null}_hasPropertyInHierarchy(e,t){if(!this._hierarchy)return!1;let r=aD(this._hierarchy,e,(e,r)=>{let i=e.classIds[r];return aU(e.classes[i].instances[t])});return aU(r)}_getPropertyNamesInHierarchy(e,t){aD(this._hierarchy,e,(e,r)=>{let i=e.classIds[r],s=e.classes[i].instances;for(let e in s)s.hasOwnProperty(e)&&-1===t.indexOf(e)&&t.push(e)})}_getHierarchyProperty(e,t){return aD(this._hierarchy,e,(e,r)=>{let i=e.classIds[r],s=e.classes[i],n=e.classIndexes[r],o=s.instances[t];return aU(o)?aU(o.typedArray)?this._getBinaryProperty(o,n):aG(o[n],!0):null})}_setHierarchyProperty(e,t,r,i){let s=aD(this._hierarchy,t,(e,s)=>{let n=e.classIds[s],o=e.classes[n],a=e.classIndexes[s],l=o.instances[r];return!!aU(l)&&((0,ir.v)(s===t,`Inherited property "${r}" is read-only.`),aU(l.typedArray)?this._setBinaryProperty(l,a,i):l[a]=aG(i,!0),!0)});return aU(s)}}function aV(e,t,r=0){let i=new DataView(t);if(e.magic=i.getUint32(r,!0),r+=4,e.version=i.getUint32(r,!0),r+=4,e.byteLength=i.getUint32(r,!0),r+=4,1!==e.version)throw Error(`3D Tile Version ${e.version} not supported`);return r}let aj="b3dm tile in legacy format.";function aW(e,t,r){let i;let s=new DataView(t);e.header=e.header||{};let n=s.getUint32(r,!0);r+=4;let o=s.getUint32(r,!0);r+=4;let a=s.getUint32(r,!0);r+=4;let l=s.getUint32(r,!0);return r+=4,a>=0x22000000?(r-=8,i=n,a=o,l=0,n=0,o=0,console.warn(aj)):l>=0x22000000&&(r-=4,i=a,a=n,l=o,n=0,o=0,console.warn(aj)),e.header.featureTableJsonByteLength=n,e.header.featureTableBinaryByteLength=o,e.header.batchTableJsonByteLength=a,e.header.batchTableBinaryByteLength=l,e.header.batchLength=i,r}function az(e,t,r,i){return r=function(e,t,r,i){let{featureTableJsonByteLength:s,featureTableBinaryByteLength:n,batchLength:o}=e.header||{};return e.featureTableJson={BATCH_LENGTH:o||0},s&&s>0&&(e.featureTableJson=JSON.parse(aR(t,r,s))),e.featureTableBinary=new Uint8Array(t,r+=s||0,n),r+=n||0}(e,t,r,0),r=function(e,t,r,i){let{batchTableJsonByteLength:s,batchTableBinaryByteLength:n}=e.header||{};return s&&s>0&&(e.batchTableJson=JSON.parse(aR(t,r,s)),r+=s,n&&n>0&&(e.batchTableBinary=new Uint8Array(t,r,n),e.batchTableBinary=new Uint8Array(e.batchTableBinary),r+=n)),r}(e,t,r,0)}function aX(e,t,r){if(!t&&(!e||!e.batchIds||!r))return null;let{batchIds:i,isRGB565:s,pointCount:n=0}=e;if(i&&r){let e=new Uint8ClampedArray(3*n);for(let t=0;t<n;t++){let s=i[t],n=r.getProperty(s,"dimensions").map(e=>255*e);e[3*t]=n[0],e[3*t+1]=n[1],e[3*t+2]=n[2]}return{type:aB.UNSIGNED_BYTE,value:e,size:3,normalized:!0}}if(t&&s){let e=new Uint8ClampedArray(3*n);for(let r=0;r<n;r++){let i=function(e,t=[0,0,0]){return t[0]=(e>>11&31)<<3,t[1]=(e>>5&63)<<2,t[2]=(31&e)<<3,t}(t[r]);e[3*r]=i[0],e[3*r+1]=i[1],e[3*r+2]=i[2]}return{type:aB.UNSIGNED_BYTE,value:e,size:3,normalized:!0}}return t&&t.length===3*n?{type:aB.UNSIGNED_BYTE,value:t,size:3,normalized:!0}:{type:aB.UNSIGNED_BYTE,value:t||new Uint8ClampedArray,size:4,normalized:!0}}class aK extends rn.M{constructor(e=0,t=0){super(2),(0,e9.cy)(e)&&1==arguments.length?this.copy(e):(e9.$W.debug&&((0,ri.ws)(e),(0,ri.ws)(t)),this[0]=e,this[1]=t)}set(e,t){return this[0]=e,this[1]=t,this.check()}copy(e){return this[0]=e[0],this[1]=e[1],this.check()}fromObject(e){return e9.$W.debug&&((0,ri.ws)(e.x),(0,ri.ws)(e.y)),this[0]=e.x,this[1]=e.y,this.check()}toObject(e){return e.x=this[0],e.y=this[1],e}get ELEMENTS(){return 2}horizontalAngle(){return Math.atan2(this.y,this.x)}verticalAngle(){return Math.atan2(this.x,this.y)}transform(e){return this.transformAsPoint(e)}transformAsPoint(e){return(0,sS.Z0)(this,this,e),this.check()}transformAsVector(e){return(0,rs.B$)(this,this,e),this.check()}transformByMatrix3(e){return(0,sS.ei)(this,this,e),this.check()}transformByMatrix2x3(e){return(0,sS.l0)(this,this,e),this.check()}transformByMatrix2(e){return(0,sS.ZF)(this,this,e),this.check()}}let aJ=new aK,a$=new t5.P,aY=new aK,aq=(new aK,new Uint8Array(1));function aQ(e,t=255){return(0,e9.qE)(e,0,t)/t*2-1}function aZ(e,t=255){return Math.round((.5*clamp(e,-1,1)+.5)*t)}function a0(e,t,r){if(assert(e),assert(r),assert(Math.abs(a$.from(e).magnitudeSquared()-1)<=_MathUtils.EPSILON6),r.x=e.x/(Math.abs(e.x)+Math.abs(e.y)+Math.abs(e.z)),r.y=e.y/(Math.abs(e.x)+Math.abs(e.y)+Math.abs(e.z)),e.z<0){let e=r.x,t=r.y;r.x=(1-Math.abs(t))*(e<0?-1:1),r.y=(1-Math.abs(e))*(t<0?-1:1)}return r.x=aZ(r.x,t),r.y=aZ(r.y,t),r}function a1(e,t,r){return function(e,t,r,i){if(!function(e,t){if(!e)throw Error("math.gl assertion failed. undefined")}(i),e<0||e>255||t<0||t>r)throw Error(`x and y must be unsigned normalized integers between 0 and ${r}`);if(i.x=aQ(e,r),i.y=aQ(t,r),i.z=1-(Math.abs(i.x)+Math.abs(i.y)),i.z<0){let e=i.x;i.x=(1-Math.abs(i.y))*(e<0?-1:1),i.y=(1-Math.abs(e))*(i.y<0?-1:1)}return i.normalize()}(e,t,255,r)}let a3=new t5.P;async function a2(e,t,r,i,s){var n;r=aV(e,t,r),r=aW(e,t,r),r=az(e,t,r,i),(n=e).attributes={positions:null,colors:null,normals:null,batchIds:null},n.isQuantized=!1,n.isTranslucent=!1,n.isRGB565=!1,n.isOctEncoded16P=!1;let{featureTable:o,batchTable:a}=function(e){let t=new aL(e.featureTableJson,e.featureTableBinary),r=t.getGlobalProperty("POINTS_LENGTH");if(!Number.isFinite(r))throw Error("POINTS_LENGTH must be defined");t.featuresLength=r,e.featuresLength=r,e.pointsLength=r,e.pointCount=r,e.rtcCenter=t.getGlobalProperty("RTC_CENTER",aB.FLOAT,3);let i=function(e,t){let r=null;if(!e.batchIds&&t.hasProperty("BATCH_ID")&&(e.batchIds=t.getPropertyArray("BATCH_ID",aB.UNSIGNED_SHORT,1),e.batchIds)){let i=t.getGlobalProperty("BATCH_LENGTH");if(!i)throw Error("Global property: BATCH_LENGTH must be defined when BATCH_ID is defined.");let{batchTableJson:s,batchTableBinary:n}=e;r=new aH(s,n,i)}return r}(e,t);return{featureTable:t,batchTable:i}}(e);return await a6(e,o,a,i,s),function(e,t,r){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.positions){if(t.hasProperty("POSITION"))e.attributes.positions=t.getPropertyArray("POSITION",aB.FLOAT,3);else if(t.hasProperty("POSITION_QUANTIZED")){let i=t.getPropertyArray("POSITION_QUANTIZED",aB.UNSIGNED_SHORT,3);if(e.isQuantized=!0,e.quantizedRange=65535,e.quantizedVolumeScale=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",aB.FLOAT,3),!e.quantizedVolumeScale)throw Error("QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");if(e.quantizedVolumeOffset=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",aB.FLOAT,3),!e.quantizedVolumeOffset)throw Error("QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");e.attributes.positions=e.isQuantized?r["3d-tiles"]&&r["3d-tiles"].decodeQuantizedPositions?(e.isQuantized=!1,function(e,t){let r=new t5.P,i=new Float32Array(3*e.pointCount);for(let s=0;s<e.pointCount;s++)r.set(t[3*s],t[3*s+1],t[3*s+2]).scale(1/e.quantizedRange).multiply(e.quantizedVolumeScale).add(e.quantizedVolumeOffset).toArray(i,3*s);return i}(e,i)):{type:aB.UNSIGNED_SHORT,value:i,size:3,normalized:!0}:i}}if(!e.attributes.positions)throw Error("Either POSITION or POSITION_QUANTIZED must be defined.")}(e,o,i),function(e,t,r){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.colors){let i=null;t.hasProperty("RGBA")?(i=t.getPropertyArray("RGBA",aB.UNSIGNED_BYTE,4),e.isTranslucent=!0):t.hasProperty("RGB")?i=t.getPropertyArray("RGB",aB.UNSIGNED_BYTE,3):t.hasProperty("RGB565")&&(i=t.getPropertyArray("RGB565",aB.UNSIGNED_SHORT,1),e.isRGB565=!0),e.attributes.colors=aX(e,i,r)}t.hasProperty("CONSTANT_RGBA")&&(e.constantRGBA=t.getGlobalProperty("CONSTANT_RGBA",aB.UNSIGNED_BYTE,4))}(e,o,a),function(e,t){if(e.attributes=e.attributes||{positions:null,colors:null,normals:null,batchIds:null},!e.attributes.normals){let r=null;t.hasProperty("NORMAL")?r=t.getPropertyArray("NORMAL",aB.FLOAT,3):t.hasProperty("NORMAL_OCT16P")&&(r=t.getPropertyArray("NORMAL_OCT16P",aB.UNSIGNED_BYTE,2),e.isOctEncoded16P=!0),e.attributes.normals=function(e,t){if(!t)return null;if(e.isOctEncoded16P){let r=new Float32Array(3*(e.pointsLength||0));for(let i=0;i<(e.pointsLength||0);i++)a1(t[2*i],t[2*i+1],a3),a3.toArray(r,3*i);return{type:aB.FLOAT,size:2,value:r}}return{type:aB.FLOAT,size:2,value:t}}(e,r)}}(e,o),r}async function a6(e,t,r,i,s){let n,o,a;let l=e.batchTableJson&&e.batchTableJson.extensions&&e.batchTableJson.extensions["3DTILES_draco_point_compression"];l&&(a=l.properties);let h=t.getExtension("3DTILES_draco_point_compression");if(h){o=h.properties;let t=h.byteOffset,r=h.byteLength;if(!o||!Number.isFinite(t)||!r)throw Error("Draco properties, byteOffset, and byteLength must be defined");n=(e.featureTableBinary||[]).slice(t,t+r),e.hasPositions=Number.isFinite(o.POSITION),e.hasColors=Number.isFinite(o.RGB)||Number.isFinite(o.RGBA),e.hasNormals=Number.isFinite(o.NORMAL),e.hasBatchIds=Number.isFinite(o.BATCH_ID),e.isTranslucent=Number.isFinite(o.RGBA)}if(!n)return!0;let u={buffer:n,properties:{...o,...a},featureTableProperties:o,batchTableProperties:a,dequantizeInShader:!1};return await a4(e,u,i,s)}async function a4(e,t,r,i){if(!i)return;let s={...r,draco:{...r?.draco,extraAttributes:t.batchTableProperties||{}}};delete s["3d-tiles"];let n=await rG(t.buffer,sg,s,i),o=n.attributes.POSITION&&n.attributes.POSITION.value,a=n.attributes.COLOR_0&&n.attributes.COLOR_0.value,l=n.attributes.NORMAL&&n.attributes.NORMAL.value,h=n.attributes.BATCH_ID&&n.attributes.BATCH_ID.value,u=o&&n.attributes.POSITION.value.quantization,c=l&&n.attributes.NORMAL.value.quantization;if(u){let t=n.POSITION.data.quantization,r=t.range;e.quantizedVolumeScale=new t5.P(r,r,r),e.quantizedVolumeOffset=new t5.P(t.minValues),e.quantizedRange=(1<<t.quantizationBits)-1,e.isQuantizedDraco=!0}c&&(e.octEncodedRange=(1<<n.NORMAL.data.quantization.quantizationBits)-1,e.isOctEncodedDraco=!0);let d={};if(t.batchTableProperties)for(let e of Object.keys(t.batchTableProperties))n.attributes[e]&&n.attributes[e].value&&(d[e.toLowerCase()]=n.attributes[e].value);e.attributes={positions:o,colors:aX(e,a,void 0),normals:l,batchIds:h,...d}}let a8={URI:0,EMBEDDED:1};function a9(e,t,r,i){e.rotateYtoZ=!0;let s=(e.byteOffset||0)+(e.byteLength||0)-r;if(0===s)throw Error("glTF byte length must be greater than 0.");return e.gltfUpAxis=i?.["3d-tiles"]&&i["3d-tiles"].assetGltfUpAxis?i["3d-tiles"].assetGltfUpAxis:"Y",e.gltfArrayBuffer=(0,rU._m)(t,r,s),e.gltfByteOffset=0,e.gltfByteLength=s,r%4==0||console.warn(`${e.type}: embedded glb is not aligned to a 4-byte boundary.`),(e.byteOffset||0)+(e.byteLength||0)}async function a5(e,t,r,i){let s=r?.["3d-tiles"]||{};if(function(e,t,r){switch(t){case a8.URI:if(e.gltfArrayBuffer){let t=new Uint8Array(e.gltfArrayBuffer,e.gltfByteOffset);e.gltfUrl=new TextDecoder().decode(t).replace(/[\s\0]+$/,"")}delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength;break;case a8.EMBEDDED:break;default:throw Error("b3dm: Illegal glTF format field")}}(e,t,0),s.loadGLTF){if(!i)return;if(e.gltfUrl){let{fetch:t}=i,s=await t(e.gltfUrl,r);e.gltfArrayBuffer=await s.arrayBuffer(),e.gltfByteOffset=0}e.gltfArrayBuffer&&(e.gltf=no(await rG(e.gltfArrayBuffer,s5,r,i)),e.gpuMemoryUsageInBytes=iE(e.gltf),delete e.gltfArrayBuffer,delete e.gltfByteOffset,delete e.gltfByteLength)}}async function a7(e,t,r,i,s){var n,o,a,l,h;n=e,o=t,a=r,l=i,h=0,a=aV(n,o,a),a=aW(n,o,a),a=az(n,o,a,l),a=a9(n,o,a,l),n.rtcCenter=new aL(n.featureTableJson,n.featureTableBinary).getGlobalProperty("RTC_CENTER",aB.FLOAT,3),r=a,await a5(e,a8.EMBEDDED,i,s);let u=e?.gltf?.extensions;return u&&u.CESIUM_RTC&&(e.rtcCenter=u.CESIUM_RTC.center),r}async function le(e,t,r,i,s){return r=function(e,t,r,i,s){if(r=aV(e,t,r),1!==e.version)throw Error(`Instanced 3D Model version ${e.version} is not supported`);if(r=aW(e,t,r),e.gltfFormat=new DataView(t).getUint32(r,!0),r+=4,r=az(e,t,r,i),r=a9(e,t,r,i),!e?.header?.featureTableJsonByteLength||0===e.header.featureTableJsonByteLength)throw Error("i3dm parser: featureTableJsonByteLength is zero.");let n=new aL(e.featureTableJson,e.featureTableBinary),o=n.getGlobalProperty("INSTANCES_LENGTH");if(n.featuresLength=o,!Number.isFinite(o))throw Error("i3dm parser: INSTANCES_LENGTH must be defined");e.eastNorthUp=n.getGlobalProperty("EAST_NORTH_UP"),e.rtcCenter=n.getGlobalProperty("RTC_CENTER",aB.FLOAT,3);let a=new aH(e.batchTableJson,e.batchTableBinary,o);return function(e,t,r,i){let s=Array(i),n=new t5.P,o=(new t5.P,new t5.P,new t5.P,new sw),a=new rT,l=new t5.P,h={},u=new t9.k,c=[],d=[],f=[],p=[];for(let r=0;r<i;r++){let i;if(t.hasProperty("POSITION"))i=t.getProperty("POSITION",aB.FLOAT,3,r,n);else if(t.hasProperty("POSITION_QUANTIZED")){i=t.getProperty("POSITION_QUANTIZED",aB.UNSIGNED_SHORT,3,r,n);let e=t.getGlobalProperty("QUANTIZED_VOLUME_OFFSET",aB.FLOAT,3);if(!e)throw Error("i3dm parser: QUANTIZED_VOLUME_OFFSET must be defined for quantized positions.");let s=t.getGlobalProperty("QUANTIZED_VOLUME_SCALE",aB.FLOAT,3);if(!s)throw Error("i3dm parser: QUANTIZED_VOLUME_SCALE must be defined for quantized positions.");for(let t=0;t<3;t++)i[t]=i[t]/65535*s[t]+e[t]}if(!i)throw Error("i3dm: POSITION or POSITION_QUANTIZED must be defined for each instance.");if(n.copy(i),h.translation=n,e.normalUp=t.getProperty("NORMAL_UP",aB.FLOAT,3,r,c),e.normalRight=t.getProperty("NORMAL_RIGHT",aB.FLOAT,3,r,d),e.normalUp){if(!e.normalRight)throw Error("i3dm: Custom orientation requires both NORMAL_UP and NORMAL_RIGHT.");e.hasCustomOrientation=!0}else{if(e.octNormalUp=t.getProperty("NORMAL_UP_OCT32P",aB.UNSIGNED_SHORT,2,r,c),e.octNormalRight=t.getProperty("NORMAL_RIGHT_OCT32P",aB.UNSIGNED_SHORT,2,r,d),e.octNormalUp){if(!e.octNormalRight)throw Error("i3dm: oct-encoded orientation requires NORMAL_UP_OCT32P and NORMAL_RIGHT_OCT32P");throw Error("i3dm: oct-encoded orientation not implemented")}e.eastNorthUp?(n3.WGS84.eastNorthUpToFixedFrame(n,u),u.getRotationMatrix3(o)):o.identity()}a.fromMatrix3(o),h.rotation=a,l.set(1,1,1);let g=t.getProperty("SCALE",aB.FLOAT,1,r,f);Number.isFinite(g)&&l.multiplyByScalar(g);let m=t.getProperty("SCALE_NON_UNIFORM",aB.FLOAT,3,r,c);m&&l.scale(m),h.scale=l;let _=t.getProperty("BATCH_ID",aB.UNSIGNED_SHORT,1,r,p);void 0===_&&(_=r);let A=new t9.k().fromQuaternion(h.rotation);u.identity(),u.translate(h.translation),u.multiplyRight(A),u.scale(h.scale);let E=u.clone();s[r]={modelMatrix:E,batchId:_}}e.instances=s}(e,n,0,o),r}(e,t,r,i,0),await a5(e,e.gltfFormat||0,i,s),r}async function lt(e,t,r,i,s,n){for(r=aV(e,t,r),e.tilesLength=new DataView(t).getUint32(r,!0),r+=4,e.tiles=[];e.tiles.length<e.tilesLength&&(e.byteLength||0)-r>12;){let o={shape:"tile3d"};e.tiles.push(o),r=await n(t,r,i,s,o)}return r}async function lr(e,t,r,i){if(e.rotateYtoZ=!0,e.gltfUpAxis=r?.["3d-tiles"]?.assetGltfUpAxis?r["3d-tiles"].assetGltfUpAxis:"Y",r?.["3d-tiles"]?.loadGLTF){if(!i)return t.byteLength;e.gltf=no(await rG(t,s5,r,i)),e.gpuMemoryUsageInBytes=iE(e.gltf)}else e.gltfArrayBuffer=t;return t.byteLength}async function li(e,t=0,r,i,s={shape:"tile3d"}){switch(s.byteOffset=t,s.type=function(e,t=0){let r=new DataView(e);return`\
${String.fromCharCode(r.getUint8(t+0))}\
${String.fromCharCode(r.getUint8(t+1))}\
${String.fromCharCode(r.getUint8(t+2))}\
${String.fromCharCode(r.getUint8(t+3))}`}(e,t),s.type){case av.COMPOSITE:return await lt(s,e,t,r,i,li);case av.BATCHED_3D_MODEL:return await a7(s,e,t,r,i);case av.GLTF:return await lr(s,e,r,i);case av.INSTANCED_3D_MODEL:return await le(s,e,t,r,i);case av.POINT_CLOUD:return await a2(s,e,t,r,i);default:throw Error(`3DTileLoader: unknown type ${s.type}`)}}async function ls(e,t,r,i){let s=Number.isFinite(t.bitstream)?t.bitstream:t.bufferView;if("number"!=typeof s)return;let n=e.bufferViews[s],o=e.buffers[n.buffer];if(!i?.baseUrl)throw Error("Url is not provided");if(!i.fetch)throw Error("fetch is not provided");if(o.uri){let e=`${i?.baseUrl||""}/${o.uri}`,r=await i.fetch(e);t.explicitBitstream=new Uint8Array(await r.arrayBuffer(),n.byteOffset,n.byteLength);return}let a=e.buffers.slice(0,n.buffer).reduce((e,t)=>e+t.byteLength,0);t.explicitBitstream=new Uint8Array(r.slice(a,a+o.byteLength),n.byteOffset,n.byteLength)}function ln(e){let t=new DataView(e);return t.getUint32(0,!0)+0x100000000*t.getUint32(4,!0)}let lo={dataType:null,batchType:null,id:"3d-tiles-subtree",name:"3D Tiles Subtree",module:"3d-tiles",version:aC,extensions:["subtree"],mimeTypes:["application/octet-stream"],tests:["subtree"],parse:async function(e,t,r){if(0x74627573!==new Uint32Array(e.slice(0,4))[0])throw Error("Wrong subtree file magic number");if(1!==new Uint32Array(e.slice(4,8))[0])throw Error("Wrong subtree file verson, must be 1");let i=ln(e.slice(8,16)),s=new Uint8Array(e,24,i),n=JSON.parse(new TextDecoder("utf8").decode(s)),o=ln(e.slice(16,24)),a=new ArrayBuffer(0);if(o&&(a=e.slice(24+i)),await ls(n,n.tileAvailability,a,r),Array.isArray(n.contentAvailability))for(let e of n.contentAvailability)await ls(n,e,a,r);else await ls(n,n.contentAvailability,a,r);return await ls(n,n.childSubtreeAvailability,a,r),n},options:{}};var la=r(43558);globalThis.probe={};let ll=new la.t({id:"@probe.gl/log"});var lh=null;try{lh=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function lu(e,t,r){this.low=0|e,this.high=0|t,this.unsigned=!!r}function lc(e){return!0===(e&&e.__isLong__)}function ld(e){var t=Math.clz32(e&-e);return e?31-t:t}lu.prototype.__isLong__,Object.defineProperty(lu.prototype,"__isLong__",{value:!0}),lu.isLong=lc;var lf={},lp={};function lg(e,t){var r,i,s;return t?(e>>>=0,(s=0<=e&&e<256)&&(i=lp[e]))?i:(r=l_(e,0,!0),s&&(lp[e]=r),r):(e|=0,(s=-128<=e&&e<128)&&(i=lf[e]))?i:(r=l_(e,e<0?-1:0,!1),s&&(lf[e]=r),r)}function lm(e,t){if(isNaN(e))return t?lS:lR;if(t){if(e<0)return lS;if(e>=lT)return lP}else{if(e<=-lC)return lL;if(e+1>=lC)return lI}return e<0?lm(-e,t).neg():l_(e%ly|0,e/ly|0,t)}function l_(e,t,r){return new lu(e,t,r)}lu.fromInt=lg,lu.fromNumber=lm,lu.fromBits=l_;var lA=Math.pow;function lE(e,t,r){if(0===e.length)throw Error("empty string");if("number"==typeof t?(r=t,t=!1):t=!!t,"NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return t?lS:lR;if((r=r||10)<2||36<r)throw RangeError("radix");if((i=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===i)return lE(e.substring(1),t,r).neg();for(var i,s=lm(lA(r,8)),n=lR,o=0;o<e.length;o+=8){var a=Math.min(8,e.length-o),l=parseInt(e.substring(o,o+a),r);if(a<8){var h=lm(lA(r,a));n=n.mul(h).add(lm(l))}else n=(n=n.mul(s)).add(lm(l))}return n.unsigned=t,n}function lb(e,t){return"number"==typeof e?lm(e,t):"string"==typeof e?lE(e,t):l_(e.low,e.high,"boolean"==typeof t?t:e.unsigned)}lu.fromString=lE,lu.fromValue=lb;var ly=0x100000000,lT=0xffffffffffffffff,lC=0x8000000000000000,lv=lg(0x1000000),lR=lg(0);lu.ZERO=lR;var lS=lg(0,!0);lu.UZERO=lS;var lB=lg(1);lu.ONE=lB;var lw=lg(1,!0);lu.UONE=lw;var lM=lg(-1);lu.NEG_ONE=lM;var lI=l_(-1,0x7fffffff,!1);lu.MAX_VALUE=lI;var lP=l_(-1,-1,!0);lu.MAX_UNSIGNED_VALUE=lP;var lL=l_(0,-0x80000000,!1);lu.MIN_VALUE=lL;var lO=lu.prototype;function lx(e){"X"===e&&(e="");let t=e.padEnd(16,"0");return lu.fromString(t,!0,16)}lO.toInt=function(){return this.unsigned?this.low>>>0:this.low},lO.toNumber=function(){return this.unsigned?(this.high>>>0)*ly+(this.low>>>0):this.high*ly+(this.low>>>0)},lO.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(!this.eq(lL))return"-"+this.neg().toString(e);var t=lm(e),r=this.div(t),i=r.mul(t).sub(this);return r.toString(e)+i.toInt().toString(e)}for(var s=lm(lA(e,6),this.unsigned),n=this,o="";;){var a=n.div(s),l=(n.sub(a.mul(s)).toInt()>>>0).toString(e);if((n=a).isZero())return l+o;for(;l.length<6;)l="0"+l;o=""+l+o}},lO.getHighBits=function(){return this.high},lO.getHighBitsUnsigned=function(){return this.high>>>0},lO.getLowBits=function(){return this.low},lO.getLowBitsUnsigned=function(){return this.low>>>0},lO.getNumBitsAbs=function(){if(this.isNegative())return this.eq(lL)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&(e&1<<t)==0;t--);return 0!=this.high?t+33:t+1},lO.isSafeInteger=function(){var e=this.high>>21;return!e||!this.unsigned&&-1===e&&(0!==this.low||-2097152!==this.high)},lO.isZero=function(){return 0===this.high&&0===this.low},lO.eqz=lO.isZero,lO.isNegative=function(){return!this.unsigned&&this.high<0},lO.isPositive=function(){return this.unsigned||this.high>=0},lO.isOdd=function(){return(1&this.low)==1},lO.isEven=function(){return(1&this.low)==0},lO.equals=function(e){return lc(e)||(e=lb(e)),(this.unsigned===e.unsigned||this.high>>>31!=1||e.high>>>31!=1)&&this.high===e.high&&this.low===e.low},lO.eq=lO.equals,lO.notEquals=function(e){return!this.eq(e)},lO.neq=lO.notEquals,lO.ne=lO.notEquals,lO.lessThan=function(e){return 0>this.comp(e)},lO.lt=lO.lessThan,lO.lessThanOrEqual=function(e){return 0>=this.comp(e)},lO.lte=lO.lessThanOrEqual,lO.le=lO.lessThanOrEqual,lO.greaterThan=function(e){return this.comp(e)>0},lO.gt=lO.greaterThan,lO.greaterThanOrEqual=function(e){return this.comp(e)>=0},lO.gte=lO.greaterThanOrEqual,lO.ge=lO.greaterThanOrEqual,lO.compare=function(e){if(lc(e)||(e=lb(e)),this.eq(e))return 0;var t=this.isNegative(),r=e.isNegative();return t&&!r?-1:!t&&r?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},lO.comp=lO.compare,lO.negate=function(){return!this.unsigned&&this.eq(lL)?lL:this.not().add(lB)},lO.neg=lO.negate,lO.add=function(e){lc(e)||(e=lb(e));var t,r,i=this.high>>>16,s=65535&this.high,n=this.low>>>16,o=65535&this.low,a=e.high>>>16,l=65535&e.high,h=e.low>>>16,u=65535&e.low,c=0,d=0;return t=0+((r=0+(o+u))>>>16),r&=65535,t+=n+h,d+=t>>>16,t&=65535,d+=s+l,c+=d>>>16,d&=65535,c+=i+a,l_(t<<16|r,(c&=65535)<<16|d,this.unsigned)},lO.subtract=function(e){return lc(e)||(e=lb(e)),this.add(e.neg())},lO.sub=lO.subtract,lO.multiply=function(e){if(this.isZero())return this;if(lc(e)||(e=lb(e)),lh)return l_(lh.mul(this.low,this.high,e.low,e.high),lh.get_high(),this.unsigned);if(e.isZero())return this.unsigned?lS:lR;if(this.eq(lL))return e.isOdd()?lL:lR;if(e.eq(lL))return this.isOdd()?lL:lR;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(lv)&&e.lt(lv))return lm(this.toNumber()*e.toNumber(),this.unsigned);var t,r,i=this.high>>>16,s=65535&this.high,n=this.low>>>16,o=65535&this.low,a=e.high>>>16,l=65535&e.high,h=e.low>>>16,u=65535&e.low,c=0,d=0;return t=0+((r=0+o*u)>>>16),r&=65535,t+=n*u,d+=t>>>16,t&=65535,t+=o*h,d+=t>>>16,t&=65535,d+=s*u,c+=d>>>16,d&=65535,d+=n*h,c+=d>>>16,d&=65535,d+=o*l,c+=d>>>16,d&=65535,c+=i*u+s*h+n*l+o*a,l_(t<<16|r,(c&=65535)<<16|d,this.unsigned)},lO.mul=lO.multiply,lO.divide=function(e){if(lc(e)||(e=lb(e)),e.isZero())throw Error("division by zero");if(lh){var t,r,i;return this.unsigned||-0x80000000!==this.high||-1!==e.low||-1!==e.high?l_((this.unsigned?lh.div_u:lh.div_s)(this.low,this.high,e.low,e.high),lh.get_high(),this.unsigned):this}if(this.isZero())return this.unsigned?lS:lR;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return lS;if(e.gt(this.shru(1)))return lw;i=lS}else{if(this.eq(lL))return e.eq(lB)||e.eq(lM)?lL:e.eq(lL)?lB:(t=this.shr(1).div(e).shl(1)).eq(lR)?e.isNegative()?lB:lM:(r=this.sub(e.mul(t)),i=t.add(r.div(e)));if(e.eq(lL))return this.unsigned?lS:lR;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=lR}for(r=this;r.gte(e);){for(var s=Math.ceil(Math.log(t=Math.max(1,Math.floor(r.toNumber()/e.toNumber())))/Math.LN2),n=s<=48?1:lA(2,s-48),o=lm(t),a=o.mul(e);a.isNegative()||a.gt(r);)t-=n,a=(o=lm(t,this.unsigned)).mul(e);o.isZero()&&(o=lB),i=i.add(o),r=r.sub(a)}return i},lO.div=lO.divide,lO.modulo=function(e){return(lc(e)||(e=lb(e)),lh)?l_((this.unsigned?lh.rem_u:lh.rem_s)(this.low,this.high,e.low,e.high),lh.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},lO.mod=lO.modulo,lO.rem=lO.modulo,lO.not=function(){return l_(~this.low,~this.high,this.unsigned)},lO.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},lO.clz=lO.countLeadingZeros,lO.countTrailingZeros=function(){return this.low?ld(this.low):ld(this.high)+32},lO.ctz=lO.countTrailingZeros,lO.and=function(e){return lc(e)||(e=lb(e)),l_(this.low&e.low,this.high&e.high,this.unsigned)},lO.or=function(e){return lc(e)||(e=lb(e)),l_(this.low|e.low,this.high|e.high,this.unsigned)},lO.xor=function(e){return lc(e)||(e=lb(e)),l_(this.low^e.low,this.high^e.high,this.unsigned)},lO.shiftLeft=function(e){return(lc(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?l_(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):l_(0,this.low<<e-32,this.unsigned)},lO.shl=lO.shiftLeft,lO.shiftRight=function(e){return(lc(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?l_(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):l_(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},lO.shr=lO.shiftRight,lO.shiftRightUnsigned=function(e){return(lc(e)&&(e=e.toInt()),0==(e&=63))?this:e<32?l_(this.low>>>e|this.high<<32-e,this.high>>>e,this.unsigned):32===e?l_(this.high,0,this.unsigned):l_(this.high>>>e-32,0,this.unsigned)},lO.shru=lO.shiftRightUnsigned,lO.shr_u=lO.shiftRightUnsigned,lO.rotateLeft=function(e){var t;return(lc(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?l_(this.high,this.low,this.unsigned):e<32?(t=32-e,l_(this.low<<e|this.high>>>t,this.high<<e|this.low>>>t,this.unsigned)):(e-=32,t=32-e,l_(this.high<<e|this.low>>>t,this.low<<e|this.high>>>t,this.unsigned))},lO.rotl=lO.rotateLeft,lO.rotateRight=function(e){var t;return(lc(e)&&(e=e.toInt()),0==(e&=63))?this:32===e?l_(this.high,this.low,this.unsigned):e<32?(t=32-e,l_(this.high<<t|this.low>>>e,this.low<<t|this.high>>>e,this.unsigned)):(e-=32,t=32-e,l_(this.low<<t|this.high>>>e,this.high<<t|this.low>>>e,this.unsigned))},lO.rotr=lO.rotateRight,lO.toSigned=function(){return this.unsigned?l_(this.low,this.high,!1):this},lO.toUnsigned=function(){return this.unsigned?this:l_(this.low,this.high,!0)},lO.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},lO.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},lO.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},lu.fromBytes=function(e,t,r){return r?lu.fromBytesLE(e,t):lu.fromBytesBE(e,t)},lu.fromBytesLE=function(e,t){return new lu(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},lu.fromBytesBE=function(e,t){return new lu(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)},"function"==typeof BigInt&&(lu.fromBigInt=function(e,t){return l_(Number(BigInt.asIntN(32,e)),Number(BigInt.asIntN(32,e>>BigInt(32))),t)},lu.fromValue=function(e,t){return"bigint"==typeof e?fromBigInt(e,t):lb(e,t)},lO.toBigInt=function(){var e=BigInt(this.low>>>0);return BigInt(this.unsigned?this.high>>>0:this.high)<<BigInt(32)|e});let lN=180/Math.PI;function lF(e,t,r){let i=1<<t;return[(e[0]+r[0])/i,(e[1]+r[1])/i]}function lD(e){return e>=.5?1/3*(4*e*e-1):1/3*(1-4*(1-e)*(1-e))}function lU(e){return[lD(e[0]),lD(e[1])]}function lG(e,[t,r]){switch(e){case 0:return[1,t,r];case 1:return[-t,1,r];case 2:return[-t,-r,1];case 3:return[-1,-r,-t];case 4:return[r,-1,-t];case 5:return[r,t,-1];default:throw Error("Invalid face")}}function lk([e,t,r]){let i=Math.atan2(r,Math.sqrt(e*e+t*t));return[Math.atan2(t,e)*lN,i*lN]}function lH(e){var t;return function(e){if(0===e.length)throw Error(`Invalid Hilbert quad key ${e}`);let t=e.split("/"),r=parseInt(t[0],10),i=t[1],s=i.length,n=0,o=[0,0];for(let e=s-1;e>=0;e--){n=s-e;let t=i[e],r=0,a=0;"1"===t?a=1:"2"===t?(r=1,a=1):"3"===t&&(r=1);let l=Math.pow(2,n-1);(function(e,t,r,i){if(0===i){1===r&&(t[0]=e-1-t[0],t[1]=e-1-t[1]);let i=t[0];t[0]=t[1],t[1]=i}})(l,o,r,a),o[0]+=l*r,o[1]+=l*a}if(r%2==1){let e=o[0];o[0]=o[1],o[1]=e}return{face:r,ij:o,level:n}}((t=e).indexOf("/")>0?t:function(e){if(e.isZero())return"";let t=e.toString(2);for(;t.length<64;)t="0"+t;let r=t.lastIndexOf("1"),i=t.substring(0,3),s=t.substring(3,r),n=s.length/2,o=lu.fromString(i,!0,2).toString(10),a="";if(0!==n)for(a=lu.fromString(s,!0,2).toString(4);a.length<n;)a="0"+a;return`${o}/${a}`}(lx(t)))}function lV(e){let{face:t,ij:r,level:i}=e,s=[[0,0],[0,1],[1,1],[1,0],[0,0]],n=Math.max(1,Math.ceil(100*Math.pow(2,-i))),o=new Float64Array(4*n*2+2),a=0,l=0;for(let e=0;e<4;e++){let h=s[e].slice(0),u=s[e+1],c=(u[0]-h[0])/n,d=(u[1]-h[1])/n;for(let e=0;e<n;e++){h[0]+=c,h[1]+=d;let e=lk(lG(t,lU(lF(r,i,h))));Math.abs(e[1])>89.999&&(e[0]=l);let s=e[0]-l;e[0]+=s>180?-360:360*(s<-180),o[a++]=e[0],o[a++]=e[1],l=e[0]}}return o[a++]=o[0],o[a++]=o[1],o}function lj(e){if(e.length%2!=0)throw Error("Invalid corners");let t=[],r=[];for(let i=0;i<e.length;i+=2)t.push(e[i]),r.push(e[i+1]);return t.sort((e,t)=>e-t),r.sort((e,t)=>e-t),{west:t[0],east:t[t.length-1],north:r[r.length-1],south:r[0]}}function lW(e){let t=e.token,r={minimumHeight:e.minimumHeight,maximumHeight:e.maximumHeight},i=function(e,t){let r=t?.minimumHeight||0,i=t?.maximumHeight||0,s=function(e){let t;if(2===e.face||5===e.face){let r=null,i=0;for(let t=0;t<4;t++){let s=lV(lH(`${e.face}/${t}`));null==r&&(r=new Float64Array(4*s.length)),r.set(s,i),i+=s.length}t=lj(r)}else t=lj(lV(e));return t}(lH(e)),n=s.west,o=s.south,a=s.east,l=s.north,h=[];return h.push(new t5.P(n,l,r)),h.push(new t5.P(a,l,r)),h.push(new t5.P(a,o,r)),h.push(new t5.P(n,o,r)),h.push(new t5.P(n,l,i)),h.push(new t5.P(a,l,i)),h.push(new t5.P(a,o,i)),h.push(new t5.P(n,o,i)),h}(t,r),s=function(e){let t=lU(lF(e.ij,e.level,[.5,.5]));return lk(lG(e.face,t))}(lH(t)),n=s[0],o=s[1],a=n3.WGS84.cartographicToCartesian([n,o,r.maximumHeight]),l=new t5.P(a[0],a[1],a[2]);i.push(l);let h=function(e,t=new of){if(!e||0===e.length)return t.halfAxes=new sw([0,0,0,0,0,0,0,0,0]),t.center=new t5.P,t;let r=e.length,i=new t5.P(0,0,0);for(let t of e)i.add(t);let s=1/r;i.multiplyByScalar(s);let n=0,o=0,a=0,l=0,h=0,u=0;for(let t of e){let e=ow.copy(t).subtract(i);n+=e.x*e.x,o+=e.x*e.y,a+=e.x*e.z,l+=e.y*e.y,h+=e.y*e.z,u+=e.z*e.z}n*=s,o*=s,a*=s,l*=s,h*=s,u*=s,oO[0]=n,oO[1]=o,oO[2]=a,oO[3]=o,oO[4]=l,oO[5]=h,oO[6]=a,oO[7]=h,oO[8]=u;let{unitary:c}=function(e,t={}){let r=0,i=0;oT.identity(),oC.copy(e);let s=1e-20*function(e){let t=0;for(let r=0;r<9;++r){let i=e[r];t+=i*i}return Math.sqrt(t)}(oC);for(;i<10&&function(e){let t=0;for(let r=0;r<3;++r){let i=e[oy.getElementIndex(oB[r],oS[r])];t+=2*i*i}return Math.sqrt(t)}(oC)>s;)(function(e,t){let r=0,i=1;for(let t=0;t<3;++t){let s=Math.abs(e[oy.getElementIndex(oB[t],oS[t])]);s>r&&(i=t,r=s)}let s=oS[i],n=oB[i],o=1,a=0;if(Math.abs(e[oy.getElementIndex(n,s)])>1e-15){let t;let r=e[oy.getElementIndex(n,n)],i=(r-e[oy.getElementIndex(s,s)])/2/e[oy.getElementIndex(n,s)];o=1/Math.sqrt(1+(t=i<0?-1/(-i+Math.sqrt(1+i*i)):1/(i+Math.sqrt(1+i*i)))*t),a=t*o}sw.IDENTITY.to(t),t[oy.getElementIndex(s,s)]=t[oy.getElementIndex(n,n)]=o,t[oy.getElementIndex(n,s)]=a,t[oy.getElementIndex(s,n)]=-a})(oC,ov),oR.copy(ov).transpose(),oC.multiplyRight(ov),oC.multiplyLeft(oR),oT.multiplyRight(ov),++r>2&&(++i,r=0);return t.unitary=oT.toTarget(t.unitary),t.diagonal=oC.toTarget(t.diagonal),t}(oO,ox),d=t.halfAxes.copy(c),f=d.getColumn(0,oI),p=d.getColumn(1,oP),g=d.getColumn(2,oL),m=-Number.MAX_VALUE,_=-Number.MAX_VALUE,A=-Number.MAX_VALUE,E=Number.MAX_VALUE,b=Number.MAX_VALUE,y=Number.MAX_VALUE;for(let t of e)ow.copy(t),m=Math.max(ow.dot(f),m),_=Math.max(ow.dot(p),_),A=Math.max(ow.dot(g),A),E=Math.min(ow.dot(f),E),b=Math.min(ow.dot(p),b),y=Math.min(ow.dot(g),y);f=f.multiplyByScalar(.5*(E+m)),p=p.multiplyByScalar(.5*(b+_)),g=g.multiplyByScalar(.5*(y+A)),t.center.copy(f).add(p).add(g);let T=oM.set(m-E,_-b,A-y).multiplyByScalar(.5),C=new sw([T[0],0,0,0,T[1],0,0,0,T[2]]);return t.halfAxes.multiplyRight(C),t}(i);return[...h.center,...h.halfAxes]}let lz={QUADTREE:4,OCTREE:8};async function lX(e){var t,r,i,s,n,o,a;let l,h,u,c;let{subtree:d,subtreeData:f={level:0,x:0,y:0,z:0},parentData:p={mortonIndex:0,localLevel:-1,localX:0,localY:0,localZ:0},childIndex:g=0,implicitOptions:m,loaderOptions:_,s2VolumeBox:A}=e,{subdivisionScheme:E,subtreeLevels:b,maximumLevel:y,contentUrlTemplate:T,subtreesUriTemplate:C,basePath:v}=m,R={children:[],lodMetricValue:0,contentUrl:""};if(!y)return ll.once(`Missing 'maximumLevel' or 'availableLevels' property. The subtree ${T} won't be loaded...`),R;let S=p.localLevel+1,B=f.level+S;if(B>y)return R;let w=lz[E],M=Math.log2(w),I=(t=p.localX,(t<<1)+(1&g)),P=(r=p.localY,(r<<1)+(g>>1&1)),L=(i=p.localZ,(i<<1)+(g>>2&1)),O=(s=f.x,(s<<S)+I),x=(n=f.y,(n<<S)+P),N=(o=f.z,(o<<S)+L),F=(a=p.mortonIndex,(a<<M)+g);if(S===b&&lK(d.childSubtreeAvailability,F)){let e=lJ(`${v}/${C}`,B,O,x,N);l=await (0,tP.H)(e,lo,_),c=0,h={level:B,x:O,y:x,z:N},u={mortonIndex:0,localLevel:0,localX:0,localY:0,localZ:0}}else l=d,c=(w**S-1)/(w-1)+F,h=f,u={mortonIndex:F,localLevel:S,localX:I,localY:P,localZ:L};if(!lK(l.tileAvailability,c))return R;lK(l.contentAvailability,c)&&(R.contentUrl=lJ(T,B,O,x,N));for(let e=0;e<w;e++){let t=function(e,t,r){if(e?.box){let i=function(e){if(e.isZero())return"X";let t=e.countTrailingZeros(),r=t%4,i=t=(t-r)/4;t*=4;let s=e.shiftRightUnsigned(t).toString(16).replace(/0+$/,"");return Array(17-i-s.length).join("0")+s}(function(e,t){var r;let i=(r=e).and(r.not().add(1)).shiftRightUnsigned(2);return e.add(lu.fromNumber(2*t+1-4).multiply(i))}(lx(e.s2VolumeInfo.token),t)),s={...e.s2VolumeInfo};if(s.token=i,"OCTREE"===r){let t=e.s2VolumeInfo,r=t.maximumHeight-t.minimumHeight,i=r/2,s=t.minimumHeight+r/2;t.minimumHeight=s-i,t.maximumHeight=s+i}return{box:lW(s),s2VolumeInfo:s}}}(A,e,E),r=await lX({subtree:l,subtreeData:h,parentData:u,childIndex:e,implicitOptions:m,loaderOptions:_,s2VolumeBox:t});(r.contentUrl||r.children.length)&&R.children.push(r)}return R.contentUrl||R.children.length?function(e,t,r,i){let{basePath:s,refine:n,getRefine:o,lodMetricType:a,getTileType:l,rootLodMetricValue:h,rootBoundingVolume:u}=r,c=e.contentUrl&&e.contentUrl.replace(`${s}/`,""),d=h/2**t.level,f=function(e,t,r){if(e.region){let i,s;let{level:n,x:o,y:a,z:l}=t,[h,u,c,d,f,p]=e.region,g=2**n,m=(c-h)/g,[_,A]=[h+m*o,h+m*(o+1)],E=(d-u)/g,[b,y]=[u+E*a,u+E*(a+1)];if("OCTREE"===r){let e=(p-f)/g;[i,s]=[f+e*l,f+e*(l+1)]}else[i,s]=[f,p];return{region:[_,b,A,y,i,s]}}if(e.box)return e;throw Error(`Unsupported bounding volume type ${JSON.stringify(e)}`)}(i?.box?{box:i.box}:u,t,r.subdivisionScheme);return{children:e.children,contentUrl:e.contentUrl,content:{uri:c},id:e.contentUrl,refine:o(n),type:l(e),lodMetricType:a,lodMetricValue:d,geometricError:d,transform:e.transform,boundingVolume:f}}(R,{level:B,x:O,y:x,z:N},m,A):R}function lK(e,t){var r;let i;return(Array.isArray(e)?(i=e[0],e.length>1&&ll.once('Not supported extension "3DTILES_multiple_contents" has been detected')):i=e,"constant"in i)?!!i.constant:!!i.explicitBitstream&&(r=t,1==(i.explicitBitstream[Math.floor(r/8)]>>r%8&1))}function lJ(e,t,r,i,s){let n=function(e){let t={};for(let r in e)t[`{${r}}`]=e[r];return t}({level:t,x:r,y:i,z:s});return e.replace(/{level}|{x}|{y}|{z}/gi,e=>n[e])}function l$(e,t=""){if(!t)return p.EMPTY;let r=t.split("?")[0].split(".").pop();switch(r){case"pnts":return p.POINTCLOUD;case"i3dm":case"b3dm":case"glb":case"gltf":return p.SCENEGRAPH;default:return r||p.EMPTY}}function lY(e){switch(e){case"REPLACE":case"replace":return f.REPLACE;case"ADD":case"add":return f.ADD;default:return e}}function lq(e,t){return/^[a-z][0-9a-z+.-]*:/i.test(t)?decodeURI(new URL(e,`${t}/`).toString()):e.startsWith("/")?e:n6.hd(t,e)}function lQ(e,t){let r;if(!e)return null;if(e.content){let i=e.content.uri||e.content?.url;void 0!==i&&(r=lq(i,t))}return{...e,id:r,contentUrl:r,lodMetricType:m.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:l$(e,r),refine:lY(e.refine)}}async function lZ(e,t,r){let i=null,s=l3(e.root);i=s&&e.root?await l0(e.root,e,t,s,r):lQ(e.root,t);let n=[];for(n.push(i);n.length>0;){let i=n.pop()||{},s=i.children||[],o=[];for(let i of s){let s;let a=l3(i);(s=a?await l0(i,e,t,a,r):lQ(i,t))&&(o.push(s),n.push(s))}i.children=o}return i}async function l0(e,t,r,i,s){let{subdivisionScheme:n,maximumLevel:o,availableLevels:a,subtreeLevels:l,subtrees:{uri:h}}=i,u=lq(lJ(h,0,0,0,0),r),c=await (0,tP.H)(u,lo,s),d=e.content?.uri,f=d?lq(d,r):"",p=t?.root?.refine,g=e.geometricError,_=e.boundingVolume.extensions?.["3DTILES_bounding_volume_S2"];_&&(e.boundingVolume={box:lW(_),s2VolumeInfo:_});let A=e.boundingVolume,E={contentUrlTemplate:f,subtreesUriTemplate:h,subdivisionScheme:n,subtreeLevels:l,maximumLevel:Number.isFinite(a)?a-1:o,refine:p,basePath:r,lodMetricType:m.GEOMETRIC_ERROR,rootLodMetricValue:g,rootBoundingVolume:A,getTileType:l$,getRefine:lY};return await l1(e,r,c,E,s)}async function l1(e,t,r,i,s){let n;if(!e)return null;let{children:o,contentUrl:a}=await lX({subtree:r,implicitOptions:i,loaderOptions:s}),l=null;return a&&(n=a,l={uri:a.replace(`${t}/`,"")}),{...e,id:n,contentUrl:n,lodMetricType:m.GEOMETRIC_ERROR,lodMetricValue:e.geometricError,transformMatrix:e.transform,type:l$(e,n),refine:lY(e.refine),content:l||e.content,children:o}}function l3(e){return e?.extensions?.["3DTILES_implicit_tiling"]||e?.implicitTiling}let l2={dataType:null,batchType:null,id:"3d-tiles",name:"3D Tiles",module:"3d-tiles",version:aC,extensions:["cmpt","pnts","b3dm","i3dm"],mimeTypes:["application/octet-stream"],tests:["cmpt","pnts","b3dm","i3dm"],parse:l6,options:{"3d-tiles":{loadGLTF:!0,decodeQuantizedPositions:!1,isTileset:"auto",assetGltfUpAxis:null}}};async function l6(e,t={},r){let i;let s=t["3d-tiles"]||{};return("auto"===s.isTileset?r?.url&&-1!==r.url.indexOf(".json"):s.isTileset)?l4(e,t,r):l8(e,t,r)}async function l4(e,t,r){var i;let s=JSON.parse(new TextDecoder().decode(e)),n=r?.url||"",o=(i=n,n6.pD(i)),a=await lZ(s,o,t||{});return{...s,shape:"tileset3d",loader:l2,url:n,queryString:r?.queryString||"",basePath:o,root:a||s.root,type:g.TILES3D,lodMetricType:m.GEOMETRIC_ERROR,lodMetricValue:s.root?.geometricError||0}}async function l8(e,t,r){let i={shape:"tile3d",featureIds:null};return await li(e,0,t,r,i),i}let l9=[0];class l5 extends tG{initializeState(){"onTileLoadFail"in this.props&&k.A.removed("onTileLoadFail","onTileError")(),this.state={layerMap:{},tileset3d:null,activeViewports:{},lastUpdatedViewports:null}}get isLoaded(){return!!(this.state?.tileset3d?.isLoaded()&&super.isLoaded)}shouldUpdateState({changeFlags:e}){return e.somethingChanged}updateState({props:e,oldProps:t,changeFlags:r}){if(e.data&&e.data!==t.data&&this._loadTileset(e.data),r.viewportChanged){let{activeViewports:e}=this.state;Object.keys(e).length&&(this._updateTileset(e),this.state.lastUpdatedViewports=e,this.state.activeViewports={})}if(r.propsChanged){let{layerMap:e}=this.state;for(let t in e)e[t].needsUpdate=!0}}activateViewport(e){let{activeViewports:t,lastUpdatedViewports:r}=this.state;this.internalState.viewport=e,t[e.id]=e;let i=r?.[e.id];i&&e.equals(i)||(this.setChangeFlags({viewportChanged:!0}),this.setNeedsUpdate())}getPickingInfo({info:e,sourceLayer:t}){let r=t&&t.props.tile;return e.picked&&(e.object=r),e.sourceTile=r,e}filterSubLayer({layer:e,viewport:t}){let{tile:r}=e.props,{id:i}=t;return r.selected&&r.viewportIds.includes(i)}_updateAutoHighlight(e){let t=e.sourceTile,r=this.state.layerMap[t?.id];r&&r.layer&&r.layer.updateAutoHighlight(e)}async _loadTileset(e){let{loadOptions:t={}}=this.props,r=this.props.loader||this.props.loaders,i=Array.isArray(r)?r[0]:r,s={loadOptions:{...t}},n=e;if(i.preload){let r=await i.preload(e,t);r.url&&(n=r.url),r.headers&&(s.loadOptions.fetch={...s.loadOptions.fetch,headers:r.headers}),Object.assign(s,r)}let o=new aT(await (0,tP.H)(n,i,s.loadOptions),{onTileLoad:this._onTileLoad.bind(this),onTileUnload:this._onTileUnload.bind(this),onTileError:this.props.onTileError,...s});this.setState({tileset3d:o,layerMap:{}}),this._updateTileset(this.state.activeViewports),this.props.onTilesetLoad(o)}_onTileLoad(e){let{lastUpdatedViewports:t}=this.state;this.props.onTileLoad(e),this._updateTileset(t),this.setNeedsUpdate()}_onTileUnload(e){delete this.state.layerMap[e.id],this.props.onTileUnload(e)}_updateTileset(e){if(!e)return;let{tileset3d:t}=this.state,{timeline:r}=this.context,i=Object.keys(e).length;r&&i&&t&&t.selectTiles(Object.values(e)).then(e=>{this.state.frameNumber!==e&&this.setState({frameNumber:e})})}_getSubLayer(e,t){if(!e.content)return null;switch(e.type){case p.POINTCLOUD:return this._makePointCloudLayer(e,t);case p.SCENEGRAPH:return this._make3DModelLayer(e);case p.MESH:return this._makeSimpleMeshLayer(e,t);default:throw Error(`Tile3DLayer: Failed to render layer of type ${e.content.type}`)}}_makePointCloudLayer(e,t){let{attributes:r,pointCount:i,constantRGBA:s,cartographicOrigin:n,modelMatrix:o}=e.content,{positions:a,normals:l,colors:h}=r;if(!a)return null;let u=t&&t.props.data||{header:{vertexCount:i},attributes:{POSITION:a,NORMAL:l,COLOR_0:h}},{pointSize:c,getPointColor:d}=this.props;return new(this.getSubLayerClass("pointcloud",t6))({pointSize:c},this.getSubLayerProps({id:"pointcloud"}),{id:`${this.id}-pointcloud-${e.id}`,tile:e,data:u,coordinateSystem:O.rf.METER_OFFSETS,coordinateOrigin:n,modelMatrix:o,getColor:s||d,_offset:0})}_make3DModelLayer(e){let{gltf:t,instances:r,cartographicOrigin:i,modelMatrix:s}=e.content;return new(this.getSubLayerClass("scenegraph",nT))({_lighting:"pbr"},this.getSubLayerProps({id:"scenegraph"}),{id:`${this.id}-scenegraph-${e.id}`,tile:e,data:r||l9,scenegraph:t,coordinateSystem:O.rf.METER_OFFSETS,coordinateOrigin:i,modelMatrix:s,getTransformMatrix:e=>e.modelMatrix,getPosition:[0,0,0],_offset:0})}_makeSimpleMeshLayer(e,t){let{attributes:r,indices:i,modelMatrix:s,cartographicOrigin:n,coordinateSystem:o=O.rf.METER_OFFSETS,material:a,featureIds:l}=e.content,{_getMeshColor:h}=this.props,u=t&&t.props.mesh||new I({topology:"triangle-list",attributes:function(e){let t={};return t.positions={...e.positions,value:new Float32Array(e.positions.value)},e.normals&&(t.normals=e.normals),e.texCoords&&(t.texCoords=e.texCoords),e.colors&&(t.colors=e.colors),e.uvRegions&&(t.uvRegions=e.uvRegions),t}(r),indices:i});return new(this.getSubLayerClass("mesh",nF))(this.getSubLayerProps({id:"mesh"}),{id:`${this.id}-mesh-${e.id}`,tile:e,mesh:u,data:l9,getColor:h(e),pbrMaterial:a,modelMatrix:s,coordinateOrigin:n,coordinateSystem:o,featureIds:l,_offset:0})}renderLayers(){let{tileset3d:e,layerMap:t}=this.state;return e?e.tiles.map(e=>{let r=t[e.id]=t[e.id]||{tile:e},{layer:i}=r;return e.selected&&(i?r.needsUpdate&&(i=this._getSubLayer(e,i),r.needsUpdate=!1):i=this._getSubLayer(e)),r.layer=i,i}).filter(Boolean):null}}l5.defaultProps={getPointColor:{type:"accessor",value:[0,0,0,255]},pointSize:1,data:"",loader:l2,onTilesetLoad:{type:"function",value:e=>{}},onTileLoad:{type:"function",value:e=>{}},onTileUnload:{type:"function",value:e=>{}},onTileError:{type:"function",value:(e,t,r)=>{}},_getMeshColor:{type:"function",value:e=>[255,255,255]}},l5.layerName="Tile3DLayer";let l7=l5},58419:(e,t,r)=>{r.d(t,{Y:()=>a,z:()=>l});var i=r(89037),s=r(78333);let n=["bc1","bc2","bc3","bc4","bc5","bc6","bc7","etc1","etc2","eac","atc","astc","pvrtc"],o=/^(r|rg|rgb|rgba|bgra)([0-9]*)([a-z]*)(-srgb)?(-webgl)?$/;function a(e){return n.some(t=>e.startsWith(t))}function l(e){let t=function(e){let t=(0,s.q)(e),r=t.bytesPerPixel||1,i=t.bitsPerChannel||[8,8,8,8];return delete t.bitsPerChannel,delete t.bytesPerPixel,delete t.f,delete t.render,delete t.filter,delete t.blend,delete t.store,{...t,format:e,attachment:t.attachment||"color",channels:t.channels||"r",components:t.components||t.channels?.length||1,bytesPerPixel:r,bitsPerChannel:i,dataType:t.dataType||"uint8",srgb:t.srgb??!1,packed:t.packed??!1,webgl:t.webgl??!1,integer:t.integer??!1,signed:t.signed??!1,normalized:t.normalized??!1,compressed:t.compressed??!1}}(e);if(a(e)){t.channels="rgb",t.components=3,t.bytesPerPixel=1,t.srgb=!1,t.compressed=!0;let r=function(e){let t=/.*-(\d+)x(\d+)-.*/.exec(e);if(t){let[,e,r]=t;return{blockWidth:Number(e),blockHeight:Number(r)}}return null}(e);r&&(t.blockWidth=r.blockWidth,t.blockHeight=r.blockHeight)}let r=o.exec(e);if(r){let[,s,n,o,a,l]=r,h=`${o}${n}`,u=(0,i.l)(h),c=8*u.byteLength,d=s.length;t={format:e,attachment:t.attachment,dataType:u.dataType,components:d,channels:s,integer:u.integer,signed:u.signed,normalized:u.normalized,bitsPerChannel:[c,d>=2?c:0,d>=3?c:0,d>=4?c:0],bytesPerPixel:u.byteLength*s.length,packed:t.packed,srgb:t.srgb},"-webgl"===l&&(t.webgl=!0),"-srgb"===a&&(t.srgb=!0)}return e.endsWith("-webgl")&&(t.webgl=!0),e.endsWith("-srgb")&&(t.srgb=!0),t}},60263:(e,t,r)=>{r.d(t,{R:()=>i});let i=new(r(43558)).t({id:"luma.gl"})},61059:(e,t,r)=>{r.d(t,{A:()=>d});let i=`\
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND

// All these functions are for substituting tan() function from Intel GPU only
const float TWO_PI = 6.2831854820251465;
const float PI_2 = 1.5707963705062866;
const float PI_16 = 0.1963495463132858;

const float SIN_TABLE_0 = 0.19509032368659973;
const float SIN_TABLE_1 = 0.3826834261417389;
const float SIN_TABLE_2 = 0.5555702447891235;
const float SIN_TABLE_3 = 0.7071067690849304;

const float COS_TABLE_0 = 0.9807852506637573;
const float COS_TABLE_1 = 0.9238795042037964;
const float COS_TABLE_2 = 0.8314695954322815;
const float COS_TABLE_3 = 0.7071067690849304;

const float INVERSE_FACTORIAL_3 = 1.666666716337204e-01; // 1/3!
const float INVERSE_FACTORIAL_5 = 8.333333767950535e-03; // 1/5!
const float INVERSE_FACTORIAL_7 = 1.9841270113829523e-04; // 1/7!
const float INVERSE_FACTORIAL_9 = 2.75573188446287533e-06; // 1/9!

float sin_taylor_fp32(float a) {
  float r, s, t, x;

  if (a == 0.0) {
    return 0.0;
  }

  x = -a * a;
  s = a;
  r = a;

  r = r * x;
  t = r * INVERSE_FACTORIAL_3;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_5;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_7;
  s = s + t;

  r = r * x;
  t = r * INVERSE_FACTORIAL_9;
  s = s + t;

  return s;
}

void sincos_taylor_fp32(float a, out float sin_t, out float cos_t) {
  if (a == 0.0) {
    sin_t = 0.0;
    cos_t = 1.0;
  }
  sin_t = sin_taylor_fp32(a);
  cos_t = sqrt(1.0 - sin_t * sin_t);
}

float tan_taylor_fp32(float a) {
    float sin_a;
    float cos_a;

    if (a == 0.0) {
        return 0.0;
    }

    // 2pi range reduction
    float z = floor(a / TWO_PI);
    float r = a - TWO_PI * z;

    float t;
    float q = floor(r / PI_2 + 0.5);
    int j = int(q);

    if (j < -2 || j > 2) {
        return 1.0 / 0.0;
    }

    t = r - PI_2 * q;

    q = floor(t / PI_16 + 0.5);
    int k = int(q);
    int abs_k = int(abs(float(k)));

    if (abs_k > 4) {
        return 1.0 / 0.0;
    } else {
        t = t - PI_16 * q;
    }

    float u = 0.0;
    float v = 0.0;

    float sin_t, cos_t;
    float s, c;
    sincos_taylor_fp32(t, sin_t, cos_t);

    if (k == 0) {
        s = sin_t;
        c = cos_t;
    } else {
        if (abs(float(abs_k) - 1.0) < 0.5) {
            u = COS_TABLE_0;
            v = SIN_TABLE_0;
        } else if (abs(float(abs_k) - 2.0) < 0.5) {
            u = COS_TABLE_1;
            v = SIN_TABLE_1;
        } else if (abs(float(abs_k) - 3.0) < 0.5) {
            u = COS_TABLE_2;
            v = SIN_TABLE_2;
        } else if (abs(float(abs_k) - 4.0) < 0.5) {
            u = COS_TABLE_3;
            v = SIN_TABLE_3;
        }
        if (k > 0) {
            s = u * sin_t + v * cos_t;
            c = u * cos_t - v * sin_t;
        } else {
            s = u * sin_t - v * cos_t;
            c = u * cos_t + v * sin_t;
        }
    }

    if (j == 0) {
        sin_a = s;
        cos_a = c;
    } else if (j == 1) {
        sin_a = c;
        cos_a = -s;
    } else if (j == -1) {
        sin_a = -c;
        cos_a = s;
    } else {
        sin_a = -s;
        cos_a = -c;
    }
    return sin_a / cos_a;
}
#endif

float tan_fp32(float a) {
#ifdef LUMA_FP32_TAN_PRECISION_WORKAROUND
  return tan_taylor_fp32(a);
#else
  return tan(a);
#endif
}
`;var s=r(70213),n=r(70709),o=r(43210);let a=Object.keys(o.rf).map(e=>`const int COORDINATE_SYSTEM_${e} = ${o.rf[e]};`).join(""),l=Object.keys(o.Kx).map(e=>`const int PROJECTION_MODE_${e} = ${o.Kx[e]};`).join(""),h=Object.keys(o.p5).map(e=>`const int UNIT_${e.toUpperCase()} = ${o.p5[e]};`).join(""),u=`\
${a}
${l}
${h}
uniform projectUniforms {
bool wrapLongitude;
int coordinateSystem;
vec3 commonUnitsPerMeter;
int projectionMode;
float scale;
vec3 commonUnitsPerWorldUnit;
vec3 commonUnitsPerWorldUnit2;
vec4 center;
mat4 modelMatrix;
mat4 viewProjectionMatrix;
vec2 viewportSize;
float devicePixelRatio;
float focalDistance;
vec3 cameraPosition;
vec3 coordinateOrigin;
vec3 commonOrigin;
bool pseudoMeters;
} project;
const float TILE_SIZE = 512.0;
const float PI = 3.1415926536;
const float WORLD_SCALE = TILE_SIZE / (PI * 2.0);
const vec3 ZERO_64_LOW = vec3(0.0);
const float EARTH_RADIUS = 6370972.0;
const float GLOBE_RADIUS = 256.0;
float project_size_at_latitude(float lat) {
float y = clamp(lat, -89.9, 89.9);
return 1.0 / cos(radians(y));
}
float project_size() {
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR &&
project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT &&
project.pseudoMeters == false) {
if (geometry.position.w == 0.0) {
return project_size_at_latitude(geometry.worldPosition.y);
}
float y = geometry.position.y / TILE_SIZE * 2.0 - 1.0;
float y2 = y * y;
float y4 = y2 * y2;
float y6 = y4 * y2;
return 1.0 + 4.9348 * y2 + 4.0587 * y4 + 1.5642 * y6;
}
return 1.0;
}
float project_size_at_latitude(float meters, float lat) {
return meters * project.commonUnitsPerMeter.z * project_size_at_latitude(lat);
}
float project_size(float meters) {
return meters * project.commonUnitsPerMeter.z * project_size();
}
vec2 project_size(vec2 meters) {
return meters * project.commonUnitsPerMeter.xy * project_size();
}
vec3 project_size(vec3 meters) {
return meters * project.commonUnitsPerMeter * project_size();
}
vec4 project_size(vec4 meters) {
return vec4(meters.xyz * project.commonUnitsPerMeter, meters.w);
}
mat3 project_get_orientation_matrix(vec3 up) {
vec3 uz = normalize(up);
vec3 ux = abs(uz.z) == 1.0 ? vec3(1.0, 0.0, 0.0) : normalize(vec3(uz.y, -uz.x, 0));
vec3 uy = cross(uz, ux);
return mat3(ux, uy, uz);
}
bool project_needs_rotation(vec3 commonPosition, out mat3 transform) {
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
transform = project_get_orientation_matrix(commonPosition);
return true;
}
return false;
}
vec3 project_normal(vec3 vector) {
vec4 normal_modelspace = project.modelMatrix * vec4(vector, 0.0);
vec3 n = normalize(normal_modelspace.xyz * project.commonUnitsPerMeter);
mat3 rotation;
if (project_needs_rotation(geometry.position.xyz, rotation)) {
n = rotation * n;
}
return n;
}
vec4 project_offset_(vec4 offset) {
float dy = offset.y;
vec3 commonUnitsPerWorldUnit = project.commonUnitsPerWorldUnit + project.commonUnitsPerWorldUnit2 * dy;
return vec4(offset.xyz * commonUnitsPerWorldUnit, offset.w);
}
vec2 project_mercator_(vec2 lnglat) {
float x = lnglat.x;
if (project.wrapLongitude) {
x = mod(x + 180., 360.0) - 180.;
}
float y = clamp(lnglat.y, -89.9, 89.9);
return vec2(
radians(x) + PI,
PI + log(tan_fp32(PI * 0.25 + radians(y) * 0.5))
) * WORLD_SCALE;
}
vec3 project_globe_(vec3 lnglatz) {
float lambda = radians(lnglatz.x);
float phi = radians(lnglatz.y);
float cosPhi = cos(phi);
float D = (lnglatz.z / EARTH_RADIUS + 1.0) * GLOBE_RADIUS;
return vec3(
sin(lambda) * cosPhi,
-cos(lambda) * cosPhi,
sin(phi)
) * D;
}
vec4 project_position(vec4 position, vec3 position64Low) {
vec4 position_world = project.modelMatrix * position;
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_mercator_(position_world.xy),
project_size_at_latitude(position_world.z, position_world.y),
position_world.w
);
}
if (project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN) {
position_world.xyz += project.coordinateOrigin;
}
}
if (project.projectionMode == PROJECTION_MODE_GLOBE) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
return vec4(
project_globe_(position_world.xyz),
position_world.w
);
}
}
if (project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET) {
if (project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
if (abs(position_world.y - project.coordinateOrigin.y) > 0.25) {
return vec4(
project_mercator_(position_world.xy) - project.commonOrigin.xy,
project_size(position_world.z),
position_world.w
);
}
}
}
if (project.projectionMode == PROJECTION_MODE_IDENTITY ||
(project.projectionMode == PROJECTION_MODE_WEB_MERCATOR_AUTO_OFFSET &&
(project.coordinateSystem == COORDINATE_SYSTEM_LNGLAT ||
project.coordinateSystem == COORDINATE_SYSTEM_CARTESIAN))) {
position_world.xyz -= project.coordinateOrigin;
}
return project_offset_(position_world) + project_offset_(project.modelMatrix * vec4(position64Low, 0.0));
}
vec4 project_position(vec4 position) {
return project_position(position, ZERO_64_LOW);
}
vec3 project_position(vec3 position, vec3 position64Low) {
vec4 projected_position = project_position(vec4(position, 1.0), position64Low);
return projected_position.xyz;
}
vec3 project_position(vec3 position) {
vec4 projected_position = project_position(vec4(position, 1.0), ZERO_64_LOW);
return projected_position.xyz;
}
vec2 project_position(vec2 position) {
vec4 projected_position = project_position(vec4(position, 0.0, 1.0), ZERO_64_LOW);
return projected_position.xy;
}
vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
return viewProjectionMatrix * position + center;
}
vec4 project_common_position_to_clipspace(vec4 position) {
return project_common_position_to_clipspace(position, project.viewProjectionMatrix, project.center);
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
vec2 offset = pixels / project.viewportSize * project.devicePixelRatio * 2.0;
return offset * project.focalDistance;
}
float project_size_to_pixel(float meters) {
return project_size(meters) * project.scale;
}
float project_size_to_pixel(float size, int unit) {
if (unit == UNIT_METERS) return project_size_to_pixel(size);
if (unit == UNIT_COMMON) return size * project.scale;
return size;
}
float project_pixel_size(float pixels) {
return pixels / project.scale;
}
vec2 project_pixel_size(vec2 pixels) {
return pixels / project.scale;
}
`,c={},d={name:"project",dependencies:[{name:"fp32",vs:i},s.A],vs:u,getUniforms:function(e=c){return"viewport"in e?(0,n.a)(e):{}},uniformTypes:{wrapLongitude:"f32",coordinateSystem:"i32",commonUnitsPerMeter:"vec3<f32>",projectionMode:"i32",scale:"f32",commonUnitsPerWorldUnit:"vec3<f32>",commonUnitsPerWorldUnit2:"vec3<f32>",center:"vec4<f32>",modelMatrix:"mat4x4<f32>",viewProjectionMatrix:"mat4x4<f32>",viewportSize:"vec2<f32>",devicePixelRatio:"f32",focalDistance:"f32",cameraPosition:"vec3<f32>",coordinateOrigin:"vec3<f32>",commonOrigin:"vec3<f32>",pseudoMeters:"f32"}}},64920:(e,t,r)=>{r.d(t,{r:()=>s});var i=r(32167);class s extends i.F{static defaultProps={...i.F.defaultProps,vs:null,vertexEntryPoint:"vertexMain",vsConstants:{},fs:null,fragmentEntryPoint:"fragmentMain",fsConstants:{},shaderLayout:null,bufferLayout:[],topology:"triangle-list",parameters:{},bindings:{},uniforms:{}};get[Symbol.toStringTag](){return"RenderPipeline"}shaderLayout;bufferLayout;linkStatus="pending";hash="";constructor(e,t){super(e,t,s.defaultProps),this.shaderLayout=this.props.shaderLayout,this.bufferLayout=this.props.bufferLayout||[]}setUniformsWebGL(e){throw Error("Use uniform blocks")}}},65744:(e,t,r)=>{function i(e){let t=s(e);return function(e){let t=s(e);return t.byteLength>=24&&0x89504e47===t.getUint32(0,!1)?{mimeType:"image/png",width:t.getUint32(16,!1),height:t.getUint32(20,!1)}:null}(t)||function(e){let t=s(e);if(!(t.byteLength>=3&&65496===t.getUint16(0,!1)&&255===t.getUint8(2)))return null;let{tableMarkers:r,sofMarkers:i}=function(){let e=new Set([65499,65476,65484,65501,65534]);for(let t=65504;t<65520;++t)e.add(t);return{tableMarkers:e,sofMarkers:new Set([65472,65473,65474,65475,65477,65478,65479,65481,65482,65483,65485,65486,65487,65502])}}(),n=2;for(;n+9<t.byteLength;){let e=t.getUint16(n,!1);if(i.has(e))return{mimeType:"image/jpeg",height:t.getUint16(n+5,!1),width:t.getUint16(n+7,!1)};if(!r.has(e))break;n+=2,n+=t.getUint16(n,!1)}return null}(t)||function(e){let t=s(e);return t.byteLength>=10&&0x47494638===t.getUint32(0,!1)?{mimeType:"image/gif",width:t.getUint16(6,!0),height:t.getUint16(8,!0)}:null}(t)||function(e){let t=s(e);return t.byteLength>=14&&16973===t.getUint16(0,!1)&&t.getUint32(2,!0)===t.byteLength?{mimeType:"image/bmp",width:t.getUint32(18,!0),height:t.getUint32(22,!0)}:null}(t)||function(e){var t;let r=!function(e,t,r=0){let i=[...t].map(e=>e.charCodeAt(0));for(let t=0;t<i.length;++t)if(i[t]!==e[t+r])return!1;return!0}(t=new Uint8Array(e instanceof DataView?e.buffer:e),"ftyp",4)||(96&t[8])==0?null:function(e){var t,r;switch((t=8,r=12,String.fromCharCode(...e.slice(8,12))).replace("\0"," ").trim()){case"avif":case"avis":return{extension:"avif",mimeType:"image/avif"};default:return null}}(t);return r?{mimeType:r.mimeType,width:0,height:0}:null}(t)}function s(e){if(e instanceof DataView)return e;if(ArrayBuffer.isView(e))return new DataView(e.buffer);if(e instanceof ArrayBuffer)return new DataView(e);throw Error("toDataView")}r.d(t,{m:()=>i})},67171:(e,t,r)=>{r.d(t,{L:()=>s});let i={};function s(e="id"){i[e]=i[e]||1;let t=i[e]++;return`${e}-${t}`}},68323:(e,t,r)=>{function i(e,t=()=>!0){return Array.isArray(e)?function e(t,r,i){let s=-1;for(;++s<t.length;){let n=t[s];Array.isArray(n)?e(n,r,i):r(n)&&i.push(n)}return i}(e,t,[]):t(e)?[e]:[]}function s({target:e,source:t,start:r=0,count:i=1}){let s=t.length,n=i*s,o=0;for(let i=r;o<s;o++)e[i++]=t[o];for(;o<n;)o<n-o?(e.copyWithin(r+o,r,r+o),o*=2):(e.copyWithin(r+o,r,r+n-o),o=n);return e}r.d(t,{B:()=>i,R:()=>s})},70213:(e,t,r)=>{r.d(t,{A:()=>s});let i="#define SMOOTH_EDGE_RADIUS 0.5",s={name:"geometry",vs:`
${i}

struct VertexGeometry {
  vec4 position;
  vec3 worldPosition;
  vec3 worldPositionAlt;
  vec3 normal;
  vec2 uv;
  vec3 pickingColor;
} geometry = VertexGeometry(
  vec4(0.0, 0.0, 1.0, 0.0),
  vec3(0.0),
  vec3(0.0),
  vec3(0.0),
  vec2(0.0),
  vec3(0.0)
);
`,fs:`
${i}

struct FragmentGeometry {
  vec2 uv;
} geometry;

float smoothedge(float edge, float x) {
  return smoothstep(edge - SMOOTH_EDGE_RADIUS, edge + SMOOTH_EDGE_RADIUS, x);
}
`}},70709:(e,t,r)=>{r.d(t,{a:()=>p,o:()=>f});var i=r(33176),s=r(74456),n=r(43210),o=r(193);let a=[0,0,0,0],l=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],h=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],u=[0,0,0],c=[0,0,0],d=(0,o.A)(function({viewport:e,devicePixelRatio:t,coordinateSystem:r,coordinateOrigin:o}){let{projectionCenter:c,viewProjectionMatrix:d,originCommon:p,cameraPosCommon:g,shaderCoordinateOrigin:m,geospatialOrigin:_}=function(e,t,r){let{viewMatrixUncentered:n,projectionMatrix:o}=e,{viewMatrix:h,viewProjectionMatrix:u}=e,c=a,d=a,p=e.cameraPosition,{geospatialOrigin:g,shaderCoordinateOrigin:m,offsetMode:_}=f(e,t,r);return _&&(d=e.projectPosition(g||m),p=[p[0]-d[0],p[1]-d[1],p[2]-d[2]],d[3]=1,c=i.Z0([],d,u),h=n||h,u=s.lw([],o,h),u=s.lw([],u,l)),{viewMatrix:h,viewProjectionMatrix:u,projectionCenter:c,originCommon:d,cameraPosCommon:p,shaderCoordinateOrigin:m,geospatialOrigin:g}}(e,r,o),A=e.getDistanceScales(),E=[e.width*t,e.height*t],b=i.Z0([],[0,0,-e.focalDistance,1],e.projectionMatrix)[3]||1,y={coordinateSystem:r,projectionMode:e.projectionMode,coordinateOrigin:m,commonOrigin:p.slice(0,3),center:c,pseudoMeters:!!e._pseudoMeters,viewportSize:E,devicePixelRatio:t,focalDistance:b,commonUnitsPerMeter:A.unitsPerMeter,commonUnitsPerWorldUnit:A.unitsPerMeter,commonUnitsPerWorldUnit2:u,scale:e.scale,wrapLongitude:!1,viewProjectionMatrix:d,modelMatrix:h,cameraPosition:g};if(_){let t=e.getDistanceScales(_);switch(r){case n.rf.METER_OFFSETS:y.commonUnitsPerWorldUnit=t.unitsPerMeter,y.commonUnitsPerWorldUnit2=t.unitsPerMeter2;break;case n.rf.LNGLAT:case n.rf.LNGLAT_OFFSETS:e._pseudoMeters||(y.commonUnitsPerMeter=t.unitsPerMeter),y.commonUnitsPerWorldUnit=t.unitsPerDegree,y.commonUnitsPerWorldUnit2=t.unitsPerDegree2;break;case n.rf.CARTESIAN:y.commonUnitsPerWorldUnit=[1,1,t.unitsPerMeter[2]],y.commonUnitsPerWorldUnit2=[0,0,t.unitsPerMeter2[2]]}}return y});function f(e,t,r=c){let i;r.length<3&&(r=[r[0],r[1],0]);let s=r,o=!0;switch(i=t===n.rf.LNGLAT_OFFSETS||t===n.rf.METER_OFFSETS?r:e.isGeospatial?[Math.fround(e.longitude),Math.fround(e.latitude),0]:null,e.projectionMode){case n.Kx.WEB_MERCATOR:(t===n.rf.LNGLAT||t===n.rf.CARTESIAN)&&(i=[0,0,0],o=!1);break;case n.Kx.WEB_MERCATOR_AUTO_OFFSET:t===n.rf.LNGLAT?s=i:t===n.rf.CARTESIAN&&(s=[Math.fround(e.center[0]),Math.fround(e.center[1]),0],i=e.unprojectPosition(s),s[0]-=r[0],s[1]-=r[1],s[2]-=r[2]);break;case n.Kx.IDENTITY:(s=e.position.map(Math.fround))[2]=s[2]||0;break;case n.Kx.GLOBE:o=!1,i=null;break;default:o=!1}return{geospatialOrigin:i,shaderCoordinateOrigin:s,offsetMode:o}}function p({viewport:e,devicePixelRatio:t=1,modelMatrix:r=null,coordinateSystem:i=n.rf.DEFAULT,coordinateOrigin:s=c,autoWrapLongitude:o=!1}){i===n.rf.DEFAULT&&(i=e.isGeospatial?n.rf.LNGLAT:n.rf.CARTESIAN);let a=d({viewport:e,devicePixelRatio:t,coordinateSystem:i,coordinateOrigin:s});return a.wrapLongitude=o,a.modelMatrix=r||h,a}},70715:(e,t,r)=>{function i(e,t,r){let i=t[0],s=t[1],n=r[3]*i+r[7]*s||1;return e[0]=(r[0]*i+r[4]*s)/n,e[1]=(r[1]*i+r[5]*s)/n,e}function s(e,t,r){let i=t[0],s=t[1],n=t[2],o=r[3]*i+r[7]*s+r[11]*n||1;return e[0]=(r[0]*i+r[4]*s+r[8]*n)/o,e[1]=(r[1]*i+r[5]*s+r[9]*n)/o,e[2]=(r[2]*i+r[6]*s+r[10]*n)/o,e}function n(e,t,r){let i=t[0],s=t[1];return e[0]=r[0]*i+r[2]*s,e[1]=r[1]*i+r[3]*s,e[2]=t[2],e}function o(e,t,r){let i=t[0],s=t[1];return e[0]=r[0]*i+r[2]*s,e[1]=r[1]*i+r[3]*s,e[2]=t[2],e[3]=t[3],e}function a(e,t,r){let i=t[0],s=t[1],n=t[2];return e[0]=r[0]*i+r[3]*s+r[6]*n,e[1]=r[1]*i+r[4]*s+r[7]*n,e[2]=r[2]*i+r[5]*s+r[8]*n,e[3]=t[3],e}r.d(t,{B$:()=>i,Cg:()=>o,J4:()=>n,cL:()=>s,vE:()=>a})},71253:(e,t,r)=>{r.d(t,{Bd:()=>n,Fr:()=>a,xD:()=>o});var i=r(49509);let s={self:"undefined"!=typeof self&&self,window:"undefined"!=typeof window&&window,global:"undefined"!=typeof global&&global,document:"undefined"!=typeof document&&document};s.self||s.window||s.global,s.window||s.self||s.global,s.global||s.self||s.window,s.document;let n="object"!=typeof i||"[object process]"!==String(i)||!0,o="function"==typeof importScripts,a="undefined"!=typeof window&&void 0!==window.orientation,l=void 0!==i&&i.version&&/v([0-9]*)/.exec(i.version);l&&parseFloat(l[1])},72593:(e,t,r)=>{r.d(t,{A:()=>i});function i(e,t){if(!e)throw Error(t||"deck.gl: assertion failed.")}},73271:(e,t,r)=>{r.d(t,{Ph:()=>a,mk:()=>o});var i=r(77031),s=r(14569);let n=()=>{let e=(0,s.K2)();return e.loaderRegistry=e.loaderRegistry||[],e.loaderRegistry};function o(e){let t=n();for(let r of e=Array.isArray(e)?e:[e]){let e=(0,i.D)(r);t.find(t=>e===t)||t.unshift(e)}}function a(){return n()}},73801:(e,t,r)=>{r.d(t,{qk:()=>n,ws:()=>s});var i=r(75031);function s(e){if(!Number.isFinite(e))throw Error(`Invalid number ${JSON.stringify(e)}`);return e}function n(e,t,r=""){if(i.$W.debug&&!function(e,t){if(e.length!==t)return!1;for(let t=0;t<e.length;++t)if(!Number.isFinite(e[t]))return!1;return!0}(e,t))throw Error(`math.gl: ${r} some fields set to invalid numbers'`);return e}},74456:(e,t,r)=>{r.d(t,{$h:()=>m,B8:()=>n,I0:()=>g,IL:()=>p,Qr:()=>f,Tl:()=>l,Z8:()=>d,a4:()=>o,e$:()=>u,eL:()=>c,fN:()=>_,hs:()=>h,lw:()=>a,mg:()=>s,t5:()=>E,v3:()=>A});var i=r(31303);function s(e,t){if(e===t){let r=t[1],i=t[2],s=t[3],n=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=i,e[9]=n,e[11]=t[14],e[12]=s,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}function n(e,t){let r=t[0],i=t[1],s=t[2],n=t[3],o=t[4],a=t[5],l=t[6],h=t[7],u=t[8],c=t[9],d=t[10],f=t[11],p=t[12],g=t[13],m=t[14],_=t[15],A=r*a-i*o,E=r*l-s*o,b=r*h-n*o,y=i*l-s*a,T=i*h-n*a,C=s*h-n*l,v=u*g-c*p,R=u*m-d*p,S=u*_-f*p,B=c*m-d*g,w=c*_-f*g,M=d*_-f*m,I=A*M-E*w+b*B+y*S-T*R+C*v;return I?(I=1/I,e[0]=(a*M-l*w+h*B)*I,e[1]=(s*w-i*M-n*B)*I,e[2]=(g*C-m*T+_*y)*I,e[3]=(d*T-c*C-f*y)*I,e[4]=(l*S-o*M-h*R)*I,e[5]=(r*M-s*S+n*R)*I,e[6]=(m*b-p*C-_*E)*I,e[7]=(u*C-d*b+f*E)*I,e[8]=(o*w-a*S+h*v)*I,e[9]=(i*S-r*w-n*v)*I,e[10]=(p*T-g*b+_*A)*I,e[11]=(c*b-u*T-f*A)*I,e[12]=(a*R-o*B-l*v)*I,e[13]=(r*B-i*R+s*v)*I,e[14]=(g*E-p*y-m*A)*I,e[15]=(u*y-c*E+d*A)*I,e):null}function o(e){let t=e[0],r=e[1],i=e[2],s=e[3],n=e[4],o=e[5],a=e[6],l=e[7],h=e[8],u=e[9],c=e[10],d=e[11],f=e[12],p=e[13],g=e[14],m=e[15],_=t*o-r*n,A=t*a-i*n,E=r*a-i*o,b=h*p-u*f,y=h*g-c*f,T=u*g-c*p;return l*(t*T-r*y+i*b)-s*(n*T-o*y+a*b)+m*(h*E-u*A+c*_)-d*(f*E-p*A+g*_)}function a(e,t,r){let i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],h=t[6],u=t[7],c=t[8],d=t[9],f=t[10],p=t[11],g=t[12],m=t[13],_=t[14],A=t[15],E=r[0],b=r[1],y=r[2],T=r[3];return e[0]=E*i+b*a+y*c+T*g,e[1]=E*s+b*l+y*d+T*m,e[2]=E*n+b*h+y*f+T*_,e[3]=E*o+b*u+y*p+T*A,E=r[4],b=r[5],y=r[6],T=r[7],e[4]=E*i+b*a+y*c+T*g,e[5]=E*s+b*l+y*d+T*m,e[6]=E*n+b*h+y*f+T*_,e[7]=E*o+b*u+y*p+T*A,E=r[8],b=r[9],y=r[10],T=r[11],e[8]=E*i+b*a+y*c+T*g,e[9]=E*s+b*l+y*d+T*m,e[10]=E*n+b*h+y*f+T*_,e[11]=E*o+b*u+y*p+T*A,E=r[12],b=r[13],y=r[14],T=r[15],e[12]=E*i+b*a+y*c+T*g,e[13]=E*s+b*l+y*d+T*m,e[14]=E*n+b*h+y*f+T*_,e[15]=E*o+b*u+y*p+T*A,e}function l(e,t,r){let i,s,n,o,a,l,h,u,c,d,f,p;let g=r[0],m=r[1],_=r[2];return t===e?(e[12]=t[0]*g+t[4]*m+t[8]*_+t[12],e[13]=t[1]*g+t[5]*m+t[9]*_+t[13],e[14]=t[2]*g+t[6]*m+t[10]*_+t[14],e[15]=t[3]*g+t[7]*m+t[11]*_+t[15]):(i=t[0],s=t[1],n=t[2],o=t[3],a=t[4],l=t[5],h=t[6],u=t[7],c=t[8],d=t[9],f=t[10],p=t[11],e[0]=i,e[1]=s,e[2]=n,e[3]=o,e[4]=a,e[5]=l,e[6]=h,e[7]=u,e[8]=c,e[9]=d,e[10]=f,e[11]=p,e[12]=i*g+a*m+c*_+t[12],e[13]=s*g+l*m+d*_+t[13],e[14]=n*g+h*m+f*_+t[14],e[15]=o*g+u*m+p*_+t[15]),e}function h(e,t,r){let i=r[0],s=r[1],n=r[2];return e[0]=t[0]*i,e[1]=t[1]*i,e[2]=t[2]*i,e[3]=t[3]*i,e[4]=t[4]*s,e[5]=t[5]*s,e[6]=t[6]*s,e[7]=t[7]*s,e[8]=t[8]*n,e[9]=t[9]*n,e[10]=t[10]*n,e[11]=t[11]*n,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function u(e,t,r,s){let n,o,a,l,h,u,c,d,f,p,g,m,_,A,E,b,y,T,C,v,R,S,B,w,M=s[0],I=s[1],P=s[2],L=Math.sqrt(M*M+I*I+P*P);return L<i.p8?null:(M*=L=1/L,I*=L,P*=L,o=Math.sin(r),a=1-(n=Math.cos(r)),l=t[0],h=t[1],u=t[2],c=t[3],d=t[4],f=t[5],p=t[6],g=t[7],m=t[8],_=t[9],A=t[10],E=t[11],b=M*M*a+n,y=I*M*a+P*o,T=P*M*a-I*o,C=M*I*a-P*o,v=I*I*a+n,R=P*I*a+M*o,S=M*P*a+I*o,B=I*P*a-M*o,w=P*P*a+n,e[0]=l*b+d*y+m*T,e[1]=h*b+f*y+_*T,e[2]=u*b+p*y+A*T,e[3]=c*b+g*y+E*T,e[4]=l*C+d*v+m*R,e[5]=h*C+f*v+_*R,e[6]=u*C+p*v+A*R,e[7]=c*C+g*v+E*R,e[8]=l*S+d*B+m*w,e[9]=h*S+f*B+_*w,e[10]=u*S+p*B+A*w,e[11]=c*S+g*B+E*w,t!==e&&(e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e)}function c(e,t,r){let i=Math.sin(r),s=Math.cos(r),n=t[4],o=t[5],a=t[6],l=t[7],h=t[8],u=t[9],c=t[10],d=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=n*s+h*i,e[5]=o*s+u*i,e[6]=a*s+c*i,e[7]=l*s+d*i,e[8]=h*s-n*i,e[9]=u*s-o*i,e[10]=c*s-a*i,e[11]=d*s-l*i,e}function d(e,t,r){let i=Math.sin(r),s=Math.cos(r),n=t[0],o=t[1],a=t[2],l=t[3],h=t[8],u=t[9],c=t[10],d=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s-h*i,e[1]=o*s-u*i,e[2]=a*s-c*i,e[3]=l*s-d*i,e[8]=n*i+h*s,e[9]=o*i+u*s,e[10]=a*i+c*s,e[11]=l*i+d*s,e}function f(e,t,r){let i=Math.sin(r),s=Math.cos(r),n=t[0],o=t[1],a=t[2],l=t[3],h=t[4],u=t[5],c=t[6],d=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=n*s+h*i,e[1]=o*s+u*i,e[2]=a*s+c*i,e[3]=l*s+d*i,e[4]=h*s-n*i,e[5]=u*s-o*i,e[6]=c*s-a*i,e[7]=d*s-l*i,e}function p(e,t){let r=t[0],i=t[1],s=t[2],n=t[4],o=t[5],a=t[6],l=t[8],h=t[9],u=t[10];return e[0]=Math.sqrt(r*r+i*i+s*s),e[1]=Math.sqrt(n*n+o*o+a*a),e[2]=Math.sqrt(l*l+h*h+u*u),e}function g(e,t){let r=t[0],i=t[1],s=t[2],n=t[3],o=r+r,a=i+i,l=s+s,h=r*o,u=i*o,c=i*a,d=s*o,f=s*a,p=s*l,g=n*o,m=n*a,_=n*l;return e[0]=1-c-p,e[1]=u+_,e[2]=d-m,e[3]=0,e[4]=u-_,e[5]=1-h-p,e[6]=f+g,e[7]=0,e[8]=d+m,e[9]=f-g,e[10]=1-h-c,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function m(e,t,r,i,s,n,o){let a=1/(r-t),l=1/(s-i),h=1/(n-o);return e[0]=2*n*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=2*n*l,e[6]=0,e[7]=0,e[8]=(r+t)*a,e[9]=(s+i)*l,e[10]=(o+n)*h,e[11]=-1,e[12]=0,e[13]=0,e[14]=o*n*2*h,e[15]=0,e}let _=function(e,t,r,i,s){let n=1/Math.tan(t/2);if(e[0]=n/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=n,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=s&&s!==1/0){let t=1/(i-s);e[10]=(s+i)*t,e[14]=2*s*i*t}else e[10]=-1,e[14]=-2*i;return e},A=function(e,t,r,i,s,n,o){let a=1/(t-r),l=1/(i-s),h=1/(n-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*h,e[11]=0,e[12]=(t+r)*a,e[13]=(s+i)*l,e[14]=(o+n)*h,e[15]=1,e};function E(e,t,r,s){let n,o,a,l,h,u,c,d,f,p;let g=t[0],m=t[1],_=t[2],A=s[0],E=s[1],b=s[2],y=r[0],T=r[1],C=r[2];if(Math.abs(g-y)<i.p8&&Math.abs(m-T)<i.p8&&Math.abs(_-C)<i.p8)return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e;return n=1/Math.sqrt((d=g-y)*d+(f=m-T)*f+(p=_-C)*p),d*=n,f*=n,p*=n,(n=Math.sqrt((o=E*p-b*f)*o+(a=b*d-A*p)*a+(l=A*f-E*d)*l))?(o*=n=1/n,a*=n,l*=n):(o=0,a=0,l=0),(n=Math.sqrt((h=f*l-p*a)*h+(u=p*o-d*l)*u+(c=d*a-f*o)*c))?(h*=n=1/n,u*=n,c*=n):(h=0,u=0,c=0),e[0]=o,e[1]=h,e[2]=d,e[3]=0,e[4]=a,e[5]=u,e[6]=f,e[7]=0,e[8]=l,e[9]=c,e[10]=p,e[11]=0,e[12]=-(o*g+a*m+l*_),e[13]=-(h*g+u*m+c*_),e[14]=-(d*g+f*m+p*_),e[15]=1,e}},74502:(e,t,r)=>{let i,s;r.d(t,{k:()=>g});var n,o=r(39394),a=r(73801),l=r(70715),h=r(74456),u=r(42538),c=r(36389),d=r(33176);!function(e){e[e.COL0ROW0=0]="COL0ROW0",e[e.COL0ROW1=1]="COL0ROW1",e[e.COL0ROW2=2]="COL0ROW2",e[e.COL0ROW3=3]="COL0ROW3",e[e.COL1ROW0=4]="COL1ROW0",e[e.COL1ROW1=5]="COL1ROW1",e[e.COL1ROW2=6]="COL1ROW2",e[e.COL1ROW3=7]="COL1ROW3",e[e.COL2ROW0=8]="COL2ROW0",e[e.COL2ROW1=9]="COL2ROW1",e[e.COL2ROW2=10]="COL2ROW2",e[e.COL2ROW3=11]="COL2ROW3",e[e.COL3ROW0=12]="COL3ROW0",e[e.COL3ROW1=13]="COL3ROW1",e[e.COL3ROW2=14]="COL3ROW2",e[e.COL3ROW3=15]="COL3ROW3"}(n||(n={}));let f=45*Math.PI/180,p=Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]);class g extends o.u{static get IDENTITY(){return s||Object.freeze(s=new g),s}static get ZERO(){return i||Object.freeze(i=new g([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0])),i}get ELEMENTS(){return 16}get RANK(){return 4}get INDICES(){return n}constructor(e){super(-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0),1==arguments.length&&Array.isArray(e)?this.copy(e):this.identity()}copy(e){return this[0]=e[0],this[1]=e[1],this[2]=e[2],this[3]=e[3],this[4]=e[4],this[5]=e[5],this[6]=e[6],this[7]=e[7],this[8]=e[8],this[9]=e[9],this[10]=e[10],this[11]=e[11],this[12]=e[12],this[13]=e[13],this[14]=e[14],this[15]=e[15],this.check()}set(e,t,r,i,s,n,o,a,l,h,u,c,d,f,p,g){return this[0]=e,this[1]=t,this[2]=r,this[3]=i,this[4]=s,this[5]=n,this[6]=o,this[7]=a,this[8]=l,this[9]=h,this[10]=u,this[11]=c,this[12]=d,this[13]=f,this[14]=p,this[15]=g,this.check()}setRowMajor(e,t,r,i,s,n,o,a,l,h,u,c,d,f,p,g){return this[0]=e,this[1]=s,this[2]=l,this[3]=d,this[4]=t,this[5]=n,this[6]=h,this[7]=f,this[8]=r,this[9]=o,this[10]=u,this[11]=p,this[12]=i,this[13]=a,this[14]=c,this[15]=g,this.check()}toRowMajor(e){return e[0]=this[0],e[1]=this[4],e[2]=this[8],e[3]=this[12],e[4]=this[1],e[5]=this[5],e[6]=this[9],e[7]=this[13],e[8]=this[2],e[9]=this[6],e[10]=this[10],e[11]=this[14],e[12]=this[3],e[13]=this[7],e[14]=this[11],e[15]=this[15],e}identity(){return this.copy(p)}fromObject(e){return this.check()}fromQuaternion(e){return(0,h.I0)(this,e),this.check()}frustum(e){var t,r,i,s,n,o;let{left:a,right:l,bottom:u,top:c,near:d=.1,far:f=500}=e;return f===1/0?(t=this,r=a,i=l,s=u,n=c,o=d,t[0]=2*o/(i-r),t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o/(n-s),t[6]=0,t[7]=0,t[8]=(i+r)/(i-r),t[9]=(n+s)/(n-s),t[10]=-1,t[11]=-1,t[12]=0,t[13]=0,t[14]=-2*o,t[15]=0):(0,h.$h)(this,a,l,u,c,d,f),this.check()}lookAt(e){let{eye:t,center:r=[0,0,0],up:i=[0,1,0]}=e;return(0,h.t5)(this,t,r,i),this.check()}ortho(e){let{left:t,right:r,bottom:i,top:s,near:n=.1,far:o=500}=e;return(0,h.v3)(this,t,r,i,s,n,o),this.check()}orthographic(e){let{fovy:t=f,aspect:r=1,focalDistance:i=1,near:s=.1,far:n=500}=e;m(t);let o=i*Math.tan(t/2),a=o*r;return this.ortho({left:-a,right:a,bottom:-o,top:o,near:s,far:n})}perspective(e){let{fovy:t=45*Math.PI/180,aspect:r=1,near:i=.1,far:s=500}=e;return m(t),(0,h.fN)(this,t,r,i,s),this.check()}determinant(){return(0,h.a4)(this)}getScale(e=[-0,-0,-0]){return e[0]=Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2]),e[1]=Math.sqrt(this[4]*this[4]+this[5]*this[5]+this[6]*this[6]),e[2]=Math.sqrt(this[8]*this[8]+this[9]*this[9]+this[10]*this[10]),e}getTranslation(e=[-0,-0,-0]){return e[0]=this[12],e[1]=this[13],e[2]=this[14],e}getRotation(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];let r=this.getScale(t),i=1/r[0],s=1/r[1],n=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*n,e[3]=0,e[4]=this[4]*i,e[5]=this[5]*s,e[6]=this[6]*n,e[7]=0,e[8]=this[8]*i,e[9]=this[9]*s,e[10]=this[10]*n,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}getRotationMatrix3(e,t){e=e||[-0,-0,-0,-0,-0,-0,-0,-0,-0],t=t||[-0,-0,-0];let r=this.getScale(t),i=1/r[0],s=1/r[1],n=1/r[2];return e[0]=this[0]*i,e[1]=this[1]*s,e[2]=this[2]*n,e[3]=this[4]*i,e[4]=this[5]*s,e[5]=this[6]*n,e[6]=this[8]*i,e[7]=this[9]*s,e[8]=this[10]*n,e}transpose(){return(0,h.mg)(this,this),this.check()}invert(){return(0,h.B8)(this,this),this.check()}multiplyLeft(e){return(0,h.lw)(this,e,this),this.check()}multiplyRight(e){return(0,h.lw)(this,this,e),this.check()}rotateX(e){return(0,h.eL)(this,this,e),this.check()}rotateY(e){return(0,h.Z8)(this,this,e),this.check()}rotateZ(e){return(0,h.Qr)(this,this,e),this.check()}rotateXYZ(e){return this.rotateX(e[0]).rotateY(e[1]).rotateZ(e[2])}rotateAxis(e,t){return(0,h.e$)(this,this,e,t),this.check()}scale(e){return(0,h.hs)(this,this,Array.isArray(e)?e:[e,e,e]),this.check()}translate(e){return(0,h.Tl)(this,this,e),this.check()}transform(e,t){return 4===e.length?(t=(0,d.Z0)(t||[-0,-0,-0,-0],e,this),(0,a.qk)(t,4),t):this.transformAsPoint(e,t)}transformAsPoint(e,t){let r;let{length:i}=e;switch(i){case 2:r=(0,u.Z0)(t||[-0,-0],e,this);break;case 3:r=(0,c.Z0)(t||[-0,-0,-0],e,this);break;default:throw Error("Illegal vector")}return(0,a.qk)(r,e.length),r}transformAsVector(e,t){let r;switch(e.length){case 2:r=(0,l.B$)(t||[-0,-0],e,this);break;case 3:r=(0,l.cL)(t||[-0,-0,-0],e,this);break;default:throw Error("Illegal vector")}return(0,a.qk)(r,e.length),r}transformPoint(e,t){return this.transformAsPoint(e,t)}transformVector(e,t){return this.transformAsPoint(e,t)}transformDirection(e,t){return this.transformAsVector(e,t)}makeRotationX(e){return this.identity().rotateX(e)}makeTranslation(e,t,r){return this.identity().translate([e,t,r])}}function m(e){if(e>2*Math.PI)throw Error("expected radians")}},75031:(e,t,r)=>{r.d(t,{$W:()=>n,Cc:()=>function e(t,r,i){return a(t)?t.map((t,s)=>e(t,r[s],i)):i*r+(1-i)*t},Fl:()=>o,aI:()=>function e(t,r,i){let s=n.EPSILON;i&&(n.EPSILON=i);try{if(t===r)return!0;if(a(t)&&a(r)){if(t.length!==r.length)return!1;for(let i=0;i<t.length;++i)if(!e(t[i],r[i]))return!1;return!0}if(t&&t.equals)return t.equals(r);if(r&&r.equals)return r.equals(t);if("number"==typeof t&&"number"==typeof r)return Math.abs(t-r)<=n.EPSILON*Math.max(1,Math.abs(t),Math.abs(r));return!1}finally{n.EPSILON=s}},cy:()=>a,eh:()=>l,qE:()=>c,uj:()=>u,xW:()=>h});let i=1/Math.PI*180,s=1/180*Math.PI;globalThis.mathgl=globalThis.mathgl||{config:{EPSILON:1e-12,debug:!1,precision:4,printTypes:!1,printDegrees:!1,printRowMajor:!0,_cartographicRadians:!1}};let n=globalThis.mathgl.config;function o(e,{precision:t=n.precision}={}){return e=Math.round(e/n.EPSILON)*n.EPSILON,`${parseFloat(e.toPrecision(t))}`}function a(e){return Array.isArray(e)||ArrayBuffer.isView(e)&&!(e instanceof DataView)}function l(e){var t;return d(e,e=>e*s,void 0)}function h(e){return u(e)}function u(e,t){return d(e,e=>e*i,t)}function c(e,t,r){return d(e,e=>Math.max(t,Math.min(r,e)))}function d(e,t,r){if(a(e)){r=r||(e.clone?e.clone():Array(e.length));for(let i=0;i<r.length&&i<e.length;++i){let s="number"==typeof e?e:e[i];r[i]=t(s,i,r)}return r}return t(e)}},75331:(e,t,r)=>{r.d(t,{M5:()=>i});function i(e){switch(function(e){let t=function(e){return"undefined"!=typeof ImageBitmap&&e instanceof ImageBitmap?"imagebitmap":"undefined"!=typeof Image&&e instanceof Image?"image":e&&"object"==typeof e&&e.data&&e.width&&e.height?"data":null}(e);if(!t)throw Error("Not an image");return t}(e)){case"data":return e;case"image":case"imagebitmap":let t=document.createElement("canvas"),r=t.getContext("2d");if(!r)throw Error("getImageData");return t.width=e.width,t.height=e.height,r.drawImage(e,0,0),r.getImageData(0,0,e.width,e.height);default:throw Error("getImageData")}}},75606:(e,t,r)=>{function i(e,t,r){if(r=r||e.byteLength,e.byteLength<r||t.byteLength<r)return!1;let i=new Uint8Array(e),s=new Uint8Array(t);for(let e=0;e<i.length;++e)if(i[e]!==s[e])return!1;return!0}function s(...e){return function(e){let t=e.map(e=>e instanceof ArrayBuffer?new Uint8Array(e):e),r=new Uint8Array(t.reduce((e,t)=>e+t.byteLength,0)),i=0;for(let e of t)r.set(e,i),i+=e.byteLength;return r.buffer}(e)}function n(e,t,r){let i=void 0!==r?new Uint8Array(e).subarray(t,t+r):new Uint8Array(e).subarray(t);return new Uint8Array(i).buffer}r.d(t,{AQ:()=>s,YV:()=>i,_m:()=>n})},77031:(e,t,r)=>{r.d(t,{D:()=>n,l:()=>s});var i=r(14080);function s(e){return!!e&&(Array.isArray(e)&&(e=e[0]),Array.isArray(e?.extensions))}function n(e){let t;return(0,i.v)(e,"null loader"),(0,i.v)(s(e),"invalid loader"),Array.isArray(e)&&(t=e[1],e={...e=e[0],options:{...e.options,...t}}),(e?.parseTextSync||e?.parseText)&&(e.text=!0),e.text||(e.binary=!0),e}},78333:(e,t,r)=>{r.d(t,{q:()=>g});let i="texture-compression-bc",s="texture-compression-astc",n="texture-compression-etc2",o="texture-compression-pvrtc-webgl",a="texture-compression-atc-webgl",l="float32-renderable-webgl",h="float16-renderable-webgl",u="snorm8-renderable-webgl",c="norm16-renderable-webgl",d="snorm16-renderable-webgl",f="float32-filterable",p="float16-filterable-webgl";function g(e){let t=m[e];if(!t)throw Error(`Unsupported texture format ${e}`);return t}let m={r8unorm:{},r8snorm:{render:u},r8uint:{},r8sint:{},rg8unorm:{},rg8snorm:{render:u},rg8uint:{},rg8sint:{},r16uint:{},r16sint:{},r16float:{render:h,filter:"float16-filterable-webgl"},"r16unorm-webgl":{f:c},"r16snorm-webgl":{f:d},"rgba4unorm-webgl":{channels:"rgba",bitsPerChannel:[4,4,4,4],packed:!0},"rgb565unorm-webgl":{channels:"rgb",bitsPerChannel:[5,6,5,0],packed:!0},"rgb5a1unorm-webgl":{channels:"rgba",bitsPerChannel:[5,5,5,1],packed:!0},"rgb8unorm-webgl":{},"rgb8snorm-webgl":{},rgba8unorm:{},"rgba8unorm-srgb":{},rgba8snorm:{render:u},rgba8uint:{},rgba8sint:{},bgra8unorm:{},"bgra8unorm-srgb":{},rg16uint:{},rg16sint:{},rg16float:{render:h,filter:p},"rg16unorm-webgl":{render:c},"rg16snorm-webgl":{render:d},r32uint:{},r32sint:{},r32float:{render:l,filter:f},rgb9e5ufloat:{channels:"rgb",packed:!0,render:"rgb9e5ufloat-renderable-webgl"},rg11b10ufloat:{channels:"rgb",bitsPerChannel:[11,11,10,0],packed:!0,p:1,render:l},rgb10a2unorm:{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1},"rgb10a2uint-webgl":{channels:"rgba",bitsPerChannel:[10,10,10,2],packed:!0,p:1,wgpu:!1},"rgb16unorm-webgl":{f:c},"rgb16snorm-webgl":{f:c},rg32uint:{},rg32sint:{},rg32float:{render:!1,filter:f},rgba16uint:{},rgba16sint:{},rgba16float:{render:h,filter:p},"rgba16unorm-webgl":{render:c},"rgba16snorm-webgl":{render:d},"rgb32float-webgl":{render:l,filter:f},rgba32uint:{},rgba32sint:{},rgba32float:{render:l,filter:f},stencil8:{attachment:"stencil",bitsPerChannel:[8,0,0,0],dataType:"uint8"},depth16unorm:{attachment:"depth",bitsPerChannel:[16,0,0,0],dataType:"uint16"},depth24plus:{attachment:"depth",bitsPerChannel:[24,0,0,0],dataType:"uint32"},depth32float:{attachment:"depth",bitsPerChannel:[32,0,0,0],dataType:"float32"},"depth24plus-stencil8":{attachment:"depth-stencil",bitsPerChannel:[24,8,0,0],packed:!0},"depth32float-stencil8":{attachment:"depth-stencil",bitsPerChannel:[32,8,0,0],packed:!0},"bc1-rgb-unorm-webgl":{f:i},"bc1-rgb-unorm-srgb-webgl":{f:i},"bc1-rgba-unorm":{f:i},"bc1-rgba-unorm-srgb":{f:i},"bc2-rgba-unorm":{f:i},"bc2-rgba-unorm-srgb":{f:i},"bc3-rgba-unorm":{f:i},"bc3-rgba-unorm-srgb":{f:i},"bc4-r-unorm":{f:i},"bc4-r-snorm":{f:i},"bc5-rg-unorm":{f:i},"bc5-rg-snorm":{f:i},"bc6h-rgb-ufloat":{f:i},"bc6h-rgb-float":{f:i},"bc7-rgba-unorm":{f:i},"bc7-rgba-unorm-srgb":{f:i},"etc2-rgb8unorm":{f:n},"etc2-rgb8unorm-srgb":{f:n},"etc2-rgb8a1unorm":{f:n},"etc2-rgb8a1unorm-srgb":{f:n},"etc2-rgba8unorm":{f:n},"etc2-rgba8unorm-srgb":{f:n},"eac-r11unorm":{f:n},"eac-r11snorm":{f:n},"eac-rg11unorm":{f:n},"eac-rg11snorm":{f:n},"astc-4x4-unorm":{f:s},"astc-4x4-unorm-srgb":{f:s},"astc-5x4-unorm":{f:s},"astc-5x4-unorm-srgb":{f:s},"astc-5x5-unorm":{f:s},"astc-5x5-unorm-srgb":{f:s},"astc-6x5-unorm":{f:s},"astc-6x5-unorm-srgb":{f:s},"astc-6x6-unorm":{f:s},"astc-6x6-unorm-srgb":{f:s},"astc-8x5-unorm":{f:s},"astc-8x5-unorm-srgb":{f:s},"astc-8x6-unorm":{f:s},"astc-8x6-unorm-srgb":{f:s},"astc-8x8-unorm":{f:s},"astc-8x8-unorm-srgb":{f:s},"astc-10x5-unorm":{f:s},"astc-10x5-unorm-srgb":{f:s},"astc-10x6-unorm":{f:s},"astc-10x6-unorm-srgb":{f:s},"astc-10x8-unorm":{f:s},"astc-10x8-unorm-srgb":{f:s},"astc-10x10-unorm":{f:s},"astc-10x10-unorm-srgb":{f:s},"astc-12x10-unorm":{f:s},"astc-12x10-unorm-srgb":{f:s},"astc-12x12-unorm":{f:s},"astc-12x12-unorm-srgb":{f:s},"pvrtc-rgb4unorm-webgl":{f:o},"pvrtc-rgba4unorm-webgl":{f:o},"pvrtc-rbg2unorm-webgl":{f:o},"pvrtc-rgba2unorm-webgl":{f:o},"etc1-rbg-unorm-webgl":{f:"texture-compression-etc1-webgl"},"atc-rgb-unorm-webgl":{f:a},"atc-rgba-unorm-webgl":{f:a},"atc-rgbai-unorm-webgl":{f:a}}},80747:(e,t,r)=>{r.d(t,{l:()=>F});var i=r(61392),s={centimeters:0x25f96350,centimetres:0x25f96350,degrees:360/(2*Math.PI),feet:20902260.511392,inches:250826616.45599997,kilometers:6371.0088,kilometres:6371.0088,meters:6371008.8,metres:6371008.8,miles:3958.761333810546,millimeters:0x17bbde120,millimetres:0x17bbde120,nauticalmiles:6371008.8/1852,radians:1,yards:6967335.223679999};function n(e,t,r={}){let i={type:"Feature"};return(0===r.id||r.id)&&(i.id=r.id),r.bbox&&(i.bbox=r.bbox),i.properties=t||{},i.geometry=e,i}function o(e,t={}){let r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}function a(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}class l{constructor(e=[],t=h){if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let e=(this.length>>1)-1;e>=0;e--)this._down(e)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;let e=this.data[0],t=this.data.pop();return this.length--,this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){let{data:t,compare:r}=this,i=t[e];for(;e>0;){let s=e-1>>1,n=t[s];if(r(i,n)>=0)break;t[e]=n,e=s}t[e]=i}_down(e){let{data:t,compare:r}=this,i=this.length>>1,s=t[e];for(;e<i;){let i=(e<<1)+1,n=t[i],o=i+1;if(o<this.length&&0>r(t[o],n)&&(i=o,n=t[o]),r(n,s)>=0)break;t[e]=n,e=i}t[e]=s}}function h(e,t){return e<t?-1:+(e>t)}function u(e,t){return e.p.x>t.p.x?1:e.p.x<t.p.x?-1:e.p.y!==t.p.y?e.p.y>t.p.y?1:-1:1}function c(e,t){return e.rightSweepEvent.p.x>t.rightSweepEvent.p.x?1:e.rightSweepEvent.p.x<t.rightSweepEvent.p.x?-1:e.rightSweepEvent.p.y!==t.rightSweepEvent.p.y?e.rightSweepEvent.p.y<t.rightSweepEvent.p.y?1:-1:1}class d{constructor(e,t,r,i){this.p={x:e[0],y:e[1]},this.featureId=t,this.ringId=r,this.eventId=i,this.otherEvent=null,this.isLeftEndpoint=null}isSamePoint(e){return this.p.x===e.p.x&&this.p.y===e.p.y}}let f=0,p=0,g=0;function m(e,t){let r="Feature"===e.type?e.geometry:e,i=r.coordinates;("Polygon"===r.type||"MultiLineString"===r.type)&&(i=[i]),"LineString"===r.type&&(i=[[i]]);for(let e=0;e<i.length;e++)for(let r=0;r<i[e].length;r++){let s=i[e][r][0],n=null;p+=1;for(let o=0;o<i[e][r].length-1;o++){n=i[e][r][o+1];let a=new d(s,f,p,g),l=new d(n,f,p,g+1);a.otherEvent=l,l.otherEvent=a,u(a,l)>0?(l.isLeftEndpoint=!0,a.isLeftEndpoint=!1):(a.isLeftEndpoint=!0,l.isLeftEndpoint=!1),t.push(a),t.push(l),s=n,g+=1}}f+=1}class _{constructor(e){this.leftSweepEvent=e,this.rightSweepEvent=e.otherEvent}}var A=function(e,t){let r=new l([],u);return!function(e,t){if("FeatureCollection"===e.type){let r=e.features;for(let e=0;e<r.length;e++)m(r[e],t)}else m(e,t)}(e,r),function(e,t){t=!!t&&t;let r=[],i=new l([],c);for(;e.length;){let s=e.pop();if(s.isLeftEndpoint){let e=new _(s);for(let n=0;n<i.data.length;n++){let o=i.data[n];if(t&&o.leftSweepEvent.featureId===s.featureId)continue;let a=function(e,t){if(null===e||null===t||e.leftSweepEvent.ringId===t.leftSweepEvent.ringId&&(e.rightSweepEvent.isSamePoint(t.leftSweepEvent)||e.rightSweepEvent.isSamePoint(t.leftSweepEvent)||e.rightSweepEvent.isSamePoint(t.rightSweepEvent)||e.leftSweepEvent.isSamePoint(t.leftSweepEvent)||e.leftSweepEvent.isSamePoint(t.rightSweepEvent)))return!1;let r=e.leftSweepEvent.p.x,i=e.leftSweepEvent.p.y,s=e.rightSweepEvent.p.x,n=e.rightSweepEvent.p.y,o=t.leftSweepEvent.p.x,a=t.leftSweepEvent.p.y,l=t.rightSweepEvent.p.x,h=t.rightSweepEvent.p.y,u=(h-a)*(s-r)-(l-o)*(n-i),c=(l-o)*(i-a)-(h-a)*(r-o),d=(s-r)*(i-a)-(n-i)*(r-o);if(0===u)return!1;let f=c/u,p=d/u;return f>=0&&f<=1&&p>=0&&p<=1&&[r+f*(s-r),i+f*(n-i)]}(e,o);!1!==a&&r.push(a)}i.push(e)}else!1===s.isLeftEndpoint&&i.pop()}return r}(r,t)};function E(e,t,r={}){let{removeDuplicates:i=!0,ignoreSelfIntersections:s=!0}=r,l=[];"FeatureCollection"===e.type?l=l.concat(e.features):"Feature"===e.type?l.push(e):("LineString"===e.type||"Polygon"===e.type||"MultiLineString"===e.type||"MultiPolygon"===e.type)&&l.push(n(e)),"FeatureCollection"===t.type?l=l.concat(t.features):"Feature"===t.type?l.push(t):("LineString"===t.type||"Polygon"===t.type||"MultiLineString"===t.type||"MultiPolygon"===t.type)&&l.push(n(t));let h=A(o(l),s),u=[];if(i){let e={};h.forEach(t=>{let r=t.join(",");e[r]||(e[r]=!0,u.push(t))})}else u=h;return o(u.map(e=>(function(e,t,r={}){if(!e)throw Error("coordinates is required");if(!Array.isArray(e))throw Error("coordinates must be an Array");if(e.length<2)throw Error("coordinates must be at least 2 numbers long");if(!a(e[0])||!a(e[1]))throw Error("coordinates must contain numbers");return n({type:"Point",coordinates:e},void 0,r)})(e)))}var b={centimeters:0x25f96350,centimetres:0x25f96350,degrees:360/(2*Math.PI),feet:20902260.511392,inches:250826616.45599997,kilometers:6371.0088,kilometres:6371.0088,meters:6371008.8,metres:6371008.8,miles:3958.761333810546,millimeters:0x17bbde120,millimetres:0x17bbde120,nauticalmiles:6371008.8/1852,radians:1,yards:6967335.223679999};function y(e,t,r={}){let i={type:"Feature"};return(0===r.id||r.id)&&(i.id=r.id),r.bbox&&(i.bbox=r.bbox),i.properties=t||{},i.geometry=e,i}function T(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function C(e,t){!function(e,t){var r,i,s,n,o,a,l,h,u,c,d=0,f="FeatureCollection"===e.type,p="Feature"===e.type,g=f?e.features.length:1;for(r=0;r<g;r++){for(s=0,a=f?e.features[r].geometry:p?e.geometry:e,h=f?e.features[r].properties:p?e.properties:{},u=f?e.features[r].bbox:p?e.bbox:void 0,c=f?e.features[r].id:p?e.id:void 0,o=(l=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1;s<o;s++){if(null===(n=l?a.geometries[s]:a)){if(!1===t(null,d,h,u,c))return!1;continue}switch(n.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(n,d,h,u,c))return!1;break;case"GeometryCollection":for(i=0;i<n.geometries.length;i++)if(!1===t(n.geometries[i],d,h,u,c))return!1;break;default:throw Error("Unknown Geometry Type")}}d++}}(e,function(e,r,i,s,n){var o,a=null===e?null:e.type;switch(a){case null:case"Point":case"LineString":case"Polygon":if(!1===t(y(e,i,{bbox:s,id:n}),r,0))return!1;return}switch(a){case"MultiPoint":o="Point";break;case"MultiLineString":o="LineString";break;case"MultiPolygon":o="Polygon"}for(var l=0;l<e.coordinates.length;l++)if(!1===t(y({type:o,coordinates:e.coordinates[l]},i),r,l))return!1})}var v={centimeters:0x25f96350,centimetres:0x25f96350,degrees:360/(2*Math.PI),feet:20902260.511392,inches:250826616.45599997,kilometers:6371.0088,kilometres:6371.0088,meters:6371008.8,metres:6371008.8,miles:3958.761333810546,millimeters:0x17bbde120,millimetres:0x17bbde120,nauticalmiles:6371008.8/1852,radians:1,yards:6967335.223679999};function R(e,t,r={}){let i={type:"Feature"};return(0===r.id||r.id)&&(i.id=r.id),r.bbox&&(i.bbox=r.bbox),i.properties=t||{},i.geometry=e,i}function S(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function B(e){return"Feature"===e.type?e.geometry:e}function w(e,t={}){let r=B(e);switch(t.properties||"Feature"!==e.type||(t.properties=e.properties),r.type){case"Polygon":return function(e,t={}){return M(B(e).coordinates,t.properties?t.properties:"Feature"===e.type?e.properties:{})}(r,t);case"MultiPolygon":return function(e,t={}){let r=B(e).coordinates,i=t.properties?t.properties:"Feature"===e.type?e.properties:{},s=[];return r.forEach(e=>{s.push(M(e,i))}),function(e,t={}){let r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}(s)}(r,t);default:throw Error("invalid poly")}}function M(e,t){return e.length>1?function(e,t,r={}){return R({type:"MultiLineString",coordinates:e},t,r)}(e,t):function(e,t,r={}){if(e.length<2)throw Error("coordinates must be an array of two or more positions");return R({type:"LineString",coordinates:e},t,r)}(e[0],t)}function I(e,t){for(let r=0;r<e.coordinates.length-1;r++)if(function(e,t,r){let i=r[0]-e[0],s=r[1]-e[1],n=t[0]-e[0],o=t[1]-e[1];return 0==i*o-s*n&&(Math.abs(n)>=Math.abs(o)?n>0?e[0]<=r[0]&&r[0]<=t[0]:t[0]<=r[0]&&r[0]<=e[0]:o>0?e[1]<=r[1]&&r[1]<=t[1]:t[1]<=r[1]&&r[1]<=e[1])}(e.coordinates[r],e.coordinates[r+1],t.coordinates))return!0;return!1}function P(e,t,r){for(let r of t.coordinates)if((0,i.m)(r,e))return!0;return E(t,w(e),{ignoreSelfIntersections:r}).features.length>0}var L={centimeters:0x25f96350,centimetres:0x25f96350,degrees:360/(2*Math.PI),feet:20902260.511392,inches:250826616.45599997,kilometers:6371.0088,kilometres:6371.0088,meters:6371008.8,metres:6371008.8,miles:3958.761333810546,millimeters:0x17bbde120,millimetres:0x17bbde120,nauticalmiles:6371008.8/1852,radians:1,yards:6967335.223679999};function O(e,t,r={}){let i={type:"Feature"};return(0===r.id||r.id)&&(i.id=r.id),r.bbox&&(i.bbox=r.bbox),i.properties=t||{},i.geometry=e,i}function x(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function N(e,t){!function(e,t){var r,i,s,n,o,a,l,h,u,c,d=0,f="FeatureCollection"===e.type,p="Feature"===e.type,g=f?e.features.length:1;for(r=0;r<g;r++){for(s=0,a=f?e.features[r].geometry:p?e.geometry:e,h=f?e.features[r].properties:p?e.properties:{},u=f?e.features[r].bbox:p?e.bbox:void 0,c=f?e.features[r].id:p?e.id:void 0,o=(l=!!a&&"GeometryCollection"===a.type)?a.geometries.length:1;s<o;s++){if(null===(n=l?a.geometries[s]:a)){if(!1===t(null,d,h,u,c))return!1;continue}switch(n.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(n,d,h,u,c))return!1;break;case"GeometryCollection":for(i=0;i<n.geometries.length;i++)if(!1===t(n.geometries[i],d,h,u,c))return!1;break;default:throw Error("Unknown Geometry Type")}}d++}}(e,function(e,r,i,s,n){var o,a=null===e?null:e.type;switch(a){case null:case"Point":case"LineString":case"Polygon":if(!1===t(O(e,i,{bbox:s,id:n}),r,0))return!1;return}switch(a){case"MultiPoint":o="Point";break;case"MultiLineString":o="LineString";break;case"MultiPolygon":o="Polygon"}for(var l=0;l<e.coordinates.length;l++)if(!1===t(O({type:o,coordinates:e.coordinates[l]},i),r,l))return!1})}function F(e,t,{ignoreSelfIntersections:r=!0}={}){let s=!1;return N(e,e=>{N(t,t=>{if(!0===s)return!0;s=!function(e,t,{ignoreSelfIntersections:r=!0}={ignoreSelfIntersections:!0}){let s=!0;return C(e,e=>{C(t,t=>{if(!1===s)return!1;s=function(e,t,r){var s,n,o,a;switch(e.type){case"Point":switch(t.type){case"Point":return s=e.coordinates,n=t.coordinates,s[0]!==n[0]||s[1]!==n[1];case"LineString":return!I(t,e);case"Polygon":return!(0,i.m)(e,t)}break;case"LineString":switch(t.type){case"Point":return!I(e,t);case"LineString":return o=e,a=t,!(E(o,a,{ignoreSelfIntersections:r}).features.length>0);case"Polygon":return!P(t,e,r)}break;case"Polygon":switch(t.type){case"Point":return!(0,i.m)(t,e);case"LineString":return!P(e,t,r);case"Polygon":return!function(e,t,r){for(let r of e.coordinates[0])if((0,i.m)(r,t))return!0;for(let r of t.coordinates[0])if((0,i.m)(r,e))return!0;return E(w(e),w(t),{ignoreSelfIntersections:r}).features.length>0}(t,e,r)}}return!1}(e.geometry,t.geometry,r)})}),s}(e.geometry,t.geometry,{ignoreSelfIntersections:r})})}),s}},81465:(e,t,r)=>{r.d(t,{aH:()=>m,dT:()=>T,Os:()=>R,Fe:()=>M,wZ:()=>S,gW:()=>P,nI:()=>y,fO:()=>E,om:()=>v,rY:()=>C,Gw:()=>_,CK:()=>O,xJ:()=>w,mY:()=>b,iV:()=>A,VJ:()=>B});var i=r(33176);function s(e,t){let r=i.Z0([],t,e);return i.hs(r,r,1/r[3]),r}function n(e,t){let r=e%t;return r<0?t+r:r}function o(e,t,r){return e<t?t:e>r?r:e}let a=Math.log2||function(e){return Math.log(e)*Math.LOG2E};var l=r(74456),h=r(36389),u=r(42538);function c(e,t){if(!e)throw Error(t||"@math.gl/web-mercator: assertion failed.")}let d=Math.PI,f=d/4,p=d/180,g=180/d,m=85.051129;function _(e){let[t,r]=e;c(Number.isFinite(t)),c(Number.isFinite(r)&&r>=-90&&r<=90,"invalid latitude");let i=512*(d+Math.log(Math.tan(f+r*p*.5)))/(2*d);return[512*(t*p+d)/(2*d),i]}function A(e){let[t,r]=e,i=2*(Math.atan(Math.exp(r/512*(2*d)-d))-f);return[(t/512*(2*d)-d)*g,i*g]}function E(e){let{latitude:t}=e;return c(Number.isFinite(t)),a(4003e4*Math.cos(t*p))-9}function b(e){return 512/4003e4/Math.cos(e*p)}function y(e){let{latitude:t,longitude:r,highPrecision:i=!1}=e;c(Number.isFinite(t)&&Number.isFinite(r));let s=Math.cos(t*p),n=512/360/s,o=512/4003e4/s,a={unitsPerMeter:[o,o,o],metersPerUnit:[1/o,1/o,1/o],unitsPerDegree:[512/360,n,o],degreesPerUnit:[1/(512/360),1/n,1/o]};if(i){let e=p*Math.tan(t*p)/s,r=512/4003e4*e,i=r/n*o;a.unitsPerDegree2=[0,512/360*e/2,r],a.unitsPerMeter2=[i,0,i]}return a}function T(e,t){let[r,i,s]=e,[n,o,a]=t,{unitsPerMeter:l,unitsPerMeter2:h}=y({longitude:r,latitude:i,highPrecision:!0}),u=_(e);u[0]+=n*(l[0]+h[0]*o),u[1]+=o*(l[1]+h[1]*o);let c=A(u);return Number.isFinite(s)||Number.isFinite(a)?[c[0],c[1],(s||0)+(a||0)]:c}function C(e){let{height:t,pitch:r,bearing:i,altitude:s,scale:n,center:o}=e,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1];l.Tl(a,a,[0,0,-s]),l.eL(a,a,-r*p),l.Qr(a,a,i*p);let u=n/t;return l.hs(a,a,[u,u,u]),o&&l.Tl(a,a,h.ze([],o)),a}function v(e){let{width:t,height:r,altitude:i,pitch:s=0,offset:n,center:a,scale:l,nearZMultiplier:h=1,farZMultiplier:u=1}=e,{fovy:c=R(1.5)}=e;void 0!==i&&(c=R(i));let d=c*p,f=s*p,g=S(c),m=g;a&&(m+=a[2]*l/Math.cos(f)/r);let _=d*(.5+(n?n[1]:0)/r),A=Math.sin(_)*m/Math.sin(o(Math.PI/2-f-_,.01,Math.PI-.01));return{fov:d,aspect:t/r,focalDistance:g,near:h,far:Math.min((Math.sin(f)*A+m)*u,10*m)}}function R(e){return 2*Math.atan(.5/e)*g}function S(e){return .5/Math.tan(.5*e*p)}function B(e,t){let[r,i,n=0]=e;return c(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(n)),s(t,[r,i,n,1])}function w(e,t,r=0){let[i,n,o]=e;if(c(Number.isFinite(i)&&Number.isFinite(n),"invalid pixel coordinate"),Number.isFinite(o))return s(t,[i,n,o,1]);let a=s(t,[i,n,0,1]),l=s(t,[i,n,1,1]),h=a[2],d=l[2];return u.Cc([],a,l,h===d?0:((r||0)-h)/(d-h))}function M(e){let{width:t,height:r,bounds:i,minExtent:s=0,maxZoom:n=24,offset:l=[0,0]}=e,[[h,u],[d,f]]=i,p=function(e=0){return"number"==typeof e?{top:e,bottom:e,left:e,right:e}:(c(Number.isFinite(e.top)&&Number.isFinite(e.bottom)&&Number.isFinite(e.left)&&Number.isFinite(e.right)),e)}(e.padding),g=_([h,o(f,-m,m)]),E=_([d,o(u,-m,m)]),b=[Math.max(Math.abs(E[0]-g[0]),s),Math.max(Math.abs(E[1]-g[1]),s)],y=[t-p.left-p.right-2*Math.abs(l[0]),r-p.top-p.bottom-2*Math.abs(l[1])];c(y[0]>0&&y[1]>0);let T=y[0]/b[0],C=y[1]/b[1],v=(p.right-p.left)/2/T,R=(p.top-p.bottom)/2/C,S=A([(E[0]+g[0])/2+v,(E[1]+g[1])/2+R]),B=Math.min(n,a(Math.abs(Math.min(T,C))));return c(Number.isFinite(B)),{longitude:S[0],latitude:S[1],zoom:B}}let I=Math.PI/180;function P(e,t=0){let r,i;let{width:s,height:n,unproject:o}=e,a={targetZ:t},l=o([0,n],a),h=o([s,n],a);return(e.fovy?.5*e.fovy*I:Math.atan(.5/e.altitude))>(90-e.pitch)*I-.01?(r=L(e,0,t),i=L(e,s,t)):(r=o([0,0],a),i=o([s,0],a)),[l,h,i,r]}function L(e,t,r){let{pixelUnprojectionMatrix:i}=e,n=s(i,[t,0,1,1]),o=s(i,[t,e.height,1,1]),a=(r*e.distanceScales.unitsPerMeter[2]-n[2])/(o[2]-n[2]),l=A(u.Cc([],n,o,a));return l.push(r),l}function O(e){let{width:t,height:r,pitch:i=0}=e,{longitude:s,latitude:o,zoom:l,bearing:h=0}=e;(s<-180||s>180)&&(s=n(s+180,360)-180),(h<-180||h>180)&&(h=n(h+180,360)-180);let u=a(r/512);if(l<=u)l=u,o=0;else{let e=r/2/Math.pow(2,l),t=A([0,e])[1];if(o<t)o=t;else{let t=A([0,512-e])[1];o>t&&(o=t)}}return{width:t,height:r,longitude:s,latitude:o,zoom:l,pitch:i,bearing:h}}let x={curve:1.414,speed:1.2}},81810:(e,t,r)=>{var i,s,n;r.d(t,{EU:()=>$,e8:()=>s,uq:()=>x,h1:()=>F,Cx:()=>L}),!function(e){e[e.Start=1]="Start",e[e.Move=2]="Move",e[e.End=4]="End",e[e.Cancel=8]="Cancel"}(i||(i={})),function(e){e[e.None=0]="None",e[e.Left=1]="Left",e[e.Right=2]="Right",e[e.Up=4]="Up",e[e.Down=8]="Down",e[e.Horizontal=3]="Horizontal",e[e.Vertical=12]="Vertical",e[e.All=15]="All"}(s||(s={})),function(e){e[e.Possible=1]="Possible",e[e.Began=2]="Began",e[e.Changed=4]="Changed",e[e.Ended=8]="Ended",e[e.Recognized=8]="Recognized",e[e.Cancelled=16]="Cancelled",e[e.Failed=32]="Failed"}(n||(n={}));let o="manipulation",a="none",l="pan-x",h="pan-y";class u{constructor(e,t){this.actions="",this.manager=e,this.set(t)}set(e){"compute"===e&&(e=this.compute()),this.manager.element&&(this.manager.element.style.touchAction=e,this.actions=e)}update(){this.set(this.manager.options.touchAction)}compute(){let e=[];for(let t of this.manager.recognizers)t.options.enable&&(e=e.concat(t.getTouchAction()));return function(e){if(e.includes(a))return a;let t=e.includes(l),r=e.includes(h);return t&&r?a:t||r?t?l:h:e.includes(o)?o:"auto"}(e.join(" "))}}function c(e){return e.trim().split(/\s+/g)}function d(e,t,r){if(e)for(let i of c(t))e.addEventListener(i,r,!1)}function f(e,t,r){if(e)for(let i of c(t))e.removeEventListener(i,r,!1)}function p(e){return(e.ownerDocument||e).defaultView}function g(e){let t=e.length;if(1===t)return{x:Math.round(e[0].clientX),y:Math.round(e[0].clientY)};let r=0,i=0,s=0;for(;s<t;)r+=e[s].clientX,i+=e[s].clientY,s++;return{x:Math.round(r/t),y:Math.round(i/t)}}function m(e){let t=[],r=0;for(;r<e.pointers.length;)t[r]={clientX:Math.round(e.pointers[r].clientX),clientY:Math.round(e.pointers[r].clientY)},r++;return{timeStamp:Date.now(),pointers:t,center:g(t),deltaX:e.deltaX,deltaY:e.deltaY}}function _(e,t){let r=t.x-e.x,i=t.y-e.y;return Math.sqrt(r*r+i*i)}function A(e,t){let r=t.clientX-e.clientX,i=t.clientY-e.clientY;return Math.sqrt(r*r+i*i)}function E(e,t){let r=t.clientX-e.clientX;return 180*Math.atan2(t.clientY-e.clientY,r)/Math.PI}function b(e,t){return e===t?s.None:Math.abs(e)>=Math.abs(t)?e<0?s.Left:s.Right:t<0?s.Up:s.Down}function y(e,t,r){return{x:t/e||0,y:r/e||0}}class T{constructor(e){this.evEl="",this.evWin="",this.evTarget="",this.domHandler=e=>{this.manager.options.enable&&this.handler(e)},this.manager=e,this.element=e.element,this.target=e.options.inputTarget||e.element}callback(e,t){!function(e,t,r){let s=r.pointers.length,n=r.changedPointers.length,o=t&i.Start&&s-n==0,a=t&(i.End|i.Cancel)&&s-n==0;r.isFirst=!!o,r.isFinal=!!a,o&&(e.session={}),r.eventType=t;let l=function(e,t){var r,s;let{session:n}=e,{pointers:o}=t,{length:a}=o;n.firstInput||(n.firstInput=m(t)),a>1&&!n.firstMultiple?n.firstMultiple=m(t):1===a&&(n.firstMultiple=!1);let{firstInput:l,firstMultiple:h}=n,u=h?h.center:l.center,c=t.center=g(o);t.timeStamp=Date.now(),t.deltaTime=t.timeStamp-l.timeStamp,t.angle=function(e,t){let r=t.x-e.x;return 180*Math.atan2(t.y-e.y,r)/Math.PI}(u,c),t.distance=_(u,c);let{deltaX:d,deltaY:f}=function(e,t){let r=t.center,s=e.offsetDelta,n=e.prevDelta,o=e.prevInput;return(t.eventType===i.Start||o?.eventType===i.End)&&(n=e.prevDelta={x:o?.deltaX||0,y:o?.deltaY||0},s=e.offsetDelta={x:r.x,y:r.y}),{deltaX:n.x+(r.x-s.x),deltaY:n.y+(r.y-s.y)}}(n,t);t.deltaX=d,t.deltaY=f,t.offsetDirection=b(t.deltaX,t.deltaY);let p=y(t.deltaTime,t.deltaX,t.deltaY);t.overallVelocityX=p.x,t.overallVelocityY=p.y,t.overallVelocity=Math.abs(p.x)>Math.abs(p.y)?p.x:p.y,t.scale=h?(r=h.pointers,A(o[0],o[1])/A(r[0],r[1])):1,t.rotation=h?(s=h.pointers,E(o[1],o[0])-E(s[1],s[0])):0,t.maxPointers=n.prevInput?t.pointers.length>n.prevInput.maxPointers?t.pointers.length:n.prevInput.maxPointers:t.pointers.length;let T=e.element;return function(e,t){let r=e;for(;r;){if(r===t)return!0;r=r.parentNode}return!1}(t.srcEvent.target,T)&&(T=t.srcEvent.target),t.target=T,!function(e,t){let r,s,n,o;let a=e.lastInterval||t,l=t.timeStamp-a.timeStamp;if(t.eventType!==i.Cancel&&(l>25||void 0===a.velocity)){let i=t.deltaX-a.deltaX,h=t.deltaY-a.deltaY,u=y(l,i,h);s=u.x,n=u.y,r=Math.abs(u.x)>Math.abs(u.y)?u.x:u.y,o=b(i,h),e.lastInterval=t}else r=a.velocity,s=a.velocityX,n=a.velocityY,o=a.direction;t.velocity=r,t.velocityX=s,t.velocityY=n,t.direction=o}(n,t),t}(e,r);e.emit("hammer.input",l),e.recognize(l),e.session.prevInput=l}(this.manager,e,t)}init(){d(this.element,this.evEl,this.domHandler),d(this.target,this.evTarget,this.domHandler),d(p(this.element),this.evWin,this.domHandler)}destroy(){f(this.element,this.evEl,this.domHandler),f(this.target,this.evTarget,this.domHandler),f(p(this.element),this.evWin,this.domHandler)}}let C={pointerdown:i.Start,pointermove:i.Move,pointerup:i.End,pointercancel:i.Cancel,pointerout:i.Cancel};class v extends T{constructor(e){super(e),this.evEl="pointerdown",this.evWin="pointermove pointerup pointercancel",this.store=this.manager.session.pointerEvents=[],this.init()}handler(e){let{store:t}=this,r=!1,s=C[e.type],n=e.pointerType,o="touch"===n,a=t.findIndex(t=>t.pointerId===e.pointerId);s&i.Start&&(e.buttons||o)?a<0&&(t.push(e),a=t.length-1):s&(i.End|i.Cancel)&&(r=!0),!(a<0)&&(t[a]=e,this.callback(s,{pointers:t,changedPointers:[e],eventType:s,pointerType:n,srcEvent:e}),r&&t.splice(a,1))}}let R=["","webkit","Moz","MS","ms","o"],S={touchAction:"compute",enable:!0,inputTarget:null,cssProps:{userSelect:"none",userDrag:"none",touchCallout:"none",tapHighlightColor:"rgba(0,0,0,0)"}};class B{constructor(e,t){this.options={...S,...t,cssProps:{...S.cssProps,...t.cssProps},inputTarget:t.inputTarget||e},this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=e,this.input=new v(this),this.touchAction=new u(this,this.options.touchAction),this.toggleCssProps(!0)}set(e){return Object.assign(this.options,e),e.touchAction&&this.touchAction.update(),e.inputTarget&&(this.input.destroy(),this.input.target=e.inputTarget,this.input.init()),this}stop(e){this.session.stopped=e?2:1}recognize(e){let t;let{session:r}=this;if(r.stopped)return;this.session.prevented&&e.srcEvent.preventDefault();let{recognizers:i}=this,{curRecognizer:s}=r;(!s||s&&s.state&n.Recognized)&&(s=r.curRecognizer=null);let o=0;for(;o<i.length;)t=i[o],2!==r.stopped&&(!s||t===s||t.canRecognizeWith(s))?t.recognize(e):t.reset(),!s&&t.state&(n.Began|n.Changed|n.Ended)&&(s=r.curRecognizer=t),o++}get(e){let{recognizers:t}=this;for(let r=0;r<t.length;r++)if(t[r].options.event===e)return t[r];return null}add(e){if(Array.isArray(e)){for(let t of e)this.add(t);return this}let t=this.get(e.options.event);return t&&this.remove(t),this.recognizers.push(e),e.manager=this,this.touchAction.update(),e}remove(e){if(Array.isArray(e)){for(let t of e)this.remove(t);return this}let t="string"==typeof e?this.get(e):e;if(t){let{recognizers:e}=this,r=e.indexOf(t);-1!==r&&(e.splice(r,1),this.touchAction.update())}return this}on(e,t){if(!e||!t)return;let{handlers:r}=this;for(let i of c(e))r[i]=r[i]||[],r[i].push(t)}off(e,t){if(!e)return;let{handlers:r}=this;for(let i of c(e))t?r[i]&&r[i].splice(r[i].indexOf(t),1):delete r[i]}emit(e,t){let r=this.handlers[e]&&this.handlers[e].slice();if(!r||!r.length)return;t.type=e,t.preventDefault=function(){t.srcEvent.preventDefault()};let i=0;for(;i<r.length;)r[i](t),i++}destroy(){this.toggleCssProps(!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}toggleCssProps(e){let{element:t}=this;if(t){for(let[r,i]of Object.entries(this.options.cssProps)){let s=function(e,t){let r=t[0].toUpperCase()+t.slice(1);for(let i of R){let s=i?i+r:t;if(s in e)return s}}(t.style,r);e?(this.oldCssProps[s]=t.style[s],t.style[s]=i):t.style[s]=this.oldCssProps[s]||""}e||(this.oldCssProps={})}}}let w=1;function M(e){return e&n.Cancelled?"cancel":e&n.Ended?"end":e&n.Changed?"move":e&n.Began?"start":""}class I{constructor(e){this.options=e,this.id=w++,this.state=n.Possible,this.simultaneous={},this.requireFail=[]}set(e){return Object.assign(this.options,e),this.manager.touchAction.update(),this}recognizeWith(e){let t;if(Array.isArray(e)){for(let t of e)this.recognizeWith(t);return this}if("string"==typeof e){if(!(t=this.manager.get(e)))throw Error(`Cannot find recognizer ${e}`)}else t=e;let{simultaneous:r}=this;return r[t.id]||(r[t.id]=t,t.recognizeWith(this)),this}dropRecognizeWith(e){let t;if(Array.isArray(e)){for(let t of e)this.dropRecognizeWith(t);return this}return(t="string"==typeof e?this.manager.get(e):e)&&delete this.simultaneous[t.id],this}requireFailure(e){let t;if(Array.isArray(e)){for(let t of e)this.requireFailure(t);return this}if("string"==typeof e){if(!(t=this.manager.get(e)))throw Error(`Cannot find recognizer ${e}`)}else t=e;let{requireFail:r}=this;return -1===r.indexOf(t)&&(r.push(t),t.requireFailure(this)),this}dropRequireFailure(e){let t;if(Array.isArray(e)){for(let t of e)this.dropRequireFailure(t);return this}if(t="string"==typeof e?this.manager.get(e):e){let e=this.requireFail.indexOf(t);e>-1&&this.requireFail.splice(e,1)}return this}hasRequireFailures(){return!!this.requireFail.find(e=>e.options.enable)}canRecognizeWith(e){return!!this.simultaneous[e.id]}emit(e){if(!e)return;let{state:t}=this;t<n.Ended&&this.manager.emit(this.options.event+M(t),e),this.manager.emit(this.options.event,e),e.additionalEvent&&this.manager.emit(e.additionalEvent,e),t>=n.Ended&&this.manager.emit(this.options.event+M(t),e)}tryEmit(e){this.canEmit()?this.emit(e):this.state=n.Failed}canEmit(){let e=0;for(;e<this.requireFail.length;){if(!(this.requireFail[e].state&(n.Failed|n.Possible)))return!1;e++}return!0}recognize(e){let t={...e};if(!this.options.enable){this.reset(),this.state=n.Failed;return}this.state&(n.Recognized|n.Cancelled|n.Failed)&&(this.state=n.Possible),this.state=this.process(t),this.state&(n.Began|n.Changed|n.Ended|n.Cancelled)&&this.tryEmit(t)}getEventNames(){return[this.options.event]}reset(){}}class P extends I{attrTest(e){let t=this.options.pointers;return 0===t||e.pointers.length===t}process(e){let{state:t}=this,{eventType:r}=e,s=t&(n.Began|n.Changed),o=this.attrTest(e);return s&&(r&i.Cancel||!o)?t|n.Cancelled:s||o?r&i.End?t|n.Ended:t&n.Began?t|n.Changed:n.Began:n.Failed}}class L extends I{constructor(e={}){super({enable:!0,event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10,...e}),this.pTime=null,this.pCenter=null,this._timer=null,this._input=null,this.count=0}getTouchAction(){return[o]}process(e){let{options:t}=this,r=e.pointers.length===t.pointers,s=e.distance<t.threshold,o=e.deltaTime<t.time;if(this.reset(),e.eventType&i.Start&&0===this.count)return this.failTimeout();if(s&&o&&r){if(e.eventType!==i.End)return this.failTimeout();let r=!this.pTime||e.timeStamp-this.pTime<t.interval,s=!this.pCenter||_(this.pCenter,e.center)<t.posThreshold;if(this.pTime=e.timeStamp,this.pCenter=e.center,s&&r?this.count+=1:this.count=1,this._input=e,0==this.count%t.taps)return this.hasRequireFailures()?(this._timer=setTimeout(()=>{this.state=n.Recognized,this.tryEmit(this._input)},t.interval),n.Began):n.Recognized}return n.Failed}failTimeout(){return this._timer=setTimeout(()=>{this.state=n.Failed},this.options.interval),n.Failed}reset(){clearTimeout(this._timer)}emit(e){this.state===n.Recognized&&(e.tapCount=this.count,this.manager.emit(this.options.event,e))}}let O=["","start","move","end","cancel","up","down","left","right"];class x extends P{constructor(e={}){super({enable:!0,pointers:1,event:"pan",threshold:10,direction:s.All,...e}),this.pX=null,this.pY=null}getTouchAction(){let{options:{direction:e}}=this,t=[];return e&s.Horizontal&&t.push(h),e&s.Vertical&&t.push(l),t}getEventNames(){return O.map(e=>this.options.event+e)}directionTest(e){let{options:t}=this,r=!0,{distance:i}=e,{direction:n}=e,o=e.deltaX,a=e.deltaY;return n&t.direction||(t.direction&s.Horizontal?(n=0===o?s.None:o<0?s.Left:s.Right,r=o!==this.pX,i=Math.abs(e.deltaX)):(n=0===a?s.None:a<0?s.Up:s.Down,r=a!==this.pY,i=Math.abs(e.deltaY))),e.direction=n,r&&i>t.threshold&&!!(n&t.direction)}attrTest(e){return super.attrTest(e)&&(!!(this.state&n.Began)||!(this.state&n.Began)&&this.directionTest(e))}emit(e){this.pX=e.deltaX,this.pY=e.deltaY;let t=s[e.direction].toLowerCase();t&&(e.additionalEvent=this.options.event+t),super.emit(e)}}let N=["","start","move","end","cancel","in","out"];class F extends P{constructor(e={}){super({enable:!0,event:"pinch",threshold:0,pointers:2,...e})}getTouchAction(){return[a]}getEventNames(){return N.map(e=>this.options.event+e)}attrTest(e){return super.attrTest(e)&&(Math.abs(e.scale-1)>this.options.threshold||!!(this.state&n.Began))}emit(e){if(1!==e.scale){let t=e.scale<1?"in":"out";e.additionalEvent=this.options.event+t}super.emit(e)}}class D{constructor(e,t,r){this.element=e,this.callback=t,this.options=r}}let U="undefined"!=typeof navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():"";"undefined"!=typeof window?window:global,"undefined"!=typeof global?global:window;let G=-1!==U.indexOf("firefox");class k extends D{constructor(e,t,r){super(e,t,{enable:!0,...r}),this.handleEvent=e=>{if(!this.options.enable)return;let t=e.deltaY;globalThis.WheelEvent&&(G&&e.deltaMode===globalThis.WheelEvent.DOM_DELTA_PIXEL&&(t/=globalThis.devicePixelRatio),e.deltaMode===globalThis.WheelEvent.DOM_DELTA_LINE&&(t*=40)),0!==t&&t%4.000244140625==0&&(t=Math.floor(t/4.000244140625)),e.shiftKey&&t&&(t*=.25),this.callback({type:"wheel",center:{x:e.clientX,y:e.clientY},delta:-t,srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("wheel",this.handleEvent,{passive:!1})}destroy(){this.element.removeEventListener("wheel",this.handleEvent)}enableEventType(e,t){"wheel"===e&&(this.options.enable=t)}}let H=["mousedown","mousemove","mouseup","mouseover","mouseout","mouseleave"];class V extends D{constructor(e,t,r){super(e,t,{enable:!0,...r}),this.handleEvent=e=>{this.handleOverEvent(e),this.handleOutEvent(e),this.handleEnterEvent(e),this.handleLeaveEvent(e),this.handleMoveEvent(e)},this.pressed=!1;let{enable:i}=this.options;this.enableMoveEvent=i,this.enableLeaveEvent=i,this.enableEnterEvent=i,this.enableOutEvent=i,this.enableOverEvent=i,H.forEach(t=>e.addEventListener(t,this.handleEvent))}destroy(){H.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){switch(e){case"pointermove":this.enableMoveEvent=t;break;case"pointerover":this.enableOverEvent=t;break;case"pointerout":this.enableOutEvent=t;break;case"pointerenter":this.enableEnterEvent=t;break;case"pointerleave":this.enableLeaveEvent=t}}handleOverEvent(e){this.enableOverEvent&&"mouseover"===e.type&&this._emit("pointerover",e)}handleOutEvent(e){this.enableOutEvent&&"mouseout"===e.type&&this._emit("pointerout",e)}handleEnterEvent(e){this.enableEnterEvent&&"mouseenter"===e.type&&this._emit("pointerenter",e)}handleLeaveEvent(e){this.enableLeaveEvent&&"mouseleave"===e.type&&this._emit("pointerleave",e)}handleMoveEvent(e){if(this.enableMoveEvent)switch(e.type){case"mousedown":e.button>=0&&(this.pressed=!0);break;case"mousemove":0===e.buttons&&(this.pressed=!1),this.pressed||this._emit("pointermove",e);break;case"mouseup":this.pressed=!1}}_emit(e,t){this.callback({type:e,center:{x:t.clientX,y:t.clientY},srcEvent:t,pointerType:"mouse",target:t.target})}}let j=["keydown","keyup"];class W extends D{constructor(e,t,r){super(e,t,{enable:!0,tabIndex:0,...r}),this.handleEvent=e=>{let t=e.target||e.srcElement;("INPUT"!==t.tagName||"text"!==t.type)&&"TEXTAREA"!==t.tagName&&(this.enableDownEvent&&"keydown"===e.type&&this.callback({type:"keydown",srcEvent:e,key:e.key,target:e.target}),this.enableUpEvent&&"keyup"===e.type&&this.callback({type:"keyup",srcEvent:e,key:e.key,target:e.target}))},this.enableDownEvent=this.options.enable,this.enableUpEvent=this.options.enable,e.tabIndex=this.options.tabIndex,e.style.outline="none",j.forEach(t=>e.addEventListener(t,this.handleEvent))}destroy(){j.forEach(e=>this.element.removeEventListener(e,this.handleEvent))}enableEventType(e,t){"keydown"===e&&(this.enableDownEvent=t),"keyup"===e&&(this.enableUpEvent=t)}}class z extends D{constructor(e,t,r){super(e,t,r),this.handleEvent=e=>{this.options.enable&&this.callback({type:"contextmenu",center:{x:e.clientX,y:e.clientY},srcEvent:e,pointerType:"mouse",target:e.target})},e.addEventListener("contextmenu",this.handleEvent)}destroy(){this.element.removeEventListener("contextmenu",this.handleEvent)}enableEventType(e,t){"contextmenu"===e&&(this.options.enable=t)}}let X={pointerdown:1,pointermove:2,pointerup:4,mousedown:1,mousemove:2,mouseup:4},K={srcElement:"root",priority:0};class J{constructor(e,t){this.handleEvent=e=>{if(this.isEmpty())return;let t=this._normalizeEvent(e),r=e.srcEvent.target;for(;r&&r!==t.rootElement;){if(this._emit(t,r),t.handled)return;r=r.parentNode}this._emit(t,"root")},this.eventManager=e,this.recognizerName=t,this.handlers=[],this.handlersByElement=new Map,this._active=!1}isEmpty(){return!this._active}add(e,t,r,i=!1,s=!1){let{handlers:n,handlersByElement:o}=this,a={...K,...r},l=o.get(a.srcElement);l||(l=[],o.set(a.srcElement,l));let h={type:e,handler:t,srcElement:a.srcElement,priority:a.priority};i&&(h.once=!0),s&&(h.passive=!0),n.push(h),this._active=this._active||!h.passive;let u=l.length-1;for(;u>=0&&!(l[u].priority>=h.priority);)u--;l.splice(u+1,0,h)}remove(e,t){let{handlers:r,handlersByElement:i}=this;for(let s=r.length-1;s>=0;s--){let n=r[s];if(n.type===e&&n.handler===t){r.splice(s,1);let e=i.get(n.srcElement);e.splice(e.indexOf(n),1),0===e.length&&i.delete(n.srcElement)}}this._active=r.some(e=>!e.passive)}_emit(e,t){let r=this.handlersByElement.get(t);if(r){let t=!1,i=()=>{e.handled=!0},s=()=>{e.handled=!0,t=!0},n=[];for(let o=0;o<r.length;o++){let{type:a,handler:l,once:h}=r[o];if(l({...e,type:a,stopPropagation:i,stopImmediatePropagation:s}),h&&n.push(r[o]),t)break}for(let e=0;e<n.length;e++){let{type:t,handler:r}=n[e];this.remove(t,r)}}}_normalizeEvent(e){let t=this.eventManager.getElement();return{...e,...function(e){let t=X[e.srcEvent.type];if(!t)return null;let{buttons:r,button:i}=e.srcEvent,s=!1,n=!1,o=!1;return 2===t?(s=!!(1&r),n=!!(4&r),o=!!(2&r)):(s=0===i,n=1===i,o=2===i),{leftButton:s,middleButton:n,rightButton:o}}(e),...function(e,t){let r=e.center;if(!r)return null;let i=t.getBoundingClientRect(),s=i.width/t.offsetWidth||1,n=i.height/t.offsetHeight||1,o={x:(r.x-i.left-t.clientLeft)/s,y:(r.y-i.top-t.clientTop)/n};return{center:r,offsetCenter:o}}(e,t),preventDefault:()=>{e.srcEvent.preventDefault()},stopImmediatePropagation:null,stopPropagation:null,handled:!1,rootElement:t}}}class ${constructor(e=null,t={}){if(this._onBasicInput=e=>{this.manager.emit(e.srcEvent.type,e)},this._onOtherEvent=e=>{this.manager.emit(e.type,e)},this.options={recognizers:[],events:{},touchAction:"compute",tabIndex:0,cssProps:{},...t},this.events=new Map,this.element=e,!e)return;for(let t of(this.manager=new B(e,this.options),this.options.recognizers)){let{recognizer:e,recognizeWith:r,requireFailure:i}=function(e){let t;if("recognizer"in e)return e;let r=Array.isArray(e)?[...e]:[e];return{recognizer:t="function"==typeof r[0]?new(r.shift())(r.shift()||{}):r.shift(),recognizeWith:"string"==typeof r[0]?[r[0]]:r[0],requireFailure:"string"==typeof r[1]?[r[1]]:r[1]}}(t);this.manager.add(e),r&&e.recognizeWith(r),i&&e.requireFailure(i)}this.manager.on("hammer.input",this._onBasicInput),this.wheelInput=new k(e,this._onOtherEvent,{enable:!1}),this.moveInput=new V(e,this._onOtherEvent,{enable:!1}),this.keyInput=new W(e,this._onOtherEvent,{enable:!1,tabIndex:t.tabIndex}),this.contextmenuInput=new z(e,this._onOtherEvent,{enable:!1}),this.on(this.options.events)}getElement(){return this.element}destroy(){this.element&&(this.wheelInput.destroy(),this.moveInput.destroy(),this.keyInput.destroy(),this.contextmenuInput.destroy(),this.manager.destroy())}on(e,t,r){this._addEventHandler(e,t,r,!1)}once(e,t,r){this._addEventHandler(e,t,r,!0)}watch(e,t,r){this._addEventHandler(e,t,r,!1,!0)}off(e,t){this._removeEventHandler(e,t)}_toggleRecognizer(e,t){let{manager:r}=this;if(!r)return;let i=r.get(e);i&&(i.set({enable:t}),r.touchAction.update()),this.wheelInput?.enableEventType(e,t),this.moveInput?.enableEventType(e,t),this.keyInput?.enableEventType(e,t),this.contextmenuInput?.enableEventType(e,t)}_addEventHandler(e,t,r,i,s){if("string"!=typeof e){for(let[n,o]of(r=t,Object.entries(e)))this._addEventHandler(n,o,r,i,s);return}let{manager:n,events:o}=this;if(!n)return;let a=o.get(e);!a&&(a=new J(this,this._getRecognizerName(e)||e),o.set(e,a),n&&n.on(e,a.handleEvent)),a.add(e,t,r,i,s),a.isEmpty()||this._toggleRecognizer(a.recognizerName,!0)}_removeEventHandler(e,t){if("string"!=typeof e){for(let[t,r]of Object.entries(e))this._removeEventHandler(t,r);return}let{events:r}=this,i=r.get(e);if(i&&(i.remove(e,t),i.isEmpty())){let{recognizerName:e}=i,t=!1;for(let i of r.values())if(i.recognizerName===e&&!i.isEmpty()){t=!0;break}t||this._toggleRecognizer(e,!1)}}_getRecognizerName(e){return this.manager.recognizers.find(t=>t.getEventNames().includes(e))?.options.event}}},83003:(e,t,r)=>{r.d(t,{B:()=>s}),r(50947);var i=r(49509);function s(){return"object"==typeof i&&String(i),!0}},86043:(e,t,r)=>{r.d(t,{A:()=>i});class i{constructor(e){this._inProgress=!1,this._handle=null,this.time=0,this.settings={duration:0},this._timeline=e}get inProgress(){return this._inProgress}start(e){this.cancel(),this.settings=e,this._inProgress=!0,this.settings.onStart?.(this)}end(){this._inProgress&&(this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1,this.settings.onEnd?.(this))}cancel(){this._inProgress&&(this.settings.onInterrupt?.(this),this._timeline.removeChannel(this._handle),this._handle=null,this._inProgress=!1)}update(){if(!this._inProgress)return!1;if(null===this._handle){let{_timeline:e,settings:t}=this;this._handle=e.addChannel({delay:e.getTime(),duration:t.duration})}return this.time=this._timeline.getTime(this._handle),this._onUpdate(),this.settings.onUpdate?.(this),this._timeline.isFinished(this._handle)&&this.end(),!0}_onUpdate(){}}},89037:(e,t,r)=>{function i(e){let t=n[s[e]],r=e.includes("norm"),i=!r&&!e.startsWith("float"),o=e.startsWith("s");return{dataType:s[e],byteLength:t,integer:i,signed:o,normalized:r}}r.d(t,{l:()=>i});let s={uint8:"uint8",sint8:"sint8",unorm8:"uint8",snorm8:"sint8",uint16:"uint16",sint16:"sint16",unorm16:"uint16",snorm16:"sint16",float16:"float16",float32:"float32",uint32:"uint32",sint32:"sint32"},n={uint8:1,sint8:1,uint16:2,sint16:2,float16:2,float32:4,uint32:4,sint32:4}},89362:(e,t,r)=>{r.d(t,{pD:()=>n,iW:()=>s,hd:()=>o});var i=r(49509);function s(e){let t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(t+1):""}function n(e){let t=e?e.lastIndexOf("/"):-1;return t>=0?e.substr(0,t):""}function o(...e){let t;let r=[];for(let t=0;t<e.length;t++)r[t]=e[t];let s="",n=!1;for(let e=r.length-1;e>=-1&&!n;e--){let o;e>=0?o=r[e]:(void 0===t&&(t=function(){if(void 0!==i&&void 0!==i.cwd)return i.cwd();let e=window.location?.pathname;return e?.slice(0,e.lastIndexOf("/")+1)||""}()),o=t),0!==o.length&&(s=`${o}/${s}`,n=o.charCodeAt(0)===a)}return(s=function(e,t){let r,i="",s=-1,n=0,o=!1;for(let l=0;l<=e.length;++l){if(l<e.length)r=e.charCodeAt(l);else if(r===a)break;else r=a;if(r===a){if(s===l-1||1===n);else if(s!==l-1&&2===n){if(i.length<2||!o||46!==i.charCodeAt(i.length-1)||46!==i.charCodeAt(i.length-2)){if(i.length>2){let e=i.length-1,t=e;for(;t>=0&&i.charCodeAt(t)!==a;--t);if(t!==e){i=-1===t?"":i.slice(0,t),s=l,n=0,o=!1;continue}}else if(2===i.length||1===i.length){i="",s=l,n=0,o=!1;continue}}t&&(i.length>0?i+="/..":i="..",o=!0)}else{let t=e.slice(s+1,l);i.length>0?i+=`/${t}`:i=t,o=!1}s=l,n=0}else 46===r&&-1!==n?++n:n=-1}return i}(s,!n),n)?`/${s}`:s.length>0?s:"."}let a=47},90288:(e,t,r)=>{r.d(t,{d:()=>n});var i=r(7840);class s{stats=new Map;getStats(e){return this.get(e)}get(e){return this.stats.has(e)||this.stats.set(e,new i.Uz({id:e})),this.stats.get(e)}}let n=new s},91852:(e,t,r)=>{r.d(t,{b:()=>function e(t,r,i){if(t===r)return!0;if(!i||!t||!r)return!1;if(Array.isArray(t)){if(!Array.isArray(r)||t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(!e(t[s],r[s],i-1))return!1;return!0}if(Array.isArray(r))return!1;if("object"==typeof t&&"object"==typeof r){let s=Object.keys(t),n=Object.keys(r);if(s.length!==n.length)return!1;for(let n of s)if(!r.hasOwnProperty(n)||!e(t[n],r[n],i-1))return!1;return!0}return!1}})},95694:(e,t,r)=>{r.d(t,{eh:()=>s,gM:()=>n,x:()=>i});let i=globalThis;globalThis.document;let s=globalThis.process||{};globalThis.console;let n=globalThis.navigator||{}},96898:(e,t,r)=>{r.d(t,{k:()=>o});var i={centimeters:0x25f96350,centimetres:0x25f96350,degrees:360/(2*Math.PI),feet:20902260.511392,inches:250826616.45599997,kilometers:6371.0088,kilometres:6371.0088,meters:6371008.8,metres:6371008.8,miles:3958.761333810546,millimeters:0x17bbde120,millimetres:0x17bbde120,nauticalmiles:6371008.8/1852,radians:1,yards:6967335.223679999};function s(e,t,r={}){let i={type:"Feature"};return(0===r.id||r.id)&&(i.id=r.id),r.bbox&&(i.bbox=r.bbox),i.properties=t||{},i.geometry=e,i}function n(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}function o(e,t={}){let r=Number(e[0]),i=Number(e[1]),n=Number(e[2]),a=Number(e[3]);if(6===e.length)throw Error("@turf/bbox-polygon does not support BBox with 6 positions");let l=[r,i],h=[r,a],u=[n,a];return function(e,t,r={}){for(let t of e){if(t.length<4)throw Error("Each LinearRing of a Polygon must have 4 or more Positions.");if(t[t.length-1].length!==t[0].length)throw Error("First and last Position are not equivalent.");for(let e=0;e<t[t.length-1].length;e++)if(t[t.length-1][e]!==t[0][e])throw Error("First and last Position are not equivalent.")}return s({type:"Polygon",coordinates:e},t,r)}([[l,[n,i],u,h,l]],t.properties,{bbox:e,id:t.id})}},98127:(e,t,r)=>{r.d(t,{Lr:()=>n});var i={centimeters:0x25f96350,centimetres:0x25f96350,degrees:360/(2*Math.PI),feet:20902260.511392,inches:250826616.45599997,kilometers:6371.0088,kilometres:6371.0088,meters:6371008.8,metres:6371008.8,miles:3958.761333810546,millimeters:0x17bbde120,millimetres:0x17bbde120,nauticalmiles:6371008.8/1852,radians:1,yards:6967335.223679999};function s(e,t,r={}){let i={type:"Feature"};return(0===r.id||r.id)&&(i.id=r.id),r.bbox&&(i.bbox=r.bbox),i.properties=t||{},i.geometry=e,i}function n(e,t={}){let r={type:"FeatureCollection"};return t.id&&(r.id=t.id),t.bbox&&(r.bbox=t.bbox),r.features=e,r}function o(e){return!isNaN(e)&&null!==e&&!Array.isArray(e)}}}]);